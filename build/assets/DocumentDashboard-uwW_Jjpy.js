import{G as B,j as e,r as d,k as m,A as C}from"./index-Dez6KUd-.js";import{T as D}from"./index-S9id1eOl.js";import{b as N}from"./isNil-BmBjv-9t.js";import{u as w,F as k,a as i,C as l}from"./index.esm-Mqip62yg.js";import{t as I,z as c}from"./index-iaQszn4l.js";import{M as K,T as U}from"./index.esm-CF5MQHYB.js";import{B as E}from"./Button-C_RkUkak.js";import{C as A}from"./Card-BHEfUViY.js";import{I as x}from"./Input-DRq-Gvwf.js";import{S as O}from"./Select-UesnTE9m.js";import{m as R}from"./index-Ds9HCm5F.js";import{c as L}from"./TextField-OkNoTz_W.js";import{I as P}from"./Autocomplete-DPH7sKEm.js";import"./useControllableState-R3jTFqjd.js";import"./classNames-Df3Pfdyt.js";import"./index-BVSbkZMk.js";import"./DefaultPropsProvider-DNq-LJgg.js";import"./FormControlLabel-CePI-8g0.js";import"./Divider-D0qqVSxz.js";import"./index-DVa26zf9.js";import"./floating-ui.dom-CrKScG7J.js";function H(r){return B({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M512 1024c-69.1 0-136.2-13.5-199.3-40.2C251.7 958 197 921 150 874c-47-47-84-101.7-109.8-162.7C13.5 648.2 0 581.1 0 512c0-19.9 16.1-36 36-36s36 16.1 36 36c0 59.4 11.6 117 34.6 171.3 22.2 52.4 53.9 99.5 94.3 139.9 40.4 40.4 87.5 72.2 139.9 94.3C395 940.4 452.6 952 512 952c59.4 0 117-11.6 171.3-34.6 52.4-22.2 99.5-53.9 139.9-94.3 40.4-40.4 72.2-87.5 94.3-139.9C940.4 629 952 571.4 952 512c0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.2C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3s-13.5 136.2-40.2 199.3C958 772.3 921 827 874 874c-47 47-101.8 83.9-162.7 109.7-63.1 26.8-130.2 40.3-199.3 40.3z"},child:[]}]})(r)}const V=L(e.jsx("path",{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2m-1 8V6h2v4h3l-4 4-4-4zm6 7H7v-2h10z"}),"DownloadForOffline"),q=c.object({title:c.string().min(3,"Title must be at least 3 characters"),documentType:c.enum(["Notification","Minutes of Meeting"],{required_error:"Select a document type"}),file:c.instanceof(File,{message:"Must be a valid file"}).optional(),document_date:c.string().min(1,{message:"Document Date is required!"})}),G=()=>{var b,j,v,y,T;const[r,u]=d.useState([]),[p,s]=d.useState(!1),f=m(t=>t.user.district_id)||null;m(t=>t.user.district_name);const{handleSubmit:_,control:n,setValue:X,reset:M,formState:{errors:o,isSubmitting:g}}=w({resolver:I(q),defaultValues:{title:"",documentType:"Notification",file:null}}),h=()=>{s(!0),C.get("/pmc/district-documents/").then(t=>u(t.data)).catch(t=>console.error("Error fetching documents:",t)).finally(()=>s(!1))};d.useEffect(()=>{h()},[]);const S=async t=>{const a=new FormData;a.append("district_id",(f==null?void 0:f.toString())||"0"),a.append("document_type",t.documentType),a.append("title",t.title),a.append("document",t.file),t.document_date&&a.append("document_date",t.document_date);try{await C.post("/pmc/district-documents/",a,{headers:{"Content-Type":"multipart/form-data"}}),alert("Document uploaded successfully!"),h(),M()}catch(z){console.error("Error uploading document:",z),alert("Failed to upload document.")}},F=[{accessorKey:"district_name",header:"District",size:200},{accessorKey:"document_type",header:"Type",size:150},{accessorKey:"title",header:"Title",size:300},{accessorKey:"document_date",header:"Document Date",size:200},{accessorKey:"uploaded_at",header:"Uploaded On",size:200},{accessorKey:"uploaded_by_name",header:"Uploaded By",size:200},{accessorKey:"file",header:"Download",size:80,Cell:({row:t})=>{const a=()=>{if(!t.original.document){alert("File not available!");return}window.open(t.original.document,"_blank","noopener,noreferrer")};return e.jsx(U,{title:"Download Document",children:e.jsxs(P,{onClick:a,sx:{background:"linear-gradient(135deg, #007BFF, #0056b3)",color:"#fff",padding:"6px",borderRadius:"8px",transition:"0.3s ease-in-out","&:hover":{background:"linear-gradient(135deg, #0056b3, #007BFF)",transform:"scale(1.05)"}},children:[e.jsx(V,{fontSize:"medium"})," "]})})}}];return e.jsxs(A,{children:[e.jsx(k,{onSubmit:_(S),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(i,{label:"Document Title",invalid:!!o.title,errorMessage:(b=o.title)==null?void 0:b.message,children:e.jsx(l,{name:"title",control:n,render:({field:t})=>e.jsx(x,{...t,placeholder:"Enter document title"})})}),e.jsx(i,{label:"Document Type",invalid:!!o.documentType,errorMessage:(j=o.documentType)==null?void 0:j.message,children:e.jsx(l,{name:"documentType",control:n,render:({field:t})=>e.jsx(O,{options:[{label:"Notification",value:"Notification"},{label:"Minutes of Meeting",value:"Minutes of Meeting"}],value:{label:t.value,value:t.value},onChange:a=>t.onChange(a==null?void 0:a.value)})})}),e.jsx(i,{label:"Document Date",invalid:!!o.document_date,errorMessage:(v=o.document_date)==null?void 0:v.message,children:e.jsx(l,{name:"document_date",control:n,render:({field:t})=>e.jsx(x,{type:"date",...t})})}),e.jsx(i,{label:"Upload File",invalid:!!o.file,errorMessage:(y=o.file)==null?void 0:y.message,children:e.jsx(l,{name:"file",control:n,render:({field:t})=>e.jsx(x,{type:"file",accept:".pdf,.png,.jpg,.jpeg,.doc,.docx,.xls,.xlsx",onChange:a=>t.onChange(a.target.files[0])})})}),e.jsx(i,{className:"mt-7",invalid:!!o.file,errorMessage:(T=o.file)==null?void 0:T.message,children:e.jsx(l,{name:"button",control:n,render:({field:t})=>e.jsxs(E,{disabled:g,className:"flex items-center",children:[g?e.jsx(H,{className:"mr-2 animate-spin"}):e.jsx(R,{className:"mr-2"}),g?"Uploading...":"Upload"]})})})]})}),p?e.jsx("p",{children:"Loading documents..."}):e.jsx(K,{columns:F,data:r,enablePagination:!0,muiTableHeadCellProps:{sx:{backgroundColor:"#f5f5f5",fontWeight:"bold",borderBottom:"2px solid #ccc",textAlign:"center"}},muiTableBodyCellProps:{sx:{borderRight:"1px solid #ddd",padding:"10px"}},muiTableBodyRowProps:{sx:{"&:nth-of-type(even)":{backgroundColor:"#f9f9f9"},"&:hover":{backgroundColor:"#e0f7fa"}}}})]})},{TabNav:Q,TabList:W,TabContent:J}=D,be=()=>{const[r,u]=d.useState("tab1");m(s=>s.user.district_id);const p=m(s=>s.user.district_name)||"";return e.jsx("div",{children:e.jsxs(D,{value:r,onChange:u,children:[e.jsx(W,{children:e.jsxs(Q,{value:"tab1",icon:e.jsx(N,{}),children:["Manage Documents for District: ",p]})}),e.jsx("div",{className:"p-4",children:e.jsx(J,{value:"tab1",children:e.jsx(G,{})})})]})})};export{be as default};
