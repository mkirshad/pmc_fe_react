import{r as w,A as Oe,j as l,Z as ye,i as xt,a2 as ut,W as _t,a0 as St}from"./index-Z3AMMw6i.js";import{B as Ge}from"./Button-DEcr4Lyu.js";import{f as bt,t as Ct,N as wt}from"./toast-By-QWdLc.js";import{u as dt,b as re,a as U,C as K,F as Ft}from"./index.esm-DT7ByJX7.js";import{C as Dt,S as He,a as pe,B as jt}from"./index-BnJx29vN.js";import{I as z}from"./Input-BTTkjljJ.js";import{e as Et,p as Tt,g as Rt,s as Pt,h as Nt,R as Bt,a as Ue,b as Pe,i as Ze,j as Ye,k as Je,E as ze,l as ee,m as Ae,d as Ke,P as qe,n as Te,o as fe,q as te,r as Xe,u as X,v as Ne,w as It,x as At,y as Mt,z as We,A as Vt,B as kt,D as Lt,H as Ot,I as Gt,f as Me,S as Qe,C as Ut,c as et,F as Kt,M as qt,V as Wt,T as $t,O as Ht,J as Zt,t as Yt,G as Jt}from"./terraformer-wkt-parser-B6ApZ7Sk.js";import{A as zt,C as Xt}from"./Autocomplete-CA8xedQ7.js";import{T as Qt}from"./TextField-B_hTQ67S.js";import{t as en,z as T}from"./index-BQV0IoRK.js";import{C as tn}from"./ConfirmDialog-DowCiGmJ.js";import{B as nn}from"./index-CSc8RSoT.js";import{u as rn}from"./useInspectionStore-CXOrAggV.js";import"./classNames-Pyc_Rw3e.js";import"./StatusIcon-Bdn0BqBl.js";import"./CloseButton-Bp-GO2Xj.js";import"./index-DkB6Qy6j.js";import"./DefaultPropsProvider-DyzT5a-w.js";import"./index-DgWlW6s7.js";import"./index-CRXjwTRT.js";import"./index-xuGNkjNg.js";import"./_getPrototype-CluAxyKH.js";const tt=0,Se=1,nt=[0,0,0,0],xe=[],Ve={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class ke extends Lt{constructor(e,n,r){super(e),this.features=n,this.mapBrowserEvent=r}}class an extends Et{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Tt,this.defaultDeleteCondition_=function(r){return Rt(r)&&Pt(r)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Nt,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Bt,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ue({source:new Pe({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:on(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let n;if(e.features?n=e.features:e.source&&(this.source_=e.source,n=new Ze(this.source_.getFeatures()),this.source_.addEventListener(Ye.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Ye.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!n)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=n,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Je.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Je.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const n=e.getGeometry();if(n){const i=this.SEGMENT_WRITERS_[n.getType()];i&&i(e,n)}const r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(r.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(ze.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,n){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Ze;const r=this.featuresBeingModified_.getArray();for(let i=0,a=n.length;i<a;++i){const s=n[i].feature;s&&!r.includes(s)&&this.featuresBeingModified_.push(s)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new ke(Ve.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(ze.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const n=this.rBush_,r=[];n.forEach(function(i){e===i.feature&&r.push(i)});for(let i=r.length-1;i>=0;--i){const a=r[i];for(let s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===a&&this.dragSegments_.splice(s,1);n.remove(a)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const n=e.target;this.removeFeature_(n),this.addFeature_(n)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,n){const r=n.getCoordinates(),i={feature:e,geometry:n,segment:[r,r]};this.rBush_.insert(n.getExtent(),i)}writeMultiPointGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i],o={feature:e,geometry:n,depth:[i],index:i,segment:[s,s]};this.rBush_.insert(n.getExtent(),o)}}writeLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length-1;i<a;++i){const s=r.slice(i,i+2),o={feature:e,geometry:n,index:i,segment:s};this.rBush_.insert(ee(s),o)}}writeMultiLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,c=s.length-1;o<c;++o){const p=s.slice(o,o+2),u={feature:e,geometry:n,depth:[i],index:o,segment:p};this.rBush_.insert(ee(p),u)}}}writePolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,c=s.length-1;o<c;++o){const p=s.slice(o,o+2),u={feature:e,geometry:n,depth:[i],index:o,segment:p};this.rBush_.insert(ee(p),u)}}}writeMultiPolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,c=s.length;o<c;++o){const p=s[o];for(let u=0,x=p.length-1;u<x;++u){const d=p.slice(u,u+2),h={feature:e,geometry:n,depth:[o,i],index:u,segment:d};this.rBush_.insert(ee(d),h)}}}}writeCircleGeometry_(e,n){const r=n.getCenter(),i={feature:e,geometry:n,index:tt,segment:[r,r]},a={feature:e,geometry:n,index:Se,segment:[r,r]},s=[i,a];i.featureSegments=s,a.featureSegments=s,this.rBush_.insert(Ae(r),i);let o=n;this.rBush_.insert(o.getExtent(),a)}writeGeometryCollectionGeometry_(e,n){const r=n.getGeometriesArray();for(let i=0;i<r.length;++i){const a=r[i],s=this.SEGMENT_WRITERS_[a.getType()];s(e,a)}}createOrUpdateVertexFeature_(e,n,r,i){let a=this.vertexFeature_;return a?a.getGeometry().setCoordinates(e):(a=new Ke(new qe(e)),this.vertexFeature_=a,this.overlay_.getSource().addFeature(a)),a.set("features",n),a.set("geometries",r),a.set("existing",i),a}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let n;return!e.map.getView().getInteracting()&&e.type==Te.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Te.SINGLECLICK||!this.ignoreNextSingleClick_?n=this.removePoint():n=!0),e.type==Te.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!n}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(!n)return;this.getMap().getView().getProjection();const r=[],i=n.getGeometry().getCoordinates(),a=ee([i]),s=this.rBush_.getInExtent(a),o={};s.sort(sn);for(let c=0,p=s.length;c<p;++c){const u=s[c],x=u.segment;let d=fe(u.geometry);const h=u.depth;if(h&&(d+="-"+h.join("-")),o[d]||(o[d]=new Array(2)),u.geometry.getType()==="Circle"&&u.index===Se){const m=it(e,u);te(m,i)&&!o[d][0]&&(this.dragSegments_.push([u,0]),o[d][0]=u);continue}if(te(x[0],i)&&!o[d][0]){this.dragSegments_.push([u,0]),o[d][0]=u;continue}if(te(x[1],i)&&!o[d][1]){if(o[d][0]&&o[d][0].index===0){let m=u.geometry.getCoordinates();switch(u.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":m=m[h[1]];case"Polygon":if(u.index!==m[h[0]].length-2)continue;break}}this.dragSegments_.push([u,1]),o[d][1]=u;continue}fe(x)in this.vertexSegments_&&!o[d][0]&&!o[d][1]&&r.push(u)}return r}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([a])=>a));const n=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],i=[];for(let a=0,s=this.dragSegments_.length;a<s;++a){const o=this.dragSegments_[a],c=o[0],p=c.feature;r.includes(p)||r.push(p);const u=c.geometry;i.includes(u)||i.push(u);const x=c.depth;let d;const h=c.segment,m=o[1];for(;n.length<u.getStride();)n.push(h[m][n.length]);switch(u.getType()){case"Point":d=n,h[0]=n,h[1]=n;break;case"MultiPoint":d=u.getCoordinates(),d[c.index]=n,h[0]=n,h[1]=n;break;case"LineString":d=u.getCoordinates(),d[c.index+m]=n,h[m]=n;break;case"MultiLineString":d=u.getCoordinates(),d[x[0]][c.index+m]=n,h[m]=n;break;case"Polygon":d=u.getCoordinates(),d[x[0]][c.index+m]=n,h[m]=n;break;case"MultiPolygon":d=u.getCoordinates(),d[x[1]][x[0]][c.index+m]=n,h[m]=n;break;case"Circle":const _=u;if(h[0]=n,h[1]=n,c.index===tt)this.changingFeature_=!0,_.setCenter(n),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let b=Xe(X(_.getCenter()),X(n));_.setRadius(b),this.changingFeature_=!1}break}d&&this.setGeometryCoordinates_(u,d)}this.createOrUpdateVertexFeature_(n,r,i,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const n=e.coordinate,r=this.findInsertVerticesAndUpdateDragSegments_(n);if(r!=null&&r.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,r),this.vertexFeature_)){const i=this.vertexFeature_.getGeometry().getCoordinates();for(let a=r.length-1;a>=0;--a)this.insertVertex_(r[a],i);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let n=this.dragSegments_.length-1;n>=0;--n){const r=this.dragSegments_[n][0],i=r.geometry;if(i.getType()==="Circle"){const a=i,s=a.getCenter(),o=r.featureSegments[0],c=r.featureSegments[1];o.segment[0]=s,o.segment[1]=s,c.segment[0]=s,c.segment[1]=s,this.rBush_.update(Ae(s),o);let p=a;this.rBush_.update(p.getExtent(),c)}else this.rBush_.update(ee(r.segment),r)}return this.featuresBeingModified_&&(this.dispatchEvent(new ke(Ve.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const n=this.getMap(),r=n.getPixelFromCoordinate(e);n.getView().getProjection();const i=function(o,c){return rt(e,o)-rt(e,c)};let a,s;if(this.hitDetection_){const o=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;n.forEachFeatureAtPixel(r,(c,p,u)=>{u&&u.getType()==="Point"&&(u=new qe(Ne(u.getCoordinates())));const x=u||c.getGeometry();if(x&&x.getType()==="Point"&&c instanceof Ke&&this.features_.getArray().includes(c)){s=x;const d=c.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:c,geometry:s,segment:[d,d]}]}return!0},{layerFilter:o})}if(!a){const o=It(Ae(e,nt)),c=n.getView().getResolution()*this.pixelTolerance_,p=At(Mt(o,c,nt));a=this.rBush_.getInExtent(p)}if(a&&a.length>0){const o=a.sort(i)[0],c=o.segment;let p=it(e,o);const u=n.getPixelFromCoordinate(p);let x=Xe(r,u);if(s||x<=this.pixelTolerance_){const d={};if(d[fe(c)]=!0,this.snapToPointer_||(this.delta_[0]=p[0]-e[0],this.delta_[1]=p[1]-e[1]),o.geometry.getType()==="Circle"&&o.index===Se)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(p,[o.feature],[o.geometry],this.snappedToVertex_);else{const h=n.getPixelFromCoordinate(c[0]),m=n.getPixelFromCoordinate(c[1]),_=We(u,h),b=We(u,m);if(x=Math.sqrt(Math.min(_,b)),this.snappedToVertex_=x<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(p=_>b?c[1]:c[0]),this.createOrUpdateVertexFeature_(p,[o.feature],[o.geometry],this.snappedToVertex_);const f={};f[fe(o.geometry)]=!0;for(let E=1,P=a.length;E<P;++E){const M=a[E].segment;if(te(c[0],M[0])&&te(c[1],M[1])||te(c[0],M[1])&&te(c[1],M[0])){const A=fe(a[E].geometry);A in f||(f[A]=!0,d[fe(M)]=!0)}else break}}this.vertexSegments_=d;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,n){const r=e.segment,i=e.feature,a=e.geometry,s=e.depth,o=e.index;let c;for(;n.length<a.getStride();)n.push(0);switch(a.getType()){case"MultiLineString":c=a.getCoordinates(),c[s[0]].splice(o+1,0,n);break;case"Polygon":c=a.getCoordinates(),c[s[0]].splice(o+1,0,n);break;case"MultiPolygon":c=a.getCoordinates(),c[s[1]][s[0]].splice(o+1,0,n);break;case"LineString":c=a.getCoordinates(),c.splice(o+1,0,n);break;default:return!1}this.setGeometryCoordinates_(a,c);const p=this.rBush_;p.remove(e),this.updateSegmentIndices_(a,o,s,1);const u={segment:[r[0],n],feature:i,geometry:a,depth:s,index:o};p.insert(ee(u.segment),u),this.dragSegments_.push([u,1]);const x={segment:[n,r[1]],feature:i,geometry:a,depth:s,index:o+1};return p.insert(ee(x.segment),x),this.dragSegments_.push([x,0]),!0}updatePointer_(e){var n;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates()}getPoint(){var n;const e=(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates();return e?Ne(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(ee([e])).some(({segment:r})=>te(r[0],e)||te(r[1],e))}removePoint(e){if(e&&(e=X(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=Te.POINTERDRAG){const n=this.lastPointerEvent_;this.willModifyFeatures_(n,this.dragSegments_.map(([i])=>i));const r=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new ke(Ve.MODIFYEND,this.featuresBeingModified_,n)),this.featuresBeingModified_=null,r}return!1}removeVertex_(){const e=this.dragSegments_,n={};let r=!1,i,a,s,o,c,p,u,x,d,h,m;for(c=e.length-1;c>=0;--c)s=e[c],h=s[0],m=fe(h.feature),h.depth&&(m+="-"+h.depth.join("-")),m in n||(n[m]={}),s[1]===0?(n[m].right=h,n[m].index=h.index):s[1]==1&&(n[m].left=h,n[m].index=h.index+1);for(m in n){switch(d=n[m].right,u=n[m].left,p=n[m].index,x=p-1,u!==void 0?h=u:h=d,x<0&&(x=0),o=h.geometry,a=o.getCoordinates(),i=a,r=!1,o.getType()){case"MultiLineString":a[h.depth[0]].length>2&&(a[h.depth[0]].splice(p,1),r=!0);break;case"LineString":a.length>2&&(a.splice(p,1),r=!0);break;case"MultiPolygon":i=i[h.depth[1]];case"Polygon":i=i[h.depth[0]],i.length>4&&(p==i.length-1&&(p=0),i.splice(p,1),r=!0,p===0&&(i.pop(),i.push(i[0]),x=i.length-1));break}if(r){this.setGeometryCoordinates_(o,a);const _=[];if(u!==void 0&&(this.rBush_.remove(u),_.push(u.segment[0])),d!==void 0&&(this.rBush_.remove(d),_.push(d.segment[1])),u!==void 0&&d!==void 0){const b={depth:h.depth,feature:h.feature,geometry:h.geometry,index:x,segment:_};this.rBush_.insert(ee(b.segment),b)}this.updateSegmentIndices_(o,p,h.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return r}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(ee([e])).some(({segment:r})=>!(te(r[0],e)||te(r[1],e)))}insertPoint(e){var i;const n=e?X(e,this.getMap().getView().getProjection()):(i=this.vertexFeature_)==null?void 0:i.getGeometry().getCoordinates();return n?this.findInsertVerticesAndUpdateDragSegments_(n).reduce((a,s)=>a||this.insertVertex_(s,n),!1):!1}setGeometryCoordinates_(e,n){this.changingFeature_=!0,e.setCoordinates(n),this.changingFeature_=!1}updateSegmentIndices_(e,n,r,i){this.rBush_.forEachInExtent(e.getExtent(),function(a){a.geometry===e&&(r===void 0||a.depth===void 0||Vt(a.depth,r))&&a.index>n&&(a.index+=i)})}}function sn(t,e){return t.index-e.index}function rt(t,e,n){const r=e.geometry;if(r.getType()==="Circle"){let a=r;if(e.index===Se){const s=We(a.getCenter(),X(t)),o=Math.sqrt(s)-a.getRadius();return o*o}}const i=X(t);return xe[0]=X(e.segment[0]),xe[1]=X(e.segment[1]),Gt(i,xe)}function it(t,e,n){const r=e.geometry;if(r.getType()==="Circle"&&e.index===Se)return Ne(r.getClosestPoint(X(t)));const i=X(t);return xe[0]=X(e.segment[0]),xe[1]=X(e.segment[1]),Ne(Ot(i,xe))}function on(){const t=kt();return function(e,n){return t.Point}}const ln=({onLocationSelect:t})=>{const e=w.useRef(null),[n,r]=w.useState(null),[i,a]=w.useState(null),[s,o]=w.useState("Fetching..."),[c,p]=w.useState(null),[u,x]=w.useState({lat:null,lng:null});w.useEffect(()=>{const _=new Pe,b=new Pe,f=new Ke({geometry:new qe(Me([74.3436,31.5497]))});f.setStyle(new Qe({image:new Ut({radius:7,fill:new Kt({color:"red"}),stroke:new et({color:"white",width:2})})})),b.addFeature(f),a(f);const E=new Ue({source:b}),P=new Ue({source:_,style:new Qe({stroke:new et({color:"blue",width:2})})}),M=new qt({target:e.current,layers:[new $t({source:new Ht}),P,E],view:new Wt({center:Me([74.3436,31.5497]),zoom:12})});r(M),p(P),m(P),d(M,f);const A=new an({source:b});return M.addInteraction(A),A.on("modifyend",Y=>{const H=Y.features.item(0).getGeometry().getCoordinates(),D=Zt(H);x({lat:D[1],lng:D[0]}),h(D[0],D[1])}),()=>M.setTarget(null)},[]);const d=(_,b)=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(f=>{const E=Me([f.coords.longitude,f.coords.latitude]);b.getGeometry().setCoordinates(E),_.getView().setCenter(E),_.getView().setZoom(15),h(f.coords.longitude,f.coords.latitude)},f=>console.error("Geolocation error:",f),{enableHighAccuracy:!0})},h=async(_,b)=>{try{t({lat:b,lng:_,district:""});const f=await Oe.get(`/pmc/DistrictByLatLon?lat=${b}&lon=${_}`);f.data&&f.data.district_name?(o(f.data.district_name),t({lat:b,lng:_,district:f.data.district_name})):o("District not found")}catch(f){console.error("Error fetching district:",f),o("Error fetching district")}},m=async _=>{try{const P={type:"FeatureCollection",features:(await Oe.get("/pmc/districts-public")).data.filter(A=>A.geom).map(A=>({type:"Feature",geometry:Yt.parse(A.geom.replace("SRID=4326;","")),properties:{district_id:A.district_id,district_name:A.district_name}}))},M=new Pe({features:new Jt().readFeatures(P,{featureProjection:"EPSG:3857"})});_.setSource(M)}catch(b){console.error("Error fetching district boundaries:",b)}};return l.jsxs("div",{children:[l.jsx("div",{ref:e,style:{height:"600px",width:"100%"}}),l.jsx("button",{type:"button",onClick:()=>d(n,i),style:{marginTop:"10px",padding:"10px",backgroundColor:"#007BFF",color:"#fff",border:"none",cursor:"pointer",borderRadius:"5px"},children:"📍 Go to Current Location"})]})};function ft(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}var be;(function(t){t.event="event",t.props="prop"})(be||(be={}));function ce(){}function cn(t){var e,n=void 0;return function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e&&r.length===e.length&&r.every(function(a,s){return a===e[s]})||(e=r,n=t.apply(void 0,r)),n}}function Ce(t){return!!(t||"").match(/\d/)}function _e(t){return t==null}function un(t){return typeof t=="number"&&isNaN(t)}function gt(t){return _e(t)||un(t)||typeof t=="number"&&!isFinite(t)}function ht(t){return t.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function dn(t){switch(t){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;case"thousand":default:return/(\d)(?=(\d{3})+(?!\d))/g}}function fn(t,e,n){var r=dn(n),i=t.search(/[1-9]/);return i=i===-1?t.length:i,t.substring(0,i)+t.substring(i,t.length).replace(r,"$1"+e)}function gn(t){var e=w.useRef(t);e.current=t;var n=w.useRef(function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e.current.apply(e,r)});return n.current}function $e(t,e){e===void 0&&(e=!0);var n=t[0]==="-",r=n&&e;t=t.replace("-","");var i=t.split("."),a=i[0],s=i[1]||"";return{beforeDecimal:a,afterDecimal:s,hasNegation:n,addNegation:r}}function hn(t){if(!t)return t;var e=t[0]==="-";e&&(t=t.substring(1,t.length));var n=t.split("."),r=n[0].replace(/^0+/,"")||"0",i=n[1]||"";return(e?"-":"")+r+(i?"."+i:"")}function mt(t,e,n){for(var r="",i=n?"0":"",a=0;a<=e-1;a++)r+=t[a]||i;return r}function at(t,e){return Array(e+1).join(t)}function vt(t){var e=t+"",n=e[0]==="-"?"-":"";n&&(e=e.substring(1));var r=e.split(/[eE]/g),i=r[0],a=r[1];if(a=Number(a),!a)return n+i;i=i.replace(".","");var s=1+a,o=i.length;return s<0?i="0."+at("0",Math.abs(s))+i:s>=o?i=i+at("0",s-o):i=(i.substring(0,s)||"0")+"."+i.substring(s),n+i}function st(t,e,n){if(["","-"].indexOf(t)!==-1)return t;var r=(t.indexOf(".")!==-1||n)&&e,i=$e(t),a=i.beforeDecimal,s=i.afterDecimal,o=i.hasNegation,c=parseFloat("0."+(s||"0")),p=s.length<=e?"0."+s:c.toFixed(e),u=p.split("."),x=a;a&&Number(u[0])&&(x=a.split("").reverse().reduce(function(_,b,f){return _.length>f?(Number(_[0])+Number(b)).toString()+_.substring(1,_.length):b+_},u[0]));var d=mt(u[1]||"",e,n),h=o?"-":"",m=r?".":"";return""+h+x+m+d}function ge(t,e){if(t.value=t.value,t!==null){if(t.createTextRange){var n=t.createTextRange();return n.move("character",e),n.select(),!0}return t.selectionStart||t.selectionStart===0?(t.focus(),t.setSelectionRange(e,e),!0):(t.focus(),!1)}}var pt=cn(function(t,e){for(var n=0,r=0,i=t.length,a=e.length;t[n]===e[n]&&n<i;)n++;for(;t[i-1-r]===e[a-1-r]&&a-r>n&&i-r>n;)r++;return{from:{start:n,end:i-r},to:{start:n,end:a-r}}}),mn=function(t,e){var n=Math.min(t.selectionStart,e);return{from:{start:n,end:t.selectionEnd},to:{start:n,end:e}}};function vn(t,e,n){return Math.min(Math.max(t,e),n)}function Le(t){return Math.max(t.selectionStart,t.selectionEnd)}function pn(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function yn(t){return{from:{start:0,end:0},to:{start:0,end:t.length},lastValue:""}}function xn(t){var e=t.currentValue,n=t.formattedValue,r=t.currentValueIndex,i=t.formattedValueIndex;return e[r]===n[i]}function _n(t,e,n,r,i,a,s){s===void 0&&(s=xn);var o=i.findIndex(function(M){return M}),c=t.slice(0,o);!e&&!n.startsWith(c)&&(e=c,n=c+n,r=r+c.length);for(var p=n.length,u=t.length,x={},d=new Array(p),h=0;h<p;h++){d[h]=-1;for(var m=0,_=u;m<_;m++){var b=s({currentValue:n,lastValue:e,formattedValue:t,currentValueIndex:h,formattedValueIndex:m});if(b&&x[m]!==!0){d[h]=m,x[m]=!0;break}}}for(var f=r;f<p&&(d[f]===-1||!a(n[f]));)f++;var E=f===p||d[f]===-1?u:d[f];for(f=r-1;f>0&&d[f]===-1;)f--;var P=f===-1||d[f]===-1?0:d[f]+1;return P>E?E:r-P<E-r?P:E}function ot(t,e,n,r){var i=t.length;if(e=vn(e,0,i),r==="left"){for(;e>=0&&!n[e];)e--;e===-1&&(e=n.indexOf(!0))}else{for(;e<=i&&!n[e];)e++;e>i&&(e=n.lastIndexOf(!0))}return e===-1&&(e=i),e}function Sn(t){for(var e=Array.from({length:t.length+1}).map(function(){return!0}),n=0,r=e.length;n<r;n++)e[n]=!!(Ce(t[n])||Ce(t[n-1]));return e}function yt(t,e,n,r,i,a){a===void 0&&(a=ce);var s=gn(function(m,_){var b,f;return gt(m)?(f="",b=""):typeof m=="number"||_?(f=typeof m=="number"?vt(m):m,b=r(f)):(f=i(m,void 0),b=r(f)),{formattedValue:b,numAsString:f}}),o=w.useState(function(){return s(_e(t)?e:t,n)}),c=o[0],p=o[1],u=function(m,_){m.formattedValue!==c.formattedValue&&p({formattedValue:m.formattedValue,numAsString:m.value}),a(m,_)},x=t,d=n;_e(t)&&(x=c.numAsString,d=!0);var h=s(x,d);return w.useMemo(function(){p(h)},[h.formattedValue]),[c,u]}function bn(t){return t.replace(/[^0-9]/g,"")}function Cn(t){return t}function wn(t){var e=t.type;e===void 0&&(e="text");var n=t.displayType;n===void 0&&(n="input");var r=t.customInput,i=t.renderText,a=t.getInputRef,s=t.format;s===void 0&&(s=Cn);var o=t.removeFormatting;o===void 0&&(o=bn);var c=t.defaultValue,p=t.valueIsNumericString,u=t.onValueChange,x=t.isAllowed,d=t.onChange;d===void 0&&(d=ce);var h=t.onKeyDown;h===void 0&&(h=ce);var m=t.onMouseUp;m===void 0&&(m=ce);var _=t.onFocus;_===void 0&&(_=ce);var b=t.onBlur;b===void 0&&(b=ce);var f=t.value,E=t.getCaretBoundary;E===void 0&&(E=Sn);var P=t.isValidInputCharacter;P===void 0&&(P=Ce);var M=t.isCharacterSame,A=ft(t,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),Y=yt(f,c,!!p,s,o,u),H=Y[0],D=H.formattedValue,q=H.numAsString,W=Y[1],J=w.useRef(),ne=w.useRef({formattedValue:D,numAsString:q}),Q=function(v,y){ne.current={formattedValue:v.formattedValue,numAsString:v.value},W(v,y)},Z=w.useState(!1),ue=Z[0],j=Z[1],F=w.useRef(null),B=w.useRef({setCaretTimeout:null,focusTimeout:null});w.useEffect(function(){return j(!0),function(){clearTimeout(B.current.setCaretTimeout),clearTimeout(B.current.focusTimeout)}},[]);var L=s,O=function(v,y){var C=parseFloat(y);return{formattedValue:v,value:y,floatValue:isNaN(C)?void 0:C}},V=function(v,y,C){v.selectionStart===0&&v.selectionEnd===v.value.length||(ge(v,y),B.current.setCaretTimeout=setTimeout(function(){v.value===C&&v.selectionStart!==y&&ge(v,y)},0))},G=function(v,y,C){return ot(v,y,E(v),C)},ie=function(v,y,C){var R=E(y),$=_n(y,D,v,C,R,P,M);return $=ot(y,$,R),$},he=function(v){var y=v.formattedValue;y===void 0&&(y="");var C=v.input,R=v.source,$=v.event,k=v.numAsString,I;if(C){var ae=v.inputValue||C.value,oe=Le(C);C.value=y,I=ie(ae,y,oe),I!==void 0&&V(C,I,y)}y!==D&&Q(O(y,k),{event:$,source:R})};w.useEffect(function(){var v=ne.current,y=v.formattedValue,C=v.numAsString;(D!==y||q!==C)&&Q(O(D,q),{event:void 0,source:be.props})},[D,q]);var se=F.current?Le(F.current):void 0,de=typeof window<"u"?w.useLayoutEffect:w.useEffect;de(function(){var v=F.current;if(D!==ne.current.formattedValue&&v){var y=ie(ne.current.formattedValue,D,se);v.value=D,V(v,y,D)}},[D]);var me=function(v,y,C){var R=y.target,$=J.current?mn(J.current,R.selectionEnd):pt(D,v),k=Object.assign(Object.assign({},$),{lastValue:D}),I=o(v,k),ae=L(I);if(I=o(ae,void 0),x&&!x(O(ae,I))){var oe=y.target,le=Le(oe),Ie=ie(v,D,le);return oe.value=D,V(oe,Ie,D),!1}return he({formattedValue:ae,numAsString:I,inputValue:v,event:y,source:C,input:y.target}),!0},ve=function(v,y){y===void 0&&(y=0);var C=v.selectionStart,R=v.selectionEnd;J.current={selectionStart:C,selectionEnd:R+y}},we=function(v){var y=v.target,C=y.value,R=me(C,v,be.event);R&&d(v),J.current=void 0},Fe=function(v){var y=v.target,C=v.key,R=y.selectionStart,$=y.selectionEnd,k=y.value;k===void 0&&(k="");var I;C==="ArrowLeft"||C==="Backspace"?I=Math.max(R-1,0):C==="ArrowRight"?I=Math.min(R+1,k.length):C==="Delete"&&(I=R);var ae=0;C==="Delete"&&R===$&&(ae=1);var oe=C==="ArrowLeft"||C==="ArrowRight";if(I===void 0||R!==$&&!oe){h(v),ve(y,ae);return}var le=I;if(oe){var Ie=C==="ArrowLeft"?"left":"right";le=G(k,I,Ie),le!==I&&v.preventDefault()}else C==="Delete"&&!P(k[I])?le=G(k,I,"right"):C==="Backspace"&&!P(k[I])&&(le=G(k,I,"left"));le!==I&&V(y,le,k),h(v),ve(y,ae)},De=function(v){var y=v.target,C=function(){var R=y.selectionStart,$=y.selectionEnd,k=y.value;if(k===void 0&&(k=""),R===$){var I=G(k,R);I!==R&&V(y,I,k)}};C(),requestAnimationFrame(function(){C()}),m(v),ve(y)},je=function(v){v.persist&&v.persist();var y=v.target,C=v.currentTarget;F.current=y,B.current.focusTimeout=setTimeout(function(){var R=y.selectionStart,$=y.selectionEnd,k=y.value;k===void 0&&(k="");var I=G(k,R);I!==R&&!(R===0&&$===k.length)&&V(y,I,k),_(Object.assign(Object.assign({},v),{currentTarget:C}))},0)},Ee=function(v){F.current=null,clearTimeout(B.current.focusTimeout),clearTimeout(B.current.setCaretTimeout),b(v)},g=ue&&pn()?"numeric":void 0,S=Object.assign({inputMode:g},A,{type:e,value:D,onChange:we,onKeyDown:Fe,onMouseUp:De,onFocus:je,onBlur:Ee});if(n==="text")return i?ye.createElement(ye.Fragment,null,i(D,A)||null):ye.createElement("span",Object.assign({},A,{ref:a}),D);if(r){var N=r;return ye.createElement(N,Object.assign({},S,{ref:a}))}return ye.createElement("input",Object.assign({},S,{ref:a}))}function lt(t,e){var n=e.decimalScale,r=e.fixedDecimalScale,i=e.prefix;i===void 0&&(i="");var a=e.suffix;a===void 0&&(a="");var s=e.allowNegative,o=e.thousandsGroupStyle;if(o===void 0&&(o="thousand"),t===""||t==="-")return t;var c=Be(e),p=c.thousandSeparator,u=c.decimalSeparator,x=n!==0&&t.indexOf(".")!==-1||n&&r,d=$e(t,s),h=d.beforeDecimal,m=d.afterDecimal,_=d.addNegation;return n!==void 0&&(m=mt(m,n,!!r)),p&&(h=fn(h,p,o)),i&&(h=i+h),a&&(m=m+a),_&&(h="-"+h),t=h+(x&&u||"")+m,t}function Be(t){var e=t.decimalSeparator;e===void 0&&(e=".");var n=t.thousandSeparator,r=t.allowedDecimalSeparators;return n===!0&&(n=","),r||(r=[e,"."]),{decimalSeparator:e,thousandSeparator:n,allowedDecimalSeparators:r}}function Fn(t,e){t===void 0&&(t="");var n=new RegExp("(-)"),r=new RegExp("(-)(.)*(-)"),i=n.test(t),a=r.test(t);return t=t.replace(/-/g,""),i&&!a&&e&&(t="-"+t),t}function Dn(t,e){return new RegExp("(^-)|[0-9]|"+ht(t),"g")}function jn(t,e,n){return t===""?!0:!(e!=null&&e.match(/\d/))&&!(n!=null&&n.match(/\d/))&&typeof t=="string"&&!isNaN(Number(t))}function En(t,e,n){var r;e===void 0&&(e=yn(t));var i=n.allowNegative,a=n.prefix;a===void 0&&(a="");var s=n.suffix;s===void 0&&(s="");var o=n.decimalScale,c=e.from,p=e.to,u=p.start,x=p.end,d=Be(n),h=d.allowedDecimalSeparators,m=d.decimalSeparator,_=t[x]===m;if(Ce(t)&&(t===a||t===s)&&e.lastValue==="")return t;if(x-u===1&&h.indexOf(t[u])!==-1){var b=o===0?"":m;t=t.substring(0,u)+b+t.substring(u+1,t.length)}var f=function(F,B,L){var O=!1,V=!1;a.startsWith("-")?O=!1:F.startsWith("--")?(O=!1,V=!0):s.startsWith("-")&&F.length===s.length?O=!1:F[0]==="-"&&(O=!0);var G=O?1:0;return V&&(G=2),G&&(F=F.substring(G),B-=G,L-=G),{value:F,start:B,end:L,hasNegation:O}},E=f(t,u,x),P=E.hasNegation;r=E,t=r.value,u=r.start,x=r.end;var M=f(e.lastValue,c.start,c.end),A=M.start,Y=M.end,H=M.value,D=t.substring(u,x);t.length&&H.length&&(A>H.length-s.length||Y<a.length)&&!(D&&s.startsWith(D))&&(t=H);var q=0;t.startsWith(a)?q+=a.length:u<a.length&&(q=u),t=t.substring(q),x-=q;var W=t.length,J=t.length-s.length;t.endsWith(s)?W=J:(x>J||x>t.length-s.length)&&(W=x),t=t.substring(0,W),t=Fn(P?"-"+t:t,i),t=(t.match(Dn(m))||[]).join("");var ne=t.indexOf(m);t=t.replace(new RegExp(ht(m),"g"),function(F,B){return B===ne?".":""});var Q=$e(t,i),Z=Q.beforeDecimal,ue=Q.afterDecimal,j=Q.addNegation;return p.end-p.start<c.end-c.start&&Z===""&&_&&!parseFloat(ue)&&(t=j?"-":""),t}function Tn(t,e){var n=e.prefix;n===void 0&&(n="");var r=e.suffix;r===void 0&&(r="");var i=Array.from({length:t.length+1}).map(function(){return!0}),a=t[0]==="-";i.fill(!1,0,n.length+(a?1:0));var s=t.length;return i.fill(!1,s-r.length+1,s+1),i}function Rn(t){var e=Be(t),n=e.thousandSeparator,r=e.decimalSeparator,i=t.prefix;i===void 0&&(i="");var a=t.allowNegative;if(a===void 0&&(a=!0),n===r)throw new Error(`
        Decimal separator can't be same as thousand separator.
        thousandSeparator: `+n+` (thousandSeparator = {true} is same as thousandSeparator = ",")
        decimalSeparator: `+r+` (default value for decimalSeparator is .)
     `);return i.startsWith("-")&&a&&(console.error(`
      Prefix can't start with '-' when allowNegative is true.
      prefix: `+i+`
      allowNegative: `+a+`
    `),a=!1),Object.assign(Object.assign({},t),{allowNegative:a})}function Pn(t){t=Rn(t),t.decimalSeparator,t.allowedDecimalSeparators,t.thousandsGroupStyle;var e=t.suffix,n=t.allowNegative,r=t.allowLeadingZeros,i=t.onKeyDown;i===void 0&&(i=ce);var a=t.onBlur;a===void 0&&(a=ce);var s=t.thousandSeparator,o=t.decimalScale,c=t.fixedDecimalScale,p=t.prefix;p===void 0&&(p="");var u=t.defaultValue,x=t.value,d=t.valueIsNumericString,h=t.onValueChange,m=ft(t,["decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","suffix","allowNegative","allowLeadingZeros","onKeyDown","onBlur","thousandSeparator","decimalScale","fixedDecimalScale","prefix","defaultValue","value","valueIsNumericString","onValueChange"]),_=Be(t),b=_.decimalSeparator,f=_.allowedDecimalSeparators,E=function(j){return lt(j,t)},P=function(j,F){return En(j,F,t)},M=_e(x)?u:x,A=d??jn(M,p,e);_e(x)?_e(u)||(A=A||typeof u=="number"):A=A||typeof x=="number";var Y=function(j){return gt(j)?j:(typeof j=="number"&&(j=vt(j)),A&&typeof o=="number"?st(j,o,!!c):j)},H=yt(Y(x),Y(u),!!A,E,P,h),D=H[0],q=D.numAsString,W=D.formattedValue,J=H[1],ne=function(j){var F=j.target,B=j.key,L=F.selectionStart,O=F.selectionEnd,V=F.value;if(V===void 0&&(V=""),(B==="Backspace"||B==="Delete")&&O<p.length){j.preventDefault();return}if(L!==O){i(j);return}B==="Backspace"&&V[0]==="-"&&L===p.length+1&&n&&ge(F,1),o&&c&&(B==="Backspace"&&V[L-1]===b?(ge(F,L-1),j.preventDefault()):B==="Delete"&&V[L]===b&&j.preventDefault()),f!=null&&f.includes(B)&&V[L]===b&&ge(F,L+1);var G=s===!0?",":s;B==="Backspace"&&V[L-1]===G&&ge(F,L-1),B==="Delete"&&V[L]===G&&ge(F,L+1),i(j)},Q=function(j){var F=q;if(F.match(/\d/g)||(F=""),r||(F=hn(F)),c&&o&&(F=st(F,o,c)),F!==q){var B=lt(F,t);J({formattedValue:B,value:F,floatValue:parseFloat(F)},{event:j,source:be.event})}a(j)},Z=function(j){return j===b?!0:Ce(j)},ue=function(j){var F=j.currentValue,B=j.lastValue,L=j.formattedValue,O=j.currentValueIndex,V=j.formattedValueIndex,G=F[O],ie=L[V],he=pt(B,F),se=he.to,de=function(me){return P(me).indexOf(".")+p.length};return x===0&&c&&o&&F[se.start]===b&&de(F)<O&&de(L)>V?!1:O>=se.start&&O<se.end&&f&&f.includes(G)&&ie===b?!0:G===ie};return Object.assign(Object.assign({},m),{value:W,valueIsNumericString:!1,isValidInputCharacter:Z,isCharacterSame:ue,onValueChange:J,format:E,removeFormatting:P,getCaretBoundary:function(j){return Tn(j,t)},onKeyDown:ne,onBlur:Q})}function Nn(t){var e=Pn(t);return ye.createElement(wn,Object.assign({},e))}const Bn=({inputSuffix:t,inputPrefix:e,...n})=>l.jsx(z,{...n,value:n.value,suffix:t,prefix:e}),In=({onValueChange:t,...e})=>l.jsx(Nn,{customInput:Bn,onValueChange:t,...e}),Re=({inputSuffix:t,inputPrefix:e,onValueChange:n,...r})=>l.jsx(In,{inputPrefix:e,inputSuffix:t,onValueChange:n,...r}),ct=[{label:"Producer",value:"Producer"},{label:"Distributor",value:"Distributor"},{label:"Recycler",value:"Recycler"},{label:"Collector",value:"Collector"},{label:"Retailer",value:"Retailer"}],An=[{label:"Plastic shopping/carry bags (having thickness less than 75 micron)",value:"Plastic shopping/carry bags (having thickness less than 75 micron)"},{label:"Other Single Use Plastics",value:"Other Single Use Plastics"}],Mn=[{label:"Notice issued",value:"Notice issued"},{label:"Confiscation",value:"Confiscation"},{label:"Sealing",value:"Sealing"},{label:"FIR",value:"FIR"},{label:"Complaint before Environmental Magistrate",value:"Complaint before Environmental Magistrate"},{label:"Fine Imposed",value:"Fine Imposed"},{label:"De Sealed",value:"De Sealed"}],Vn=({control:t,errors:e,readOnly:n=!1,defaultValues:r})=>{var L,O,V,G,ie,he,se,de,me,ve,we,Fe,De,je,Ee;const[i,a]=w.useState([]),[s,o]=w.useState([]),{setValue:c,getValues:p,trigger:u}=dt(),[x,d]=w.useState(""),h=re({control:t,name:"violationFound",defaultValue:[]}),m=re({control:t,name:"violationType",defaultValue:[]}),_=re({control:t,name:"actionTaken",defaultValue:[]}),b=re({control:t,name:"fineRecoveryStatus",defaultValue:[]});re({control:t,name:"fineAmount",defaultValue:0});const f=(g,S)=>{o(S);const N=S.filter(v=>!i.includes(v));N.length>0&&a(v=>[...v,...N])},E=re({control:t,name:"plasticBagsConfiscation",defaultValue:0}),P=re({control:t,name:"confiscation_otherPlastics",defaultValue:{}}),[M,A]=w.useState(0);w.useEffect(()=>{if(_.includes("Confiscation")){let g=0;m.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&(g+=parseFloat(E)||0),s.forEach(S=>{P[S]&&(g+=parseFloat(P[S])||0)}),A(g),c("totalConfiscation",g)}},[E,P,_,c,s,m]),w.useEffect(()=>{Oe.get("/pmc/inspection-report/all_other_single_use_plastics/").then(g=>{a(g.data.single_use_plastic_items||[])}).catch(g=>{console.error("Error fetching available options:",g)})},[]),w.useEffect(()=>{if(r!=null&&r.fineRecoveryBreakup){const g=r.fineRecoveryBreakup.map(S=>({...S,isNew:!1}));q(g)}},[r==null?void 0:r.fineRecoveryBreakup]);const Y=re({control:t,name:"fineAmount",defaultValue:0});re({control:t,name:"recoveryAmount",defaultValue:0});const H=re({control:t,name:"fineRecoveryBreakup",defaultValue:[]}),[D,q]=w.useState(H||[]),[W,J]=w.useState(0);w.useEffect(()=>{console.log("Updating total recovery"),console.log("recoveryEntries",D);const g=D.reduce((S,N)=>S+(N.amount||0),0);J(g),console.log("fineReoceryBreakup is setup")},[D,c]);const ne=()=>{W<Y&&q([...D,{date:"",amount:0,isNew:!0}])},Q=(g,S,N)=>{console.log("recovery amount updated:"),console.log(g,S,N),q(v=>{const y=v.map((C,R)=>R===g?{...C,[S]:S==="amount"?parseFloat(N)||0:N}:C);return console.log("🔹 Updated Recovery Entries:",y),y})};w.useEffect(()=>{console.log("Updated recovery entries:",D),console.log("Calculated Total Recovery:",W)},[D,W]),w.useEffect(()=>{r!=null&&r.OtherSingleUseItems&&o(r.OtherSingleUseItems)},[r==null?void 0:r.OtherSingleUseItems]);const[Z,ue]=w.useState({lat:null,lng:null,district:""}),j=g=>{ue(g)},F=g=>{g.key==="Backspace"&&d(B(x,!0))},B=(g,S)=>{let N=g.replace(/[^a-zA-Z0-9]/g,""),v=N.slice(0,3).toUpperCase().replace(/[^A-Z]/g,""),y=N.slice(3,6).toUpperCase().replace(/[^A-Z]/g,""),C=N.slice(6).replace(/[^0-9]/g,"");if(S)return[v,y,C].filter(Boolean).join("-");let R="";return v&&(R+=v+(v.length===3?"-":"")),y&&(R+=y+(y.length===3?"-":"")),C&&(R+=C),R};return console.log("fineRecoveryBreakup:",r==null?void 0:r.fineRecoveryBreakup),console.log("readOnly",n),l.jsxs(Dt,{children:[l.jsx("h4",{className:"mb-6",children:"Inspection Report3"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(U,{label:"Inspection Date*",invalid:!!e.inspectionDate,errorMessage:(L=e.inspectionDate)==null?void 0:L.message,children:l.jsx(K,{name:"inspectionDate",control:t,render:({field:g})=>l.jsx(z,{type:"date",...g,readOnly:n})})}),l.jsx(U,{label:"Name of Business*",invalid:!!e.businessName,errorMessage:(O=e.businessName)==null?void 0:O.message,children:l.jsx(K,{name:"businessName",control:t,render:({field:g})=>l.jsx(z,{type:"text",placeholder:"Business Name",readOnly:n,...g})})}),l.jsx(U,{label:"Type of Business*",invalid:!!e.businessType,errorMessage:(V=e.businessType)==null?void 0:V.message,children:l.jsx(K,{name:"businessType",control:t,render:({field:g})=>l.jsx(He,{options:ct,value:ct.find(S=>S.value===g.value),isDisabled:n,onChange:S=>g.onChange(S==null?void 0:S.value)})})}),l.jsx(U,{label:"Plastic Application / License Number",invalid:!!e.licenseNumber,errorMessage:(G=e.licenseNumber)==null?void 0:G.message,children:l.jsx(K,{name:"licenseNumber",control:t,render:({field:g})=>l.jsx(z,{value:x,onChange:S=>d(B(S.target.value,!1)),onKeyDown:F,placeholder:"e.g., LHR-PRO-001",title:"Tracking Number (e.g., LHR-PRO-001)",readOnly:n})})})]}),l.jsx(U,{label:"Violation Found",invalid:!!e.violationFound,errorMessage:(ie=e.violationFound)==null?void 0:ie.message,children:l.jsx(K,{name:"violationFound",control:t,render:({field:g})=>l.jsx(pe.Group,{value:g.value||[],onChange:S=>g.onChange(S),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(pe,{...g,value:"Yes",disabled:n,children:"Yes"})})},"a1")}),h.includes("Yes")&&l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs(U,{label:"Type of Violation Found*",invalid:!!e.violationType,errorMessage:(he=e.violationType)==null?void 0:he.message,children:[An.map(g=>l.jsx(K,{name:"violationType",control:t,render:({field:S})=>l.jsx(pe.Group,{value:S.value||[],onChange:N=>S.onChange(N),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(pe,{...S,value:g.value,disabled:n,children:g.label})})},g.value)),m.includes("Other Single Use Plastics")&&l.jsx(U,{label:"Add List + (If desired item is not in the list, then type and press enter to add)",invalid:!!e.PackagingItems,errorMessage:(se=e.PackagingItems)==null?void 0:se.message,className:"ml-2 mt-4",children:l.jsx(K,{name:"OtherSingleUseItems",control:t,render:({field:g})=>l.jsx(zt,{multiple:!0,freeSolo:!0,options:i,value:s,readOnly:n,onChange:(S,N)=>{g.onChange(N),f(S,N)},renderTags:(S,N)=>S.map((v,y)=>l.jsx(Xt,{variant:"outlined",label:v,...N({index:y})})),renderInput:S=>l.jsx(Qt,{...S,variant:"outlined",label:"Other Single Use Plastics",placeholder:"Add or select Single Use Plastics"})})})})]}),l.jsx(U,{label:"Action Taken*",invalid:!!e.actionTaken,errorMessage:(de=e.actionTaken)==null?void 0:de.message,children:Mn.map(g=>l.jsx(K,{name:"actionTaken",control:t,render:({field:S})=>l.jsx(pe.Group,{value:S.value||[],onChange:N=>S.onChange(N),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(pe,{...S,value:g.value,disabled:n&&g.value!=="De Sealed",children:g.label})})},g.value))}),_.includes("Confiscation")&&m.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&l.jsx(U,{label:"Plastic shopping/carry bags (having thickness less than 75 micron) (KG)",invalid:!!e.plasticBagsConfiscation,errorMessage:(me=e.plasticBagsConfiscation)==null?void 0:me.message,children:l.jsx(K,{name:"plasticBagsConfiscation",control:t,render:({field:g})=>l.jsx(Re,{placeholder:"Enter KG",...g,readOnly:n})})}),_.includes("Confiscation")&&m.includes("Other Single Use Plastics")&&s.map((g,S)=>l.jsx(U,{label:`${g} Confiscation (KG)`,children:l.jsx(K,{name:`confiscation_otherPlastics.${g}`,control:t,render:({field:N})=>l.jsx(z,{type:"number",placeholder:"Enter KG",...N,readOnly:n})})},S)),_.includes("Confiscation")&&l.jsx(U,{label:"Total Confiscation (KG)",invalid:!!e.totalConfiscation,errorMessage:(ve=e.totalConfiscation)==null?void 0:ve.message,children:l.jsx(K,{name:"totalConfiscation",control:t,render:({field:g})=>(w.useEffect(()=>{g.onChange(M)},[M]),l.jsx(z,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...g}))})}),_.includes("Fine Imposed")&&l.jsxs(l.Fragment,{children:[l.jsx(U,{label:"Fine Amount (PKR)",invalid:!!e.fineAmount,errorMessage:(we=e.fineAmount)==null?void 0:we.message,children:l.jsx(K,{name:"fineAmount",control:t,render:({field:g})=>l.jsx(Re,{placeholder:"Enter Fine Amount",...g,readOnly:n})})}),l.jsx(U,{label:"Fine Recovery Status",invalid:!!e.fineRecoveryStatus,errorMessage:(Fe=e.fineRecoveryStatus)==null?void 0:Fe.message,children:l.jsx(K,{name:"fineRecoveryStatus",control:t,render:({field:g})=>l.jsx(He,{options:[{label:"Pending",value:"Pending"},{label:"Partial",value:"Partial"},{label:"Recovered",value:"Recovered"}],value:{label:g.value,value:g.value},onChange:S=>g.onChange(S==null?void 0:S.value),isDisabled:n&&g.value==="Recovered"})})}),b!=="Pending"&&l.jsxs(l.Fragment,{children:[l.jsx(U,{label:"Total Recovery Amount (PKR)",invalid:!!e.recoveryAmount,errorMessage:(De=e.recoveryAmount)==null?void 0:De.message,children:l.jsx(K,{name:"recoveryAmount",control:t,render:({field:g})=>(w.useEffect(()=>{g.onChange(W)},[W]),l.jsx(Re,{placeholder:"Auto-calculated",readOnly:!0,...g}))})}),D.map((g,S)=>{var N,v;return l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(U,{label:"Recovery Date",invalid:!!e.fineRecoveryBreakup,errorMessage:(N=e.fineAmount)==null?void 0:N.fineRecoveryBreakup,children:l.jsx(z,{type:"date",value:g.date,onChange:y=>Q(S,"date",y.target.value),readOnly:!g.isNew})}),l.jsx(U,{label:"Recovery Amount (PKR)",invalid:!!e.fineRecoveryBreakup,errorMessage:(v=e.fineAmount)==null?void 0:v.fineRecoveryBreakup,children:l.jsx(Re,{value:g.amount,onChange:y=>Q(S,"amount",y.target.value),readOnly:!g.isNew})})]},S)}),l.jsx(Ge,{type:"button",onClick:ne,disabled:W>=Y,className:"mt-7",children:"+ Add Recovery"})]})]}),_.includes("De Sealed")&&l.jsxs(l.Fragment,{children:[l.jsx(U,{label:"De Sealed Date",invalid:!!e.deSealedDate,errorMessage:(je=e.deSealedDate)==null?void 0:je.message,children:l.jsx(K,{name:"deSealedDate",control:t,render:({field:g})=>l.jsx(z,{type:"date",...g,readOnly:n&&g.value!==null&&g.value!==""})})}),l.jsx(U,{label:"De Seal - Affidavit",invalid:!!e.affidavit,errorMessage:(Ee=e.affidavit)==null?void 0:Ee.message,children:l.jsx(K,{name:"affidavit",control:t,render:({field:g})=>l.jsx(z,{type:"file",accept:".pdf,.png,.jpg,.jpeg",onChange:S=>g.onChange(S.target.files[0]||null)})})})]})]}),l.jsxs("div",{style:{padding:"20px"},children:[l.jsx("h1",{children:"Select Location"}),l.jsx(ln,{onLocationSelect:j}),Z.lat&&Z.lng&&l.jsxs("div",{style:{marginTop:"20px",padding:"10px",border:"1px solid #ccc"},children:[l.jsx("h3",{children:"Selected Location Details:"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(U,{label:"Latitude",children:l.jsx(K,{name:"latitude",control:t,render:({field:g})=>(w.useEffect(()=>{g.onChange(Z.lat)},[Z.lat]),l.jsx(z,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...g}))})}),l.jsx(U,{label:"Longitude",children:l.jsx(K,{name:"longitude",control:t,render:({field:g})=>(w.useEffect(()=>{g.onChange(Z.lng)},[Z.lng]),l.jsx(z,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...g}))})}),l.jsx(K,{name:"fineRecoveryBreakup",control:t,render:({field:g})=>(w.useEffect(()=>{g.onChange(D)},[D]),l.jsx(z,{type:"hidden",placeholder:"Auto-calculated",readOnly:!0,...g}))})]})]})]})]})},kn=T.object({businessName:T.string().min(1,{message:"Business name required"}),businessType:T.string().min(1,{message:"Business type required"}),licenseNumber:T.string().optional(),violationFound:T.array(T.string()).optional(),violationType:T.array(T.string()).optional(),actionTaken:T.array(T.string()).optional(),plasticBagsConfiscation:T.coerce.number().optional(),confiscation_otherPlastics:T.record(T.string(),T.coerce.number()).optional(),totalConfiscation:T.coerce.number().optional(),OtherSingleUseItems:T.array(T.string()).optional(),latitude:T.coerce.number().nullable(),longitude:T.coerce.number().nullable(),district:T.string().optional(),inspectionDate:T.string().min(1,{message:"Inspection date is required"}),fineAmount:T.coerce.number().optional(),fineRecoveryStatus:T.enum(["Pending","Partial","Recovered"]).optional(),fineRecoveryDate:T.string().optional(),recoveryAmount:T.coerce.number().optional(),deSealedDate:T.string().optional(),fineRecoveryBreakup:T.array(T.object({date:T.string().min(1,{message:"Date is required"}),amount:T.coerce.number().min(0,{message:"Amount must be a number and at least 0"}),isNew:T.boolean().optional()})).default([]),affidavit:T.instanceof(File,{message:"Must be a valid file"}).optional()}),Ln=({onFormSubmit:t,defaultValues:e={},readOnly:n,children:r})=>{const{handleSubmit:i,reset:a,formState:{errors:s},control:o}=dt({defaultValues:{fineRecoveryBreakup:(e==null?void 0:e.fineRecoveryBreakup)??[]},resolver:en(kn)});return w.useEffect(()=>{xt(e)||a(e)},[JSON.stringify(e)]),l.jsxs(Ft,{className:"flex w-full h-full",containerClassName:"flex flex-col w-full justify-between",onSubmit:i(t),children:[l.jsx(ut,{children:l.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:l.jsx("div",{className:"gap-4 flex flex-col flex-auto",children:l.jsx(Vn,{control:o,errors:s,defaultValues:e,readOnly:n})})})}),l.jsx(jt,{children:r})]})},On=t=>t?{id:t.id,businessName:t.business_name,businessType:t.business_type,licenseNumber:t.license_number||"",violationFound:t.violation_found||[],violationType:t.violation_type||[],actionTaken:t.action_taken||[],plasticBagsConfiscation:t.plastic_bags_confiscation??0,confiscationOtherPlastics:t.confiscation_other_plastics||{},totalConfiscation:t.total_confiscation||0,OtherSingleUseItems:t.other_single_use_items||[],latitude:t.latitude??null,longitude:t.longitude??null,district:t.district||"",inspectionDate:t.inspection_date||null,fineAmount:t.fine_amount??0,fineRecoveryStatus:t.fine_recovery_status||void 0,fineRecoveryDate:t.fine_recovery_date||"",recoveryAmount:t.recovery_amount??0,deSealedDate:t.de_sealed_date||"",fineRecoveryBreakup:t.fine_recovery_breakup||null,syncStatus:t.syncStatus||void 0}:null,cr=()=>{const t=_t(),e=St(),{reports:n,fetchReports:r,updateReport:i,addNewReport:a,syncReports:s}=rn(),[o,c]=w.useState(!1),[p,u]=w.useState(!1),d=new URLSearchParams(e.search).get("id");console.log(n);let h=w.useMemo(()=>{const f=n.find(E=>E.id==d);return f?On(f):null},[n,d]);h={...h,inspectionDate:(h==null?void 0:h.inspectionDate)||new Date().toISOString().split("T")[0]},w.useEffect(()=>{d&&!h&&r()},[h,r]);const m=async f=>{console.log("Submitting Data:",f),u(!0);const E={business_name:f.businessName,business_type:f.businessType,license_number:f.licenseNumber||"",violation_found:f.violationFound||[],violation_type:f.violationType||[],action_taken:f.actionTaken||[],plastic_bags_confiscation:f.plasticBagsConfiscation??0,confiscation_other_plastics:f.confiscationOtherPlastics||{},total_confiscation:f.totalConfiscation||0,other_single_use_items:f.OtherSingleUseItems||[],latitude:f.latitude??null,longitude:f.longitude??null,district:f.district||"",inspection_date:f.inspectionDate||null,fine_amount:f.fineAmount??0,fine_recovery_status:f.fineRecoveryStatus||void 0,fine_recovery_date:f.fineRecoveryDate||null,recovery_amount:f.recoveryAmount??0,de_sealed_date:f.deSealedDate||null,fine_recovery_breakup:f.fineRecoveryBreakup||null,affidavit:f.affidavit||null,syncStatus:d?"patch":"post"};try{d?i(d,E):a(E),console.log("✅ Report Updated in Store"),u(!1),t("/auth/EPAOperations/AllInspections")}catch(P){console.error("❌ Error in Submission:",P),u(!1)}},_=()=>c(!0),b=()=>{c(!1),Ct.push(l.jsx(wt,{type:"success",children:"Customer discard!"}),{placement:"top-center"}),t("/auth/EPAOperations/AllInspections")};return l.jsx(l.Fragment,{children:l.jsxs(l.Fragment,{children:[l.jsx(Ln,{newCustomer:!0,defaultValues:h,onFormSubmit:m,readOnly:d!==null,children:l.jsx(ut,{children:l.jsxs("div",{className:"flex items-center justify-between px-8",children:[l.jsx("span",{}),l.jsxs("div",{className:"flex items-center",children:[l.jsx(Ge,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:l.jsx(bt,{}),onClick:_,children:"Discard"}),l.jsx(Ge,{icon:l.jsx(nn,{}),variant:"solid",type:"submit",loading:p,children:"Save"})]})]})})}),l.jsx(tn,{isOpen:o,type:"danger",title:"Discard changes",onClose:()=>c(!1),onCancel:()=>c(!1),onConfirm:b,children:l.jsx("p",{children:"Are you sure you want to discard this?"})})]})})};export{cr as default};
