import{j as e,r as d,l as c,A as D}from"./index-oDwQGYEA.js";import{T as _}from"./index-D-8Rpkt9.js";import{b as N}from"./isNil-DegOKdHG.js";import{u as B,F as w,a as n,C as i}from"./index.esm-BwKut1eI.js";import{t as k,z as l}from"./index-EAOVwyn9.js";import{M as I,T as K}from"./index.esm-C6T0MJvz.js";import{B as U}from"./Button-CkHimBRY.js";import{C as A}from"./Card-DyjZqYue.js";import{I as x}from"./Input-Zn4GrLhU.js";import{S as E}from"./Select-D8ijT30g.js";import{A as O}from"./index-DE7QgtAB.js";import{r as R}from"./index-D9L9-oRE.js";import{c as L}from"./TextField-r5TNIsmD.js";import{I as P}from"./Autocomplete-Dg-hWFz0.js";import"./useControllableState-D-PZJh6c.js";import"./classNames-Dv-7hrnu.js";import"./index-DWjkHJka.js";import"./DefaultPropsProvider-CGomaEqC.js";import"./emotion-element-f0de968e.browser.esm-DX8E_o2N.js";import"./Modal-CFzYjZPq.js";import"./setPrototypeOf-C3V6guyq.js";import"./Box-CNakWzJu.js";import"./FormControlLabel-BQoHBKRj.js";import"./Divider-B6CetmYu.js";import"./assertThisInitialized-Cle6jci9.js";import"./index-CFuoc-5k.js";import"./floating-ui.dom-CrKScG7J.js";const H=L(e.jsx("path",{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2m-1 8V6h2v4h3l-4 4-4-4zm6 7H7v-2h10z"}),"DownloadForOffline"),V=l.object({title:l.string().min(3,"Title must be at least 3 characters"),documentType:l.enum(["Notification","Minutes of Meeting"],{required_error:"Select a document type"}),file:l.instanceof(File,{message:"Must be a valid file"}).optional(),document_date:l.string().min(1,{message:"Document Date is required!"})}),q=()=>{var b,j,v,y,T;const[m,u]=d.useState([]),[p,s]=d.useState(!1),f=c(t=>t.user.district_id)||null;c(t=>t.user.district_name);const{handleSubmit:C,control:r,setValue:J,reset:S,formState:{errors:a,isSubmitting:g}}=B({resolver:k(V),defaultValues:{title:"",documentType:"Notification",file:null}}),h=()=>{s(!0),D.get("/pmc/district-documents/").then(t=>u(t.data)).catch(t=>console.error("Error fetching documents:",t)).finally(()=>s(!1))};d.useEffect(()=>{h()},[]);const F=async t=>{const o=new FormData;o.append("district_id",(f==null?void 0:f.toString())||"0"),o.append("document_type",t.documentType),o.append("title",t.title),o.append("document",t.file),t.document_date&&o.append("document_date",t.document_date);try{await D.post("/pmc/district-documents/",o,{headers:{"Content-Type":"multipart/form-data"}}),alert("Document uploaded successfully!"),h(),S()}catch(z){console.error("Error uploading document:",z),alert("Failed to upload document.")}},M=[{accessorKey:"district_name",header:"District",size:200},{accessorKey:"document_type",header:"Type",size:150},{accessorKey:"title",header:"Title",size:300},{accessorKey:"document_date",header:"Document Date",size:200},{accessorKey:"uploaded_at",header:"Uploaded On",size:200},{accessorKey:"uploaded_by_name",header:"Uploaded By",size:200},{accessorKey:"file",header:"Download",size:80,Cell:({row:t})=>{const o=()=>{if(!t.original.document){alert("File not available!");return}window.open(t.original.document,"_blank","noopener,noreferrer")};return e.jsx(K,{title:"Download Document",children:e.jsxs(P,{onClick:o,sx:{background:"linear-gradient(135deg, #007BFF, #0056b3)",color:"#fff",padding:"6px",borderRadius:"8px",transition:"0.3s ease-in-out","&:hover":{background:"linear-gradient(135deg, #0056b3, #007BFF)",transform:"scale(1.05)"}},children:[e.jsx(H,{fontSize:"medium"})," "]})})}}];return e.jsxs(A,{children:[e.jsx(w,{onSubmit:C(F),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(n,{label:"Document Title",invalid:!!a.title,errorMessage:(b=a.title)==null?void 0:b.message,children:e.jsx(i,{name:"title",control:r,render:({field:t})=>e.jsx(x,{...t,placeholder:"Enter document title"})})}),e.jsx(n,{label:"Document Type",invalid:!!a.documentType,errorMessage:(j=a.documentType)==null?void 0:j.message,children:e.jsx(i,{name:"documentType",control:r,render:({field:t})=>e.jsx(E,{options:[{label:"Notification",value:"Notification"},{label:"Minutes of Meeting",value:"Minutes of Meeting"}],value:{label:t.value,value:t.value},onChange:o=>t.onChange(o==null?void 0:o.value)})})}),e.jsx(n,{label:"Document Date",invalid:!!a.document_date,errorMessage:(v=a.document_date)==null?void 0:v.message,children:e.jsx(i,{name:"document_date",control:r,render:({field:t})=>e.jsx(x,{type:"date",...t})})}),e.jsx(n,{label:"Upload File",invalid:!!a.file,errorMessage:(y=a.file)==null?void 0:y.message,children:e.jsx(i,{name:"file",control:r,render:({field:t})=>e.jsx(x,{type:"file",accept:".pdf,.png,.jpg,.jpeg,.doc,.docx,.xls,.xlsx",onChange:o=>t.onChange(o.target.files[0])})})}),e.jsx(n,{className:"mt-7",invalid:!!a.file,errorMessage:(T=a.file)==null?void 0:T.message,children:e.jsx(i,{name:"button",control:r,render:({field:t})=>e.jsxs(U,{disabled:g,className:"flex items-center",children:[g?e.jsx(O,{className:"mr-2 animate-spin"}):e.jsx(R,{className:"mr-2"}),g?"Uploading...":"Upload"]})})})]})}),p?e.jsx("p",{children:"Loading documents..."}):e.jsx(I,{columns:M,data:m,enablePagination:!0,muiTableHeadCellProps:{sx:{backgroundColor:"#f5f5f5",fontWeight:"bold",borderBottom:"2px solid #ccc",textAlign:"center"}},muiTableBodyCellProps:{sx:{borderRight:"1px solid #ddd",padding:"10px"}},muiTableBodyRowProps:{sx:{"&:nth-of-type(even)":{backgroundColor:"#f9f9f9"},"&:hover":{backgroundColor:"#e0f7fa"}}}})]})},{TabNav:Q,TabList:W,TabContent:G}=_,De=()=>{const[m,u]=d.useState("tab1");c(s=>s.user.district_id);const p=c(s=>s.user.district_name)||"";return e.jsx("div",{children:e.jsxs(_,{value:m,onChange:u,children:[e.jsx(W,{children:e.jsxs(Q,{value:"tab1",icon:e.jsx(N,{}),children:["Manage Documents for District: ",p]})}),e.jsx("div",{className:"p-4",children:e.jsx(G,{value:"tab1",children:e.jsx(q,{})})})]})})};export{De as default};
