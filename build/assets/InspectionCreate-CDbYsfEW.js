import{r as C,j as c,Z as me,A as pt,k as Ne,i as xt,a2 as st,W as yt,a0 as _t}from"./index-D0IGZuaL.js";import{B as Oe}from"./Button-CHtMPc9f.js";import{f as St,t as bt,N as Ct}from"./toast-Zuw7JM-4.js";import{u as ot,b as te,a as L,C as O,F as wt}from"./index.esm--Mi2MQig.js";import{C as he,B as Ft}from"./index-DrnRzGmZ.js";import{C as jt}from"./Card-jeXCgV48.js";import{I as H}from"./Input-I6JNGBMk.js";import{S as We}from"./Select-CEyAJz7f.js";import{e as Et,p as Dt,g as Tt,s as Rt,h as Nt,R as Pt,a as lt,b as ct,i as $e,j as He,k as Ze,E as Ye,l as X,m as Ae,d as Ge,P as Ue,n as Te,o as ce,q as J,r as ze,t as Z,u as Pe,v as Bt,w as It,x as At,y as Ke,z as Mt,A as kt,B as Vt,D as Lt,G as Ot,f as Me,S as Gt,C as Ut,c as Kt,F as qt,M as Wt,V as $t,T as Ht,O as Zt,H as Yt}from"./OSM-CHMvphyu.js";import{A as zt,C as Xt}from"./Autocomplete-DD-OvJUR.js";import{T as Jt}from"./TextField-C5_qVraA.js";import{t as Qt,z as T}from"./index-B_ZYJBDr.js";import{C as en}from"./ConfirmDialog-BHukzQQw.js";import{B as tn}from"./index-DLzC979A.js";import{u as nn}from"./useInspectionStore-BoriC2WK.js";import"./classNames-Ng-nVz_W.js";import"./StatusIcon-DPQZ5oit.js";import"./isNil-Cd52hBaS.js";import"./CloseButton-Ch1W30n6.js";import"./index-BQKTGHKq.js";import"./_getPrototype-ChD501J2.js";import"./DefaultPropsProvider-t5SPt5v_.js";import"./floating-ui.dom-CrKScG7J.js";import"./index-C17Kx2bW.js";import"./index-BGnwdksW.js";import"./index-BotPxOXw.js";const Xe=0,ye=1,Je=[0,0,0,0],ve=[],ke={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Ve extends Vt{constructor(e,n,r){super(e),this.features=n,this.mapBrowserEvent=r}}class rn extends Et{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Dt,this.defaultDeleteCondition_=function(r){return Tt(r)&&Rt(r)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Nt,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Pt,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new lt({source:new ct({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:sn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let n;if(e.features?n=e.features:e.source&&(this.source_=e.source,n=new $e(this.source_.getFeatures()),this.source_.addEventListener(He.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(He.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!n)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=n,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ze.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ze.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const n=e.getGeometry();if(n){const i=this.SEGMENT_WRITERS_[n.getType()];i&&i(e,n)}const r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(r.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(Ye.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,n){if(!this.featuresBeingModified_){this.featuresBeingModified_=new $e;const r=this.featuresBeingModified_.getArray();for(let i=0,a=n.length;i<a;++i){const o=n[i].feature;o&&!r.includes(o)&&this.featuresBeingModified_.push(o)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Ve(ke.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Ye.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const n=this.rBush_,r=[];n.forEach(function(i){e===i.feature&&r.push(i)});for(let i=r.length-1;i>=0;--i){const a=r[i];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===a&&this.dragSegments_.splice(o,1);n.remove(a)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const n=e.target;this.removeFeature_(n),this.addFeature_(n)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,n){const r=n.getCoordinates(),i={feature:e,geometry:n,segment:[r,r]};this.rBush_.insert(n.getExtent(),i)}writeMultiPointGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const o=r[i],l={feature:e,geometry:n,depth:[i],index:i,segment:[o,o]};this.rBush_.insert(n.getExtent(),l)}}writeLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length-1;i<a;++i){const o=r.slice(i,i+2),l={feature:e,geometry:n,index:i,segment:o};this.rBush_.insert(X(o),l)}}writeMultiLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const o=r[i];for(let l=0,u=o.length-1;l<u;++l){const v=o.slice(l,l+2),d={feature:e,geometry:n,depth:[i],index:l,segment:v};this.rBush_.insert(X(v),d)}}}writePolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const o=r[i];for(let l=0,u=o.length-1;l<u;++l){const v=o.slice(l,l+2),d={feature:e,geometry:n,depth:[i],index:l,segment:v};this.rBush_.insert(X(v),d)}}}writeMultiPolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const o=r[i];for(let l=0,u=o.length;l<u;++l){const v=o[l];for(let d=0,x=v.length-1;d<x;++d){const h=v.slice(d,d+2),f={feature:e,geometry:n,depth:[l,i],index:d,segment:h};this.rBush_.insert(X(h),f)}}}}writeCircleGeometry_(e,n){const r=n.getCenter(),i={feature:e,geometry:n,index:Xe,segment:[r,r]},a={feature:e,geometry:n,index:ye,segment:[r,r]},o=[i,a];i.featureSegments=o,a.featureSegments=o,this.rBush_.insert(Ae(r),i);let l=n;this.rBush_.insert(l.getExtent(),a)}writeGeometryCollectionGeometry_(e,n){const r=n.getGeometriesArray();for(let i=0;i<r.length;++i){const a=r[i],o=this.SEGMENT_WRITERS_[a.getType()];o(e,a)}}createOrUpdateVertexFeature_(e,n,r,i){let a=this.vertexFeature_;return a?a.getGeometry().setCoordinates(e):(a=new Ge(new Ue(e)),this.vertexFeature_=a,this.overlay_.getSource().addFeature(a)),a.set("features",n),a.set("geometries",r),a.set("existing",i),a}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let n;return!e.map.getView().getInteracting()&&e.type==Te.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Te.SINGLECLICK||!this.ignoreNextSingleClick_?n=this.removePoint():n=!0),e.type==Te.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!n}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(!n)return;this.getMap().getView().getProjection();const r=[],i=n.getGeometry().getCoordinates(),a=X([i]),o=this.rBush_.getInExtent(a),l={};o.sort(an);for(let u=0,v=o.length;u<v;++u){const d=o[u],x=d.segment;let h=ce(d.geometry);const f=d.depth;if(f&&(h+="-"+f.join("-")),l[h]||(l[h]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===ye){const m=et(e,d);J(m,i)&&!l[h][0]&&(this.dragSegments_.push([d,0]),l[h][0]=d);continue}if(J(x[0],i)&&!l[h][0]){this.dragSegments_.push([d,0]),l[h][0]=d;continue}if(J(x[1],i)&&!l[h][1]){if(l[h][0]&&l[h][0].index===0){let m=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":m=m[f[1]];case"Polygon":if(d.index!==m[f[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),l[h][1]=d;continue}ce(x)in this.vertexSegments_&&!l[h][0]&&!l[h][1]&&r.push(d)}return r}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([a])=>a));const n=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],i=[];for(let a=0,o=this.dragSegments_.length;a<o;++a){const l=this.dragSegments_[a],u=l[0],v=u.feature;r.includes(v)||r.push(v);const d=u.geometry;i.includes(d)||i.push(d);const x=u.depth;let h;const f=u.segment,m=l[1];for(;n.length<d.getStride();)n.push(f[m][n.length]);switch(d.getType()){case"Point":h=n,f[0]=n,f[1]=n;break;case"MultiPoint":h=d.getCoordinates(),h[u.index]=n,f[0]=n,f[1]=n;break;case"LineString":h=d.getCoordinates(),h[u.index+m]=n,f[m]=n;break;case"MultiLineString":h=d.getCoordinates(),h[x[0]][u.index+m]=n,f[m]=n;break;case"Polygon":h=d.getCoordinates(),h[x[0]][u.index+m]=n,f[m]=n;break;case"MultiPolygon":h=d.getCoordinates(),h[x[1]][x[0]][u.index+m]=n,f[m]=n;break;case"Circle":const S=d;if(f[0]=n,f[1]=n,u.index===Xe)this.changingFeature_=!0,S.setCenter(n),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let j=ze(Z(S.getCenter()),Z(n));S.setRadius(j),this.changingFeature_=!1}break}h&&this.setGeometryCoordinates_(d,h)}this.createOrUpdateVertexFeature_(n,r,i,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const n=e.coordinate,r=this.findInsertVerticesAndUpdateDragSegments_(n);if(r!=null&&r.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,r),this.vertexFeature_)){const i=this.vertexFeature_.getGeometry().getCoordinates();for(let a=r.length-1;a>=0;--a)this.insertVertex_(r[a],i);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let n=this.dragSegments_.length-1;n>=0;--n){const r=this.dragSegments_[n][0],i=r.geometry;if(i.getType()==="Circle"){const a=i,o=a.getCenter(),l=r.featureSegments[0],u=r.featureSegments[1];l.segment[0]=o,l.segment[1]=o,u.segment[0]=o,u.segment[1]=o,this.rBush_.update(Ae(o),l);let v=a;this.rBush_.update(v.getExtent(),u)}else this.rBush_.update(X(r.segment),r)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ve(ke.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const n=this.getMap(),r=n.getPixelFromCoordinate(e);n.getView().getProjection();const i=function(l,u){return Qe(e,l)-Qe(e,u)};let a,o;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?u=>u===this.hitDetection_:void 0;n.forEachFeatureAtPixel(r,(u,v,d)=>{d&&d.getType()==="Point"&&(d=new Ue(Pe(d.getCoordinates())));const x=d||u.getGeometry();if(x&&x.getType()==="Point"&&u instanceof Ge&&this.features_.getArray().includes(u)){o=x;const h=u.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:u,geometry:o,segment:[h,h]}]}return!0},{layerFilter:l})}if(!a){const l=Bt(Ae(e,Je)),u=n.getView().getResolution()*this.pixelTolerance_,v=It(At(l,u,Je));a=this.rBush_.getInExtent(v)}if(a&&a.length>0){const l=a.sort(i)[0],u=l.segment;let v=et(e,l);const d=n.getPixelFromCoordinate(v);let x=ze(r,d);if(o||x<=this.pixelTolerance_){const h={};if(h[ce(u)]=!0,this.snapToPointer_||(this.delta_[0]=v[0]-e[0],this.delta_[1]=v[1]-e[1]),l.geometry.getType()==="Circle"&&l.index===ye)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(v,[l.feature],[l.geometry],this.snappedToVertex_);else{const f=n.getPixelFromCoordinate(u[0]),m=n.getPixelFromCoordinate(u[1]),S=Ke(d,f),j=Ke(d,m);if(x=Math.sqrt(Math.min(S,j)),this.snappedToVertex_=x<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(v=S>j?u[1]:u[0]),this.createOrUpdateVertexFeature_(v,[l.feature],[l.geometry],this.snappedToVertex_);const p={};p[ce(l.geometry)]=!0;for(let R=1,P=a.length;R<P;++R){const G=a[R].segment;if(J(u[0],G[0])&&J(u[1],G[1])||J(u[0],G[1])&&J(u[1],G[0])){const U=ce(a[R].geometry);U in p||(p[U]=!0,h[ce(G)]=!0)}else break}}this.vertexSegments_=h;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,n){const r=e.segment,i=e.feature,a=e.geometry,o=e.depth,l=e.index;let u;for(;n.length<a.getStride();)n.push(0);switch(a.getType()){case"MultiLineString":u=a.getCoordinates(),u[o[0]].splice(l+1,0,n);break;case"Polygon":u=a.getCoordinates(),u[o[0]].splice(l+1,0,n);break;case"MultiPolygon":u=a.getCoordinates(),u[o[1]][o[0]].splice(l+1,0,n);break;case"LineString":u=a.getCoordinates(),u.splice(l+1,0,n);break;default:return!1}this.setGeometryCoordinates_(a,u);const v=this.rBush_;v.remove(e),this.updateSegmentIndices_(a,l,o,1);const d={segment:[r[0],n],feature:i,geometry:a,depth:o,index:l};v.insert(X(d.segment),d),this.dragSegments_.push([d,1]);const x={segment:[n,r[1]],feature:i,geometry:a,depth:o,index:l+1};return v.insert(X(x.segment),x),this.dragSegments_.push([x,0]),!0}updatePointer_(e){var n;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates()}getPoint(){var n;const e=(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates();return e?Pe(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(X([e])).some(({segment:r})=>J(r[0],e)||J(r[1],e))}removePoint(e){if(e&&(e=Z(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=Te.POINTERDRAG){const n=this.lastPointerEvent_;this.willModifyFeatures_(n,this.dragSegments_.map(([i])=>i));const r=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ve(ke.MODIFYEND,this.featuresBeingModified_,n)),this.featuresBeingModified_=null,r}return!1}removeVertex_(){const e=this.dragSegments_,n={};let r=!1,i,a,o,l,u,v,d,x,h,f,m;for(u=e.length-1;u>=0;--u)o=e[u],f=o[0],m=ce(f.feature),f.depth&&(m+="-"+f.depth.join("-")),m in n||(n[m]={}),o[1]===0?(n[m].right=f,n[m].index=f.index):o[1]==1&&(n[m].left=f,n[m].index=f.index+1);for(m in n){switch(h=n[m].right,d=n[m].left,v=n[m].index,x=v-1,d!==void 0?f=d:f=h,x<0&&(x=0),l=f.geometry,a=l.getCoordinates(),i=a,r=!1,l.getType()){case"MultiLineString":a[f.depth[0]].length>2&&(a[f.depth[0]].splice(v,1),r=!0);break;case"LineString":a.length>2&&(a.splice(v,1),r=!0);break;case"MultiPolygon":i=i[f.depth[1]];case"Polygon":i=i[f.depth[0]],i.length>4&&(v==i.length-1&&(v=0),i.splice(v,1),r=!0,v===0&&(i.pop(),i.push(i[0]),x=i.length-1));break}if(r){this.setGeometryCoordinates_(l,a);const S=[];if(d!==void 0&&(this.rBush_.remove(d),S.push(d.segment[0])),h!==void 0&&(this.rBush_.remove(h),S.push(h.segment[1])),d!==void 0&&h!==void 0){const j={depth:f.depth,feature:f.feature,geometry:f.geometry,index:x,segment:S};this.rBush_.insert(X(j.segment),j)}this.updateSegmentIndices_(l,v,f.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return r}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(X([e])).some(({segment:r})=>!(J(r[0],e)||J(r[1],e)))}insertPoint(e){var i;const n=e?Z(e,this.getMap().getView().getProjection()):(i=this.vertexFeature_)==null?void 0:i.getGeometry().getCoordinates();return n?this.findInsertVerticesAndUpdateDragSegments_(n).reduce((a,o)=>a||this.insertVertex_(o,n),!1):!1}setGeometryCoordinates_(e,n){this.changingFeature_=!0,e.setCoordinates(n),this.changingFeature_=!1}updateSegmentIndices_(e,n,r,i){this.rBush_.forEachInExtent(e.getExtent(),function(a){a.geometry===e&&(r===void 0||a.depth===void 0||Mt(a.depth,r))&&a.index>n&&(a.index+=i)})}}function an(t,e){return t.index-e.index}function Qe(t,e,n){const r=e.geometry;if(r.getType()==="Circle"){let a=r;if(e.index===ye){const o=Ke(a.getCenter(),Z(t)),l=Math.sqrt(o)-a.getRadius();return l*l}}const i=Z(t);return ve[0]=Z(e.segment[0]),ve[1]=Z(e.segment[1]),Ot(i,ve)}function et(t,e,n){const r=e.geometry;if(r.getType()==="Circle"&&e.index===ye)return Pe(r.getClosestPoint(Z(t)));const i=Z(t);return ve[0]=Z(e.segment[0]),ve[1]=Z(e.segment[1]),Pe(Lt(i,ve))}function sn(){const t=kt();return function(e,n){return t.Point}}const on=({onLocationSelect:t,savedLocation:e,isEditing:n})=>{const r=C.useRef(null),[i,a]=C.useState(null),[o,l]=C.useState(null),[u,v]=C.useState({lat:null,lng:null});C.useEffect(()=>{const x=new ct,h=e&&n?Me([e.lng,e.lat]):Me([74.3436,31.5497]),f=new Ge({geometry:new Ue(h)});f.setStyle(new Gt({image:new Ut({radius:7,fill:new qt({color:"red"}),stroke:new Kt({color:"white",width:2})})})),x.addFeature(f),l(f);const m=new lt({source:x}),S=new Wt({target:r.current,layers:[new Ht({source:new Zt}),m],view:new $t({center:h,zoom:12})});if(a(S),!n){d(S,f);const j=new rn({source:x});S.addInteraction(j),j.on("modifyend",p=>{const R=p.features.item(0).getGeometry().getCoordinates(),P=Yt(R);v({lat:P[1],lng:P[0]}),t({lat:P[1],lng:P[0]})})}return()=>S.setTarget(null)},[n,e]);const d=(x,h)=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(f=>{const m=Me([f.coords.longitude,f.coords.latitude]);h.getGeometry().setCoordinates(m),x.getView().setCenter(m),x.getView().setZoom(15),v({lat:f.coords.latitude,lng:f.coords.longitude}),t({lat:f.coords.latitude,lng:f.coords.longitude})},f=>console.error("Geolocation error:",f),{enableHighAccuracy:!0})};return c.jsxs("div",{children:[c.jsx("div",{ref:r,style:{height:"600px",width:"100%"}}),!n&&o&&i&&c.jsx("button",{type:"button",onClick:()=>d(i,o),style:{marginTop:"10px",padding:"10px",backgroundColor:"#007BFF",color:"#fff",border:"none",cursor:"pointer",borderRadius:"5px"},children:"📍 Go to Current Location"})]})};function ut(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}var _e;(function(t){t.event="event",t.props="prop"})(_e||(_e={}));function oe(){}function ln(t){var e,n=void 0;return function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e&&r.length===e.length&&r.every(function(a,o){return a===e[o]})||(e=r,n=t.apply(void 0,r)),n}}function Se(t){return!!(t||"").match(/\d/)}function pe(t){return t==null}function cn(t){return typeof t=="number"&&isNaN(t)}function dt(t){return pe(t)||cn(t)||typeof t=="number"&&!isFinite(t)}function ft(t){return t.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function un(t){switch(t){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;case"thousand":default:return/(\d)(?=(\d{3})+(?!\d))/g}}function dn(t,e,n){var r=un(n),i=t.search(/[1-9]/);return i=i===-1?t.length:i,t.substring(0,i)+t.substring(i,t.length).replace(r,"$1"+e)}function fn(t){var e=C.useRef(t);e.current=t;var n=C.useRef(function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e.current.apply(e,r)});return n.current}function qe(t,e){e===void 0&&(e=!0);var n=t[0]==="-",r=n&&e;t=t.replace("-","");var i=t.split("."),a=i[0],o=i[1]||"";return{beforeDecimal:a,afterDecimal:o,hasNegation:n,addNegation:r}}function gn(t){if(!t)return t;var e=t[0]==="-";e&&(t=t.substring(1,t.length));var n=t.split("."),r=n[0].replace(/^0+/,"")||"0",i=n[1]||"";return(e?"-":"")+r+(i?"."+i:"")}function gt(t,e,n){for(var r="",i=n?"0":"",a=0;a<=e-1;a++)r+=t[a]||i;return r}function tt(t,e){return Array(e+1).join(t)}function ht(t){var e=t+"",n=e[0]==="-"?"-":"";n&&(e=e.substring(1));var r=e.split(/[eE]/g),i=r[0],a=r[1];if(a=Number(a),!a)return n+i;i=i.replace(".","");var o=1+a,l=i.length;return o<0?i="0."+tt("0",Math.abs(o))+i:o>=l?i=i+tt("0",o-l):i=(i.substring(0,o)||"0")+"."+i.substring(o),n+i}function nt(t,e,n){if(["","-"].indexOf(t)!==-1)return t;var r=(t.indexOf(".")!==-1||n)&&e,i=qe(t),a=i.beforeDecimal,o=i.afterDecimal,l=i.hasNegation,u=parseFloat("0."+(o||"0")),v=o.length<=e?"0."+o:u.toFixed(e),d=v.split("."),x=a;a&&Number(d[0])&&(x=a.split("").reverse().reduce(function(S,j,p){return S.length>p?(Number(S[0])+Number(j)).toString()+S.substring(1,S.length):j+S},d[0]));var h=gt(d[1]||"",e,n),f=l?"-":"",m=r?".":"";return""+f+x+m+h}function ue(t,e){if(t.value=t.value,t!==null){if(t.createTextRange){var n=t.createTextRange();return n.move("character",e),n.select(),!0}return t.selectionStart||t.selectionStart===0?(t.focus(),t.setSelectionRange(e,e),!0):(t.focus(),!1)}}var mt=ln(function(t,e){for(var n=0,r=0,i=t.length,a=e.length;t[n]===e[n]&&n<i;)n++;for(;t[i-1-r]===e[a-1-r]&&a-r>n&&i-r>n;)r++;return{from:{start:n,end:i-r},to:{start:n,end:a-r}}}),hn=function(t,e){var n=Math.min(t.selectionStart,e);return{from:{start:n,end:t.selectionEnd},to:{start:n,end:e}}};function mn(t,e,n){return Math.min(Math.max(t,e),n)}function Le(t){return Math.max(t.selectionStart,t.selectionEnd)}function vn(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function pn(t){return{from:{start:0,end:0},to:{start:0,end:t.length},lastValue:""}}function xn(t){var e=t.currentValue,n=t.formattedValue,r=t.currentValueIndex,i=t.formattedValueIndex;return e[r]===n[i]}function yn(t,e,n,r,i,a,o){o===void 0&&(o=xn);var l=i.findIndex(function(G){return G}),u=t.slice(0,l);!e&&!n.startsWith(u)&&(e=u,n=u+n,r=r+u.length);for(var v=n.length,d=t.length,x={},h=new Array(v),f=0;f<v;f++){h[f]=-1;for(var m=0,S=d;m<S;m++){var j=o({currentValue:n,lastValue:e,formattedValue:t,currentValueIndex:f,formattedValueIndex:m});if(j&&x[m]!==!0){h[f]=m,x[m]=!0;break}}}for(var p=r;p<v&&(h[p]===-1||!a(n[p]));)p++;var R=p===v||h[p]===-1?d:h[p];for(p=r-1;p>0&&h[p]===-1;)p--;var P=p===-1||h[p]===-1?0:h[p]+1;return P>R?R:r-P<R-r?P:R}function rt(t,e,n,r){var i=t.length;if(e=mn(e,0,i),r==="left"){for(;e>=0&&!n[e];)e--;e===-1&&(e=n.indexOf(!0))}else{for(;e<=i&&!n[e];)e++;e>i&&(e=n.lastIndexOf(!0))}return e===-1&&(e=i),e}function _n(t){for(var e=Array.from({length:t.length+1}).map(function(){return!0}),n=0,r=e.length;n<r;n++)e[n]=!!(Se(t[n])||Se(t[n-1]));return e}function vt(t,e,n,r,i,a){a===void 0&&(a=oe);var o=fn(function(m,S){var j,p;return dt(m)?(p="",j=""):typeof m=="number"||S?(p=typeof m=="number"?ht(m):m,j=r(p)):(p=i(m,void 0),j=r(p)),{formattedValue:j,numAsString:p}}),l=C.useState(function(){return o(pe(t)?e:t,n)}),u=l[0],v=l[1],d=function(m,S){m.formattedValue!==u.formattedValue&&v({formattedValue:m.formattedValue,numAsString:m.value}),a(m,S)},x=t,h=n;pe(t)&&(x=u.numAsString,h=!0);var f=o(x,h);return C.useMemo(function(){v(f)},[f.formattedValue]),[u,d]}function Sn(t){return t.replace(/[^0-9]/g,"")}function bn(t){return t}function Cn(t){var e=t.type;e===void 0&&(e="text");var n=t.displayType;n===void 0&&(n="input");var r=t.customInput,i=t.renderText,a=t.getInputRef,o=t.format;o===void 0&&(o=bn);var l=t.removeFormatting;l===void 0&&(l=Sn);var u=t.defaultValue,v=t.valueIsNumericString,d=t.onValueChange,x=t.isAllowed,h=t.onChange;h===void 0&&(h=oe);var f=t.onKeyDown;f===void 0&&(f=oe);var m=t.onMouseUp;m===void 0&&(m=oe);var S=t.onFocus;S===void 0&&(S=oe);var j=t.onBlur;j===void 0&&(j=oe);var p=t.value,R=t.getCaretBoundary;R===void 0&&(R=_n);var P=t.isValidInputCharacter;P===void 0&&(P=Se);var G=t.isCharacterSame,U=ut(t,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),Q=vt(p,u,!!v,o,l,d),Y=Q[0],E=Y.formattedValue,K=Y.numAsString,W=Q[1],$=C.useRef(),ee=C.useRef({formattedValue:E,numAsString:K}),z=function(y,s){ee.current={formattedValue:y.formattedValue,numAsString:y.value},W(y,s)},A=C.useState(!1),re=A[0],w=A[1],b=C.useRef(null),B=C.useRef({setCaretTimeout:null,focusTimeout:null});C.useEffect(function(){return w(!0),function(){clearTimeout(B.current.setCaretTimeout),clearTimeout(B.current.focusTimeout)}},[]);var M=o,V=function(y,s){var g=parseFloat(s);return{formattedValue:y,value:s,floatValue:isNaN(g)?void 0:g}},I=function(y,s,g){y.selectionStart===0&&y.selectionEnd===y.value.length||(ue(y,s),B.current.setCaretTimeout=setTimeout(function(){y.value===g&&y.selectionStart!==s&&ue(y,s)},0))},k=function(y,s,g){return rt(y,s,R(y),g)},ne=function(y,s,g){var _=R(s),N=yn(s,E,y,g,_,P,G);return N=rt(s,N,_),N},de=function(y){var s=y.formattedValue;s===void 0&&(s="");var g=y.input,_=y.source,N=y.event,F=y.numAsString,D;if(g){var q=y.inputValue||g.value,ae=Le(g);g.value=s,D=ne(q,s,ae),D!==void 0&&I(g,D,s)}s!==E&&z(V(s,F),{event:N,source:_})};C.useEffect(function(){var y=ee.current,s=y.formattedValue,g=y.numAsString;(E!==s||K!==g)&&z(V(E,K),{event:void 0,source:_e.props})},[E,K]);var ie=b.current?Le(b.current):void 0,le=typeof window<"u"?C.useLayoutEffect:C.useEffect;le(function(){var y=b.current;if(E!==ee.current.formattedValue&&y){var s=ne(ee.current.formattedValue,E,ie);y.value=E,I(y,s,E)}},[E]);var fe=function(y,s,g){var _=s.target,N=$.current?hn($.current,_.selectionEnd):mt(E,y),F=Object.assign(Object.assign({},N),{lastValue:E}),D=l(y,F),q=M(D);if(D=l(q,void 0),x&&!x(V(q,D))){var ae=s.target,se=Le(ae),Ie=ne(y,E,se);return ae.value=E,I(ae,Ie,E),!1}return de({formattedValue:q,numAsString:D,inputValue:y,event:s,source:g,input:s.target}),!0},ge=function(y,s){s===void 0&&(s=0);var g=y.selectionStart,_=y.selectionEnd;$.current={selectionStart:g,selectionEnd:_+s}},be=function(y){var s=y.target,g=s.value,_=fe(g,y,_e.event);_&&h(y),$.current=void 0},Ce=function(y){var s=y.target,g=y.key,_=s.selectionStart,N=s.selectionEnd,F=s.value;F===void 0&&(F="");var D;g==="ArrowLeft"||g==="Backspace"?D=Math.max(_-1,0):g==="ArrowRight"?D=Math.min(_+1,F.length):g==="Delete"&&(D=_);var q=0;g==="Delete"&&_===N&&(q=1);var ae=g==="ArrowLeft"||g==="ArrowRight";if(D===void 0||_!==N&&!ae){f(y),ge(s,q);return}var se=D;if(ae){var Ie=g==="ArrowLeft"?"left":"right";se=k(F,D,Ie),se!==D&&y.preventDefault()}else g==="Delete"&&!P(F[D])?se=k(F,D,"right"):g==="Backspace"&&!P(F[D])&&(se=k(F,D,"left"));se!==D&&I(s,se,F),f(y),ge(s,q)},we=function(y){var s=y.target,g=function(){var _=s.selectionStart,N=s.selectionEnd,F=s.value;if(F===void 0&&(F=""),_===N){var D=k(F,_);D!==_&&I(s,D,F)}};g(),requestAnimationFrame(function(){g()}),m(y),ge(s)},Fe=function(y){y.persist&&y.persist();var s=y.target,g=y.currentTarget;b.current=s,B.current.focusTimeout=setTimeout(function(){var _=s.selectionStart,N=s.selectionEnd,F=s.value;F===void 0&&(F="");var D=k(F,_);D!==_&&!(_===0&&N===F.length)&&I(s,D,F),S(Object.assign(Object.assign({},y),{currentTarget:g}))},0)},je=function(y){b.current=null,clearTimeout(B.current.focusTimeout),clearTimeout(B.current.setCaretTimeout),j(y)},Ee=re&&vn()?"numeric":void 0,xe=Object.assign({inputMode:Ee},U,{type:e,value:E,onChange:be,onKeyDown:Ce,onMouseUp:we,onFocus:Fe,onBlur:je});if(n==="text")return i?me.createElement(me.Fragment,null,i(E,U)||null):me.createElement("span",Object.assign({},U,{ref:a}),E);if(r){var De=r;return me.createElement(De,Object.assign({},xe,{ref:a}))}return me.createElement("input",Object.assign({},xe,{ref:a}))}function it(t,e){var n=e.decimalScale,r=e.fixedDecimalScale,i=e.prefix;i===void 0&&(i="");var a=e.suffix;a===void 0&&(a="");var o=e.allowNegative,l=e.thousandsGroupStyle;if(l===void 0&&(l="thousand"),t===""||t==="-")return t;var u=Be(e),v=u.thousandSeparator,d=u.decimalSeparator,x=n!==0&&t.indexOf(".")!==-1||n&&r,h=qe(t,o),f=h.beforeDecimal,m=h.afterDecimal,S=h.addNegation;return n!==void 0&&(m=gt(m,n,!!r)),v&&(f=dn(f,v,l)),i&&(f=i+f),a&&(m=m+a),S&&(f="-"+f),t=f+(x&&d||"")+m,t}function Be(t){var e=t.decimalSeparator;e===void 0&&(e=".");var n=t.thousandSeparator,r=t.allowedDecimalSeparators;return n===!0&&(n=","),r||(r=[e,"."]),{decimalSeparator:e,thousandSeparator:n,allowedDecimalSeparators:r}}function wn(t,e){t===void 0&&(t="");var n=new RegExp("(-)"),r=new RegExp("(-)(.)*(-)"),i=n.test(t),a=r.test(t);return t=t.replace(/-/g,""),i&&!a&&e&&(t="-"+t),t}function Fn(t,e){return new RegExp("(^-)|[0-9]|"+ft(t),"g")}function jn(t,e,n){return t===""?!0:!(e!=null&&e.match(/\d/))&&!(n!=null&&n.match(/\d/))&&typeof t=="string"&&!isNaN(Number(t))}function En(t,e,n){var r;e===void 0&&(e=pn(t));var i=n.allowNegative,a=n.prefix;a===void 0&&(a="");var o=n.suffix;o===void 0&&(o="");var l=n.decimalScale,u=e.from,v=e.to,d=v.start,x=v.end,h=Be(n),f=h.allowedDecimalSeparators,m=h.decimalSeparator,S=t[x]===m;if(Se(t)&&(t===a||t===o)&&e.lastValue==="")return t;if(x-d===1&&f.indexOf(t[d])!==-1){var j=l===0?"":m;t=t.substring(0,d)+j+t.substring(d+1,t.length)}var p=function(b,B,M){var V=!1,I=!1;a.startsWith("-")?V=!1:b.startsWith("--")?(V=!1,I=!0):o.startsWith("-")&&b.length===o.length?V=!1:b[0]==="-"&&(V=!0);var k=V?1:0;return I&&(k=2),k&&(b=b.substring(k),B-=k,M-=k),{value:b,start:B,end:M,hasNegation:V}},R=p(t,d,x),P=R.hasNegation;r=R,t=r.value,d=r.start,x=r.end;var G=p(e.lastValue,u.start,u.end),U=G.start,Q=G.end,Y=G.value,E=t.substring(d,x);t.length&&Y.length&&(U>Y.length-o.length||Q<a.length)&&!(E&&o.startsWith(E))&&(t=Y);var K=0;t.startsWith(a)?K+=a.length:d<a.length&&(K=d),t=t.substring(K),x-=K;var W=t.length,$=t.length-o.length;t.endsWith(o)?W=$:(x>$||x>t.length-o.length)&&(W=x),t=t.substring(0,W),t=wn(P?"-"+t:t,i),t=(t.match(Fn(m))||[]).join("");var ee=t.indexOf(m);t=t.replace(new RegExp(ft(m),"g"),function(b,B){return B===ee?".":""});var z=qe(t,i),A=z.beforeDecimal,re=z.afterDecimal,w=z.addNegation;return v.end-v.start<u.end-u.start&&A===""&&S&&!parseFloat(re)&&(t=w?"-":""),t}function Dn(t,e){var n=e.prefix;n===void 0&&(n="");var r=e.suffix;r===void 0&&(r="");var i=Array.from({length:t.length+1}).map(function(){return!0}),a=t[0]==="-";i.fill(!1,0,n.length+(a?1:0));var o=t.length;return i.fill(!1,o-r.length+1,o+1),i}function Tn(t){var e=Be(t),n=e.thousandSeparator,r=e.decimalSeparator,i=t.prefix;i===void 0&&(i="");var a=t.allowNegative;if(a===void 0&&(a=!0),n===r)throw new Error(`
        Decimal separator can't be same as thousand separator.
        thousandSeparator: `+n+` (thousandSeparator = {true} is same as thousandSeparator = ",")
        decimalSeparator: `+r+` (default value for decimalSeparator is .)
     `);return i.startsWith("-")&&a&&(console.error(`
      Prefix can't start with '-' when allowNegative is true.
      prefix: `+i+`
      allowNegative: `+a+`
    `),a=!1),Object.assign(Object.assign({},t),{allowNegative:a})}function Rn(t){t=Tn(t),t.decimalSeparator,t.allowedDecimalSeparators,t.thousandsGroupStyle;var e=t.suffix,n=t.allowNegative,r=t.allowLeadingZeros,i=t.onKeyDown;i===void 0&&(i=oe);var a=t.onBlur;a===void 0&&(a=oe);var o=t.thousandSeparator,l=t.decimalScale,u=t.fixedDecimalScale,v=t.prefix;v===void 0&&(v="");var d=t.defaultValue,x=t.value,h=t.valueIsNumericString,f=t.onValueChange,m=ut(t,["decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","suffix","allowNegative","allowLeadingZeros","onKeyDown","onBlur","thousandSeparator","decimalScale","fixedDecimalScale","prefix","defaultValue","value","valueIsNumericString","onValueChange"]),S=Be(t),j=S.decimalSeparator,p=S.allowedDecimalSeparators,R=function(w){return it(w,t)},P=function(w,b){return En(w,b,t)},G=pe(x)?d:x,U=h??jn(G,v,e);pe(x)?pe(d)||(U=U||typeof d=="number"):U=U||typeof x=="number";var Q=function(w){return dt(w)?w:(typeof w=="number"&&(w=ht(w)),U&&typeof l=="number"?nt(w,l,!!u):w)},Y=vt(Q(x),Q(d),!!U,R,P,f),E=Y[0],K=E.numAsString,W=E.formattedValue,$=Y[1],ee=function(w){var b=w.target,B=w.key,M=b.selectionStart,V=b.selectionEnd,I=b.value;if(I===void 0&&(I=""),(B==="Backspace"||B==="Delete")&&V<v.length){w.preventDefault();return}if(M!==V){i(w);return}B==="Backspace"&&I[0]==="-"&&M===v.length+1&&n&&ue(b,1),l&&u&&(B==="Backspace"&&I[M-1]===j?(ue(b,M-1),w.preventDefault()):B==="Delete"&&I[M]===j&&w.preventDefault()),p!=null&&p.includes(B)&&I[M]===j&&ue(b,M+1);var k=o===!0?",":o;B==="Backspace"&&I[M-1]===k&&ue(b,M-1),B==="Delete"&&I[M]===k&&ue(b,M+1),i(w)},z=function(w){var b=K;if(b.match(/\d/g)||(b=""),r||(b=gn(b)),u&&l&&(b=nt(b,l,u)),b!==K){var B=it(b,t);$({formattedValue:B,value:b,floatValue:parseFloat(b)},{event:w,source:_e.event})}a(w)},A=function(w){return w===j?!0:Se(w)},re=function(w){var b=w.currentValue,B=w.lastValue,M=w.formattedValue,V=w.currentValueIndex,I=w.formattedValueIndex,k=b[V],ne=M[I],de=mt(B,b),ie=de.to,le=function(fe){return P(fe).indexOf(".")+v.length};return x===0&&u&&l&&b[ie.start]===j&&le(b)<V&&le(M)>I?!1:V>=ie.start&&V<ie.end&&p&&p.includes(k)&&ne===j?!0:k===ne};return Object.assign(Object.assign({},m),{value:W,valueIsNumericString:!1,isValidInputCharacter:A,isCharacterSame:re,onValueChange:$,format:R,removeFormatting:P,getCaretBoundary:function(w){return Dn(w,t)},onKeyDown:ee,onBlur:z})}function Nn(t){var e=Rn(t);return me.createElement(Cn,Object.assign({},e))}const Pn=({inputSuffix:t,inputPrefix:e,...n})=>c.jsx(H,{...n,value:n.value,suffix:t,prefix:e}),Bn=({onValueChange:t,...e})=>c.jsx(Nn,{customInput:Pn,onValueChange:t,...e}),Re=({inputSuffix:t,inputPrefix:e,onValueChange:n,...r})=>c.jsx(Bn,{inputPrefix:e,inputSuffix:t,onValueChange:n,...r}),at=[{label:"Producer",value:"Producer"},{label:"Distributor",value:"Distributor"},{label:"Recycler",value:"Recycler"},{label:"Collector",value:"Collector"},{label:"Retailer",value:"Retailer"}],In=[{label:"Plastic shopping/carry bags (having thickness less than 75 micron or less than 12 x 16 inch in size)",value:"Plastic shopping/carry bags (having thickness less than 75 micron)"},{label:"Other Single Use Plastics",value:"Other Single Use Plastics"}],An=[{label:"Notice issued",value:"Notice issued"},{label:"Confiscation",value:"Confiscation"},{label:"Sealing",value:"Sealing"},{label:"FIR",value:"FIR"},{label:"Complaint before Environmental Magistrate",value:"Complaint before Environmental Magistrate"},{label:"Fine Imposed",value:"Fine Imposed"},{label:"De Sealed",value:"De Sealed"}],Mn=({control:t,errors:e,readOnly:n=!1,defaultValues:r})=>{var ne,de,ie,le,fe,ge,be,Ce,we,Fe,je,Ee,xe,De,y;const[i,a]=C.useState([]),[o,l]=C.useState([]),{setValue:u,getValues:v,trigger:d}=ot(),[x,h]=C.useState(""),f=te({control:t,name:"violationFound",defaultValue:[]}),m=te({control:t,name:"violationType",defaultValue:[]}),S=te({control:t,name:"actionTaken",defaultValue:[]}),j=te({control:t,name:"fineRecoveryStatus",defaultValue:[]});te({control:t,name:"fineAmount",defaultValue:0});const p=(s,g)=>{l(g);const _=g.filter(N=>!i.includes(N));_.length>0&&a(N=>[...N,..._])},R=te({control:t,name:"plasticBagsConfiscation",defaultValue:0}),P=te({control:t,name:"confiscation_otherPlastics",defaultValue:{}}),[G,U]=C.useState(0);C.useEffect(()=>{if(S.includes("Confiscation")){let s=0;m.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&(s+=parseFloat(R)||0),o.forEach(g=>{P[g]&&(s+=parseFloat(P[g])||0)}),U(s),u("totalConfiscation",s)}},[R,P,S,u,o,m]),C.useEffect(()=>{pt.get("/pmc/inspection-report-cached/all_other_single_use_plastics/").then(s=>{a(s.data.single_use_plastic_items||[])}).catch(s=>{console.error("Error fetching available options:",s)})},[]),C.useEffect(()=>{if(r!=null&&r.fineRecoveryBreakup){const s=r.fineRecoveryBreakup.map(g=>({...g,isNew:!1}));K(s)}},[r==null?void 0:r.fineRecoveryBreakup]);const Q=te({control:t,name:"fineAmount",defaultValue:0});te({control:t,name:"recoveryAmount",defaultValue:0});const Y=te({control:t,name:"fineRecoveryBreakup",defaultValue:[]}),[E,K]=C.useState(Y||[]),[W,$]=C.useState(0);C.useEffect(()=>{console.log("Updating total recovery"),console.log("recoveryEntries",E);const s=E.reduce((g,_)=>g+(_.amount||0),0);$(s),console.log("fineReoceryBreakup is setup")},[E,u]);const ee=()=>{W<Q&&K([...E,{date:"",amount:0,isNew:!0}])},z=(s,g,_)=>{console.log("recovery amount updated:"),console.log(s,g,_),K(N=>{const F=N.map((D,q)=>q===s?{...D,[g]:g==="amount"?parseFloat(_)||0:_}:D);return console.log("🔹 Updated Recovery Entries:",F),F})};C.useEffect(()=>{console.log("Updated recovery entries:",E),console.log("Calculated Total Recovery:",W)},[E,W]),C.useEffect(()=>{r!=null&&r.OtherSingleUseItems&&l(r.OtherSingleUseItems)},[r==null?void 0:r.OtherSingleUseItems]);const[A,re]=C.useState({lat:r.latitude,lng:r.longitude,district:""}),w=s=>{console.log("Selected Location:",s),(!s.lat||!s.lng)&&console.warn("Latitude or Longitude is missing, retrying..."),re({lat:s.lat||A.lat,lng:s.lng||A.lng,district:s.district||A.district})},b=s=>{s.key==="Backspace"&&h(B(x,!0))},B=(s,g)=>{let _=s.replace(/[^a-zA-Z0-9]/g,""),N=_.slice(0,3).toUpperCase().replace(/[^A-Z]/g,""),F=_.slice(3,6).toUpperCase().replace(/[^A-Z]/g,""),D=_.slice(6).replace(/[^0-9]/g,"");if(g)return[N,F,D].filter(Boolean).join("-");let q="";return N&&(q+=N+(N.length===3?"-":"")),F&&(q+=F+(F.length===3?"-":"")),D&&(q+=D),q};console.log("fineRecoveryBreakup:",r==null?void 0:r.fineRecoveryBreakup),console.log("readOnly",n),Ne(s=>s.user.district_id);const M=Ne(s=>s.user.district_name)||"";console.log("district_name:",M),console.log("location:",r==null?void 0:r.location),console.log("defaultValues:",r);const{latitude:V,longitude:I}=r,k=V&&I?{lat:V,lng:I}:null;return C.useEffect(()=>{const g=setInterval(()=>{(!A.lat||!A.lng)&&(console.log("Retrying location fetch..."),k?re(k):console.warn("No valid location found, please select again."))},2e3);return()=>clearInterval(g)},[A.lat,A.lng,k]),c.jsxs(jt,{children:[c.jsxs("h4",{className:"mb-6",children:["Inspection Report - ",M]}),c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsx(L,{label:"Inspection Date*",invalid:!!e.inspectionDate,errorMessage:(ne=e.inspectionDate)==null?void 0:ne.message,children:c.jsx(O,{name:"inspectionDate",control:t,render:({field:s})=>c.jsx(H,{type:"date",...s,readOnly:n})})}),c.jsx(L,{label:"Name of Business*",invalid:!!e.businessName,errorMessage:(de=e.businessName)==null?void 0:de.message,children:c.jsx(O,{name:"businessName",control:t,render:({field:s})=>c.jsx(H,{type:"text",placeholder:"Business Name",readOnly:n,...s})})}),c.jsx(L,{label:"Type of Business*",invalid:!!e.businessType,errorMessage:(ie=e.businessType)==null?void 0:ie.message,children:c.jsx(O,{name:"businessType",control:t,render:({field:s})=>c.jsx(We,{options:at,value:at.find(g=>g.value===s.value),isDisabled:n,onChange:g=>s.onChange(g==null?void 0:g.value)})})}),c.jsx(L,{label:"Plastic Application / License Number",invalid:!!e.licenseNumber,errorMessage:(le=e.licenseNumber)==null?void 0:le.message,children:c.jsx(O,{name:"licenseNumber",control:t,render:({field:s})=>c.jsx(H,{value:x,onChange:g=>h(B(g.target.value,!1)),onKeyDown:b,placeholder:"e.g., LHR-PRO-001",title:"Tracking Number (e.g., LHR-PRO-001)",readOnly:n})})})]}),c.jsx(L,{label:"Violation Found",invalid:!!e.violationFound,errorMessage:(fe=e.violationFound)==null?void 0:fe.message,children:c.jsx(O,{name:"violationFound",control:t,render:({field:s})=>c.jsx(he.Group,{value:s.value||[],onChange:g=>s.onChange(g),className:"flex flex-col gap-2 mb-2 ml-2",children:c.jsx(he,{...s,value:"Yes",disabled:n,children:"Yes"})})},"a1")}),f.includes("Yes")&&c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsxs(L,{label:"Type of Violation Found*",invalid:!!e.violationType,errorMessage:(ge=e.violationType)==null?void 0:ge.message,children:[In.map(s=>c.jsx(O,{name:"violationType",control:t,render:({field:g})=>c.jsx(he.Group,{value:g.value||[],onChange:_=>g.onChange(_),className:"flex flex-col gap-2 mb-2 ml-2",children:c.jsx(he,{...g,value:s.value,disabled:n,children:s.label})})},s.value)),m.includes("Other Single Use Plastics")&&c.jsx(L,{label:"Add List + (If desired item is not in the list, then type and press enter to add)",invalid:!!e.PackagingItems,errorMessage:(be=e.PackagingItems)==null?void 0:be.message,className:"ml-2 mt-4",children:c.jsx(O,{name:"OtherSingleUseItems",control:t,render:({field:s})=>c.jsx(zt,{multiple:!0,freeSolo:!0,options:i,value:o,readOnly:n,onChange:(g,_)=>{s.onChange(_),p(g,_)},renderTags:(g,_)=>g.map((N,F)=>c.jsx(Xt,{variant:"outlined",label:N,..._({index:F})})),renderInput:g=>c.jsx(Jt,{...g,variant:"outlined",label:"Other Single Use Plastics",placeholder:"Add or select Single Use Plastics"})})})})]}),c.jsx(L,{label:"Action Taken*",invalid:!!e.actionTaken,errorMessage:(Ce=e.actionTaken)==null?void 0:Ce.message,children:An.map(s=>c.jsx(O,{name:"actionTaken",control:t,render:({field:g})=>c.jsx(he.Group,{value:g.value||[],onChange:_=>g.onChange(_),className:"flex flex-col gap-2 mb-2 ml-2",children:c.jsx(he,{...g,value:s.value,disabled:n&&s.value!=="De Sealed",children:s.label})})},s.value))}),S.includes("Confiscation")&&m.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&c.jsx(L,{label:"Plastic shopping/carry bags (having thickness less than 75 micron) (KG)",invalid:!!e.plasticBagsConfiscation,errorMessage:(we=e.plasticBagsConfiscation)==null?void 0:we.message,children:c.jsx(O,{name:"plasticBagsConfiscation",control:t,render:({field:s})=>c.jsx(Re,{placeholder:"Enter KG",...s,readOnly:n})})}),S.includes("Confiscation")&&m.includes("Other Single Use Plastics")&&o.map((s,g)=>c.jsx(L,{label:`${s} Confiscation (KG)`,children:c.jsx(O,{name:`confiscation_otherPlastics.${s}`,control:t,render:({field:_})=>c.jsx(H,{type:"number",placeholder:"Enter KG",..._,readOnly:n})})},g)),S.includes("Confiscation")&&c.jsx(L,{label:"Total Confiscation (KG)",invalid:!!e.totalConfiscation,errorMessage:(Fe=e.totalConfiscation)==null?void 0:Fe.message,children:c.jsx(O,{name:"totalConfiscation",control:t,render:({field:s})=>(C.useEffect(()=>{s.onChange(G)},[G]),c.jsx(H,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...s}))})}),S.includes("Fine Imposed")&&c.jsxs(c.Fragment,{children:[c.jsx(L,{label:"Fine Amount (PKR)",invalid:!!e.fineAmount,errorMessage:(je=e.fineAmount)==null?void 0:je.message,children:c.jsx(O,{name:"fineAmount",control:t,render:({field:s})=>c.jsx(Re,{placeholder:"Enter Fine Amount",...s,readOnly:n})})}),c.jsx(L,{label:"Fine Recovery Status",invalid:!!e.fineRecoveryStatus,errorMessage:(Ee=e.fineRecoveryStatus)==null?void 0:Ee.message,children:c.jsx(O,{name:"fineRecoveryStatus",control:t,render:({field:s})=>c.jsx(We,{options:[{label:"Pending",value:"Pending"},{label:"Partial",value:"Partial"},{label:"Recovered",value:"Recovered"}],value:{label:s.value,value:s.value},onChange:g=>s.onChange(g==null?void 0:g.value),isDisabled:n&&s.value==="Recovered"})})}),j!=="Pending"&&c.jsxs(c.Fragment,{children:[c.jsx(L,{label:"Total Recovery Amount (PKR)",invalid:!!e.recoveryAmount,errorMessage:(xe=e.recoveryAmount)==null?void 0:xe.message,children:c.jsx(O,{name:"recoveryAmount",control:t,render:({field:s})=>(C.useEffect(()=>{s.onChange(W)},[W]),c.jsx(Re,{placeholder:"Auto-calculated",readOnly:!0,...s}))})}),E.map((s,g)=>{var _,N;return c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsx(L,{label:"Recovery Date",invalid:!!e.fineRecoveryBreakup,errorMessage:(_=e.fineAmount)==null?void 0:_.fineRecoveryBreakup,children:c.jsx(H,{type:"date",value:s.date,onChange:F=>z(g,"date",F.target.value),readOnly:!s.isNew})}),c.jsx(L,{label:"Recovery Amount (PKR)",invalid:!!e.fineRecoveryBreakup,errorMessage:(N=e.fineAmount)==null?void 0:N.fineRecoveryBreakup,children:c.jsx(Re,{value:s.amount,onChange:F=>z(g,"amount",F.target.value),readOnly:!s.isNew})})]},g)}),c.jsx(Oe,{type:"button",onClick:ee,disabled:W>=Q,className:"mt-7",children:"+ Add Recovery"})]})]}),S.includes("De Sealed")&&c.jsxs(c.Fragment,{children:[c.jsx(L,{label:"De Sealed Date",invalid:!!e.deSealedDate,errorMessage:(De=e.deSealedDate)==null?void 0:De.message,children:c.jsx(O,{name:"deSealedDate",control:t,render:({field:s})=>c.jsx(H,{type:"date",...s,readOnly:n&&s.value!==null&&s.value!==""})})}),c.jsx(L,{label:"De Seal - Affidavit",invalid:!!e.affidavit,errorMessage:(y=e.affidavit)==null?void 0:y.message,children:c.jsx(O,{name:"affidavit",control:t,render:({field:s})=>c.jsx(H,{type:"file",accept:".pdf,.png,.jpg,.jpeg",onChange:g=>s.onChange(g.target.files[0]||null)})})})]})]}),c.jsxs("div",{style:{padding:"20px"},children:[c.jsx("h1",{children:"Select Location"}),c.jsx(on,{onLocationSelect:w,savedLocation:k,isEditing:!!(r!=null&&r.id)}),A.lat&&A.lng&&c.jsxs("div",{style:{marginTop:"20px",padding:"10px",border:"1px solid #ccc"},children:[c.jsx("h3",{children:"Selected Location Details:"}),c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsx(L,{label:"Latitude",children:c.jsx(O,{name:"latitude",control:t,render:({field:s})=>(C.useEffect(()=>{A.lat||console.warn("Latitude is missing, setting default..."),s.onChange(A.lat||0)},[A.lat]),c.jsx(H,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...s}))})}),c.jsx(L,{label:"Longitude",children:c.jsx(O,{name:"longitude",control:t,render:({field:s})=>(C.useEffect(()=>{A.lng||console.warn("Longitude is missing, setting default..."),s.onChange(A.lng||0)},[A.lng]),c.jsx(H,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...s}))})}),c.jsx(O,{name:"fineRecoveryBreakup",control:t,render:({field:s})=>(C.useEffect(()=>{s.onChange(E)},[E]),c.jsx(H,{type:"hidden",placeholder:"Auto-calculated",readOnly:!0,...s}))})]})]})]})]})},kn=T.object({businessName:T.string().min(1,{message:"Business name required"}),businessType:T.string().min(1,{message:"Business type required"}),licenseNumber:T.string().optional(),violationFound:T.array(T.string()).optional(),violationType:T.array(T.string()).optional(),actionTaken:T.array(T.string()).optional(),plasticBagsConfiscation:T.coerce.number().optional(),confiscation_otherPlastics:T.record(T.string(),T.coerce.number()).optional(),totalConfiscation:T.coerce.number().optional(),OtherSingleUseItems:T.array(T.string()).optional(),latitude:T.coerce.number().nullable(),longitude:T.coerce.number().nullable(),district:T.string().optional(),inspectionDate:T.string().min(1,{message:"Inspection date is required"}),fineAmount:T.coerce.number().optional(),fineRecoveryStatus:T.enum(["Pending","Partial","Recovered"]).optional(),fineRecoveryDate:T.string().optional(),recoveryAmount:T.coerce.number().optional(),deSealedDate:T.string().optional(),fineRecoveryBreakup:T.array(T.object({date:T.string().min(1,{message:"Date is required"}),amount:T.coerce.number().min(0,{message:"Amount must be a number and at least 0"}),isNew:T.boolean().optional()})).default([]),affidavit:T.instanceof(File,{message:"Must be a valid file"}).optional()}),Vn=({onFormSubmit:t,defaultValues:e={},readOnly:n,children:r})=>{const{handleSubmit:i,reset:a,formState:{errors:o},control:l}=ot({defaultValues:{fineRecoveryBreakup:(e==null?void 0:e.fineRecoveryBreakup)??[]},resolver:Qt(kn)});return C.useEffect(()=>{xt(e)||a(e)},[JSON.stringify(e)]),c.jsxs(wt,{className:"flex w-full h-full",containerClassName:"flex flex-col w-full justify-between",onSubmit:i(t),children:[c.jsx(st,{children:c.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:c.jsx("div",{className:"gap-4 flex flex-col flex-auto",children:c.jsx(Mn,{control:l,errors:o,defaultValues:e,readOnly:n})})})}),c.jsx(Ft,{children:r})]})},Ln=t=>t?{id:t.id,businessName:t.business_name,businessType:t.business_type,licenseNumber:t.license_number||"",violationFound:t.violation_found||[],violationType:t.violation_type||[],actionTaken:t.action_taken||[],plasticBagsConfiscation:t.plastic_bags_confiscation??0,confiscationOtherPlastics:t.confiscation_other_plastics||{},totalConfiscation:t.total_confiscation||0,OtherSingleUseItems:t.other_single_use_items||[],latitude:t.latitude??null,longitude:t.longitude??null,district:t.district||"",inspectionDate:t.inspection_date||null,fineAmount:t.fine_amount??0,fineRecoveryStatus:t.fine_recovery_status||void 0,fineRecoveryDate:t.fine_recovery_date||"",recoveryAmount:t.recovery_amount??0,deSealedDate:t.de_sealed_date||"",fineRecoveryBreakup:t.fine_recovery_breakup||null,syncStatus:t.syncStatus||void 0}:null,fr=()=>{const t=yt(),e=_t(),{reports:n,fetchReports:r,updateReport:i,addNewReport:a,syncReports:o}=nn(),[l,u]=C.useState(!1),[v,d]=C.useState(!1),h=new URLSearchParams(e.search).get("id");console.log(n);let f=C.useMemo(()=>{const p=n.find(R=>R.id==h);return p?Ln(p):null},[n,h]);f={...f,inspectionDate:(f==null?void 0:f.inspectionDate)||new Date().toISOString().split("T")[0]},C.useEffect(()=>{h&&!f&&r()},[f,r]),Ne(p=>p.user.district_id),Ne(p=>p.user.district_name);const m=async p=>{console.log("Submitting Data:",p),d(!0);const R={business_name:p.businessName,business_type:p.businessType,license_number:p.licenseNumber||"",violation_found:p.violationFound||[],violation_type:p.violationType||[],action_taken:p.actionTaken||[],plastic_bags_confiscation:p.plasticBagsConfiscation??0,confiscation_other_plastics:p.confiscationOtherPlastics||{},total_confiscation:p.totalConfiscation||0,other_single_use_items:p.OtherSingleUseItems||[],latitude:p.latitude??null,longitude:p.longitude??null,district:p.district||"",inspection_date:p.inspectionDate||null,fine_amount:p.fineAmount??0,fine_recovery_status:p.fineRecoveryStatus||void 0,fine_recovery_date:p.fineRecoveryDate||null,recovery_amount:p.recoveryAmount??0,de_sealed_date:p.deSealedDate||null,fine_recovery_breakup:p.fineRecoveryBreakup||null,affidavit:p.affidavit||null,syncStatus:h?"patch":"post"};try{h?i(h,R):a(R),console.log("✅ Report Updated in Store"),d(!1),t("/auth/EPAOperations/AllInspections")}catch(P){console.error("❌ Error in Submission:",P),d(!1)}},S=()=>u(!0),j=()=>{u(!1),bt.push(c.jsx(Ct,{type:"success",children:"Customer discard!"}),{placement:"top-center"}),t("/auth/EPAOperations/AllInspections")};return c.jsx(c.Fragment,{children:c.jsxs(c.Fragment,{children:[c.jsx(Vn,{newCustomer:!0,defaultValues:f,onFormSubmit:m,readOnly:h!==null,children:c.jsx(st,{children:c.jsxs("div",{className:"flex items-center justify-between px-8",children:[c.jsx("span",{}),c.jsxs("div",{className:"flex items-center",children:[c.jsx(Oe,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:c.jsx(St,{}),onClick:S,children:"Discard"}),c.jsx(Oe,{icon:c.jsx(tn,{}),variant:"solid",type:"submit",loading:v,children:"Save"})]})]})})}),c.jsx(en,{isOpen:l,type:"danger",title:"Discard changes",onClose:()=>u(!1),onCancel:()=>u(!1),onConfirm:j,children:c.jsx("p",{children:"Are you sure you want to discard this?"})})]})})};export{fr as default};
