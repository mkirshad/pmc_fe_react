import{r as P,A as ge,j as d,Y as fe,i as yt,a1 as ct,a2 as xt,V as St}from"./index-ClZ1D3YW.js";import{B as Ye}from"./Button-BDdSh-Me.js";import{f as Ct,t as bt,N as wt}from"./toast-DzHRrjRb.js";import{u as ut,b as _e,a as X,C as Q,F as Dt}from"./index.esm-rF5RvrN-.js";import{C as Ft,S as Tt,a as de,B as Pt}from"./index-Cjw-ac6U.js";import{I as ie}from"./Input-BucYOXaX.js";import{e as Et,p as Nt,g as jt,s as Vt,h as It,R as Bt,a as Oe,b as De,i as $e,j as Je,k as He,E as Ze,l as re,m as Ve,d as Re,P as ke,n as we,o as le,q as ae,r as ze,u as te,v as Fe,w as At,x as Mt,y as Lt,z as Ge,A as Ot,B as Rt,D as kt,H as Gt,I as qt,f as Ie,S as Xe,C as Ut,F as Kt,c as Qe,M as Wt,T as Yt,O as $t,V as Jt,J as Ht,t as Zt,G as zt}from"./terraformer-wkt-parser-BigPuMoS.js";import{A as Xt,C as Qt}from"./Autocomplete-CpDavdaV.js";import{T as er}from"./TextField-9Vn3-ST6.js";import{z as q,t as tr}from"./index-D3aL2x1p.js";import{C as Be}from"./ConfirmDialog-R-7qoeBo.js";import{u as rr,B as ar}from"./supidStore-DtpZxaKN.js";import"./classNames-CsTn49mz.js";import"./StatusIcon-BnImT7UO.js";import"./CloseButton-DzNN2dAy.js";import"./index-BQ1VkaX8.js";import"./DefaultPropsProvider-DjBBzL5c.js";import"./index-BLUdmI3I.js";import"./index-DAdE-ZFy.js";import"./index-INZugyEU.js";import"./_getPrototype-CJnBsJGJ.js";const et=0,ye=1,tt=[0,0,0,0],he=[],Ae={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Me extends Gt{constructor(e,r,a){super(e),this.features=r,this.mapBrowserEvent=a}}class nr extends Et{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Nt,this.defaultDeleteCondition_=function(a){return jt(a)&&Vt(a)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:It,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Bt,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Oe({source:new De({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:sr(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let r;if(e.features?r=e.features:e.source&&(this.source_=e.source,r=new $e(this.source_.getFeatures()),this.source_.addEventListener(Je.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Je.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!r)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=r,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(He.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(He.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const r=e.getGeometry();if(r){const n=this.SEGMENT_WRITERS_[r.getType()];n&&n(e,r)}const a=this.getMap();a&&a.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(a.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(Ze.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,r){if(!this.featuresBeingModified_){this.featuresBeingModified_=new $e;const a=this.featuresBeingModified_.getArray();for(let n=0,i=r.length;n<i;++n){const l=r[n].feature;l&&!a.includes(l)&&this.featuresBeingModified_.push(l)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Me(Ae.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Ze.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const r=this.rBush_,a=[];r.forEach(function(n){e===n.feature&&a.push(n)});for(let n=a.length-1;n>=0;--n){const i=a[n];for(let l=this.dragSegments_.length-1;l>=0;--l)this.dragSegments_[l][0]===i&&this.dragSegments_.splice(l,1);r.remove(i)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const r=e.target;this.removeFeature_(r),this.addFeature_(r)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,r){const a=r.getCoordinates(),n={feature:e,geometry:r,segment:[a,a]};this.rBush_.insert(r.getExtent(),n)}writeMultiPointGeometry_(e,r){const a=r.getCoordinates();for(let n=0,i=a.length;n<i;++n){const l=a[n],o={feature:e,geometry:r,depth:[n],index:n,segment:[l,l]};this.rBush_.insert(r.getExtent(),o)}}writeLineStringGeometry_(e,r){const a=r.getCoordinates();for(let n=0,i=a.length-1;n<i;++n){const l=a.slice(n,n+2),o={feature:e,geometry:r,index:n,segment:l};this.rBush_.insert(re(l),o)}}writeMultiLineStringGeometry_(e,r){const a=r.getCoordinates();for(let n=0,i=a.length;n<i;++n){const l=a[n];for(let o=0,u=l.length-1;o<u;++o){const m=l.slice(o,o+2),c={feature:e,geometry:r,depth:[n],index:o,segment:m};this.rBush_.insert(re(m),c)}}}writePolygonGeometry_(e,r){const a=r.getCoordinates();for(let n=0,i=a.length;n<i;++n){const l=a[n];for(let o=0,u=l.length-1;o<u;++o){const m=l.slice(o,o+2),c={feature:e,geometry:r,depth:[n],index:o,segment:m};this.rBush_.insert(re(m),c)}}}writeMultiPolygonGeometry_(e,r){const a=r.getCoordinates();for(let n=0,i=a.length;n<i;++n){const l=a[n];for(let o=0,u=l.length;o<u;++o){const m=l[o];for(let c=0,p=m.length-1;c<p;++c){const f=m.slice(c,c+2),h={feature:e,geometry:r,depth:[o,n],index:c,segment:f};this.rBush_.insert(re(f),h)}}}}writeCircleGeometry_(e,r){const a=r.getCenter(),n={feature:e,geometry:r,index:et,segment:[a,a]},i={feature:e,geometry:r,index:ye,segment:[a,a]},l=[n,i];n.featureSegments=l,i.featureSegments=l,this.rBush_.insert(Ve(a),n);let o=r;this.rBush_.insert(o.getExtent(),i)}writeGeometryCollectionGeometry_(e,r){const a=r.getGeometriesArray();for(let n=0;n<a.length;++n){const i=a[n],l=this.SEGMENT_WRITERS_[i.getType()];l(e,i)}}createOrUpdateVertexFeature_(e,r,a,n){let i=this.vertexFeature_;return i?i.getGeometry().setCoordinates(e):(i=new Re(new ke(e)),this.vertexFeature_=i,this.overlay_.getSource().addFeature(i)),i.set("features",r),i.set("geometries",a),i.set("existing",n),i}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let r;return!e.map.getView().getInteracting()&&e.type==we.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=we.SINGLECLICK||!this.ignoreNextSingleClick_?r=this.removePoint():r=!0),e.type==we.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!r}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const r=this.vertexFeature_;if(!r)return;this.getMap().getView().getProjection();const a=[],n=r.getGeometry().getCoordinates(),i=re([n]),l=this.rBush_.getInExtent(i),o={};l.sort(ir);for(let u=0,m=l.length;u<m;++u){const c=l[u],p=c.segment;let f=le(c.geometry);const h=c.depth;if(h&&(f+="-"+h.join("-")),o[f]||(o[f]=new Array(2)),c.geometry.getType()==="Circle"&&c.index===ye){const g=at(e,c);ae(g,n)&&!o[f][0]&&(this.dragSegments_.push([c,0]),o[f][0]=c);continue}if(ae(p[0],n)&&!o[f][0]){this.dragSegments_.push([c,0]),o[f][0]=c;continue}if(ae(p[1],n)&&!o[f][1]){if(o[f][0]&&o[f][0].index===0){let g=c.geometry.getCoordinates();switch(c.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":g=g[h[1]];case"Polygon":if(c.index!==g[h[0]].length-2)continue;break}}this.dragSegments_.push([c,1]),o[f][1]=c;continue}le(p)in this.vertexSegments_&&!o[f][0]&&!o[f][1]&&a.push(c)}return a}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([i])=>i));const r=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],a=[],n=[];for(let i=0,l=this.dragSegments_.length;i<l;++i){const o=this.dragSegments_[i],u=o[0],m=u.feature;a.includes(m)||a.push(m);const c=u.geometry;n.includes(c)||n.push(c);const p=u.depth;let f;const h=u.segment,g=o[1];for(;r.length<c.getStride();)r.push(h[g][r.length]);switch(c.getType()){case"Point":f=r,h[0]=r,h[1]=r;break;case"MultiPoint":f=c.getCoordinates(),f[u.index]=r,h[0]=r,h[1]=r;break;case"LineString":f=c.getCoordinates(),f[u.index+g]=r,h[g]=r;break;case"MultiLineString":f=c.getCoordinates(),f[p[0]][u.index+g]=r,h[g]=r;break;case"Polygon":f=c.getCoordinates(),f[p[0]][u.index+g]=r,h[g]=r;break;case"MultiPolygon":f=c.getCoordinates(),f[p[1]][p[0]][u.index+g]=r,h[g]=r;break;case"Circle":const w=c;if(h[0]=r,h[1]=r,u.index===et)this.changingFeature_=!0,w.setCenter(r),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let b=ze(te(w.getCenter()),te(r));w.setRadius(b),this.changingFeature_=!1}break}f&&this.setGeometryCoordinates_(c,f)}this.createOrUpdateVertexFeature_(r,a,n,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const r=e.coordinate,a=this.findInsertVerticesAndUpdateDragSegments_(r);if(a!=null&&a.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,a),this.vertexFeature_)){const n=this.vertexFeature_.getGeometry().getCoordinates();for(let i=a.length-1;i>=0;--i)this.insertVertex_(a[i],n);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let r=this.dragSegments_.length-1;r>=0;--r){const a=this.dragSegments_[r][0],n=a.geometry;if(n.getType()==="Circle"){const i=n,l=i.getCenter(),o=a.featureSegments[0],u=a.featureSegments[1];o.segment[0]=l,o.segment[1]=l,u.segment[0]=l,u.segment[1]=l,this.rBush_.update(Ve(l),o);let m=i;this.rBush_.update(m.getExtent(),u)}else this.rBush_.update(re(a.segment),a)}return this.featuresBeingModified_&&(this.dispatchEvent(new Me(Ae.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const r=this.getMap(),a=r.getPixelFromCoordinate(e);r.getView().getProjection();const n=function(o,u){return rt(e,o)-rt(e,u)};let i,l;if(this.hitDetection_){const o=typeof this.hitDetection_=="object"?u=>u===this.hitDetection_:void 0;r.forEachFeatureAtPixel(a,(u,m,c)=>{c&&c.getType()==="Point"&&(c=new ke(Fe(c.getCoordinates())));const p=c||u.getGeometry();if(p&&p.getType()==="Point"&&u instanceof Re&&this.features_.getArray().includes(u)){l=p;const f=u.getGeometry().getFlatCoordinates().slice(0,2);i=[{feature:u,geometry:l,segment:[f,f]}]}return!0},{layerFilter:o})}if(!i){const o=At(Ve(e,tt)),u=r.getView().getResolution()*this.pixelTolerance_,m=Mt(Lt(o,u,tt));i=this.rBush_.getInExtent(m)}if(i&&i.length>0){const o=i.sort(n)[0],u=o.segment;let m=at(e,o);const c=r.getPixelFromCoordinate(m);let p=ze(a,c);if(l||p<=this.pixelTolerance_){const f={};if(f[le(u)]=!0,this.snapToPointer_||(this.delta_[0]=m[0]-e[0],this.delta_[1]=m[1]-e[1]),o.geometry.getType()==="Circle"&&o.index===ye)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(m,[o.feature],[o.geometry],this.snappedToVertex_);else{const h=r.getPixelFromCoordinate(u[0]),g=r.getPixelFromCoordinate(u[1]),w=Ge(c,h),b=Ge(c,g);p=Math.sqrt(Math.min(w,b)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(m=w>b?u[1]:u[0]),this.createOrUpdateVertexFeature_(m,[o.feature],[o.geometry],this.snappedToVertex_);const v={};v[le(o.geometry)]=!0;for(let E=1,A=i.length;E<A;++E){const j=i[E].segment;if(ae(u[0],j[0])&&ae(u[1],j[1])||ae(u[0],j[1])&&ae(u[1],j[0])){const M=le(i[E].geometry);M in v||(v[M]=!0,f[le(j)]=!0)}else break}}this.vertexSegments_=f;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,r){const a=e.segment,n=e.feature,i=e.geometry,l=e.depth,o=e.index;let u;for(;r.length<i.getStride();)r.push(0);switch(i.getType()){case"MultiLineString":u=i.getCoordinates(),u[l[0]].splice(o+1,0,r);break;case"Polygon":u=i.getCoordinates(),u[l[0]].splice(o+1,0,r);break;case"MultiPolygon":u=i.getCoordinates(),u[l[1]][l[0]].splice(o+1,0,r);break;case"LineString":u=i.getCoordinates(),u.splice(o+1,0,r);break;default:return!1}this.setGeometryCoordinates_(i,u);const m=this.rBush_;m.remove(e),this.updateSegmentIndices_(i,o,l,1);const c={segment:[a[0],r],feature:n,geometry:i,depth:l,index:o};m.insert(re(c.segment),c),this.dragSegments_.push([c,1]);const p={segment:[r,a[1]],feature:n,geometry:i,depth:l,index:o+1};return m.insert(re(p.segment),p),this.dragSegments_.push([p,0]),!0}updatePointer_(e){var r;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(r=this.vertexFeature_)==null?void 0:r.getGeometry().getCoordinates()}getPoint(){var r;const e=(r=this.vertexFeature_)==null?void 0:r.getGeometry().getCoordinates();return e?Fe(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(a=>a.getType()==="Circle"||a.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(re([e])).some(({segment:a})=>ae(a[0],e)||ae(a[1],e))}removePoint(e){if(e&&(e=te(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=we.POINTERDRAG){const r=this.lastPointerEvent_;this.willModifyFeatures_(r,this.dragSegments_.map(([n])=>n));const a=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Me(Ae.MODIFYEND,this.featuresBeingModified_,r)),this.featuresBeingModified_=null,a}return!1}removeVertex_(){const e=this.dragSegments_,r={};let a=!1,n,i,l,o,u,m,c,p,f,h,g;for(u=e.length-1;u>=0;--u)l=e[u],h=l[0],g=le(h.feature),h.depth&&(g+="-"+h.depth.join("-")),g in r||(r[g]={}),l[1]===0?(r[g].right=h,r[g].index=h.index):l[1]==1&&(r[g].left=h,r[g].index=h.index+1);for(g in r){switch(f=r[g].right,c=r[g].left,m=r[g].index,p=m-1,c!==void 0?h=c:h=f,p<0&&(p=0),o=h.geometry,i=o.getCoordinates(),n=i,a=!1,o.getType()){case"MultiLineString":i[h.depth[0]].length>2&&(i[h.depth[0]].splice(m,1),a=!0);break;case"LineString":i.length>2&&(i.splice(m,1),a=!0);break;case"MultiPolygon":n=n[h.depth[1]];case"Polygon":n=n[h.depth[0]],n.length>4&&(m==n.length-1&&(m=0),n.splice(m,1),a=!0,m===0&&(n.pop(),n.push(n[0]),p=n.length-1));break}if(a){this.setGeometryCoordinates_(o,i);const w=[];if(c!==void 0&&(this.rBush_.remove(c),w.push(c.segment[0])),f!==void 0&&(this.rBush_.remove(f),w.push(f.segment[1])),c!==void 0&&f!==void 0){const b={depth:h.depth,feature:h.feature,geometry:h.geometry,index:p,segment:w};this.rBush_.insert(re(b.segment),b)}this.updateSegmentIndices_(o,m,h.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return a}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(a=>a.getType()==="Circle"||a.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(re([e])).some(({segment:a})=>!(ae(a[0],e)||ae(a[1],e)))}insertPoint(e){var n;const r=e?te(e,this.getMap().getView().getProjection()):(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates();return r?this.findInsertVerticesAndUpdateDragSegments_(r).reduce((i,l)=>i||this.insertVertex_(l,r),!1):!1}setGeometryCoordinates_(e,r){this.changingFeature_=!0,e.setCoordinates(r),this.changingFeature_=!1}updateSegmentIndices_(e,r,a,n){this.rBush_.forEachInExtent(e.getExtent(),function(i){i.geometry===e&&(a===void 0||i.depth===void 0||Ot(i.depth,a))&&i.index>r&&(i.index+=n)})}}function ir(t,e){return t.index-e.index}function rt(t,e,r){const a=e.geometry;if(a.getType()==="Circle"){let i=a;if(e.index===ye){const l=Ge(i.getCenter(),te(t)),o=Math.sqrt(l)-i.getRadius();return o*o}}const n=te(t);return he[0]=te(e.segment[0]),he[1]=te(e.segment[1]),qt(n,he)}function at(t,e,r){const a=e.geometry;if(a.getType()==="Circle"&&e.index===ye)return Fe(a.getClosestPoint(te(t)));const n=te(t);return he[0]=te(e.segment[0]),he[1]=te(e.segment[1]),Fe(Rt(n,he))}function sr(){const t=kt();return function(e,r){return t.Point}}const or=({onLocationSelect:t})=>{const e=P.useRef(null),[r,a]=P.useState(null),[n,i]=P.useState(null),[l,o]=P.useState("Fetching..."),[u,m]=P.useState(null),[c,p]=P.useState({lat:null,lng:null});P.useEffect(()=>{const w=new De,b=new De,v=new Re({geometry:new ke(Ie([74.3436,31.5497]))});v.setStyle(new Xe({image:new Ut({radius:7,fill:new Kt({color:"red"}),stroke:new Qe({color:"white",width:2})})})),b.addFeature(v),i(v);const E=new Oe({source:b}),A=new Oe({source:w,style:new Xe({stroke:new Qe({color:"blue",width:2})})}),j=new Wt({target:e.current,layers:[new Yt({source:new $t}),A,E],view:new Jt({center:Ie([74.3436,31.5497]),zoom:12})});a(j),m(A),g(A),f(j,v);const M=new nr({source:b});return j.addInteraction(M),M.on("modifyend",ee=>{const Y=ee.features.item(0).getGeometry().getCoordinates(),V=Ht(Y);p({lat:V[1],lng:V[0]}),h(V[0],V[1])}),()=>j.setTarget(null)},[]);const f=(w,b)=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(v=>{const E=Ie([v.coords.longitude,v.coords.latitude]);b.getGeometry().setCoordinates(E),w.getView().setCenter(E),w.getView().setZoom(15),h(v.coords.longitude,v.coords.latitude)},v=>console.error("Geolocation error:",v),{enableHighAccuracy:!0})},h=async(w,b)=>{try{t({lat:b,lng:w,district:""});const v=await ge.get(`/pmc/DistrictByLatLon?lat=${b}&lon=${w}`);v.data&&v.data.district_name?(o(v.data.district_name),t({lat:b,lng:w,district:v.data.district_name})):o("District not found")}catch(v){console.error("Error fetching district:",v),o("Error fetching district")}},g=async w=>{try{const A={type:"FeatureCollection",features:(await ge.get("/pmc/districts-public")).data.filter(M=>M.geom).map(M=>({type:"Feature",geometry:Zt.parse(M.geom.replace("SRID=4326;","")),properties:{district_id:M.district_id,district_name:M.district_name}}))},j=new De({features:new zt().readFeatures(A,{featureProjection:"EPSG:3857"})});w.setSource(j)}catch(b){console.error("Error fetching district boundaries:",b)}};return d.jsxs("div",{children:[d.jsx("div",{ref:e,style:{height:"600px",width:"100%"}}),d.jsx("button",{type:"button",onClick:()=>f(r,n),style:{marginTop:"10px",padding:"10px",backgroundColor:"#007BFF",color:"#fff",border:"none",cursor:"pointer",borderRadius:"5px"},children:"üìç Go to Current Location"})]})};function dt(t,e){var r={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(r[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(t);n<a.length;n++)e.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(t,a[n])&&(r[a[n]]=t[a[n]]);return r}var xe;(function(t){t.event="event",t.props="prop"})(xe||(xe={}));function se(){}function lr(t){var e,r=void 0;return function(){for(var a=[],n=arguments.length;n--;)a[n]=arguments[n];return e&&a.length===e.length&&a.every(function(i,l){return i===e[l]})||(e=a,r=t.apply(void 0,a)),r}}function Se(t){return!!(t||"").match(/\d/)}function me(t){return t==null}function cr(t){return typeof t=="number"&&isNaN(t)}function ft(t){return me(t)||cr(t)||typeof t=="number"&&!isFinite(t)}function gt(t){return t.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function ur(t){switch(t){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;case"thousand":default:return/(\d)(?=(\d{3})+(?!\d))/g}}function dr(t,e,r){var a=ur(r),n=t.search(/[1-9]/);return n=n===-1?t.length:n,t.substring(0,n)+t.substring(n,t.length).replace(a,"$1"+e)}function fr(t){var e=P.useRef(t);e.current=t;var r=P.useRef(function(){for(var a=[],n=arguments.length;n--;)a[n]=arguments[n];return e.current.apply(e,a)});return r.current}function qe(t,e){e===void 0&&(e=!0);var r=t[0]==="-",a=r&&e;t=t.replace("-","");var n=t.split("."),i=n[0],l=n[1]||"";return{beforeDecimal:i,afterDecimal:l,hasNegation:r,addNegation:a}}function gr(t){if(!t)return t;var e=t[0]==="-";e&&(t=t.substring(1,t.length));var r=t.split("."),a=r[0].replace(/^0+/,"")||"0",n=r[1]||"";return(e?"-":"")+a+(n?"."+n:"")}function ht(t,e,r){for(var a="",n=r?"0":"",i=0;i<=e-1;i++)a+=t[i]||n;return a}function nt(t,e){return Array(e+1).join(t)}function mt(t){var e=t+"",r=e[0]==="-"?"-":"";r&&(e=e.substring(1));var a=e.split(/[eE]/g),n=a[0],i=a[1];if(i=Number(i),!i)return r+n;n=n.replace(".","");var l=1+i,o=n.length;return l<0?n="0."+nt("0",Math.abs(l))+n:l>=o?n=n+nt("0",l-o):n=(n.substring(0,l)||"0")+"."+n.substring(l),r+n}function it(t,e,r){if(["","-"].indexOf(t)!==-1)return t;var a=(t.indexOf(".")!==-1||r)&&e,n=qe(t),i=n.beforeDecimal,l=n.afterDecimal,o=n.hasNegation,u=parseFloat("0."+(l||"0")),m=l.length<=e?"0."+l:u.toFixed(e),c=m.split("."),p=i;i&&Number(c[0])&&(p=i.split("").reverse().reduce(function(w,b,v){return w.length>v?(Number(w[0])+Number(b)).toString()+w.substring(1,w.length):b+w},c[0]));var f=ht(c[1]||"",e,r),h=o?"-":"",g=a?".":"";return""+h+p+g+f}function ce(t,e){if(t.value=t.value,t!==null){if(t.createTextRange){var r=t.createTextRange();return r.move("character",e),r.select(),!0}return t.selectionStart||t.selectionStart===0?(t.focus(),t.setSelectionRange(e,e),!0):(t.focus(),!1)}}var pt=lr(function(t,e){for(var r=0,a=0,n=t.length,i=e.length;t[r]===e[r]&&r<n;)r++;for(;t[n-1-a]===e[i-1-a]&&i-a>r&&n-a>r;)a++;return{from:{start:r,end:n-a},to:{start:r,end:i-a}}}),hr=function(t,e){var r=Math.min(t.selectionStart,e);return{from:{start:r,end:t.selectionEnd},to:{start:r,end:e}}};function mr(t,e,r){return Math.min(Math.max(t,e),r)}function Le(t){return Math.max(t.selectionStart,t.selectionEnd)}function pr(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function vr(t){return{from:{start:0,end:0},to:{start:0,end:t.length},lastValue:""}}function _r(t){var e=t.currentValue,r=t.formattedValue,a=t.currentValueIndex,n=t.formattedValueIndex;return e[a]===r[n]}function yr(t,e,r,a,n,i,l){l===void 0&&(l=_r);var o=n.findIndex(function(j){return j}),u=t.slice(0,o);!e&&!r.startsWith(u)&&(e=u,r=u+r,a=a+u.length);for(var m=r.length,c=t.length,p={},f=new Array(m),h=0;h<m;h++){f[h]=-1;for(var g=0,w=c;g<w;g++){var b=l({currentValue:r,lastValue:e,formattedValue:t,currentValueIndex:h,formattedValueIndex:g});if(b&&p[g]!==!0){f[h]=g,p[g]=!0;break}}}for(var v=a;v<m&&(f[v]===-1||!i(r[v]));)v++;var E=v===m||f[v]===-1?c:f[v];for(v=a-1;v>0&&f[v]===-1;)v--;var A=v===-1||f[v]===-1?0:f[v]+1;return A>E?E:a-A<E-a?A:E}function st(t,e,r,a){var n=t.length;if(e=mr(e,0,n),a==="left"){for(;e>=0&&!r[e];)e--;e===-1&&(e=r.indexOf(!0))}else{for(;e<=n&&!r[e];)e++;e>n&&(e=r.lastIndexOf(!0))}return e===-1&&(e=n),e}function xr(t){for(var e=Array.from({length:t.length+1}).map(function(){return!0}),r=0,a=e.length;r<a;r++)e[r]=!!(Se(t[r])||Se(t[r-1]));return e}function vt(t,e,r,a,n,i){i===void 0&&(i=se);var l=fr(function(g,w){var b,v;return ft(g)?(v="",b=""):typeof g=="number"||w?(v=typeof g=="number"?mt(g):g,b=a(v)):(v=n(g,void 0),b=a(v)),{formattedValue:b,numAsString:v}}),o=P.useState(function(){return l(me(t)?e:t,r)}),u=o[0],m=o[1],c=function(g,w){g.formattedValue!==u.formattedValue&&m({formattedValue:g.formattedValue,numAsString:g.value}),i(g,w)},p=t,f=r;me(t)&&(p=u.numAsString,f=!0);var h=l(p,f);return P.useMemo(function(){m(h)},[h.formattedValue]),[u,c]}function Sr(t){return t.replace(/[^0-9]/g,"")}function Cr(t){return t}function br(t){var e=t.type;e===void 0&&(e="text");var r=t.displayType;r===void 0&&(r="input");var a=t.customInput,n=t.renderText,i=t.getInputRef,l=t.format;l===void 0&&(l=Cr);var o=t.removeFormatting;o===void 0&&(o=Sr);var u=t.defaultValue,m=t.valueIsNumericString,c=t.onValueChange,p=t.isAllowed,f=t.onChange;f===void 0&&(f=se);var h=t.onKeyDown;h===void 0&&(h=se);var g=t.onMouseUp;g===void 0&&(g=se);var w=t.onFocus;w===void 0&&(w=se);var b=t.onBlur;b===void 0&&(b=se);var v=t.value,E=t.getCaretBoundary;E===void 0&&(E=xr);var A=t.isValidInputCharacter;A===void 0&&(A=Se);var j=t.isCharacterSame,M=dt(t,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),ee=vt(v,u,!!m,l,o,c),Y=ee[0],V=Y.formattedValue,K=Y.numAsString,J=ee[1],$=P.useRef(),H=P.useRef({formattedValue:V,numAsString:K}),Z=function(_,y){H.current={formattedValue:_.formattedValue,numAsString:_.value},J(_,y)},x=P.useState(!1),T=x[0],S=x[1],C=P.useRef(null),I=P.useRef({setCaretTimeout:null,focusTimeout:null});P.useEffect(function(){return S(!0),function(){clearTimeout(I.current.setCaretTimeout),clearTimeout(I.current.focusTimeout)}},[]);var L=l,O=function(_,y){var F=parseFloat(y);return{formattedValue:_,value:y,floatValue:isNaN(F)?void 0:F}},R=function(_,y,F){_.selectionStart===0&&_.selectionEnd===_.value.length||(ce(_,y),I.current.setCaretTimeout=setTimeout(function(){_.value===F&&_.selectionStart!==y&&ce(_,y)},0))},U=function(_,y,F){return st(_,y,E(_),F)},ne=function(_,y,F){var B=E(y),D=yr(y,V,_,F,B,A,j);return D=st(y,D,B),D},pe=function(_){var y=_.formattedValue;y===void 0&&(y="");var F=_.input,B=_.source,D=_.event,s=_.numAsString,N;if(F){var G=_.inputValue||F.value,W=Le(F);F.value=y,N=ne(G,y,W),N!==void 0&&R(F,N,y)}y!==V&&Z(O(y,s),{event:D,source:B})};P.useEffect(function(){var _=H.current,y=_.formattedValue,F=_.numAsString;(V!==y||K!==F)&&Z(O(V,K),{event:void 0,source:xe.props})},[V,K]);var oe=C.current?Le(C.current):void 0,ue=typeof window<"u"?P.useLayoutEffect:P.useEffect;ue(function(){var _=C.current;if(V!==H.current.formattedValue&&_){var y=ne(H.current.formattedValue,V,oe);_.value=V,R(_,y,V)}},[V]);var ve=function(_,y,F){var B=y.target,D=$.current?hr($.current,B.selectionEnd):pt(V,_),s=Object.assign(Object.assign({},D),{lastValue:V}),N=o(_,s),G=L(N);if(N=o(G,void 0),p&&!p(O(G,N))){var W=y.target,k=Le(W),z=ne(_,V,k);return W.value=V,R(W,z,V),!1}return pe({formattedValue:G,numAsString:N,inputValue:_,event:y,source:F,input:y.target}),!0},Ce=function(_,y){y===void 0&&(y=0);var F=_.selectionStart,B=_.selectionEnd;$.current={selectionStart:F,selectionEnd:B+y}},Ue=function(_){var y=_.target,F=y.value,B=ve(F,_,xe.event);B&&f(_),$.current=void 0},Ke=function(_){var y=_.target,F=_.key,B=y.selectionStart,D=y.selectionEnd,s=y.value;s===void 0&&(s="");var N;F==="ArrowLeft"||F==="Backspace"?N=Math.max(B-1,0):F==="ArrowRight"?N=Math.min(B+1,s.length):F==="Delete"&&(N=B);var G=0;F==="Delete"&&B===D&&(G=1);var W=F==="ArrowLeft"||F==="ArrowRight";if(N===void 0||B!==D&&!W){h(_),Ce(y,G);return}var k=N;if(W){var z=F==="ArrowLeft"?"left":"right";k=U(s,N,z),k!==N&&_.preventDefault()}else F==="Delete"&&!A(s[N])?k=U(s,N,"right"):F==="Backspace"&&!A(s[N])&&(k=U(s,N,"left"));k!==N&&R(y,k,s),h(_),Ce(y,G)},We=function(_){var y=_.target,F=function(){var B=y.selectionStart,D=y.selectionEnd,s=y.value;if(s===void 0&&(s=""),B===D){var N=U(s,B);N!==B&&R(y,N,s)}};F(),requestAnimationFrame(function(){F()}),g(_),Ce(y)},Pe=function(_){_.persist&&_.persist();var y=_.target,F=_.currentTarget;C.current=y,I.current.focusTimeout=setTimeout(function(){var B=y.selectionStart,D=y.selectionEnd,s=y.value;s===void 0&&(s="");var N=U(s,B);N!==B&&!(B===0&&D===s.length)&&R(y,N,s),w(Object.assign(Object.assign({},_),{currentTarget:F}))},0)},Ee=function(_){C.current=null,clearTimeout(I.current.focusTimeout),clearTimeout(I.current.setCaretTimeout),b(_)},Ne=T&&pr()?"numeric":void 0,be=Object.assign({inputMode:Ne},M,{type:e,value:V,onChange:Ue,onKeyDown:Ke,onMouseUp:We,onFocus:Pe,onBlur:Ee});if(r==="text")return n?fe.createElement(fe.Fragment,null,n(V,M)||null):fe.createElement("span",Object.assign({},M,{ref:i}),V);if(a){var je=a;return fe.createElement(je,Object.assign({},be,{ref:i}))}return fe.createElement("input",Object.assign({},be,{ref:i}))}function ot(t,e){var r=e.decimalScale,a=e.fixedDecimalScale,n=e.prefix;n===void 0&&(n="");var i=e.suffix;i===void 0&&(i="");var l=e.allowNegative,o=e.thousandsGroupStyle;if(o===void 0&&(o="thousand"),t===""||t==="-")return t;var u=Te(e),m=u.thousandSeparator,c=u.decimalSeparator,p=r!==0&&t.indexOf(".")!==-1||r&&a,f=qe(t,l),h=f.beforeDecimal,g=f.afterDecimal,w=f.addNegation;return r!==void 0&&(g=ht(g,r,!!a)),m&&(h=dr(h,m,o)),n&&(h=n+h),i&&(g=g+i),w&&(h="-"+h),t=h+(p&&c||"")+g,t}function Te(t){var e=t.decimalSeparator;e===void 0&&(e=".");var r=t.thousandSeparator,a=t.allowedDecimalSeparators;return r===!0&&(r=","),a||(a=[e,"."]),{decimalSeparator:e,thousandSeparator:r,allowedDecimalSeparators:a}}function wr(t,e){t===void 0&&(t="");var r=new RegExp("(-)"),a=new RegExp("(-)(.)*(-)"),n=r.test(t),i=a.test(t);return t=t.replace(/-/g,""),n&&!i&&e&&(t="-"+t),t}function Dr(t,e){return new RegExp("(^-)|[0-9]|"+gt(t),"g")}function Fr(t,e,r){return t===""?!0:!(e!=null&&e.match(/\d/))&&!(r!=null&&r.match(/\d/))&&typeof t=="string"&&!isNaN(Number(t))}function Tr(t,e,r){var a;e===void 0&&(e=vr(t));var n=r.allowNegative,i=r.prefix;i===void 0&&(i="");var l=r.suffix;l===void 0&&(l="");var o=r.decimalScale,u=e.from,m=e.to,c=m.start,p=m.end,f=Te(r),h=f.allowedDecimalSeparators,g=f.decimalSeparator,w=t[p]===g;if(Se(t)&&(t===i||t===l)&&e.lastValue==="")return t;if(p-c===1&&h.indexOf(t[c])!==-1){var b=o===0?"":g;t=t.substring(0,c)+b+t.substring(c+1,t.length)}var v=function(C,I,L){var O=!1,R=!1;i.startsWith("-")?O=!1:C.startsWith("--")?(O=!1,R=!0):l.startsWith("-")&&C.length===l.length?O=!1:C[0]==="-"&&(O=!0);var U=O?1:0;return R&&(U=2),U&&(C=C.substring(U),I-=U,L-=U),{value:C,start:I,end:L,hasNegation:O}},E=v(t,c,p),A=E.hasNegation;a=E,t=a.value,c=a.start,p=a.end;var j=v(e.lastValue,u.start,u.end),M=j.start,ee=j.end,Y=j.value,V=t.substring(c,p);t.length&&Y.length&&(M>Y.length-l.length||ee<i.length)&&!(V&&l.startsWith(V))&&(t=Y);var K=0;t.startsWith(i)?K+=i.length:c<i.length&&(K=c),t=t.substring(K),p-=K;var J=t.length,$=t.length-l.length;t.endsWith(l)?J=$:(p>$||p>t.length-l.length)&&(J=p),t=t.substring(0,J),t=wr(A?"-"+t:t,n),t=(t.match(Dr(g))||[]).join("");var H=t.indexOf(g);t=t.replace(new RegExp(gt(g),"g"),function(C,I){return I===H?".":""});var Z=qe(t,n),x=Z.beforeDecimal,T=Z.afterDecimal,S=Z.addNegation;return m.end-m.start<u.end-u.start&&x===""&&w&&!parseFloat(T)&&(t=S?"-":""),t}function Pr(t,e){var r=e.prefix;r===void 0&&(r="");var a=e.suffix;a===void 0&&(a="");var n=Array.from({length:t.length+1}).map(function(){return!0}),i=t[0]==="-";n.fill(!1,0,r.length+(i?1:0));var l=t.length;return n.fill(!1,l-a.length+1,l+1),n}function Er(t){var e=Te(t),r=e.thousandSeparator,a=e.decimalSeparator,n=t.prefix;n===void 0&&(n="");var i=t.allowNegative;if(i===void 0&&(i=!0),r===a)throw new Error(`
        Decimal separator can't be same as thousand separator.
        thousandSeparator: `+r+` (thousandSeparator = {true} is same as thousandSeparator = ",")
        decimalSeparator: `+a+` (default value for decimalSeparator is .)
     `);return n.startsWith("-")&&i&&(console.error(`
      Prefix can't start with '-' when allowNegative is true.
      prefix: `+n+`
      allowNegative: `+i+`
    `),i=!1),Object.assign(Object.assign({},t),{allowNegative:i})}function Nr(t){t=Er(t),t.decimalSeparator,t.allowedDecimalSeparators,t.thousandsGroupStyle;var e=t.suffix,r=t.allowNegative,a=t.allowLeadingZeros,n=t.onKeyDown;n===void 0&&(n=se);var i=t.onBlur;i===void 0&&(i=se);var l=t.thousandSeparator,o=t.decimalScale,u=t.fixedDecimalScale,m=t.prefix;m===void 0&&(m="");var c=t.defaultValue,p=t.value,f=t.valueIsNumericString,h=t.onValueChange,g=dt(t,["decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","suffix","allowNegative","allowLeadingZeros","onKeyDown","onBlur","thousandSeparator","decimalScale","fixedDecimalScale","prefix","defaultValue","value","valueIsNumericString","onValueChange"]),w=Te(t),b=w.decimalSeparator,v=w.allowedDecimalSeparators,E=function(S){return ot(S,t)},A=function(S,C){return Tr(S,C,t)},j=me(p)?c:p,M=f??Fr(j,m,e);me(p)?me(c)||(M=M||typeof c=="number"):M=M||typeof p=="number";var ee=function(S){return ft(S)?S:(typeof S=="number"&&(S=mt(S)),M&&typeof o=="number"?it(S,o,!!u):S)},Y=vt(ee(p),ee(c),!!M,E,A,h),V=Y[0],K=V.numAsString,J=V.formattedValue,$=Y[1],H=function(S){var C=S.target,I=S.key,L=C.selectionStart,O=C.selectionEnd,R=C.value;if(R===void 0&&(R=""),(I==="Backspace"||I==="Delete")&&O<m.length){S.preventDefault();return}if(L!==O){n(S);return}I==="Backspace"&&R[0]==="-"&&L===m.length+1&&r&&ce(C,1),o&&u&&(I==="Backspace"&&R[L-1]===b?(ce(C,L-1),S.preventDefault()):I==="Delete"&&R[L]===b&&S.preventDefault()),v!=null&&v.includes(I)&&R[L]===b&&ce(C,L+1);var U=l===!0?",":l;I==="Backspace"&&R[L-1]===U&&ce(C,L-1),I==="Delete"&&R[L]===U&&ce(C,L+1),n(S)},Z=function(S){var C=K;if(C.match(/\d/g)||(C=""),a||(C=gr(C)),u&&o&&(C=it(C,o,u)),C!==K){var I=ot(C,t);$({formattedValue:I,value:C,floatValue:parseFloat(C)},{event:S,source:xe.event})}i(S)},x=function(S){return S===b?!0:Se(S)},T=function(S){var C=S.currentValue,I=S.lastValue,L=S.formattedValue,O=S.currentValueIndex,R=S.formattedValueIndex,U=C[O],ne=L[R],pe=pt(I,C),oe=pe.to,ue=function(ve){return A(ve).indexOf(".")+m.length};return p===0&&u&&o&&C[oe.start]===b&&ue(C)<O&&ue(L)>R?!1:O>=oe.start&&O<oe.end&&v&&v.includes(U)&&ne===b?!0:U===ne};return Object.assign(Object.assign({},g),{value:J,valueIsNumericString:!1,isValidInputCharacter:x,isCharacterSame:T,onValueChange:$,format:E,removeFormatting:A,getCaretBoundary:function(S){return Pr(S,t)},onKeyDown:H,onBlur:Z})}function jr(t){var e=Nr(t);return fe.createElement(br,Object.assign({},e))}const Vr=({inputSuffix:t,inputPrefix:e,...r})=>d.jsx(ie,{...r,value:r.value,suffix:t,prefix:e}),Ir=({onValueChange:t,...e})=>d.jsx(jr,{customInput:Vr,onValueChange:t,...e}),Br=({inputSuffix:t,inputPrefix:e,onValueChange:r,...a})=>d.jsx(Ir,{inputPrefix:e,inputSuffix:t,onValueChange:r,...a}),lt=[{label:"Producer",value:"Producer"},{label:"Distributor",value:"Distributor"},{label:"Recycler",value:"Recycler"},{label:"Collector",value:"Collector"}],Ar=[{label:"Plastic shopping bags less than 75 microns",value:"Plastic shopping bags less than 75 microns"},{label:"Other Single Use Plastics",value:"Other Single Use Plastics"}],Mr=[{label:"Notice issued",value:"Notice issued"},{label:"Confiscation",value:"Confiscation"},{label:"Sealing",value:"Sealing"},{label:"FIR",value:"FIR"},{label:"Complaint before Environmental Magistrate",value:"Complaint before Environmental Magistrate"}],Lr=({control:t,errors:e,readOnly:r=!1})=>{var K,J,$,H,Z;const[a,n]=P.useState([]),[i,l]=P.useState([]),{setValue:o,getValues:u,trigger:m}=ut(),[c,p]=P.useState(""),f=_e({control:t,name:"violationFound",defaultValue:[]}),h=_e({control:t,name:"violationType",defaultValue:[]}),g=_e({control:t,name:"actionTaken",defaultValue:[]}),w=(x,T)=>{l(T);const S=T.filter(C=>!a.includes(C));S.length>0&&n(C=>[...C,...S])},b=_e({control:t,name:"plasticBagsConfiscation",defaultValue:0}),v=_e({control:t,name:"confiscation_otherPlastics",defaultValue:{}}),[E,A]=P.useState(0);P.useEffect(()=>{if(g.includes("Confiscation")){let x=0;x+=parseFloat(b)||0,Object.values(v).forEach(T=>{x+=parseFloat(T)||0}),A(x),o("totalConfiscation",x)}},[b,v,g,o]);const[j,M]=P.useState({lat:null,lng:null,district:""}),ee=x=>{console.log("Selected Location:",x),M(x),console.log(j)},Y=x=>{x.key==="Backspace"&&p(V(c,!0))},V=(x,T)=>{let S=x.replace(/[^a-zA-Z0-9]/g,""),C=S.slice(0,3).toUpperCase().replace(/[^A-Z]/g,""),I=S.slice(3,6).toUpperCase().replace(/[^A-Z]/g,""),L=S.slice(6).replace(/[^0-9]/g,"");if(T)return[C,I,L].filter(Boolean).join("-");let O="";return C&&(O+=C+(C.length===3?"-":"")),I&&(O+=I+(I.length===3?"-":"")),L&&(O+=L),O};return d.jsxs(Ft,{children:[d.jsx("h4",{className:"mb-6",children:"Inspection Report"}),d.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[d.jsx(X,{label:"Name of Business*",invalid:!!e.businessName,errorMessage:(K=e.businessName)==null?void 0:K.message,children:d.jsx(Q,{name:"businessName",control:t,render:({field:x})=>d.jsx(ie,{type:"text",placeholder:"Business Name",readOnly:r,...x})})}),d.jsx(X,{label:"Type of Business*",invalid:!!e.businessType,errorMessage:(J=e.businessType)==null?void 0:J.message,children:d.jsx(Q,{name:"businessType",control:t,render:({field:x})=>d.jsx(Tt,{options:lt,isDisabled:r,value:lt.find(T=>T.value===x.value),onChange:T=>x.onChange(T==null?void 0:T.value)})})}),d.jsx(X,{label:"Plastic Application / License Number",invalid:!!e.businessType,errorMessage:($=e.businessType)==null?void 0:$.message,children:d.jsx(Q,{name:"licenseNumber",control:t,render:({field:x})=>d.jsx(ie,{value:c,onChange:T=>p(V(T.target.value,!1)),onKeyDown:Y,placeholder:"e.g., LHR-PRO-001",title:"Tracking Number (e.g., LHR-PRO-001)"})})})]}),d.jsx(X,{label:"Violation Found*",children:d.jsx(Q,{name:"violationFound",control:t,render:({field:x})=>d.jsx(de.Group,{value:x.value||[],onChange:T=>x.onChange(T),className:"flex flex-col gap-2 mb-2 ml-2",children:d.jsx(de,{...x,value:"Yes",children:"Yes"})})},"a1")}),f.includes("Yes")&&d.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[d.jsxs(X,{label:"Type of Violation Found*",children:[Ar.map(x=>d.jsx(Q,{name:"violationType",control:t,render:({field:T})=>d.jsx(de.Group,{value:T.value||[],onChange:S=>T.onChange(S),className:"flex flex-col gap-2 mb-2 ml-2",children:d.jsx(de,{...T,value:x.value,children:x.label})})},x.value)),h.includes("Other Single Use Plastics")&&d.jsx(X,{label:"Add List + (If desired item is not in the list, then type and press enter to add)",invalid:!!e.PackagingItems,errorMessage:(H=e.PackagingItems)==null?void 0:H.message,className:"ml-2 mt-4",children:d.jsx(Q,{name:"OtherSingleUseItems",control:t,render:({field:x})=>d.jsx(Xt,{multiple:!0,freeSolo:!0,options:a,value:i,readOnly:r,onChange:(T,S)=>{x.onChange(S),w(T,S)},renderTags:(T,S)=>T.map((C,I)=>d.jsx(Qt,{variant:"outlined",label:C,...S({index:I})})),renderInput:T=>d.jsx(er,{...T,variant:"outlined",label:"Other Single Use Plastics",placeholder:"Add or select Single Use Plastics"})})})})]}),d.jsxs(X,{label:"Action Taken*",children:[Mr.map(x=>d.jsx(Q,{name:"actionTaken",control:t,render:({field:T})=>d.jsx(de.Group,{value:T.value||[],onChange:S=>T.onChange(S),className:"flex flex-col gap-2 mb-2 ml-2",children:d.jsx(de,{...T,value:x.value,children:x.label})})},x.value)),g.includes("Confiscation")&&d.jsxs("div",{children:[d.jsx("h4",{className:"mt-4",children:"Confiscation Details"}),h.includes("Plastic shopping bags less than 75 microns")&&d.jsx(X,{label:"Plastic shopping bags Confiscation (KG)",invalid:!!e.plasticBagsConfiscation,errorMessage:(Z=e.plasticBagsConfiscation)==null?void 0:Z.message,children:d.jsx(Q,{name:"plasticBagsConfiscation",control:t,render:({field:x})=>d.jsx(Br,{placeholder:"Enter KG",...x})})}),h.includes("Other Single Use Plastics")&&i.map((x,T)=>d.jsx(X,{label:`${x} Confiscation (KG)`,children:d.jsx(Q,{name:`confiscation_otherPlastics.${x}`,control:t,render:({field:S})=>d.jsx(ie,{type:"number",placeholder:"Enter KG",...S})})},T)),d.jsx(X,{label:"Total Confiscation (KG)",children:d.jsx(Q,{name:"totalConfiscation",control:t,render:({field:x})=>(P.useEffect(()=>{x.onChange(E)},[E]),d.jsx(ie,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...x}))})})]})]})]}),d.jsxs("div",{style:{padding:"20px"},children:[d.jsx("h1",{children:"Select Location"}),d.jsx(or,{onLocationSelect:ee}),j.lat&&j.lng&&d.jsxs("div",{style:{marginTop:"20px",padding:"10px",border:"1px solid #ccc"},children:[d.jsx("h3",{children:"Selected Location Details:"}),d.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[d.jsx(X,{label:"Latitude",children:d.jsx(Q,{name:"latitude",control:t,render:({field:x})=>(P.useEffect(()=>{x.onChange(j.lat)},[j.lat]),d.jsx(ie,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...x}))})}),d.jsx(X,{label:"Longitude",children:d.jsx(Q,{name:"longitude",control:t,render:({field:x})=>(P.useEffect(()=>{x.onChange(j.lng)},[j.lng]),d.jsx(ie,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...x}))})}),d.jsx(X,{label:"District",children:d.jsx(Q,{name:"district",control:t,render:({field:x})=>(P.useEffect(()=>{x.onChange(j.district)},[j.district]),d.jsx(ie,{type:"text",placeholder:"Auto-calculated",readOnly:!0,...x}))})})]})]})]})]})},Or=q.object({businessName:q.string().min(1,{message:"Business name required"}),businessType:q.string().min(1,{message:"Business type required"}),licenseNumber:q.string().optional(),violationFound:q.array(q.string()).optional(),violationType:q.array(q.string()).optional(),actionTaken:q.array(q.string()).optional(),plasticBagsConfiscation:q.coerce.number().optional(),confiscation_otherPlastics:q.record(q.string(),q.coerce.number()).optional(),totalConfiscation:q.coerce.number().optional(),OtherSingleUseItems:q.array(q.string()).optional(),latitude:q.coerce.number().nullable(),longitude:q.coerce.number().nullable(),district:q.string().optional()}),Rr=({onFormSubmit:t,defaultValues:e={},readOnly:r,children:a})=>{const{handleSubmit:n,reset:i,formState:{errors:l},control:o}=ut({defaultValues:e,resolver:tr(Or)});return P.useState(()=>{yt(e)||i(e)},[JSON.stringify(e)]),d.jsxs(Dt,{className:"flex w-full h-full",containerClassName:"flex flex-col w-full justify-between",onSubmit:n(t),children:[d.jsx(ct,{children:d.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:d.jsx("div",{className:"gap-4 flex flex-col flex-auto",children:d.jsx(Lr,{control:o,errors:l,readOnly:r})})})}),d.jsx(Pt,{children:a})]})},oa=()=>{const{id:t}=xt(),e=St(),[r,a]=P.useState(0);console.log("id is:",t);const[n,i]=P.useState(!1),[l,o]=P.useState(!1),[u,m]=P.useState(!1),[c,p]=P.useState(!1),[f,h]=P.useState(""),[g,w]=P.useState("success"),b=D=>{D<0?a(0):D>6?a(6):a(D)},v=()=>b(r-1),{applicantDetail:E,updateApplicantDetail:A,resetApplicantDetail:j,businessDetail:M,updateBusinessDetail:ee,resetBusinessDetail:Y,businessDetailIndividual:V,updateBusinessDetailIndividual:K,resetBusinessDetailIndividual:J,businessEntity:$,updateBusinessEntity:H,resetBusinessEntity:Z,resetAll:x,completedSections:T,getValuesFromStateBusinessEntity:S,getValuesFromLicenseDetail:C,updateLicenseDetail:I,updateLicenseDetailCollector:L,updateLicenseDetailConsumer:O,updateLicenseDetailProducer:R,updateLicenseDetailRecycler:U,resetLicenseDetail:ne,resetLicenseDetailProducer:pe,resetLicenseDetailConsumer:oe,resetLicenseDetailCollector:ue,resetLicenseDetailRecycler:ve,licenseDetailProducer:Ce,licenseDetailConsumer:Ue,licenseDetailCollector:Ke,licenseDetailRecycler:We}=rr(),Pe=E.applicationStatus!=="Created",Ee=E.assignedGroup!=="APPLICANT";E.assignedGroup,P.useEffect(()=>{(async()=>{var s,N;try{const G=await ge.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch(G){const W={status:(s=G.response)==null?void 0:s.status,data:(N=G.response)==null?void 0:N.data,message:G.message};e("/error",{state:{error:W}})}})(),t&&t!=="0"?Ne(t):(j(),Y(),J(),Z(),ne(),pe(),oe(),ve(),ue(),a(0))},[t]);const Ne=D=>{ge.get(`/pmc/applicant-detail/${D}/`,{headers:{"Content-Type":"multipart/form-data"}}).then(s=>{var G,W;console.log("Data:",s.data);const N={firstName:s.data.first_name,lastName:s.data.last_name,applicantDesignation:s.data.applicant_designation,gender:s.data.gender,cnic:s.data.cnic,email:s.data.email,phoneNumber:s.data.mobile_no,id:s.data.id,has_identity_document:s.data.has_identity_document,has_fee_challan:s.data.has_fee_challan,applicationStatus:s.data.application_status,assignedGroup:s.data.assigned_group,is_downloaded_fee_challan:s.data.is_downloaded_fee_challan};if(A(N),s.data.businessprofile){{const k={applicant:s.data.id,name:s.data.businessprofile.name,district:s.data.businessprofile.district,tehsil:s.data.businessprofile.tehsil,city:s.data.businessprofile.city_town_village,postalAddress:s.data.businessprofile.postal_address,mobileNumber:s.data.businessprofile.mobile_no,id:s.data.businessprofile.id};K(k)}H({businessEntityType:s.data.businessprofile.entity_type})}if(I({licenseType:s.data.registration_for}),s.data.producer&&s.data.registration_for==="Producer"){const k={tracking_number:s.data.producer.tracking_number||"",registration_required_for:s.data.producer.registration_required_for||[],registration_required_for_other:s.data.producer.registration_required_for_other||[],registration_required_for_other_other_text:s.data.producer.registration_required_for_other_other_text||"",plain_plastic_Sheets_for_food_wrapping:s.data.producer.plain_plastic_sheets_for_food_wrapping||[],PackagingItems:s.data.producer.packaging_items||[],number_of_machines:s.data.producer.number_of_machines||"",total_capacity_value:((G=s.data.producer.total_capacity_value)==null?void 0:G.toString())||"",date_of_setting_up:s.data.producer.date_of_setting_up||"",total_waste_generated_value:((W=s.data.producer.total_waste_generated_value)==null?void 0:W.toString())||"",has_waste_storage_capacity:s.data.producer.has_waste_storage_capacity||"",waste_disposal_provision:s.data.producer.waste_disposal_provision||"",applicant:s.data.producer.applicant||"",id:s.data.producer.id||null};R(k)}if(s.data.consumer&&s.data.registration_for==="Consumer"){const k={registration_required_for:s.data.consumer.registration_required_for||[],registration_required_for_other:s.data.consumer.registration_required_for_other||[],registration_required_for_other_other_text:s.data.consumer.registration_required_for_other_other_text||"",plain_plastic_Sheets_for_food_wrapping:s.data.consumer.plain_plastic_sheets_for_food_wrapping||[],PackagingItems:s.data.consumer.packaging_items||[],consumption:s.data.consumer.consumption||"",provision_waste_disposal_bins:s.data.consumer.provision_waste_disposal_bins||"No",no_of_waste_disposible_bins:s.data.consumer.no_of_waste_disposable_bins||"",segregated_plastics_handed_over_to_registered_recyclers:s.data.consumer.segregated_plastics_handed_over_to_registered_recyclers||"No",applicant:s.data.consumer.applicant||"",id:s.data.consumer.id||null};O(k)}if(s.data.recycler&&s.data.registration_for==="Recycler"){const k={selectedCategories:s.data.recycler.selected_categories||[],plastic_waste_acquired_through:s.data.recycler.plastic_waste_acquired_through||[],has_adequate_pollution_control_systems:s.data.recycler.has_adequate_pollution_control_systems||"No",pollution_control_details:s.data.recycler.pollution_control_details||"",applicant:s.data.recycler.applicant||"",registration_required_for_other_other_text:s.data.recycler.registration_required_for_other_other_text||"",id:s.data.recycler.id||null};U(k)}if(s.data.collector&&s.data.registration_for==="Collector"){const k={registration_required_for:s.data.collector.registration_required_for||[],registration_required_for_other:s.data.collector.registration_required_for_other||[],registration_required_for_other_other_text:s.data.collector.registration_required_for_other_other_text||"",selectedCategoriesCollector:s.data.collector.selected_categories||[],total_capacity_value_collector:s.data.collector.total_capacity_value||"",number_of_vehicles:s.data.collector.number_of_vehicles||"",number_of_persons:s.data.collector.number_of_persons||"",applicant:s.data.collector.applicant||"",id:s.data.collector.id||null};L(k)}s.data.application_status==="Fee Challan"&&a(4)}).catch(s=>{console.error("Error:",s)})},be=async D=>{var N,G,W,k;console.log("Submitted values",D),m(!0);const s=new FormData;s.append("business_name",D.businessName),s.append("business_type",D.businessType),D.licenseNumber&&s.append("license_number",D.licenseNumber),D.violationFound&&s.append("violation_found",JSON.stringify(D.violationFound)),D.violationType&&s.append("violation_type",JSON.stringify(D.violationType)),D.actionTaken&&s.append("action_taken",JSON.stringify(D.actionTaken)),D.plasticBagsConfiscation&&s.append("plastic_bags_confiscation",D.plasticBagsConfiscation.toString()),D.confiscation_otherPlastics&&s.append("confiscation_other_plastics",JSON.stringify(D.confiscation_otherPlastics)),D.totalConfiscation&&s.append("total_confiscation",D.totalConfiscation.toString()),D.OtherSingleUseItems&&s.append("other_single_use_items",JSON.stringify(D.OtherSingleUseItems)),s.append("latitude",((N=D.latitude)==null?void 0:N.toString())||""),s.append("longitude",((G=D.longitude)==null?void 0:G.toString())||""),s.append("district",D.district||"");try{let z;D.id?z=await ge.patch(`/pmc/inspection-report/${D.id}/`,s,{headers:{"Content-Type":"multipart/form-data"}}):z=await ge.post("/pmc/inspection-report/",s,{headers:{"Content-Type":"multipart/form-data"}}),console.log("Post successful:",z.data),m(!1),e("/auth/EPAOperations/AllInspections")}catch(z){console.error("Error in POST request:",z.response||z.message),m(!1);const _t={status:(W=z.response)==null?void 0:W.status,data:(k=z.response)==null?void 0:k.data,message:z.message};e("/error",{state:{error:_t}})}},je=()=>{i(!1),bt.push(d.jsx(wt,{type:"success",children:"Customer discard!"}),{placement:"top-center"}),e("/concepts/customers/customer-list")},_=()=>{i(!0)},y=()=>{i(!1),o(!1)},F=()=>{o(!1),v()};S(),C();const B=()=>{p(!1),E.applicationStatus==="Submitted"&&e("/home")};return d.jsxs(d.Fragment,{children:[d.jsx(Rr,{newCustomer:!0,defaultValues:E,onFormSubmit:be,readOnly:Pe&&Ee,children:d.jsx(ct,{children:d.jsxs("div",{className:"flex items-center justify-between px-8",children:[d.jsx("span",{}),d.jsxs("div",{className:"flex items-center",children:[d.jsx(Ye,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:d.jsx(Ct,{}),onClick:_,children:"Discard"}),d.jsx(Ye,{icon:d.jsx(ar,{}),variant:"solid",type:"submit",loading:u,children:"Save"})]})]})})}),d.jsx(Be,{isOpen:c,type:g,title:"Notification",onClose:B,onRequestClose:B,onConfirm:B,onCancel:B,children:d.jsx("p",{children:f})}),d.jsx(Be,{isOpen:n,type:"danger",title:"Discard changes",onClose:y,onRequestClose:y,onCancel:y,onConfirm:je,children:d.jsx("p",{children:"Are you sure you want discard this?"})}),d.jsx(Be,{isOpen:l,type:"danger",title:"Go Back",onClose:y,onRequestClose:y,onCancel:y,onConfirm:F,children:d.jsx("p",{children:"There are unsaved changes on this step, Are you sure you want to go back step?"})})]})};export{oa as default};
