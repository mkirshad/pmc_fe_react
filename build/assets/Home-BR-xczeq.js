import{r as i,k as I,W as k,j as n,A as w}from"./index-DnuspYaO.js";import{M as j}from"./index.esm-DW_l0syq.js";import{T as M}from"./index-BSwMoGvQ.js";import"./TextField-DnzLoTYC.js";import"./DefaultPropsProvider-B8bWQP4E.js";import"./Autocomplete-Bkh9yYw1.js";import"./FormControlLabel-TTFewDMt.js";import"./Divider-CNUGPaGs.js";import"./index-DvllCgW7.js";import"./useControllableState-CmA8CQq6.js";import"./classNames-CdBoP-Uu.js";const{TabNav:Y,TabList:Z,TabContent:ee}=M,P=t=>{var a,m,x;const o=(t.assigned_group==="APPLICANT"&&t.applicationassignment||[]).filter(l=>l.assigned_group==="APPLICANT"&&l.remarks&&l.remarks!=="undefined").map(l=>l.remarks),p=o.length>0?o.join("; "):"N/A";return{id:t.id,tracking_number:t.tracking_number,first_name:t.first_name,last_name:t.last_name,CNIC:t.cnic,mobile_no:t.mobile_no,application_status:t.application_status,assigned_group:t.assigned_group,registration_for:t.registration_for,application_Start_Time:((a=t.created_at)==null?void 0:a.substring(0,16))||"N/A",application_Submission_Time:((x=(m=t.submittedapplication)==null?void 0:m.created_at)==null?void 0:x.substring(0,16))||"N/A",remarks:p}},z=t=>t.map(_=>{const o=P(_);return Object.keys(o).forEach(p=>{(o[p]===void 0||o[p]===null)&&(o[p]="N/A")}),o}),te=()=>{const[t,_]=i.useState([]),[o,p]=i.useState([]),[a,m]=i.useState([]),[x,l]=i.useState(0),[S,b]=i.useState(null),[N,O]=i.useState({}),[$,G]=i.useState("tab1");console.log(S);const[R,A]=i.useState(!1),T=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],C={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},v=I(e=>e.user.authority)||[];console.log("user authority:",v);const y=(e,d,r)=>{const f=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],s=z(e),c=s[0];console.log(e);const u=[...Object.keys(c).filter(h=>f.includes(h)).map(h=>({accessorKey:h,header:h.replace(/_/g," ").replace(/\b\w/g,L=>L.toUpperCase()),Cell:({cell:L,row:E})=>n.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const D=E.original.id;console.log(`Clicked ${h}:`,L.getValue()),console.log(`Navigating with ID: ${D}`),window.location.href=d?`/spuid-review/${D}?group=${r}`:`/spuid-signup/${D}`},children:L.getValue()||"-"})}))];return{flattenedData:s,columns:u}},g=k();return i.useEffect(()=>{(async()=>{A(!0);try{let r=[];try{if(navigator.onLine){const s=await w.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})}else throw new Error("Application is offline. Cannot fetch data.");r=response.data||[],m(r.map(s=>s.name))}catch(s){console.error("Error fetching user groups:",s),m([])}if(console.log("groupsResponse",r),navigator.onLine){const s=await w.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})}else throw new Error("Application is offline. Cannot fetch data.");const f=response.data;if(Array.isArray(f)&&f.length>0){const s=y(f,r.length>0,r.map(u=>u.name)[0]);_(s.flattenedData),p(s.columns),console.log("Flattened Data:",s.flattenedData);const c=s.flattenedData[s.flattenedData.length-1];if(console.log("Last Row:",c),c&&c.id){b(c.id),console.log("Last Row ID:",c.id);const u=T.indexOf(c.assigned_group);u!==-1&&l(u)}}if(navigator.onLine){const s=await w.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}})}else throw new Error("Application is offline. Cannot fetch data.");O(statsResponse.data)}catch(r){console.error("Error fetching data:",r)}finally{A(!1)}})(),b(25);const d=T.indexOf("LSO");d!==-1&&l(d)},[]),i.useEffect(()=>{console.log("userGroups:",a),a.includes("DEO")||a.includes("DG")?g("/home-deo"):a.includes("Admin")?g("/home-admin"):a.includes("DO")?g("/home-do"):a.includes("Super")&&g("/home-super")},[a,g]),console.log("selectedRowId:",S),console.log(S),n.jsxs("div",{children:[n.jsx("div",{className:"tiles-container",children:Object.entries(N).map(([e,d])=>n.jsxs("div",{className:"tile",children:[n.jsx("h3",{children:C[e]||e})," ",n.jsx("p",{children:d})]},e))}),a.length>0&&n.jsx("div",{className:"mb-4",children:n.jsxs("h3",{children:[a.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),R?n.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),n.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):n.jsx(j,{columns:[...o],data:t.map(e=>({...e,assigned_group_title:C[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:100,size:140},enableColumnResizing:!0,enableTopToolbar:a.length>0,enablePagination:!0},S)]})};export{te as default};
