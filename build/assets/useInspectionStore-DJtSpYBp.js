import{a3 as f,a4 as y,A as d}from"./index-KL744_Zs.js";const l=f()(y((o,a)=>({reports:[],loading:!1,error:null,fetchReports:async()=>{a().reports.some(t=>t.syncStatus)&&(console.warn("Skipping fetch: Unsynced data exists"),l.getState().syncReports()),o({loading:!0,error:null});try{const t=await d.get("/pmc/inspection-report/");o({reports:t.data})}catch(t){console.error("Error fetching reports:",t),o({error:"Failed to fetch reports"})}finally{o({loading:!1})}},updateReport:(n,t)=>{console.log("its in update state"),o(e=>({reports:e.reports.map(s=>s.id===n?{...s,...t,syncStatus:"patch"}:s)})),l.getState().syncReports()},addNewReport:n=>{const t=`temp-${Date.now()}`;o(e=>({reports:[...e.reports,{...n,id:t,syncStatus:"post"}]}))},syncReports:async()=>{const{reports:n}=a(),t=n.filter(e=>e.syncStatus);if(t.length===0){console.log("No unsynced reports. Fetching fresh data..."),a().fetchReports();return}for(const e of t)try{let s,p=e,i={};if(e.hasFileUpload){const r=new FormData;r.append("id",e.id),r.append("business_name",e.businessName),r.append("license_number",e.licenseNumber||""),e.file&&r.append("file",e.file),p=r,i={"Content-Type":"multipart/form-data"}}e.syncStatus==="post"?(s=await d.post("/pmc/inspection-report/",p,{headers:i}),e.id=s.data.id):e.syncStatus==="patch"&&(s=await d.patch(`/pmc/inspection-report/${e.id}/`,p,{headers:i})),console.log("[✅ Synced]:",s.status,e.id),o(r=>({reports:r.reports.map(c=>c.id===e.id?{...c,syncStatus:void 0}:c)}))}catch(s){console.error("[❌ Sync Failed]:",e.id,s)}},resetReports:()=>o({reports:[]})}),{name:"inspection-reports",getStorage:()=>localStorage}));typeof window<"u"&&window.addEventListener("online",async()=>{console.log("[🔄 Online] Syncing stored reports..."),l.getState().syncReports()});export{l as u};
