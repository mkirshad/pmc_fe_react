import{r as p,V as I,j as r,A as h}from"./index-BUja0691.js";import{M as k}from"./index.esm-DuHCNrHJ.js";import"./TextField-D_rs7nxK.js";import"./Divider-CLlu8qwH.js";import"./FormControlLabel-CUE3rA3Y.js";import"./Autocomplete-Bzlk8W7Y.js";import"./index-Z6aWpTV9.js";const v=e=>{var c,g,S;const n=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(l=>l.assigned_group==="APPLICANT"&&l.remarks&&l.remarks!=="undefined").map(l=>l.remarks),d=n.length>0?n.join("; "):"N/A";return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,cnic:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,application_Start_Time:((c=e.created_at)==null?void 0:c.substring(0,16))||"N/A",application_Submission_Time:((S=(g=e.submittedapplication)==null?void 0:g.created_at)==null?void 0:S.substring(0,16))||"N/A",remarks:d}},y=e=>e.map(f=>{const n=v(f);return Object.keys(n).forEach(d=>{(n[d]===void 0||n[d]===null)&&(n[d]="N/A")}),n}),G=()=>{const[e,f]=p.useState([]),[n,d]=p.useState([]),[c,g]=p.useState([]),[S,l]=p.useState(0),[_,w]=p.useState(null),[R,O]=p.useState({});console.log(_);const A=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],C={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},b=(t,u,a)=>{const T=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],m=y(t),L=m[0];console.log(t);const o=[...Object.keys(L).filter(s=>T.includes(s)).map(s=>({accessorKey:s,header:s.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()),size:200,Cell:({cell:i,row:N})=>r.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const x=N.original.id;console.log(`Clicked ${s}:`,i.getValue()),console.log(`Navigating with ID: ${x}`),window.location.href=u?`/spuid-review/${x}?group=${a}`:`/spuid-signup/${x}`},children:i.getValue()||"-"})}))];return{flattenedData:m,columns:o}},D=I();return p.useEffect(()=>{(async()=>{try{const a=await h.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{D("/error")}try{let a=[];try{a=(await h.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],g(a.map(s=>s.name))}catch(o){console.error("Error fetching user groups:",o),g([])}console.log("groupsResponse",a);const m=(await h.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(m)&&m.length>0){const o=b(m,a.length>0,a.map(i=>i.name)[0]);f(o.flattenedData),d(o.columns),console.log("Flattened Data:",o.flattenedData);const s=o.flattenedData[o.flattenedData.length-1];if(console.log("Last Row:",s),s&&s.id){w(s.id),console.log("Last Row ID:",s.id);const i=A.indexOf(s.assigned_group);i!==-1&&l(i)}}const L=await h.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});O(L.data)}catch(a){console.error("Error fetching data:",a)}})(),w(25);const u=A.indexOf("LSO");u!==-1&&l(u)},[]),p.useEffect(()=>{console.log("userGroups:",c),c.includes("Super")&&D("/home-super")},[c,D]),console.log("selectedRowId:",_),console.log(_),r.jsxs("div",{children:[r.jsx("div",{className:"tiles-container",children:Object.entries(R).map(([t,u])=>r.jsxs("div",{className:"tile",children:[r.jsx("h3",{children:C[t]||t})," ",r.jsx("p",{children:u})]},t))}),r.jsx("div",{className:"mb-4",children:r.jsxs("h3",{children:[c.filter(t=>t!=="Download License"&&t!=="Applicant"&&t!=="LSM2").join(" - ")," Dashboard"]})}),r.jsx(k,{columns:[...n],data:e.map(t=>({...t,assigned_group_title:C[t.assigned_group]||t.assigned_group})),getRowId:t=>t.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:1,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:c.length>0,enablePagination:!0},_)]})};export{G as default};
