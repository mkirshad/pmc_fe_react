import{r as i,k as E,V as R,j as e,A as S}from"./index-D8nJZtJt.js";import{M as P}from"./index.esm-Dc5Niph5.js";import{T as I}from"./index-Bxnl0gd4.js";import{q as M}from"./index-ygezcPLj.js";import{a as F}from"./index-BGBr0ppS.js";import"./TextField-BZuLgQqT.js";import"./DefaultPropsProvider-DOWsvLhH.js";import"./emotion-element-f0de968e.browser.esm-LzCS9emh.js";import"./setPrototypeOf-C3V6guyq.js";import"./assertThisInitialized-BaPDaEme.js";import"./Modal-IBht-_uA.js";import"./Autocomplete-BtllHiky.js";import"./Box-BOSY3aB-.js";import"./FormControlLabel--9ZGn5Ap.js";import"./Divider--jG0XPJR.js";import"./index-Bwc2VGjd.js";import"./useControllableState-Bk4Kxx3r.js";import"./classNames-BdT_eiOq.js";const{TabNav:ie,TabList:le,TabContent:ce}=I,G=t=>{var D,x,m;const o=(t.assigned_group==="APPLICANT"&&t.applicationassignment||[]).filter(l=>l.assigned_group==="APPLICANT"&&l.remarks&&l.remarks!=="undefined").map(l=>l.remarks),u=o.length>0?o.join("; "):"N/A";return{id:t.id,tracking_number:t.tracking_number,first_name:t.first_name,last_name:t.last_name,CNIC:t.cnic,mobile_no:t.mobile_no,application_status:t.application_status,assigned_group:t.assigned_group,registration_for:t.registration_for,application_Start_Time:((D=t.created_at)==null?void 0:D.substring(0,16))||"N/A",application_Submission_Time:((m=(x=t.submittedapplication)==null?void 0:x.created_at)==null?void 0:m.substring(0,16))||"N/A",remarks:u}},U=t=>t.map(_=>{const o=G(_);return Object.keys(o).forEach(u=>{(o[u]===void 0||o[u]===null)&&(o[u]="N/A")}),o}),de=()=>{const[t,_]=i.useState([]),[o,u]=i.useState([]),[D,x]=i.useState(0),[m,l]=i.useState(null),[T,k]=i.useState({}),[$,z]=i.useState("tab1");console.log(m);const[N,A]=i.useState(!1),C=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],y={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},s=E(n=>n.user.authority)||[];console.log("user authority:",s);const O=(n,c,a)=>{const g=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],d=U(n),p=d[0],w=[{accessorKey:"download",header:"",size:50,Cell:({row:r})=>{if(r.original.assigned_group==="Download License"){const b=`/api/pmc/license-pdf?license_number=${r.original.tracking_number}`;return e.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",title:"Download License",children:e.jsx(M,{style:{fontSize:"1.5rem",color:"#d32f2f",cursor:"pointer"}})})}return null}},...Object.keys(p).filter(r=>g.includes(r)).map(r=>r==="assigned_group"?{accessorKey:r,header:"Assigned Group",Cell:({row:f})=>{const b=f.original.assigned_group,L=f.original.tracking_number;if(b==="Download License"){const v=`/api/pmc/license-pdf?license_number=${L}`;return e.jsx("a",{href:v,target:"_blank",rel:"noopener noreferrer",style:{backgroundColor:"#2563eb",color:"white",padding:"5px 10px",borderRadius:"6px",fontSize:"0.9rem",fontWeight:"500",display:"inline-block",textDecoration:"none"},title:"Download License PDF",children:b})}return b}}:{accessorKey:r,header:r.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),Cell:({cell:f,row:b})=>{const L=b.original.id;return e.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{window.location.href=c?`/spuid-review/${L}?group=${a}`:`/spuid-signup/${L}`},children:f.getValue()||"-"})}})];return{flattenedData:d,columns:w}},h=R();i.useEffect(()=>{(async()=>{A(!0);try{if(navigator.onLine){const g=(await S.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(g)&&g.length>0){const d=O(g,s.length>0&&s[0]!=="",s[0]);_(d.flattenedData),u(d.columns),console.log("Flattened Data:",d.flattenedData);const p=d.flattenedData[d.flattenedData.length-1];if(console.log("Last Row:",p),p&&p.id){l(p.id),console.log("Last Row ID:",p.id);const w=C.indexOf(p.assigned_group);w!==-1&&x(w)}}}else throw new Error("Application is offline. Cannot fetch applicant details.");if(navigator.onLine){const a=await S.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});k(a.data)}else throw new Error("Application is offline. Cannot fetch statistics.")}catch(a){console.error("Error fetching data:",a)}finally{A(!1)}})(),l(25);const c=C.indexOf("LSO");c!==-1&&x(c)},[]),i.useEffect(()=>{console.log("userGroups:",s),s.includes("DEO")||s.includes("DG")?h("/home-deo"):s.includes("Admin")?h("/home-admin"):s.includes("DO")?h("/home-do"):s.includes("Super")?h("/home-super"):s.length===1&&s[0]==="Inspector"&&h("/auth/EPAOperations/AllInspections")},[s,h]),console.log("selectedRowId:",m),console.log(m);const j=async()=>{try{const n=await S.post("/pmc/export-applicant/",{applicant_ids:t==null?void 0:t.map(g=>g.id)},{responseType:"blob"}),c=window.URL.createObjectURL(new Blob([n.data])),a=document.createElement("a");a.href=c,a.setAttribute("download",`Applicant_Details_${new Date().toISOString()}.xlsx`),document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(n){console.error("Export failed:",n)}};return e.jsxs("div",{children:[e.jsx("div",{className:"tiles-container",children:Object.entries(T).map(([n,c])=>e.jsxs("div",{className:"tile",children:[e.jsx("h3",{children:y[n]||n})," ",e.jsx("p",{children:c})]},n))}),s.length>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("h3",{children:[s.filter(n=>n!=="Download License"&&n!=="Applicant"&&n!=="LSM2").join(" - ")," Dashboard"]})}),N?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid md:grid-cols-5 gap-5 items-center mb-4",children:[e.jsx("span",{className:"text-red-500 col-span-3"}),e.jsx("span",{}),e.jsxs("button",{type:"button",onClick:j,className:"flex items-center justify-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200",children:[e.jsx(F,{className:"mr-2 text-xl"}),"Export to Excel"]})]}),e.jsx(P,{columns:[...o],data:t.map(n=>({...n,assigned_group_title:y[n.assigned_group]||n.assigned_group})),enableColumnFilters:!0,enableSorting:!0,enableStickyHeader:!0,muiTableProps:{sx:{border:"1px solid #ddd"}},muiTableHeadCellProps:{sx:{backgroundColor:"#f5f5f5",fontWeight:"bold",borderBottom:"2px solid #ccc",textAlign:"center"}},muiTableBodyCellProps:{sx:{borderRight:"1px solid #ddd",padding:"10px"}},muiTableBodyRowProps:{sx:{"&:nth-of-type(even)":{backgroundColor:"#f9f9f9"},"&:hover":{backgroundColor:"#e0f7fa"}}},enableZebraStripes:!0,enableColumnResizing:!0,enableTopToolbar:!0,enablePagination:!0},m)]})]})};export{de as default};
