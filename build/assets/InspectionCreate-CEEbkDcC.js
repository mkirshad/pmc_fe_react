import{r as j,A as fe,j as l,Z as de,i as _t,a2 as it,W as St,a0 as Ct}from"./index-D_1ywQiJ.js";import{B as Le}from"./Button-DAZ5Bmyr.js";import{f as bt,t as wt,N as Ft}from"./toast-CPe1ZeOc.js";import{u as at,b as ce,a as q,C as K,F as Dt}from"./index.esm-l6Z3Au3o.js";import{C as jt,S as Ge,a as ue,B as Tt}from"./index-B4tRSPHn.js";import{I as Z}from"./Input-BrrWZPdL.js";import{e as Pt,p as Et,g as Nt,s as It,h as Vt,R as Rt,a as Re,b as Se,i as Ue,j as qe,k as Ke,E as We,l as Q,m as je,d as Ae,P as Be,n as _e,o as oe,q as ee,r as Ye,u as z,v as Ce,w as At,x as Bt,y as Mt,z as Me,A as kt,B as Ot,D as Lt,H as Gt,I as Ut,f as Te,S as $e,C as qt,c as Je,F as Kt,M as Wt,V as Yt,T as $t,O as Jt,J as Ht,t as Zt,G as zt}from"./terraformer-wkt-parser-ikK8bTu4.js";import{A as Xt,C as Qt}from"./Autocomplete-BaIPv15Y.js";import{T as en}from"./TextField-CPU8Ag7R.js";import{t as tn,z as M}from"./index-BYjnW3sB.js";import{C as Pe}from"./ConfirmDialog-BN_-oDqi.js";import{B as nn}from"./index-BxB9QlXp.js";import"./classNames-D46SM-nT.js";import"./StatusIcon-D1powkTS.js";import"./CloseButton-DsL4NN89.js";import"./index-CNE3WTgN.js";import"./DefaultPropsProvider-CJ9uD5E9.js";import"./index-BLoKHfKv.js";import"./index-55mwKGyU.js";import"./index-louR6sYh.js";import"./_getPrototype-CHj1lEPG.js";const He=0,ve=1,Ze=[0,0,0,0],ge=[],Ee={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Ne extends Lt{constructor(e,n,r){super(e),this.features=n,this.mapBrowserEvent=r}}class rn extends Pt{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Et,this.defaultDeleteCondition_=function(r){return Nt(r)&&It(r)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Vt,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Rt,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Re({source:new Se({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:sn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let n;if(e.features?n=e.features:e.source&&(this.source_=e.source,n=new Ue(this.source_.getFeatures()),this.source_.addEventListener(qe.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(qe.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!n)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=n,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ke.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ke.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const n=e.getGeometry();if(n){const i=this.SEGMENT_WRITERS_[n.getType()];i&&i(e,n)}const r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(r.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(We.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,n){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Ue;const r=this.featuresBeingModified_.getArray();for(let i=0,a=n.length;i<a;++i){const s=n[i].feature;s&&!r.includes(s)&&this.featuresBeingModified_.push(s)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Ne(Ee.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(We.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const n=this.rBush_,r=[];n.forEach(function(i){e===i.feature&&r.push(i)});for(let i=r.length-1;i>=0;--i){const a=r[i];for(let s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===a&&this.dragSegments_.splice(s,1);n.remove(a)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const n=e.target;this.removeFeature_(n),this.addFeature_(n)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,n){const r=n.getCoordinates(),i={feature:e,geometry:n,segment:[r,r]};this.rBush_.insert(n.getExtent(),i)}writeMultiPointGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i],o={feature:e,geometry:n,depth:[i],index:i,segment:[s,s]};this.rBush_.insert(n.getExtent(),o)}}writeLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length-1;i<a;++i){const s=r.slice(i,i+2),o={feature:e,geometry:n,index:i,segment:s};this.rBush_.insert(Q(s),o)}}writeMultiLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,u=s.length-1;o<u;++o){const v=s.slice(o,o+2),d={feature:e,geometry:n,depth:[i],index:o,segment:v};this.rBush_.insert(Q(v),d)}}}writePolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,u=s.length-1;o<u;++o){const v=s.slice(o,o+2),d={feature:e,geometry:n,depth:[i],index:o,segment:v};this.rBush_.insert(Q(v),d)}}}writeMultiPolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,u=s.length;o<u;++o){const v=s[o];for(let d=0,p=v.length-1;d<p;++d){const f=v.slice(d,d+2),h={feature:e,geometry:n,depth:[o,i],index:d,segment:f};this.rBush_.insert(Q(f),h)}}}}writeCircleGeometry_(e,n){const r=n.getCenter(),i={feature:e,geometry:n,index:He,segment:[r,r]},a={feature:e,geometry:n,index:ve,segment:[r,r]},s=[i,a];i.featureSegments=s,a.featureSegments=s,this.rBush_.insert(je(r),i);let o=n;this.rBush_.insert(o.getExtent(),a)}writeGeometryCollectionGeometry_(e,n){const r=n.getGeometriesArray();for(let i=0;i<r.length;++i){const a=r[i],s=this.SEGMENT_WRITERS_[a.getType()];s(e,a)}}createOrUpdateVertexFeature_(e,n,r,i){let a=this.vertexFeature_;return a?a.getGeometry().setCoordinates(e):(a=new Ae(new Be(e)),this.vertexFeature_=a,this.overlay_.getSource().addFeature(a)),a.set("features",n),a.set("geometries",r),a.set("existing",i),a}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let n;return!e.map.getView().getInteracting()&&e.type==_e.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=_e.SINGLECLICK||!this.ignoreNextSingleClick_?n=this.removePoint():n=!0),e.type==_e.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!n}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(!n)return;this.getMap().getView().getProjection();const r=[],i=n.getGeometry().getCoordinates(),a=Q([i]),s=this.rBush_.getInExtent(a),o={};s.sort(an);for(let u=0,v=s.length;u<v;++u){const d=s[u],p=d.segment;let f=oe(d.geometry);const h=d.depth;if(h&&(f+="-"+h.join("-")),o[f]||(o[f]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===ve){const g=Xe(e,d);ee(g,i)&&!o[f][0]&&(this.dragSegments_.push([d,0]),o[f][0]=d);continue}if(ee(p[0],i)&&!o[f][0]){this.dragSegments_.push([d,0]),o[f][0]=d;continue}if(ee(p[1],i)&&!o[f][1]){if(o[f][0]&&o[f][0].index===0){let g=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":g=g[h[1]];case"Polygon":if(d.index!==g[h[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),o[f][1]=d;continue}oe(p)in this.vertexSegments_&&!o[f][0]&&!o[f][1]&&r.push(d)}return r}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([a])=>a));const n=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],i=[];for(let a=0,s=this.dragSegments_.length;a<s;++a){const o=this.dragSegments_[a],u=o[0],v=u.feature;r.includes(v)||r.push(v);const d=u.geometry;i.includes(d)||i.push(d);const p=u.depth;let f;const h=u.segment,g=o[1];for(;n.length<d.getStride();)n.push(h[g][n.length]);switch(d.getType()){case"Point":f=n,h[0]=n,h[1]=n;break;case"MultiPoint":f=d.getCoordinates(),f[u.index]=n,h[0]=n,h[1]=n;break;case"LineString":f=d.getCoordinates(),f[u.index+g]=n,h[g]=n;break;case"MultiLineString":f=d.getCoordinates(),f[p[0]][u.index+g]=n,h[g]=n;break;case"Polygon":f=d.getCoordinates(),f[p[0]][u.index+g]=n,h[g]=n;break;case"MultiPolygon":f=d.getCoordinates(),f[p[1]][p[0]][u.index+g]=n,h[g]=n;break;case"Circle":const C=d;if(h[0]=n,h[1]=n,u.index===He)this.changingFeature_=!0,C.setCenter(n),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let w=Ye(z(C.getCenter()),z(n));C.setRadius(w),this.changingFeature_=!1}break}f&&this.setGeometryCoordinates_(d,f)}this.createOrUpdateVertexFeature_(n,r,i,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const n=e.coordinate,r=this.findInsertVerticesAndUpdateDragSegments_(n);if(r!=null&&r.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,r),this.vertexFeature_)){const i=this.vertexFeature_.getGeometry().getCoordinates();for(let a=r.length-1;a>=0;--a)this.insertVertex_(r[a],i);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let n=this.dragSegments_.length-1;n>=0;--n){const r=this.dragSegments_[n][0],i=r.geometry;if(i.getType()==="Circle"){const a=i,s=a.getCenter(),o=r.featureSegments[0],u=r.featureSegments[1];o.segment[0]=s,o.segment[1]=s,u.segment[0]=s,u.segment[1]=s,this.rBush_.update(je(s),o);let v=a;this.rBush_.update(v.getExtent(),u)}else this.rBush_.update(Q(r.segment),r)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ne(Ee.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const n=this.getMap(),r=n.getPixelFromCoordinate(e);n.getView().getProjection();const i=function(o,u){return ze(e,o)-ze(e,u)};let a,s;if(this.hitDetection_){const o=typeof this.hitDetection_=="object"?u=>u===this.hitDetection_:void 0;n.forEachFeatureAtPixel(r,(u,v,d)=>{d&&d.getType()==="Point"&&(d=new Be(Ce(d.getCoordinates())));const p=d||u.getGeometry();if(p&&p.getType()==="Point"&&u instanceof Ae&&this.features_.getArray().includes(u)){s=p;const f=u.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:u,geometry:s,segment:[f,f]}]}return!0},{layerFilter:o})}if(!a){const o=At(je(e,Ze)),u=n.getView().getResolution()*this.pixelTolerance_,v=Bt(Mt(o,u,Ze));a=this.rBush_.getInExtent(v)}if(a&&a.length>0){const o=a.sort(i)[0],u=o.segment;let v=Xe(e,o);const d=n.getPixelFromCoordinate(v);let p=Ye(r,d);if(s||p<=this.pixelTolerance_){const f={};if(f[oe(u)]=!0,this.snapToPointer_||(this.delta_[0]=v[0]-e[0],this.delta_[1]=v[1]-e[1]),o.geometry.getType()==="Circle"&&o.index===ve)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(v,[o.feature],[o.geometry],this.snappedToVertex_);else{const h=n.getPixelFromCoordinate(u[0]),g=n.getPixelFromCoordinate(u[1]),C=Me(d,h),w=Me(d,g);if(p=Math.sqrt(Math.min(C,w)),this.snappedToVertex_=p<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(v=C>w?u[1]:u[0]),this.createOrUpdateVertexFeature_(v,[o.feature],[o.geometry],this.snappedToVertex_);const x={};x[oe(o.geometry)]=!0;for(let V=1,E=a.length;V<E;++V){const A=a[V].segment;if(ee(u[0],A[0])&&ee(u[1],A[1])||ee(u[0],A[1])&&ee(u[1],A[0])){const R=oe(a[V].geometry);R in x||(x[R]=!0,f[oe(A)]=!0)}else break}}this.vertexSegments_=f;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,n){const r=e.segment,i=e.feature,a=e.geometry,s=e.depth,o=e.index;let u;for(;n.length<a.getStride();)n.push(0);switch(a.getType()){case"MultiLineString":u=a.getCoordinates(),u[s[0]].splice(o+1,0,n);break;case"Polygon":u=a.getCoordinates(),u[s[0]].splice(o+1,0,n);break;case"MultiPolygon":u=a.getCoordinates(),u[s[1]][s[0]].splice(o+1,0,n);break;case"LineString":u=a.getCoordinates(),u.splice(o+1,0,n);break;default:return!1}this.setGeometryCoordinates_(a,u);const v=this.rBush_;v.remove(e),this.updateSegmentIndices_(a,o,s,1);const d={segment:[r[0],n],feature:i,geometry:a,depth:s,index:o};v.insert(Q(d.segment),d),this.dragSegments_.push([d,1]);const p={segment:[n,r[1]],feature:i,geometry:a,depth:s,index:o+1};return v.insert(Q(p.segment),p),this.dragSegments_.push([p,0]),!0}updatePointer_(e){var n;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates()}getPoint(){var n;const e=(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates();return e?Ce(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(Q([e])).some(({segment:r})=>ee(r[0],e)||ee(r[1],e))}removePoint(e){if(e&&(e=z(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=_e.POINTERDRAG){const n=this.lastPointerEvent_;this.willModifyFeatures_(n,this.dragSegments_.map(([i])=>i));const r=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ne(Ee.MODIFYEND,this.featuresBeingModified_,n)),this.featuresBeingModified_=null,r}return!1}removeVertex_(){const e=this.dragSegments_,n={};let r=!1,i,a,s,o,u,v,d,p,f,h,g;for(u=e.length-1;u>=0;--u)s=e[u],h=s[0],g=oe(h.feature),h.depth&&(g+="-"+h.depth.join("-")),g in n||(n[g]={}),s[1]===0?(n[g].right=h,n[g].index=h.index):s[1]==1&&(n[g].left=h,n[g].index=h.index+1);for(g in n){switch(f=n[g].right,d=n[g].left,v=n[g].index,p=v-1,d!==void 0?h=d:h=f,p<0&&(p=0),o=h.geometry,a=o.getCoordinates(),i=a,r=!1,o.getType()){case"MultiLineString":a[h.depth[0]].length>2&&(a[h.depth[0]].splice(v,1),r=!0);break;case"LineString":a.length>2&&(a.splice(v,1),r=!0);break;case"MultiPolygon":i=i[h.depth[1]];case"Polygon":i=i[h.depth[0]],i.length>4&&(v==i.length-1&&(v=0),i.splice(v,1),r=!0,v===0&&(i.pop(),i.push(i[0]),p=i.length-1));break}if(r){this.setGeometryCoordinates_(o,a);const C=[];if(d!==void 0&&(this.rBush_.remove(d),C.push(d.segment[0])),f!==void 0&&(this.rBush_.remove(f),C.push(f.segment[1])),d!==void 0&&f!==void 0){const w={depth:h.depth,feature:h.feature,geometry:h.geometry,index:p,segment:C};this.rBush_.insert(Q(w.segment),w)}this.updateSegmentIndices_(o,v,h.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return r}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(Q([e])).some(({segment:r})=>!(ee(r[0],e)||ee(r[1],e)))}insertPoint(e){var i;const n=e?z(e,this.getMap().getView().getProjection()):(i=this.vertexFeature_)==null?void 0:i.getGeometry().getCoordinates();return n?this.findInsertVerticesAndUpdateDragSegments_(n).reduce((a,s)=>a||this.insertVertex_(s,n),!1):!1}setGeometryCoordinates_(e,n){this.changingFeature_=!0,e.setCoordinates(n),this.changingFeature_=!1}updateSegmentIndices_(e,n,r,i){this.rBush_.forEachInExtent(e.getExtent(),function(a){a.geometry===e&&(r===void 0||a.depth===void 0||kt(a.depth,r))&&a.index>n&&(a.index+=i)})}}function an(t,e){return t.index-e.index}function ze(t,e,n){const r=e.geometry;if(r.getType()==="Circle"){let a=r;if(e.index===ve){const s=Me(a.getCenter(),z(t)),o=Math.sqrt(s)-a.getRadius();return o*o}}const i=z(t);return ge[0]=z(e.segment[0]),ge[1]=z(e.segment[1]),Ut(i,ge)}function Xe(t,e,n){const r=e.geometry;if(r.getType()==="Circle"&&e.index===ve)return Ce(r.getClosestPoint(z(t)));const i=z(t);return ge[0]=z(e.segment[0]),ge[1]=z(e.segment[1]),Ce(Gt(i,ge))}function sn(){const t=Ot();return function(e,n){return t.Point}}const on=({onLocationSelect:t})=>{const e=j.useRef(null),[n,r]=j.useState(null),[i,a]=j.useState(null),[s,o]=j.useState("Fetching..."),[u,v]=j.useState(null),[d,p]=j.useState({lat:null,lng:null});j.useEffect(()=>{const C=new Se,w=new Se,x=new Ae({geometry:new Be(Te([74.3436,31.5497]))});x.setStyle(new $e({image:new qt({radius:7,fill:new Kt({color:"red"}),stroke:new Je({color:"white",width:2})})})),w.addFeature(x),a(x);const V=new Re({source:w}),E=new Re({source:C,style:new $e({stroke:new Je({color:"blue",width:2})})}),A=new Wt({target:e.current,layers:[new $t({source:new Jt}),E,V],view:new Yt({center:Te([74.3436,31.5497]),zoom:12})});r(A),v(E),g(E),f(A,x);const R=new rn({source:w});return A.addInteraction(R),R.on("modifyend",G=>{const U=G.features.item(0).getGeometry().getCoordinates(),N=Ht(U);p({lat:N[1],lng:N[0]}),h(N[0],N[1])}),()=>A.setTarget(null)},[]);const f=(C,w)=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(x=>{const V=Te([x.coords.longitude,x.coords.latitude]);w.getGeometry().setCoordinates(V),C.getView().setCenter(V),C.getView().setZoom(15),h(x.coords.longitude,x.coords.latitude)},x=>console.error("Geolocation error:",x),{enableHighAccuracy:!0})},h=async(C,w)=>{try{t({lat:w,lng:C,district:""});const x=await fe.get(`/pmc/DistrictByLatLon?lat=${w}&lon=${C}`);x.data&&x.data.district_name?(o(x.data.district_name),t({lat:w,lng:C,district:x.data.district_name})):o("District not found")}catch(x){console.error("Error fetching district:",x),o("Error fetching district")}},g=async C=>{try{const E={type:"FeatureCollection",features:(await fe.get("/pmc/districts-public")).data.filter(R=>R.geom).map(R=>({type:"Feature",geometry:Zt.parse(R.geom.replace("SRID=4326;","")),properties:{district_id:R.district_id,district_name:R.district_name}}))},A=new Se({features:new zt().readFeatures(E,{featureProjection:"EPSG:3857"})});C.setSource(A)}catch(w){console.error("Error fetching district boundaries:",w)}};return l.jsxs("div",{children:[l.jsx("div",{ref:e,style:{height:"600px",width:"100%"}}),l.jsx("button",{type:"button",onClick:()=>f(n,i),style:{marginTop:"10px",padding:"10px",backgroundColor:"#007BFF",color:"#fff",border:"none",cursor:"pointer",borderRadius:"5px"},children:"📍 Go to Current Location"})]})};function st(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}var pe;(function(t){t.event="event",t.props="prop"})(pe||(pe={}));function se(){}function ln(t){var e,n=void 0;return function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e&&r.length===e.length&&r.every(function(a,s){return a===e[s]})||(e=r,n=t.apply(void 0,r)),n}}function xe(t){return!!(t||"").match(/\d/)}function he(t){return t==null}function cn(t){return typeof t=="number"&&isNaN(t)}function ot(t){return he(t)||cn(t)||typeof t=="number"&&!isFinite(t)}function lt(t){return t.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function un(t){switch(t){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;case"thousand":default:return/(\d)(?=(\d{3})+(?!\d))/g}}function dn(t,e,n){var r=un(n),i=t.search(/[1-9]/);return i=i===-1?t.length:i,t.substring(0,i)+t.substring(i,t.length).replace(r,"$1"+e)}function fn(t){var e=j.useRef(t);e.current=t;var n=j.useRef(function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e.current.apply(e,r)});return n.current}function ke(t,e){e===void 0&&(e=!0);var n=t[0]==="-",r=n&&e;t=t.replace("-","");var i=t.split("."),a=i[0],s=i[1]||"";return{beforeDecimal:a,afterDecimal:s,hasNegation:n,addNegation:r}}function gn(t){if(!t)return t;var e=t[0]==="-";e&&(t=t.substring(1,t.length));var n=t.split("."),r=n[0].replace(/^0+/,"")||"0",i=n[1]||"";return(e?"-":"")+r+(i?"."+i:"")}function ct(t,e,n){for(var r="",i=n?"0":"",a=0;a<=e-1;a++)r+=t[a]||i;return r}function Qe(t,e){return Array(e+1).join(t)}function ut(t){var e=t+"",n=e[0]==="-"?"-":"";n&&(e=e.substring(1));var r=e.split(/[eE]/g),i=r[0],a=r[1];if(a=Number(a),!a)return n+i;i=i.replace(".","");var s=1+a,o=i.length;return s<0?i="0."+Qe("0",Math.abs(s))+i:s>=o?i=i+Qe("0",s-o):i=(i.substring(0,s)||"0")+"."+i.substring(s),n+i}function et(t,e,n){if(["","-"].indexOf(t)!==-1)return t;var r=(t.indexOf(".")!==-1||n)&&e,i=ke(t),a=i.beforeDecimal,s=i.afterDecimal,o=i.hasNegation,u=parseFloat("0."+(s||"0")),v=s.length<=e?"0."+s:u.toFixed(e),d=v.split("."),p=a;a&&Number(d[0])&&(p=a.split("").reverse().reduce(function(C,w,x){return C.length>x?(Number(C[0])+Number(w)).toString()+C.substring(1,C.length):w+C},d[0]));var f=ct(d[1]||"",e,n),h=o?"-":"",g=r?".":"";return""+h+p+g+f}function le(t,e){if(t.value=t.value,t!==null){if(t.createTextRange){var n=t.createTextRange();return n.move("character",e),n.select(),!0}return t.selectionStart||t.selectionStart===0?(t.focus(),t.setSelectionRange(e,e),!0):(t.focus(),!1)}}var dt=ln(function(t,e){for(var n=0,r=0,i=t.length,a=e.length;t[n]===e[n]&&n<i;)n++;for(;t[i-1-r]===e[a-1-r]&&a-r>n&&i-r>n;)r++;return{from:{start:n,end:i-r},to:{start:n,end:a-r}}}),hn=function(t,e){var n=Math.min(t.selectionStart,e);return{from:{start:n,end:t.selectionEnd},to:{start:n,end:e}}};function mn(t,e,n){return Math.min(Math.max(t,e),n)}function Ie(t){return Math.max(t.selectionStart,t.selectionEnd)}function vn(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function pn(t){return{from:{start:0,end:0},to:{start:0,end:t.length},lastValue:""}}function xn(t){var e=t.currentValue,n=t.formattedValue,r=t.currentValueIndex,i=t.formattedValueIndex;return e[r]===n[i]}function yn(t,e,n,r,i,a,s){s===void 0&&(s=xn);var o=i.findIndex(function(A){return A}),u=t.slice(0,o);!e&&!n.startsWith(u)&&(e=u,n=u+n,r=r+u.length);for(var v=n.length,d=t.length,p={},f=new Array(v),h=0;h<v;h++){f[h]=-1;for(var g=0,C=d;g<C;g++){var w=s({currentValue:n,lastValue:e,formattedValue:t,currentValueIndex:h,formattedValueIndex:g});if(w&&p[g]!==!0){f[h]=g,p[g]=!0;break}}}for(var x=r;x<v&&(f[x]===-1||!a(n[x]));)x++;var V=x===v||f[x]===-1?d:f[x];for(x=r-1;x>0&&f[x]===-1;)x--;var E=x===-1||f[x]===-1?0:f[x]+1;return E>V?V:r-E<V-r?E:V}function tt(t,e,n,r){var i=t.length;if(e=mn(e,0,i),r==="left"){for(;e>=0&&!n[e];)e--;e===-1&&(e=n.indexOf(!0))}else{for(;e<=i&&!n[e];)e++;e>i&&(e=n.lastIndexOf(!0))}return e===-1&&(e=i),e}function _n(t){for(var e=Array.from({length:t.length+1}).map(function(){return!0}),n=0,r=e.length;n<r;n++)e[n]=!!(xe(t[n])||xe(t[n-1]));return e}function ft(t,e,n,r,i,a){a===void 0&&(a=se);var s=fn(function(g,C){var w,x;return ot(g)?(x="",w=""):typeof g=="number"||C?(x=typeof g=="number"?ut(g):g,w=r(x)):(x=i(g,void 0),w=r(x)),{formattedValue:w,numAsString:x}}),o=j.useState(function(){return s(he(t)?e:t,n)}),u=o[0],v=o[1],d=function(g,C){g.formattedValue!==u.formattedValue&&v({formattedValue:g.formattedValue,numAsString:g.value}),a(g,C)},p=t,f=n;he(t)&&(p=u.numAsString,f=!0);var h=s(p,f);return j.useMemo(function(){v(h)},[h.formattedValue]),[u,d]}function Sn(t){return t.replace(/[^0-9]/g,"")}function Cn(t){return t}function bn(t){var e=t.type;e===void 0&&(e="text");var n=t.displayType;n===void 0&&(n="input");var r=t.customInput,i=t.renderText,a=t.getInputRef,s=t.format;s===void 0&&(s=Cn);var o=t.removeFormatting;o===void 0&&(o=Sn);var u=t.defaultValue,v=t.valueIsNumericString,d=t.onValueChange,p=t.isAllowed,f=t.onChange;f===void 0&&(f=se);var h=t.onKeyDown;h===void 0&&(h=se);var g=t.onMouseUp;g===void 0&&(g=se);var C=t.onFocus;C===void 0&&(C=se);var w=t.onBlur;w===void 0&&(w=se);var x=t.value,V=t.getCaretBoundary;V===void 0&&(V=_n);var E=t.isValidInputCharacter;E===void 0&&(E=xe);var A=t.isCharacterSame,R=st(t,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),G=ft(x,u,!!v,s,o,d),U=G[0],N=U.formattedValue,W=U.numAsString,b=G[1],_=j.useRef(),Y=j.useRef({formattedValue:N,numAsString:W}),$=function(y,S){Y.current={formattedValue:y.formattedValue,numAsString:y.value},b(y,S)},H=j.useState(!1),X=H[0],D=H[1],F=j.useRef(null),c=j.useRef({setCaretTimeout:null,focusTimeout:null});j.useEffect(function(){return D(!0),function(){clearTimeout(c.current.setCaretTimeout),clearTimeout(c.current.focusTimeout)}},[]);var m=s,T=function(y,S){var P=parseFloat(S);return{formattedValue:y,value:S,floatValue:isNaN(P)?void 0:P}},I=function(y,S,P){y.selectionStart===0&&y.selectionEnd===y.value.length||(le(y,S),c.current.setCaretTimeout=setTimeout(function(){y.value===P&&y.selectionStart!==S&&le(y,S)},0))},k=function(y,S,P){return tt(y,S,V(y),P)},te=function(y,S,P){var O=V(S),J=yn(S,N,y,P,O,E,A);return J=tt(S,J,O),J},re=function(y){var S=y.formattedValue;S===void 0&&(S="");var P=y.input,O=y.source,J=y.event,L=y.numAsString,B;if(P){var ne=y.inputValue||P.value,ie=Ie(P);P.value=S,B=te(ne,S,ie),B!==void 0&&I(P,B,S)}S!==N&&$(T(S,L),{event:J,source:O})};j.useEffect(function(){var y=Y.current,S=y.formattedValue,P=y.numAsString;(N!==S||W!==P)&&$(T(N,W),{event:void 0,source:pe.props})},[N,W]);var me=F.current?Ie(F.current):void 0,ye=typeof window<"u"?j.useLayoutEffect:j.useEffect;ye(function(){var y=F.current;if(N!==Y.current.formattedValue&&y){var S=te(Y.current.formattedValue,N,me);y.value=N,I(y,S,N)}},[N]);var we=function(y,S,P){var O=S.target,J=_.current?hn(_.current,O.selectionEnd):dt(N,y),L=Object.assign(Object.assign({},J),{lastValue:N}),B=o(y,L),ne=m(B);if(B=o(ne,void 0),p&&!p(T(ne,B))){var ie=S.target,ae=Ie(ie),De=te(y,N,ae);return ie.value=N,I(ie,De,N),!1}return re({formattedValue:ne,numAsString:B,inputValue:y,event:S,source:P,input:S.target}),!0},Fe=function(y,S){S===void 0&&(S=0);var P=y.selectionStart,O=y.selectionEnd;_.current={selectionStart:P,selectionEnd:O+S}},gt=function(y){var S=y.target,P=S.value,O=we(P,y,pe.event);O&&f(y),_.current=void 0},ht=function(y){var S=y.target,P=y.key,O=S.selectionStart,J=S.selectionEnd,L=S.value;L===void 0&&(L="");var B;P==="ArrowLeft"||P==="Backspace"?B=Math.max(O-1,0):P==="ArrowRight"?B=Math.min(O+1,L.length):P==="Delete"&&(B=O);var ne=0;P==="Delete"&&O===J&&(ne=1);var ie=P==="ArrowLeft"||P==="ArrowRight";if(B===void 0||O!==J&&!ie){h(y),Fe(S,ne);return}var ae=B;if(ie){var De=P==="ArrowLeft"?"left":"right";ae=k(L,B,De),ae!==B&&y.preventDefault()}else P==="Delete"&&!E(L[B])?ae=k(L,B,"right"):P==="Backspace"&&!E(L[B])&&(ae=k(L,B,"left"));ae!==B&&I(S,ae,L),h(y),Fe(S,ne)},mt=function(y){var S=y.target,P=function(){var O=S.selectionStart,J=S.selectionEnd,L=S.value;if(L===void 0&&(L=""),O===J){var B=k(L,O);B!==O&&I(S,B,L)}};P(),requestAnimationFrame(function(){P()}),g(y),Fe(S)},vt=function(y){y.persist&&y.persist();var S=y.target,P=y.currentTarget;F.current=S,c.current.focusTimeout=setTimeout(function(){var O=S.selectionStart,J=S.selectionEnd,L=S.value;L===void 0&&(L="");var B=k(L,O);B!==O&&!(O===0&&J===L.length)&&I(S,B,L),C(Object.assign(Object.assign({},y),{currentTarget:P}))},0)},pt=function(y){F.current=null,clearTimeout(c.current.focusTimeout),clearTimeout(c.current.setCaretTimeout),w(y)},xt=X&&vn()?"numeric":void 0,Oe=Object.assign({inputMode:xt},R,{type:e,value:N,onChange:gt,onKeyDown:ht,onMouseUp:mt,onFocus:vt,onBlur:pt});if(n==="text")return i?de.createElement(de.Fragment,null,i(N,R)||null):de.createElement("span",Object.assign({},R,{ref:a}),N);if(r){var yt=r;return de.createElement(yt,Object.assign({},Oe,{ref:a}))}return de.createElement("input",Object.assign({},Oe,{ref:a}))}function nt(t,e){var n=e.decimalScale,r=e.fixedDecimalScale,i=e.prefix;i===void 0&&(i="");var a=e.suffix;a===void 0&&(a="");var s=e.allowNegative,o=e.thousandsGroupStyle;if(o===void 0&&(o="thousand"),t===""||t==="-")return t;var u=be(e),v=u.thousandSeparator,d=u.decimalSeparator,p=n!==0&&t.indexOf(".")!==-1||n&&r,f=ke(t,s),h=f.beforeDecimal,g=f.afterDecimal,C=f.addNegation;return n!==void 0&&(g=ct(g,n,!!r)),v&&(h=dn(h,v,o)),i&&(h=i+h),a&&(g=g+a),C&&(h="-"+h),t=h+(p&&d||"")+g,t}function be(t){var e=t.decimalSeparator;e===void 0&&(e=".");var n=t.thousandSeparator,r=t.allowedDecimalSeparators;return n===!0&&(n=","),r||(r=[e,"."]),{decimalSeparator:e,thousandSeparator:n,allowedDecimalSeparators:r}}function wn(t,e){t===void 0&&(t="");var n=new RegExp("(-)"),r=new RegExp("(-)(.)*(-)"),i=n.test(t),a=r.test(t);return t=t.replace(/-/g,""),i&&!a&&e&&(t="-"+t),t}function Fn(t,e){return new RegExp("(^-)|[0-9]|"+lt(t),"g")}function Dn(t,e,n){return t===""?!0:!(e!=null&&e.match(/\d/))&&!(n!=null&&n.match(/\d/))&&typeof t=="string"&&!isNaN(Number(t))}function jn(t,e,n){var r;e===void 0&&(e=pn(t));var i=n.allowNegative,a=n.prefix;a===void 0&&(a="");var s=n.suffix;s===void 0&&(s="");var o=n.decimalScale,u=e.from,v=e.to,d=v.start,p=v.end,f=be(n),h=f.allowedDecimalSeparators,g=f.decimalSeparator,C=t[p]===g;if(xe(t)&&(t===a||t===s)&&e.lastValue==="")return t;if(p-d===1&&h.indexOf(t[d])!==-1){var w=o===0?"":g;t=t.substring(0,d)+w+t.substring(d+1,t.length)}var x=function(F,c,m){var T=!1,I=!1;a.startsWith("-")?T=!1:F.startsWith("--")?(T=!1,I=!0):s.startsWith("-")&&F.length===s.length?T=!1:F[0]==="-"&&(T=!0);var k=T?1:0;return I&&(k=2),k&&(F=F.substring(k),c-=k,m-=k),{value:F,start:c,end:m,hasNegation:T}},V=x(t,d,p),E=V.hasNegation;r=V,t=r.value,d=r.start,p=r.end;var A=x(e.lastValue,u.start,u.end),R=A.start,G=A.end,U=A.value,N=t.substring(d,p);t.length&&U.length&&(R>U.length-s.length||G<a.length)&&!(N&&s.startsWith(N))&&(t=U);var W=0;t.startsWith(a)?W+=a.length:d<a.length&&(W=d),t=t.substring(W),p-=W;var b=t.length,_=t.length-s.length;t.endsWith(s)?b=_:(p>_||p>t.length-s.length)&&(b=p),t=t.substring(0,b),t=wn(E?"-"+t:t,i),t=(t.match(Fn(g))||[]).join("");var Y=t.indexOf(g);t=t.replace(new RegExp(lt(g),"g"),function(F,c){return c===Y?".":""});var $=ke(t,i),H=$.beforeDecimal,X=$.afterDecimal,D=$.addNegation;return v.end-v.start<u.end-u.start&&H===""&&C&&!parseFloat(X)&&(t=D?"-":""),t}function Tn(t,e){var n=e.prefix;n===void 0&&(n="");var r=e.suffix;r===void 0&&(r="");var i=Array.from({length:t.length+1}).map(function(){return!0}),a=t[0]==="-";i.fill(!1,0,n.length+(a?1:0));var s=t.length;return i.fill(!1,s-r.length+1,s+1),i}function Pn(t){var e=be(t),n=e.thousandSeparator,r=e.decimalSeparator,i=t.prefix;i===void 0&&(i="");var a=t.allowNegative;if(a===void 0&&(a=!0),n===r)throw new Error(`
        Decimal separator can't be same as thousand separator.
        thousandSeparator: `+n+` (thousandSeparator = {true} is same as thousandSeparator = ",")
        decimalSeparator: `+r+` (default value for decimalSeparator is .)
     `);return i.startsWith("-")&&a&&(console.error(`
      Prefix can't start with '-' when allowNegative is true.
      prefix: `+i+`
      allowNegative: `+a+`
    `),a=!1),Object.assign(Object.assign({},t),{allowNegative:a})}function En(t){t=Pn(t),t.decimalSeparator,t.allowedDecimalSeparators,t.thousandsGroupStyle;var e=t.suffix,n=t.allowNegative,r=t.allowLeadingZeros,i=t.onKeyDown;i===void 0&&(i=se);var a=t.onBlur;a===void 0&&(a=se);var s=t.thousandSeparator,o=t.decimalScale,u=t.fixedDecimalScale,v=t.prefix;v===void 0&&(v="");var d=t.defaultValue,p=t.value,f=t.valueIsNumericString,h=t.onValueChange,g=st(t,["decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","suffix","allowNegative","allowLeadingZeros","onKeyDown","onBlur","thousandSeparator","decimalScale","fixedDecimalScale","prefix","defaultValue","value","valueIsNumericString","onValueChange"]),C=be(t),w=C.decimalSeparator,x=C.allowedDecimalSeparators,V=function(D){return nt(D,t)},E=function(D,F){return jn(D,F,t)},A=he(p)?d:p,R=f??Dn(A,v,e);he(p)?he(d)||(R=R||typeof d=="number"):R=R||typeof p=="number";var G=function(D){return ot(D)?D:(typeof D=="number"&&(D=ut(D)),R&&typeof o=="number"?et(D,o,!!u):D)},U=ft(G(p),G(d),!!R,V,E,h),N=U[0],W=N.numAsString,b=N.formattedValue,_=U[1],Y=function(D){var F=D.target,c=D.key,m=F.selectionStart,T=F.selectionEnd,I=F.value;if(I===void 0&&(I=""),(c==="Backspace"||c==="Delete")&&T<v.length){D.preventDefault();return}if(m!==T){i(D);return}c==="Backspace"&&I[0]==="-"&&m===v.length+1&&n&&le(F,1),o&&u&&(c==="Backspace"&&I[m-1]===w?(le(F,m-1),D.preventDefault()):c==="Delete"&&I[m]===w&&D.preventDefault()),x!=null&&x.includes(c)&&I[m]===w&&le(F,m+1);var k=s===!0?",":s;c==="Backspace"&&I[m-1]===k&&le(F,m-1),c==="Delete"&&I[m]===k&&le(F,m+1),i(D)},$=function(D){var F=W;if(F.match(/\d/g)||(F=""),r||(F=gn(F)),u&&o&&(F=et(F,o,u)),F!==W){var c=nt(F,t);_({formattedValue:c,value:F,floatValue:parseFloat(F)},{event:D,source:pe.event})}a(D)},H=function(D){return D===w?!0:xe(D)},X=function(D){var F=D.currentValue,c=D.lastValue,m=D.formattedValue,T=D.currentValueIndex,I=D.formattedValueIndex,k=F[T],te=m[I],re=dt(c,F),me=re.to,ye=function(we){return E(we).indexOf(".")+v.length};return p===0&&u&&o&&F[me.start]===w&&ye(F)<T&&ye(m)>I?!1:T>=me.start&&T<me.end&&x&&x.includes(k)&&te===w?!0:k===te};return Object.assign(Object.assign({},g),{value:b,valueIsNumericString:!1,isValidInputCharacter:H,isCharacterSame:X,onValueChange:_,format:V,removeFormatting:E,getCaretBoundary:function(D){return Tn(D,t)},onKeyDown:Y,onBlur:$})}function Nn(t){var e=En(t);return de.createElement(bn,Object.assign({},e))}const In=({inputSuffix:t,inputPrefix:e,...n})=>l.jsx(Z,{...n,value:n.value,suffix:t,prefix:e}),Vn=({onValueChange:t,...e})=>l.jsx(Nn,{customInput:In,onValueChange:t,...e}),Ve=({inputSuffix:t,inputPrefix:e,onValueChange:n,...r})=>l.jsx(Vn,{inputPrefix:e,inputSuffix:t,onValueChange:n,...r}),rt=[{label:"Producer",value:"Producer"},{label:"Distributor",value:"Distributor"},{label:"Recycler",value:"Recycler"},{label:"Collector",value:"Collector"},{label:"Retailer",value:"Retailer"}],Rn=[{label:"Plastic shopping/carry bags (having thickness less than 75 micron)",value:"Plastic shopping/carry bags (having thickness less than 75 micron)"},{label:"Other Single Use Plastics",value:"Other Single Use Plastics"}],An=[{label:"Notice issued",value:"Notice issued"},{label:"Confiscation",value:"Confiscation"},{label:"Sealing",value:"Sealing"},{label:"FIR",value:"FIR"},{label:"Complaint before Environmental Magistrate",value:"Complaint before Environmental Magistrate"},{label:"Fine Imposed",value:"Fine Imposed"},{label:"De Sealed",value:"De Sealed"}],Bn=({control:t,errors:e,readOnly:n=!1,defaultValues:r})=>{var _,Y,$,H,X,D,F;const[i,a]=j.useState([]),[s,o]=j.useState([]),{setValue:u,getValues:v,trigger:d}=at(),[p,f]=j.useState(""),h=ce({control:t,name:"violationFound",defaultValue:[]}),g=ce({control:t,name:"violationType",defaultValue:[]}),C=ce({control:t,name:"actionTaken",defaultValue:[]}),w=ce({control:t,name:"fineRecoveryStatus",defaultValue:[]}),x=(c,m)=>{o(m);const T=m.filter(I=>!i.includes(I));T.length>0&&a(I=>[...I,...T])},V=ce({control:t,name:"plasticBagsConfiscation",defaultValue:0}),E=ce({control:t,name:"confiscation_otherPlastics",defaultValue:{}}),[A,R]=j.useState(0);j.useEffect(()=>{if(C.includes("Confiscation")){let c=0;g.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&(c+=parseFloat(V)||0),s.forEach(m=>{E[m]&&(c+=parseFloat(E[m])||0)}),R(c),u("totalConfiscation",c)}},[V,E,C,u,s,g]),j.useEffect(()=>{fe.get("/pmc/inspection-report/all_other_single_use_plastics/").then(c=>{a(c.data.single_use_plastic_items||[])}).catch(c=>{console.error("Error fetching available options:",c)})},[]),j.useEffect(()=>{r!=null&&r.OtherSingleUseItems&&o(r.OtherSingleUseItems)},[r==null?void 0:r.OtherSingleUseItems]);const[G,U]=j.useState({lat:null,lng:null,district:""}),N=c=>{U(c)},W=c=>{c.key==="Backspace"&&f(b(p,!0))},b=(c,m)=>{let T=c.replace(/[^a-zA-Z0-9]/g,""),I=T.slice(0,3).toUpperCase().replace(/[^A-Z]/g,""),k=T.slice(3,6).toUpperCase().replace(/[^A-Z]/g,""),te=T.slice(6).replace(/[^0-9]/g,"");if(m)return[I,k,te].filter(Boolean).join("-");let re="";return I&&(re+=I+(I.length===3?"-":"")),k&&(re+=k+(k.length===3?"-":"")),te&&(re+=te),re};return l.jsxs(jt,{children:[l.jsx("h4",{className:"mb-6",children:"Inspection Report"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(q,{label:"Inspection Date*",invalid:!!e.inspectionDate,errorMessage:(_=e.inspectionDate)==null?void 0:_.message,children:l.jsx(K,{name:"inspectionDate",control:t,render:({field:c})=>l.jsx(Z,{type:"date",...c})})}),l.jsx(q,{label:"Name of Business*",invalid:!!e.businessName,errorMessage:(Y=e.businessName)==null?void 0:Y.message,children:l.jsx(K,{name:"businessName",control:t,render:({field:c})=>l.jsx(Z,{type:"text",placeholder:"Business Name",readOnly:n,...c})})}),l.jsx(q,{label:"Type of Business*",invalid:!!e.businessType,errorMessage:($=e.businessType)==null?void 0:$.message,children:l.jsx(K,{name:"businessType",control:t,render:({field:c})=>l.jsx(Ge,{options:rt,isDisabled:n,value:rt.find(m=>m.value===c.value),onChange:m=>c.onChange(m==null?void 0:m.value)})})}),l.jsx(q,{label:"Plastic Application / License Number",invalid:!!e.businessType,errorMessage:(H=e.businessType)==null?void 0:H.message,children:l.jsx(K,{name:"licenseNumber",control:t,render:({field:c})=>l.jsx(Z,{value:p,onChange:m=>f(b(m.target.value,!1)),onKeyDown:W,placeholder:"e.g., LHR-PRO-001",title:"Tracking Number (e.g., LHR-PRO-001)"})})})]}),l.jsx(q,{label:"Violation Found",children:l.jsx(K,{name:"violationFound",control:t,render:({field:c})=>l.jsx(ue.Group,{value:c.value||[],onChange:m=>c.onChange(m),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(ue,{...c,value:"Yes",children:"Yes"})})},"a1")}),h.includes("Yes")&&l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs(q,{label:"Type of Violation Found*",children:[Rn.map(c=>l.jsx(K,{name:"violationType",control:t,render:({field:m})=>l.jsx(ue.Group,{value:m.value||[],onChange:T=>m.onChange(T),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(ue,{...m,value:c.value,children:c.label})})},c.value)),g.includes("Other Single Use Plastics")&&l.jsx(q,{label:"Add List + (If desired item is not in the list, then type and press enter to add)",invalid:!!e.PackagingItems,errorMessage:(X=e.PackagingItems)==null?void 0:X.message,className:"ml-2 mt-4",children:l.jsx(K,{name:"OtherSingleUseItems",control:t,render:({field:c})=>l.jsx(Xt,{multiple:!0,freeSolo:!0,options:i,value:s,readOnly:n,onChange:(m,T)=>{c.onChange(T),x(m,T)},renderTags:(m,T)=>m.map((I,k)=>l.jsx(Qt,{variant:"outlined",label:I,...T({index:k})})),renderInput:m=>l.jsx(en,{...m,variant:"outlined",label:"Other Single Use Plastics",placeholder:"Add or select Single Use Plastics"})})})})]}),l.jsx(q,{label:"Action Taken*",children:An.map(c=>l.jsx(K,{name:"actionTaken",control:t,render:({field:m})=>l.jsx(ue.Group,{value:m.value||[],onChange:T=>m.onChange(T),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(ue,{...m,value:c.value,children:c.label})})},c.value))}),C.includes("Confiscation")&&g.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&l.jsx(q,{label:"Plastic shopping/carry bags (having thickness less than 75 micron) (KG)",invalid:!!e.plasticBagsConfiscation,errorMessage:(D=e.plasticBagsConfiscation)==null?void 0:D.message,children:l.jsx(K,{name:"plasticBagsConfiscation",control:t,render:({field:c})=>l.jsx(Ve,{placeholder:"Enter KG",...c})})}),C.includes("Confiscation")&&g.includes("Other Single Use Plastics")&&s.map((c,m)=>l.jsx(q,{label:`${c} Confiscation (KG)`,children:l.jsx(K,{name:`confiscation_otherPlastics.${c}`,control:t,render:({field:T})=>l.jsx(Z,{type:"number",placeholder:"Enter KG",...T})})},m)),C.includes("Confiscation")&&l.jsx(q,{label:"Total Confiscation (KG)",children:l.jsx(K,{name:"totalConfiscation",control:t,render:({field:c})=>(j.useEffect(()=>{c.onChange(A)},[A]),l.jsx(Z,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...c}))})}),C.includes("Fine Imposed")&&l.jsx(q,{label:"Fine Amount (PKR)",children:l.jsx(K,{name:"fineAmount",control:t,render:({field:c})=>l.jsx(Ve,{placeholder:"Enter Fine Amount",...c})})}),l.jsx(q,{label:"Fine Recovery Status",children:l.jsx(K,{name:"fineRecoveryStatus",control:t,render:({field:c})=>l.jsx(Ge,{options:[{label:"Pending",value:"Pending"},{label:"Partial",value:"Partial"},{label:"Recovered",value:"Recovered"}],isDisabled:n,value:{label:c.value,value:c.value},onChange:m=>c.onChange(m==null?void 0:m.value)})})}),w!=="Pending"&&l.jsxs(l.Fragment,{children:[l.jsx(q,{label:"Fine Recovery Date",children:l.jsx(K,{name:"fineRecoveryDate",control:t,render:({field:c})=>l.jsx(Z,{type:"date",...c})})}),l.jsx(q,{label:"Recovery Amount (PKR)",children:l.jsx(K,{name:"recoveryAmount",control:t,render:({field:c})=>l.jsx(Ve,{placeholder:"Enter Recovery Amount",...c})})})]}),C.includes("De Sealed")&&l.jsxs(l.Fragment,{children:[l.jsx(q,{label:"De Sealed Date",children:l.jsx(K,{name:"deSealedDate",control:t,render:({field:c})=>l.jsx(Z,{type:"date",...c})})}),l.jsx(q,{label:"De Seal - Affidavit",invalid:!!e.flow_diagram,errorMessage:(F=e.flow_diagram)==null?void 0:F.message,children:l.jsx(K,{name:"affidavit",control:t,render:({field:c})=>l.jsx(Z,{type:"file",accept:".pdf,.png,.jpg,.jpeg",disabled:n,onChange:m=>c.onChange(m.target.files[0]||null)})})})]})]}),l.jsxs("div",{style:{padding:"20px"},children:[l.jsx("h1",{children:"Select Location"}),l.jsx(on,{onLocationSelect:N}),G.lat&&G.lng&&l.jsxs("div",{style:{marginTop:"20px",padding:"10px",border:"1px solid #ccc"},children:[l.jsx("h3",{children:"Selected Location Details:"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(q,{label:"Latitude",children:l.jsx(K,{name:"latitude",control:t,render:({field:c})=>(j.useEffect(()=>{c.onChange(G.lat)},[G.lat]),l.jsx(Z,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...c}))})}),l.jsx(q,{label:"Longitude",children:l.jsx(K,{name:"longitude",control:t,render:({field:c})=>(j.useEffect(()=>{c.onChange(G.lng)},[G.lng]),l.jsx(Z,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...c}))})}),l.jsx(q,{label:"District",children:l.jsx(K,{name:"district",control:t,render:({field:c})=>(j.useEffect(()=>{c.onChange(G.district)},[G.district]),l.jsx(Z,{type:"text",placeholder:"Auto-calculated",readOnly:!0,...c}))})})]})]})]})]})},Mn=M.object({businessName:M.string().min(1,{message:"Business name required"}),businessType:M.string().min(1,{message:"Business type required"}),licenseNumber:M.string().optional(),violationFound:M.array(M.string()).optional(),violationType:M.array(M.string()).optional(),actionTaken:M.array(M.string()).optional(),plasticBagsConfiscation:M.coerce.number().optional(),confiscation_otherPlastics:M.record(M.string(),M.coerce.number()).optional(),totalConfiscation:M.coerce.number().optional(),OtherSingleUseItems:M.array(M.string()).optional(),latitude:M.coerce.number().nullable(),longitude:M.coerce.number().nullable(),district:M.string().optional(),inspectionDate:M.string().min(1,{message:"Inspection date is required"}),fineAmount:M.coerce.number().optional(),fineRecoveryStatus:M.enum(["Pending","Partial","Recovered"]).optional(),fineRecoveryDate:M.string().optional(),recoveryAmount:M.coerce.number().optional(),deSealedDate:M.string().optional(),affidavit:M.instanceof(File,{message:"Must be a valid file"}).optional()}),kn=({onFormSubmit:t,defaultValues:e={},readOnly:n,children:r})=>{const{handleSubmit:i,reset:a,formState:{errors:s},control:o}=at({defaultValues:e,resolver:tn(Mn)});return j.useEffect(()=>{_t(e)||a(e)},[JSON.stringify(e)]),l.jsxs(Dt,{className:"flex w-full h-full",containerClassName:"flex flex-col w-full justify-between",onSubmit:i(t),children:[l.jsx(it,{children:l.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:l.jsx("div",{className:"gap-4 flex flex-col flex-auto",children:l.jsx(Bn,{control:o,errors:s,defaultValues:e})})})}),l.jsx(Tt,{children:r})]})},sr=()=>{const t=St(),e=Ct(),[n,r]=j.useState(!1),[i,a]=j.useState(!1),[s,o]=j.useState(!1),[u,v]=j.useState(!1),[d,p]=j.useState(""),[f,h]=j.useState("success"),[g,C]=j.useState(null),[w,x]=j.useState(!1),E=new URLSearchParams(e.search).get("id");j.useEffect(()=>{console.log("id",E),console.log("Fetching inspection data..."),E&&(x(!0),fe.get(`/pmc/inspection-report/${E}/`).then(b=>{const _=b.data,Y={businessName:_.business_name,businessType:_.business_type,licenseNumber:_.license_number||"",violationFound:_.violation_found||[],violationType:_.violation_type||[],actionTaken:_.action_taken||[],plasticBagsConfiscation:_.plastic_bags_confiscation||0,confiscation_otherPlastics:_.confiscation_other_plastics||{},totalConfiscation:_.total_confiscation||0,OtherSingleUseItems:_.other_single_use_items||[],latitude:_.latitude??null,longitude:_.longitude??null,district:_.district||"",inspectionDate:_.inspection_date||"",fineAmount:_.fine_amount||0,fineRecoveryStatus:_.fine_recovery_status||"Pending",fineRecoveryDate:_.fine_recovery_date||"",recoveryAmount:_.recovery_amount||0,deSealedDate:_.de_sealed_date||""};console.log("Formatted Inspection Data:",Y),C(Y)}).catch(b=>{console.error("Error fetching inspection data:",b)}).finally(()=>{x(!1)}))},[E]);const A=async b=>{var Y,$,H,X,D,F,c;console.log("inspectionData",g),o(!0);const _=new FormData;_.append("business_name",b.businessName),_.append("business_type",b.businessType),b.licenseNumber&&_.append("license_number",b.licenseNumber),b.violationFound&&_.append("violation_found",JSON.stringify(b.violationFound)),b.violationType&&_.append("violation_type",JSON.stringify(b.violationType)),b.actionTaken&&_.append("action_taken",JSON.stringify(b.actionTaken)),b.plasticBagsConfiscation&&_.append("plastic_bags_confiscation",b.plasticBagsConfiscation.toString()),b.confiscation_otherPlastics&&_.append("confiscation_other_plastics",JSON.stringify(b.confiscation_otherPlastics)),b.totalConfiscation&&_.append("total_confiscation",b.totalConfiscation.toString()),b.OtherSingleUseItems&&_.append("other_single_use_items",JSON.stringify(b.OtherSingleUseItems)),_.append("latitude",((Y=b.latitude)==null?void 0:Y.toString())||""),_.append("longitude",(($=b.longitude)==null?void 0:$.toString())||""),_.append("district",b.district||""),b.inspectionDate&&_.append("inspection_date",b.inspectionDate),b.fineAmount&&_.append("fine_amount",b.fineAmount.toString()),b.fineRecoveryStatus&&_.append("fine_recovery_status",b.fineRecoveryStatus),b.fineRecoveryDate&&_.append("fine_recovery_date",b.fineRecoveryDate),b.recoveryAmount&&_.append("recovery_amount",b.recoveryAmount.toString()),b.deSealedDate&&_.append("de_sealed_date",b.deSealedDate),b.affidavit&&_.append("affidavit",b.affidavit);try{let m;E?m=await fe.patch(`/pmc/inspection-report/${E}/`,_,{headers:{"Content-Type":"multipart/form-data"}}):m=await fe.post("/pmc/inspection-report/",_,{headers:{"Content-Type":"multipart/form-data"}}),console.log("Post successful:",m.data),o(!1),t("/auth/EPAOperations/AllInspections")}catch(m){console.error("❌ Error in POST request:",m),o(!1);const T={status:((H=m.response)==null?void 0:H.status)||"Unknown",data:((X=m.response)==null?void 0:X.data)||"No response data",message:m.message||"Unknown error"};if(typeof window<"u"&&!navigator.onLine){console.warn("[⚠️ Offline Mode] Request will be retried later."),alert("You are offline. The request will be retried when you are back online.");return}((D=m.response)==null?void 0:D.status)===500?(console.error("[🔥 Server Error] The server encountered an issue."),alert("Server is experiencing issues. Please try again later.")):((F=m.response)==null?void 0:F.status)===400?(console.warn("[⚠️ Client Error] Invalid request."),alert("There was an issue with the request. Please check your data.")):((c=m.response)==null?void 0:c.status)===404?(console.error("[🔎 Not Found] The API endpoint was not found."),alert("Requested data not found.")):m.code==="ECONNABORTED"?(console.warn("[⏳ Timeout] The request took too long to complete."),alert("The request took too long. Please check your internet connection and retry.")):(console.error("[❌ Unexpected Error]:",m),alert("An unexpected error occurred. Please try again.")),t("/error",{state:{error:T}})}},R=()=>{r(!1),wt.push(l.jsx(Ft,{type:"success",children:"Customer discard!"}),{placement:"top-center"}),t("/auth/EPAOperations/AllInspections")},G=()=>{r(!0)},U=()=>{r(!1),a(!1)},N=()=>{a(!1)},W=()=>{v(!1)};return l.jsx(l.Fragment,{children:w?l.jsx("p",{children:"Loading..."}):l.jsxs(l.Fragment,{children:[l.jsx(kn,{newCustomer:!0,defaultValues:g,onFormSubmit:A,readOnly:!1,children:l.jsx(it,{children:l.jsxs("div",{className:"flex items-center justify-between px-8",children:[l.jsx("span",{}),l.jsxs("div",{className:"flex items-center",children:[l.jsx(Le,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:l.jsx(bt,{}),onClick:G,children:"Discard"}),l.jsx(Le,{icon:l.jsx(nn,{}),variant:"solid",type:"submit",loading:s,children:"Save"})]})]})})}),l.jsx(Pe,{isOpen:u,type:f,title:"Notification",onClose:W,onRequestClose:W,onConfirm:W,onCancel:W,children:l.jsx("p",{children:d})}),l.jsx(Pe,{isOpen:n,type:"danger",title:"Discard changes",onClose:U,onRequestClose:U,onCancel:U,onConfirm:R,children:l.jsx("p",{children:"Are you sure you want discard this?"})}),l.jsx(Pe,{isOpen:i,type:"danger",title:"Go Back",onClose:U,onRequestClose:U,onCancel:U,onConfirm:N,children:l.jsx("p",{children:"There are unsaved changes on this step, Are you sure you want to go back step?"})})]})})};export{sr as default};
