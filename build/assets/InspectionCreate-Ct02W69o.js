import{r as F,A as de,j as c,X as ue,i as _t,a0 as it,U as St,Z as Ct}from"./index-D7gsvq0q.js";import{B as Le}from"./Button-Bf2oe3_B.js";import{f as bt,t as wt,N as Ft}from"./toast-CRaxgUYW.js";import{u as at,b as le,a as K,C as W,F as jt}from"./index.esm-QNsk-DpT.js";import{C as Dt,S as Ge,a as ce,B as Et}from"./index-Ci0zb0E8.js";import{I as ee}from"./Input-BTawwoPM.js";import{e as Tt,p as Pt,g as Nt,s as It,h as Vt,R as Bt,a as Be,b as _e,i as Ue,j as qe,k as Ke,E as We,l as X,m as De,d as Re,P as Ae,n as ye,o as ae,q as Q,r as Ye,u as Z,v as Se,w as Rt,x as At,y as Mt,z as Me,A as Ot,B as kt,D as Lt,H as Gt,I as Ut,f as Ee,S as $e,C as qt,F as Kt,c as Je,M as Wt,T as Yt,O as $t,V as Jt,J as Ht,t as Zt,G as zt}from"./terraformer-wkt-parser-DvzUJjf7.js";import{A as Xt,C as Qt}from"./Autocomplete-CbjDOeDC.js";import{T as en}from"./TextField-Ct4mkRVW.js";import{z as U,t as tn}from"./index-aKDC5JgN.js";import{C as Te}from"./ConfirmDialog-CNKjZ6md.js";import{B as nn}from"./index-BSy-KV4K.js";import"./classNames-X1KmuX5b.js";import"./StatusIcon-2Yyiicru.js";import"./CloseButton-CG_7audC.js";import"./index-SItUOnqi.js";import"./DefaultPropsProvider-BP7L4F6z.js";import"./index-BsV2fCke.js";import"./index-GeG-ga1p.js";import"./index-DoY1wmVf.js";import"./_getPrototype-dIsKZRMr.js";const He=0,me=1,Ze=[0,0,0,0],fe=[],Pe={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Ne extends Gt{constructor(e,n,r){super(e),this.features=n,this.mapBrowserEvent=r}}class rn extends Tt{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Pt,this.defaultDeleteCondition_=function(r){return Nt(r)&&It(r)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Vt,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Bt,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Be({source:new _e({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:sn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let n;if(e.features?n=e.features:e.source&&(this.source_=e.source,n=new Ue(this.source_.getFeatures()),this.source_.addEventListener(qe.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(qe.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!n)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=n,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ke.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ke.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const n=e.getGeometry();if(n){const i=this.SEGMENT_WRITERS_[n.getType()];i&&i(e,n)}const r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(r.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(We.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,n){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Ue;const r=this.featuresBeingModified_.getArray();for(let i=0,a=n.length;i<a;++i){const o=n[i].feature;o&&!r.includes(o)&&this.featuresBeingModified_.push(o)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Ne(Pe.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(We.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const n=this.rBush_,r=[];n.forEach(function(i){e===i.feature&&r.push(i)});for(let i=r.length-1;i>=0;--i){const a=r[i];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===a&&this.dragSegments_.splice(o,1);n.remove(a)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const n=e.target;this.removeFeature_(n),this.addFeature_(n)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,n){const r=n.getCoordinates(),i={feature:e,geometry:n,segment:[r,r]};this.rBush_.insert(n.getExtent(),i)}writeMultiPointGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const o=r[i],s={feature:e,geometry:n,depth:[i],index:i,segment:[o,o]};this.rBush_.insert(n.getExtent(),s)}}writeLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length-1;i<a;++i){const o=r.slice(i,i+2),s={feature:e,geometry:n,index:i,segment:o};this.rBush_.insert(X(o),s)}}writeMultiLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const o=r[i];for(let s=0,u=o.length-1;s<u;++s){const v=o.slice(s,s+2),d={feature:e,geometry:n,depth:[i],index:s,segment:v};this.rBush_.insert(X(v),d)}}}writePolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const o=r[i];for(let s=0,u=o.length-1;s<u;++s){const v=o.slice(s,s+2),d={feature:e,geometry:n,depth:[i],index:s,segment:v};this.rBush_.insert(X(v),d)}}}writeMultiPolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const o=r[i];for(let s=0,u=o.length;s<u;++s){const v=o[s];for(let d=0,p=v.length-1;d<p;++d){const f=v.slice(d,d+2),m={feature:e,geometry:n,depth:[s,i],index:d,segment:f};this.rBush_.insert(X(f),m)}}}}writeCircleGeometry_(e,n){const r=n.getCenter(),i={feature:e,geometry:n,index:He,segment:[r,r]},a={feature:e,geometry:n,index:me,segment:[r,r]},o=[i,a];i.featureSegments=o,a.featureSegments=o,this.rBush_.insert(De(r),i);let s=n;this.rBush_.insert(s.getExtent(),a)}writeGeometryCollectionGeometry_(e,n){const r=n.getGeometriesArray();for(let i=0;i<r.length;++i){const a=r[i],o=this.SEGMENT_WRITERS_[a.getType()];o(e,a)}}createOrUpdateVertexFeature_(e,n,r,i){let a=this.vertexFeature_;return a?a.getGeometry().setCoordinates(e):(a=new Re(new Ae(e)),this.vertexFeature_=a,this.overlay_.getSource().addFeature(a)),a.set("features",n),a.set("geometries",r),a.set("existing",i),a}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let n;return!e.map.getView().getInteracting()&&e.type==ye.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=ye.SINGLECLICK||!this.ignoreNextSingleClick_?n=this.removePoint():n=!0),e.type==ye.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!n}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(!n)return;this.getMap().getView().getProjection();const r=[],i=n.getGeometry().getCoordinates(),a=X([i]),o=this.rBush_.getInExtent(a),s={};o.sort(an);for(let u=0,v=o.length;u<v;++u){const d=o[u],p=d.segment;let f=ae(d.geometry);const m=d.depth;if(m&&(f+="-"+m.join("-")),s[f]||(s[f]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===me){const h=Xe(e,d);Q(h,i)&&!s[f][0]&&(this.dragSegments_.push([d,0]),s[f][0]=d);continue}if(Q(p[0],i)&&!s[f][0]){this.dragSegments_.push([d,0]),s[f][0]=d;continue}if(Q(p[1],i)&&!s[f][1]){if(s[f][0]&&s[f][0].index===0){let h=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":h=h[m[1]];case"Polygon":if(d.index!==h[m[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),s[f][1]=d;continue}ae(p)in this.vertexSegments_&&!s[f][0]&&!s[f][1]&&r.push(d)}return r}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([a])=>a));const n=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],i=[];for(let a=0,o=this.dragSegments_.length;a<o;++a){const s=this.dragSegments_[a],u=s[0],v=u.feature;r.includes(v)||r.push(v);const d=u.geometry;i.includes(d)||i.push(d);const p=u.depth;let f;const m=u.segment,h=s[1];for(;n.length<d.getStride();)n.push(m[h][n.length]);switch(d.getType()){case"Point":f=n,m[0]=n,m[1]=n;break;case"MultiPoint":f=d.getCoordinates(),f[u.index]=n,m[0]=n,m[1]=n;break;case"LineString":f=d.getCoordinates(),f[u.index+h]=n,m[h]=n;break;case"MultiLineString":f=d.getCoordinates(),f[p[0]][u.index+h]=n,m[h]=n;break;case"Polygon":f=d.getCoordinates(),f[p[0]][u.index+h]=n,m[h]=n;break;case"MultiPolygon":f=d.getCoordinates(),f[p[1]][p[0]][u.index+h]=n,m[h]=n;break;case"Circle":const S=d;if(m[0]=n,m[1]=n,u.index===He)this.changingFeature_=!0,S.setCenter(n),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let C=Ye(Z(S.getCenter()),Z(n));S.setRadius(C),this.changingFeature_=!1}break}f&&this.setGeometryCoordinates_(d,f)}this.createOrUpdateVertexFeature_(n,r,i,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const n=e.coordinate,r=this.findInsertVerticesAndUpdateDragSegments_(n);if(r!=null&&r.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,r),this.vertexFeature_)){const i=this.vertexFeature_.getGeometry().getCoordinates();for(let a=r.length-1;a>=0;--a)this.insertVertex_(r[a],i);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let n=this.dragSegments_.length-1;n>=0;--n){const r=this.dragSegments_[n][0],i=r.geometry;if(i.getType()==="Circle"){const a=i,o=a.getCenter(),s=r.featureSegments[0],u=r.featureSegments[1];s.segment[0]=o,s.segment[1]=o,u.segment[0]=o,u.segment[1]=o,this.rBush_.update(De(o),s);let v=a;this.rBush_.update(v.getExtent(),u)}else this.rBush_.update(X(r.segment),r)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ne(Pe.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const n=this.getMap(),r=n.getPixelFromCoordinate(e);n.getView().getProjection();const i=function(s,u){return ze(e,s)-ze(e,u)};let a,o;if(this.hitDetection_){const s=typeof this.hitDetection_=="object"?u=>u===this.hitDetection_:void 0;n.forEachFeatureAtPixel(r,(u,v,d)=>{d&&d.getType()==="Point"&&(d=new Ae(Se(d.getCoordinates())));const p=d||u.getGeometry();if(p&&p.getType()==="Point"&&u instanceof Re&&this.features_.getArray().includes(u)){o=p;const f=u.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:u,geometry:o,segment:[f,f]}]}return!0},{layerFilter:s})}if(!a){const s=Rt(De(e,Ze)),u=n.getView().getResolution()*this.pixelTolerance_,v=At(Mt(s,u,Ze));a=this.rBush_.getInExtent(v)}if(a&&a.length>0){const s=a.sort(i)[0],u=s.segment;let v=Xe(e,s);const d=n.getPixelFromCoordinate(v);let p=Ye(r,d);if(o||p<=this.pixelTolerance_){const f={};if(f[ae(u)]=!0,this.snapToPointer_||(this.delta_[0]=v[0]-e[0],this.delta_[1]=v[1]-e[1]),s.geometry.getType()==="Circle"&&s.index===me)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(v,[s.feature],[s.geometry],this.snappedToVertex_);else{const m=n.getPixelFromCoordinate(u[0]),h=n.getPixelFromCoordinate(u[1]),S=Me(d,m),C=Me(d,h);p=Math.sqrt(Math.min(S,C)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(v=S>C?u[1]:u[0]),this.createOrUpdateVertexFeature_(v,[s.feature],[s.geometry],this.snappedToVertex_);const x={};x[ae(s.geometry)]=!0;for(let P=1,T=a.length;P<T;++P){const V=a[P].segment;if(Q(u[0],V[0])&&Q(u[1],V[1])||Q(u[0],V[1])&&Q(u[1],V[0])){const I=ae(a[P].geometry);I in x||(x[I]=!0,f[ae(V)]=!0)}else break}}this.vertexSegments_=f;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,n){const r=e.segment,i=e.feature,a=e.geometry,o=e.depth,s=e.index;let u;for(;n.length<a.getStride();)n.push(0);switch(a.getType()){case"MultiLineString":u=a.getCoordinates(),u[o[0]].splice(s+1,0,n);break;case"Polygon":u=a.getCoordinates(),u[o[0]].splice(s+1,0,n);break;case"MultiPolygon":u=a.getCoordinates(),u[o[1]][o[0]].splice(s+1,0,n);break;case"LineString":u=a.getCoordinates(),u.splice(s+1,0,n);break;default:return!1}this.setGeometryCoordinates_(a,u);const v=this.rBush_;v.remove(e),this.updateSegmentIndices_(a,s,o,1);const d={segment:[r[0],n],feature:i,geometry:a,depth:o,index:s};v.insert(X(d.segment),d),this.dragSegments_.push([d,1]);const p={segment:[n,r[1]],feature:i,geometry:a,depth:o,index:s+1};return v.insert(X(p.segment),p),this.dragSegments_.push([p,0]),!0}updatePointer_(e){var n;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates()}getPoint(){var n;const e=(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates();return e?Se(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(X([e])).some(({segment:r})=>Q(r[0],e)||Q(r[1],e))}removePoint(e){if(e&&(e=Z(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=ye.POINTERDRAG){const n=this.lastPointerEvent_;this.willModifyFeatures_(n,this.dragSegments_.map(([i])=>i));const r=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ne(Pe.MODIFYEND,this.featuresBeingModified_,n)),this.featuresBeingModified_=null,r}return!1}removeVertex_(){const e=this.dragSegments_,n={};let r=!1,i,a,o,s,u,v,d,p,f,m,h;for(u=e.length-1;u>=0;--u)o=e[u],m=o[0],h=ae(m.feature),m.depth&&(h+="-"+m.depth.join("-")),h in n||(n[h]={}),o[1]===0?(n[h].right=m,n[h].index=m.index):o[1]==1&&(n[h].left=m,n[h].index=m.index+1);for(h in n){switch(f=n[h].right,d=n[h].left,v=n[h].index,p=v-1,d!==void 0?m=d:m=f,p<0&&(p=0),s=m.geometry,a=s.getCoordinates(),i=a,r=!1,s.getType()){case"MultiLineString":a[m.depth[0]].length>2&&(a[m.depth[0]].splice(v,1),r=!0);break;case"LineString":a.length>2&&(a.splice(v,1),r=!0);break;case"MultiPolygon":i=i[m.depth[1]];case"Polygon":i=i[m.depth[0]],i.length>4&&(v==i.length-1&&(v=0),i.splice(v,1),r=!0,v===0&&(i.pop(),i.push(i[0]),p=i.length-1));break}if(r){this.setGeometryCoordinates_(s,a);const S=[];if(d!==void 0&&(this.rBush_.remove(d),S.push(d.segment[0])),f!==void 0&&(this.rBush_.remove(f),S.push(f.segment[1])),d!==void 0&&f!==void 0){const C={depth:m.depth,feature:m.feature,geometry:m.geometry,index:p,segment:S};this.rBush_.insert(X(C.segment),C)}this.updateSegmentIndices_(s,v,m.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return r}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(X([e])).some(({segment:r})=>!(Q(r[0],e)||Q(r[1],e)))}insertPoint(e){var i;const n=e?Z(e,this.getMap().getView().getProjection()):(i=this.vertexFeature_)==null?void 0:i.getGeometry().getCoordinates();return n?this.findInsertVerticesAndUpdateDragSegments_(n).reduce((a,o)=>a||this.insertVertex_(o,n),!1):!1}setGeometryCoordinates_(e,n){this.changingFeature_=!0,e.setCoordinates(n),this.changingFeature_=!1}updateSegmentIndices_(e,n,r,i){this.rBush_.forEachInExtent(e.getExtent(),function(a){a.geometry===e&&(r===void 0||a.depth===void 0||Ot(a.depth,r))&&a.index>n&&(a.index+=i)})}}function an(t,e){return t.index-e.index}function ze(t,e,n){const r=e.geometry;if(r.getType()==="Circle"){let a=r;if(e.index===me){const o=Me(a.getCenter(),Z(t)),s=Math.sqrt(o)-a.getRadius();return s*s}}const i=Z(t);return fe[0]=Z(e.segment[0]),fe[1]=Z(e.segment[1]),Ut(i,fe)}function Xe(t,e,n){const r=e.geometry;if(r.getType()==="Circle"&&e.index===me)return Se(r.getClosestPoint(Z(t)));const i=Z(t);return fe[0]=Z(e.segment[0]),fe[1]=Z(e.segment[1]),Se(kt(i,fe))}function sn(){const t=Lt();return function(e,n){return t.Point}}const on=({onLocationSelect:t})=>{const e=F.useRef(null),[n,r]=F.useState(null),[i,a]=F.useState(null),[o,s]=F.useState("Fetching..."),[u,v]=F.useState(null),[d,p]=F.useState({lat:null,lng:null});F.useEffect(()=>{const S=new _e,C=new _e,x=new Re({geometry:new Ae(Ee([74.3436,31.5497]))});x.setStyle(new $e({image:new qt({radius:7,fill:new Kt({color:"red"}),stroke:new Je({color:"white",width:2})})})),C.addFeature(x),a(x);const P=new Be({source:C}),T=new Be({source:S,style:new $e({stroke:new Je({color:"blue",width:2})})}),V=new Wt({target:e.current,layers:[new Yt({source:new $t}),T,P],view:new Jt({center:Ee([74.3436,31.5497]),zoom:12})});r(V),v(T),h(T),f(V,x);const I=new rn({source:C});return V.addInteraction(I),I.on("modifyend",L=>{const G=L.features.item(0).getGeometry().getCoordinates(),E=Ht(G);p({lat:E[1],lng:E[0]}),m(E[0],E[1])}),()=>V.setTarget(null)},[]);const f=(S,C)=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(x=>{const P=Ee([x.coords.longitude,x.coords.latitude]);C.getGeometry().setCoordinates(P),S.getView().setCenter(P),S.getView().setZoom(15),m(x.coords.longitude,x.coords.latitude)},x=>console.error("Geolocation error:",x),{enableHighAccuracy:!0})},m=async(S,C)=>{try{t({lat:C,lng:S,district:""});const x=await de.get(`/pmc/DistrictByLatLon?lat=${C}&lon=${S}`);x.data&&x.data.district_name?(s(x.data.district_name),t({lat:C,lng:S,district:x.data.district_name})):s("District not found")}catch(x){console.error("Error fetching district:",x),s("Error fetching district")}},h=async S=>{try{const T={type:"FeatureCollection",features:(await de.get("/pmc/districts-public")).data.filter(I=>I.geom).map(I=>({type:"Feature",geometry:Zt.parse(I.geom.replace("SRID=4326;","")),properties:{district_id:I.district_id,district_name:I.district_name}}))},V=new _e({features:new zt().readFeatures(T,{featureProjection:"EPSG:3857"})});S.setSource(V)}catch(C){console.error("Error fetching district boundaries:",C)}};return c.jsxs("div",{children:[c.jsx("div",{ref:e,style:{height:"600px",width:"100%"}}),c.jsx("button",{type:"button",onClick:()=>f(n,i),style:{marginTop:"10px",padding:"10px",backgroundColor:"#007BFF",color:"#fff",border:"none",cursor:"pointer",borderRadius:"5px"},children:"📍 Go to Current Location"})]})};function st(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}var ve;(function(t){t.event="event",t.props="prop"})(ve||(ve={}));function ie(){}function ln(t){var e,n=void 0;return function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e&&r.length===e.length&&r.every(function(a,o){return a===e[o]})||(e=r,n=t.apply(void 0,r)),n}}function pe(t){return!!(t||"").match(/\d/)}function ge(t){return t==null}function cn(t){return typeof t=="number"&&isNaN(t)}function ot(t){return ge(t)||cn(t)||typeof t=="number"&&!isFinite(t)}function lt(t){return t.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function un(t){switch(t){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;case"thousand":default:return/(\d)(?=(\d{3})+(?!\d))/g}}function dn(t,e,n){var r=un(n),i=t.search(/[1-9]/);return i=i===-1?t.length:i,t.substring(0,i)+t.substring(i,t.length).replace(r,"$1"+e)}function fn(t){var e=F.useRef(t);e.current=t;var n=F.useRef(function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e.current.apply(e,r)});return n.current}function Oe(t,e){e===void 0&&(e=!0);var n=t[0]==="-",r=n&&e;t=t.replace("-","");var i=t.split("."),a=i[0],o=i[1]||"";return{beforeDecimal:a,afterDecimal:o,hasNegation:n,addNegation:r}}function gn(t){if(!t)return t;var e=t[0]==="-";e&&(t=t.substring(1,t.length));var n=t.split("."),r=n[0].replace(/^0+/,"")||"0",i=n[1]||"";return(e?"-":"")+r+(i?"."+i:"")}function ct(t,e,n){for(var r="",i=n?"0":"",a=0;a<=e-1;a++)r+=t[a]||i;return r}function Qe(t,e){return Array(e+1).join(t)}function ut(t){var e=t+"",n=e[0]==="-"?"-":"";n&&(e=e.substring(1));var r=e.split(/[eE]/g),i=r[0],a=r[1];if(a=Number(a),!a)return n+i;i=i.replace(".","");var o=1+a,s=i.length;return o<0?i="0."+Qe("0",Math.abs(o))+i:o>=s?i=i+Qe("0",o-s):i=(i.substring(0,o)||"0")+"."+i.substring(o),n+i}function et(t,e,n){if(["","-"].indexOf(t)!==-1)return t;var r=(t.indexOf(".")!==-1||n)&&e,i=Oe(t),a=i.beforeDecimal,o=i.afterDecimal,s=i.hasNegation,u=parseFloat("0."+(o||"0")),v=o.length<=e?"0."+o:u.toFixed(e),d=v.split("."),p=a;a&&Number(d[0])&&(p=a.split("").reverse().reduce(function(S,C,x){return S.length>x?(Number(S[0])+Number(C)).toString()+S.substring(1,S.length):C+S},d[0]));var f=ct(d[1]||"",e,n),m=s?"-":"",h=r?".":"";return""+m+p+h+f}function se(t,e){if(t.value=t.value,t!==null){if(t.createTextRange){var n=t.createTextRange();return n.move("character",e),n.select(),!0}return t.selectionStart||t.selectionStart===0?(t.focus(),t.setSelectionRange(e,e),!0):(t.focus(),!1)}}var dt=ln(function(t,e){for(var n=0,r=0,i=t.length,a=e.length;t[n]===e[n]&&n<i;)n++;for(;t[i-1-r]===e[a-1-r]&&a-r>n&&i-r>n;)r++;return{from:{start:n,end:i-r},to:{start:n,end:a-r}}}),hn=function(t,e){var n=Math.min(t.selectionStart,e);return{from:{start:n,end:t.selectionEnd},to:{start:n,end:e}}};function mn(t,e,n){return Math.min(Math.max(t,e),n)}function Ie(t){return Math.max(t.selectionStart,t.selectionEnd)}function vn(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function pn(t){return{from:{start:0,end:0},to:{start:0,end:t.length},lastValue:""}}function xn(t){var e=t.currentValue,n=t.formattedValue,r=t.currentValueIndex,i=t.formattedValueIndex;return e[r]===n[i]}function yn(t,e,n,r,i,a,o){o===void 0&&(o=xn);var s=i.findIndex(function(V){return V}),u=t.slice(0,s);!e&&!n.startsWith(u)&&(e=u,n=u+n,r=r+u.length);for(var v=n.length,d=t.length,p={},f=new Array(v),m=0;m<v;m++){f[m]=-1;for(var h=0,S=d;h<S;h++){var C=o({currentValue:n,lastValue:e,formattedValue:t,currentValueIndex:m,formattedValueIndex:h});if(C&&p[h]!==!0){f[m]=h,p[h]=!0;break}}}for(var x=r;x<v&&(f[x]===-1||!a(n[x]));)x++;var P=x===v||f[x]===-1?d:f[x];for(x=r-1;x>0&&f[x]===-1;)x--;var T=x===-1||f[x]===-1?0:f[x]+1;return T>P?P:r-T<P-r?T:P}function tt(t,e,n,r){var i=t.length;if(e=mn(e,0,i),r==="left"){for(;e>=0&&!n[e];)e--;e===-1&&(e=n.indexOf(!0))}else{for(;e<=i&&!n[e];)e++;e>i&&(e=n.lastIndexOf(!0))}return e===-1&&(e=i),e}function _n(t){for(var e=Array.from({length:t.length+1}).map(function(){return!0}),n=0,r=e.length;n<r;n++)e[n]=!!(pe(t[n])||pe(t[n-1]));return e}function ft(t,e,n,r,i,a){a===void 0&&(a=ie);var o=fn(function(h,S){var C,x;return ot(h)?(x="",C=""):typeof h=="number"||S?(x=typeof h=="number"?ut(h):h,C=r(x)):(x=i(h,void 0),C=r(x)),{formattedValue:C,numAsString:x}}),s=F.useState(function(){return o(ge(t)?e:t,n)}),u=s[0],v=s[1],d=function(h,S){h.formattedValue!==u.formattedValue&&v({formattedValue:h.formattedValue,numAsString:h.value}),a(h,S)},p=t,f=n;ge(t)&&(p=u.numAsString,f=!0);var m=o(p,f);return F.useMemo(function(){v(m)},[m.formattedValue]),[u,d]}function Sn(t){return t.replace(/[^0-9]/g,"")}function Cn(t){return t}function bn(t){var e=t.type;e===void 0&&(e="text");var n=t.displayType;n===void 0&&(n="input");var r=t.customInput,i=t.renderText,a=t.getInputRef,o=t.format;o===void 0&&(o=Cn);var s=t.removeFormatting;s===void 0&&(s=Sn);var u=t.defaultValue,v=t.valueIsNumericString,d=t.onValueChange,p=t.isAllowed,f=t.onChange;f===void 0&&(f=ie);var m=t.onKeyDown;m===void 0&&(m=ie);var h=t.onMouseUp;h===void 0&&(h=ie);var S=t.onFocus;S===void 0&&(S=ie);var C=t.onBlur;C===void 0&&(C=ie);var x=t.value,P=t.getCaretBoundary;P===void 0&&(P=_n);var T=t.isValidInputCharacter;T===void 0&&(T=pe);var V=t.isCharacterSame,I=st(t,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),L=ft(x,u,!!v,o,s,d),G=L[0],E=G.formattedValue,q=G.numAsString,D=L[1],b=F.useRef(),Y=F.useRef({formattedValue:E,numAsString:q}),$=function(y,_){Y.current={formattedValue:y.formattedValue,numAsString:y.value},D(y,_)},H=F.useState(!1),z=H[0],l=H[1],g=F.useRef(null),w=F.useRef({setCaretTimeout:null,focusTimeout:null});F.useEffect(function(){return l(!0),function(){clearTimeout(w.current.setCaretTimeout),clearTimeout(w.current.focusTimeout)}},[]);var N=o,R=function(y,_){var j=parseFloat(_);return{formattedValue:y,value:_,floatValue:isNaN(j)?void 0:j}},A=function(y,_,j){y.selectionStart===0&&y.selectionEnd===y.value.length||(se(y,_),w.current.setCaretTimeout=setTimeout(function(){y.value===j&&y.selectionStart!==_&&se(y,_)},0))},k=function(y,_,j){return tt(y,_,P(y),j)},oe=function(y,_,j){var M=P(_),J=yn(_,E,y,j,M,T,V);return J=tt(_,J,M),J},be=function(y){var _=y.formattedValue;_===void 0&&(_="");var j=y.input,M=y.source,J=y.event,O=y.numAsString,B;if(j){var te=y.inputValue||j.value,ne=Ie(j);j.value=_,B=oe(te,_,ne),B!==void 0&&A(j,B,_)}_!==E&&$(R(_,O),{event:J,source:M})};F.useEffect(function(){var y=Y.current,_=y.formattedValue,j=y.numAsString;(E!==_||q!==j)&&$(R(E,q),{event:void 0,source:ve.props})},[E,q]);var he=g.current?Ie(g.current):void 0,xe=typeof window<"u"?F.useLayoutEffect:F.useEffect;xe(function(){var y=g.current;if(E!==Y.current.formattedValue&&y){var _=oe(Y.current.formattedValue,E,he);y.value=E,A(y,_,E)}},[E]);var we=function(y,_,j){var M=_.target,J=b.current?hn(b.current,M.selectionEnd):dt(E,y),O=Object.assign(Object.assign({},J),{lastValue:E}),B=s(y,O),te=N(B);if(B=s(te,void 0),p&&!p(R(te,B))){var ne=_.target,re=Ie(ne),je=oe(y,E,re);return ne.value=E,A(ne,je,E),!1}return be({formattedValue:te,numAsString:B,inputValue:y,event:_,source:j,input:_.target}),!0},Fe=function(y,_){_===void 0&&(_=0);var j=y.selectionStart,M=y.selectionEnd;b.current={selectionStart:j,selectionEnd:M+_}},gt=function(y){var _=y.target,j=_.value,M=we(j,y,ve.event);M&&f(y),b.current=void 0},ht=function(y){var _=y.target,j=y.key,M=_.selectionStart,J=_.selectionEnd,O=_.value;O===void 0&&(O="");var B;j==="ArrowLeft"||j==="Backspace"?B=Math.max(M-1,0):j==="ArrowRight"?B=Math.min(M+1,O.length):j==="Delete"&&(B=M);var te=0;j==="Delete"&&M===J&&(te=1);var ne=j==="ArrowLeft"||j==="ArrowRight";if(B===void 0||M!==J&&!ne){m(y),Fe(_,te);return}var re=B;if(ne){var je=j==="ArrowLeft"?"left":"right";re=k(O,B,je),re!==B&&y.preventDefault()}else j==="Delete"&&!T(O[B])?re=k(O,B,"right"):j==="Backspace"&&!T(O[B])&&(re=k(O,B,"left"));re!==B&&A(_,re,O),m(y),Fe(_,te)},mt=function(y){var _=y.target,j=function(){var M=_.selectionStart,J=_.selectionEnd,O=_.value;if(O===void 0&&(O=""),M===J){var B=k(O,M);B!==M&&A(_,B,O)}};j(),requestAnimationFrame(function(){j()}),h(y),Fe(_)},vt=function(y){y.persist&&y.persist();var _=y.target,j=y.currentTarget;g.current=_,w.current.focusTimeout=setTimeout(function(){var M=_.selectionStart,J=_.selectionEnd,O=_.value;O===void 0&&(O="");var B=k(O,M);B!==M&&!(M===0&&J===O.length)&&A(_,B,O),S(Object.assign(Object.assign({},y),{currentTarget:j}))},0)},pt=function(y){g.current=null,clearTimeout(w.current.focusTimeout),clearTimeout(w.current.setCaretTimeout),C(y)},xt=z&&vn()?"numeric":void 0,ke=Object.assign({inputMode:xt},I,{type:e,value:E,onChange:gt,onKeyDown:ht,onMouseUp:mt,onFocus:vt,onBlur:pt});if(n==="text")return i?ue.createElement(ue.Fragment,null,i(E,I)||null):ue.createElement("span",Object.assign({},I,{ref:a}),E);if(r){var yt=r;return ue.createElement(yt,Object.assign({},ke,{ref:a}))}return ue.createElement("input",Object.assign({},ke,{ref:a}))}function nt(t,e){var n=e.decimalScale,r=e.fixedDecimalScale,i=e.prefix;i===void 0&&(i="");var a=e.suffix;a===void 0&&(a="");var o=e.allowNegative,s=e.thousandsGroupStyle;if(s===void 0&&(s="thousand"),t===""||t==="-")return t;var u=Ce(e),v=u.thousandSeparator,d=u.decimalSeparator,p=n!==0&&t.indexOf(".")!==-1||n&&r,f=Oe(t,o),m=f.beforeDecimal,h=f.afterDecimal,S=f.addNegation;return n!==void 0&&(h=ct(h,n,!!r)),v&&(m=dn(m,v,s)),i&&(m=i+m),a&&(h=h+a),S&&(m="-"+m),t=m+(p&&d||"")+h,t}function Ce(t){var e=t.decimalSeparator;e===void 0&&(e=".");var n=t.thousandSeparator,r=t.allowedDecimalSeparators;return n===!0&&(n=","),r||(r=[e,"."]),{decimalSeparator:e,thousandSeparator:n,allowedDecimalSeparators:r}}function wn(t,e){t===void 0&&(t="");var n=new RegExp("(-)"),r=new RegExp("(-)(.)*(-)"),i=n.test(t),a=r.test(t);return t=t.replace(/-/g,""),i&&!a&&e&&(t="-"+t),t}function Fn(t,e){return new RegExp("(^-)|[0-9]|"+lt(t),"g")}function jn(t,e,n){return t===""?!0:!(e!=null&&e.match(/\d/))&&!(n!=null&&n.match(/\d/))&&typeof t=="string"&&!isNaN(Number(t))}function Dn(t,e,n){var r;e===void 0&&(e=pn(t));var i=n.allowNegative,a=n.prefix;a===void 0&&(a="");var o=n.suffix;o===void 0&&(o="");var s=n.decimalScale,u=e.from,v=e.to,d=v.start,p=v.end,f=Ce(n),m=f.allowedDecimalSeparators,h=f.decimalSeparator,S=t[p]===h;if(pe(t)&&(t===a||t===o)&&e.lastValue==="")return t;if(p-d===1&&m.indexOf(t[d])!==-1){var C=s===0?"":h;t=t.substring(0,d)+C+t.substring(d+1,t.length)}var x=function(g,w,N){var R=!1,A=!1;a.startsWith("-")?R=!1:g.startsWith("--")?(R=!1,A=!0):o.startsWith("-")&&g.length===o.length?R=!1:g[0]==="-"&&(R=!0);var k=R?1:0;return A&&(k=2),k&&(g=g.substring(k),w-=k,N-=k),{value:g,start:w,end:N,hasNegation:R}},P=x(t,d,p),T=P.hasNegation;r=P,t=r.value,d=r.start,p=r.end;var V=x(e.lastValue,u.start,u.end),I=V.start,L=V.end,G=V.value,E=t.substring(d,p);t.length&&G.length&&(I>G.length-o.length||L<a.length)&&!(E&&o.startsWith(E))&&(t=G);var q=0;t.startsWith(a)?q+=a.length:d<a.length&&(q=d),t=t.substring(q),p-=q;var D=t.length,b=t.length-o.length;t.endsWith(o)?D=b:(p>b||p>t.length-o.length)&&(D=p),t=t.substring(0,D),t=wn(T?"-"+t:t,i),t=(t.match(Fn(h))||[]).join("");var Y=t.indexOf(h);t=t.replace(new RegExp(lt(h),"g"),function(g,w){return w===Y?".":""});var $=Oe(t,i),H=$.beforeDecimal,z=$.afterDecimal,l=$.addNegation;return v.end-v.start<u.end-u.start&&H===""&&S&&!parseFloat(z)&&(t=l?"-":""),t}function En(t,e){var n=e.prefix;n===void 0&&(n="");var r=e.suffix;r===void 0&&(r="");var i=Array.from({length:t.length+1}).map(function(){return!0}),a=t[0]==="-";i.fill(!1,0,n.length+(a?1:0));var o=t.length;return i.fill(!1,o-r.length+1,o+1),i}function Tn(t){var e=Ce(t),n=e.thousandSeparator,r=e.decimalSeparator,i=t.prefix;i===void 0&&(i="");var a=t.allowNegative;if(a===void 0&&(a=!0),n===r)throw new Error(`
        Decimal separator can't be same as thousand separator.
        thousandSeparator: `+n+` (thousandSeparator = {true} is same as thousandSeparator = ",")
        decimalSeparator: `+r+` (default value for decimalSeparator is .)
     `);return i.startsWith("-")&&a&&(console.error(`
      Prefix can't start with '-' when allowNegative is true.
      prefix: `+i+`
      allowNegative: `+a+`
    `),a=!1),Object.assign(Object.assign({},t),{allowNegative:a})}function Pn(t){t=Tn(t),t.decimalSeparator,t.allowedDecimalSeparators,t.thousandsGroupStyle;var e=t.suffix,n=t.allowNegative,r=t.allowLeadingZeros,i=t.onKeyDown;i===void 0&&(i=ie);var a=t.onBlur;a===void 0&&(a=ie);var o=t.thousandSeparator,s=t.decimalScale,u=t.fixedDecimalScale,v=t.prefix;v===void 0&&(v="");var d=t.defaultValue,p=t.value,f=t.valueIsNumericString,m=t.onValueChange,h=st(t,["decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","suffix","allowNegative","allowLeadingZeros","onKeyDown","onBlur","thousandSeparator","decimalScale","fixedDecimalScale","prefix","defaultValue","value","valueIsNumericString","onValueChange"]),S=Ce(t),C=S.decimalSeparator,x=S.allowedDecimalSeparators,P=function(l){return nt(l,t)},T=function(l,g){return Dn(l,g,t)},V=ge(p)?d:p,I=f??jn(V,v,e);ge(p)?ge(d)||(I=I||typeof d=="number"):I=I||typeof p=="number";var L=function(l){return ot(l)?l:(typeof l=="number"&&(l=ut(l)),I&&typeof s=="number"?et(l,s,!!u):l)},G=ft(L(p),L(d),!!I,P,T,m),E=G[0],q=E.numAsString,D=E.formattedValue,b=G[1],Y=function(l){var g=l.target,w=l.key,N=g.selectionStart,R=g.selectionEnd,A=g.value;if(A===void 0&&(A=""),(w==="Backspace"||w==="Delete")&&R<v.length){l.preventDefault();return}if(N!==R){i(l);return}w==="Backspace"&&A[0]==="-"&&N===v.length+1&&n&&se(g,1),s&&u&&(w==="Backspace"&&A[N-1]===C?(se(g,N-1),l.preventDefault()):w==="Delete"&&A[N]===C&&l.preventDefault()),x!=null&&x.includes(w)&&A[N]===C&&se(g,N+1);var k=o===!0?",":o;w==="Backspace"&&A[N-1]===k&&se(g,N-1),w==="Delete"&&A[N]===k&&se(g,N+1),i(l)},$=function(l){var g=q;if(g.match(/\d/g)||(g=""),r||(g=gn(g)),u&&s&&(g=et(g,s,u)),g!==q){var w=nt(g,t);b({formattedValue:w,value:g,floatValue:parseFloat(g)},{event:l,source:ve.event})}a(l)},H=function(l){return l===C?!0:pe(l)},z=function(l){var g=l.currentValue,w=l.lastValue,N=l.formattedValue,R=l.currentValueIndex,A=l.formattedValueIndex,k=g[R],oe=N[A],be=dt(w,g),he=be.to,xe=function(we){return T(we).indexOf(".")+v.length};return p===0&&u&&s&&g[he.start]===C&&xe(g)<R&&xe(N)>A?!1:R>=he.start&&R<he.end&&x&&x.includes(k)&&oe===C?!0:k===oe};return Object.assign(Object.assign({},h),{value:D,valueIsNumericString:!1,isValidInputCharacter:H,isCharacterSame:z,onValueChange:b,format:P,removeFormatting:T,getCaretBoundary:function(l){return En(l,t)},onKeyDown:Y,onBlur:$})}function Nn(t){var e=Pn(t);return ue.createElement(bn,Object.assign({},e))}const In=({inputSuffix:t,inputPrefix:e,...n})=>c.jsx(ee,{...n,value:n.value,suffix:t,prefix:e}),Vn=({onValueChange:t,...e})=>c.jsx(Nn,{customInput:In,onValueChange:t,...e}),Ve=({inputSuffix:t,inputPrefix:e,onValueChange:n,...r})=>c.jsx(Vn,{inputPrefix:e,inputSuffix:t,onValueChange:n,...r}),rt=[{label:"Producer",value:"Producer"},{label:"Distributor",value:"Distributor"},{label:"Recycler",value:"Recycler"},{label:"Collector",value:"Collector"},{label:"Retailer",value:"Retailer"}],Bn=[{label:"Plastic shopping bags less than 75 microns",value:"Plastic shopping bags less than 75 microns"},{label:"Other Single Use Plastics",value:"Other Single Use Plastics"}],Rn=[{label:"Notice issued",value:"Notice issued"},{label:"Confiscation",value:"Confiscation"},{label:"Sealing",value:"Sealing"},{label:"FIR",value:"FIR"},{label:"Complaint before Environmental Magistrate",value:"Complaint before Environmental Magistrate"},{label:"Fine Imposed",value:"Fine Imposed"},{label:"De Sealed",value:"De Sealed"}],An=({control:t,errors:e,readOnly:n=!1,defaultValues:r})=>{var b,Y,$,H,z;const[i,a]=F.useState([]),[o,s]=F.useState([]),{setValue:u,getValues:v,trigger:d}=at(),[p,f]=F.useState(""),m=le({control:t,name:"violationFound",defaultValue:[]}),h=le({control:t,name:"violationType",defaultValue:[]}),S=le({control:t,name:"actionTaken",defaultValue:[]}),C=le({control:t,name:"fineRecoveryStatus",defaultValue:[]}),x=(l,g)=>{s(g);const w=g.filter(N=>!i.includes(N));w.length>0&&a(N=>[...N,...w])},P=le({control:t,name:"plasticBagsConfiscation",defaultValue:0}),T=le({control:t,name:"confiscation_otherPlastics",defaultValue:{}}),[V,I]=F.useState(0);F.useEffect(()=>{if(S.includes("Confiscation")){let l=0;l+=parseFloat(P)||0,Object.values(T).forEach(g=>{l+=parseFloat(g)||0}),I(l),u("totalConfiscation",l)}},[P,T,S,u]),F.useEffect(()=>{de.get("/pmc/inspection-report/all_other_single_use_plastics/").then(l=>{console.log("API Response:",l.data),a(l.data.single_use_plastic_items||[])}).catch(l=>{console.error("Error fetching available options:",l)})},[]),F.useEffect(()=>{r!=null&&r.OtherSingleUseItems&&s(r.OtherSingleUseItems)},[r==null?void 0:r.OtherSingleUseItems]);const[L,G]=F.useState({lat:null,lng:null,district:""}),E=l=>{console.log("Selected Location:",l),G(l),console.log(L)},q=l=>{l.key==="Backspace"&&f(D(p,!0))},D=(l,g)=>{let w=l.replace(/[^a-zA-Z0-9]/g,""),N=w.slice(0,3).toUpperCase().replace(/[^A-Z]/g,""),R=w.slice(3,6).toUpperCase().replace(/[^A-Z]/g,""),A=w.slice(6).replace(/[^0-9]/g,"");if(g)return[N,R,A].filter(Boolean).join("-");let k="";return N&&(k+=N+(N.length===3?"-":"")),R&&(k+=R+(R.length===3?"-":"")),A&&(k+=A),k};return c.jsxs(Dt,{children:[c.jsx("h4",{className:"mb-6",children:"Inspection Report"}),c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsx(K,{label:"Inspection Date",children:c.jsx(W,{name:"inspectionDate",control:t,render:({field:l})=>c.jsx(ee,{type:"date",...l})})}),c.jsx(K,{label:"Name of Business*",invalid:!!e.businessName,errorMessage:(b=e.businessName)==null?void 0:b.message,children:c.jsx(W,{name:"businessName",control:t,render:({field:l})=>c.jsx(ee,{type:"text",placeholder:"Business Name",readOnly:n,...l})})}),c.jsx(K,{label:"Type of Business*",invalid:!!e.businessType,errorMessage:(Y=e.businessType)==null?void 0:Y.message,children:c.jsx(W,{name:"businessType",control:t,render:({field:l})=>c.jsx(Ge,{options:rt,isDisabled:n,value:rt.find(g=>g.value===l.value),onChange:g=>l.onChange(g==null?void 0:g.value)})})}),c.jsx(K,{label:"Plastic Application / License Number",invalid:!!e.businessType,errorMessage:($=e.businessType)==null?void 0:$.message,children:c.jsx(W,{name:"licenseNumber",control:t,render:({field:l})=>c.jsx(ee,{value:p,onChange:g=>f(D(g.target.value,!1)),onKeyDown:q,placeholder:"e.g., LHR-PRO-001",title:"Tracking Number (e.g., LHR-PRO-001)"})})})]}),c.jsx(K,{label:"Violation Found",children:c.jsx(W,{name:"violationFound",control:t,render:({field:l})=>c.jsx(ce.Group,{value:l.value||[],onChange:g=>l.onChange(g),className:"flex flex-col gap-2 mb-2 ml-2",children:c.jsx(ce,{...l,value:"Yes",children:"Yes"})})},"a1")}),m.includes("Yes")&&c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsxs(K,{label:"Type of Violation Found*",children:[Bn.map(l=>c.jsx(W,{name:"violationType",control:t,render:({field:g})=>c.jsx(ce.Group,{value:g.value||[],onChange:w=>g.onChange(w),className:"flex flex-col gap-2 mb-2 ml-2",children:c.jsx(ce,{...g,value:l.value,children:l.label})})},l.value)),h.includes("Other Single Use Plastics")&&c.jsx(K,{label:"Add List + (If desired item is not in the list, then type and press enter to add)",invalid:!!e.PackagingItems,errorMessage:(H=e.PackagingItems)==null?void 0:H.message,className:"ml-2 mt-4",children:c.jsx(W,{name:"OtherSingleUseItems",control:t,render:({field:l})=>c.jsx(Xt,{multiple:!0,freeSolo:!0,options:i,value:o,readOnly:n,onChange:(g,w)=>{l.onChange(w),x(g,w)},renderTags:(g,w)=>g.map((N,R)=>c.jsx(Qt,{variant:"outlined",label:N,...w({index:R})})),renderInput:g=>c.jsx(en,{...g,variant:"outlined",label:"Other Single Use Plastics",placeholder:"Add or select Single Use Plastics"})})})})]}),c.jsx(K,{label:"Action Taken*",children:Rn.map(l=>c.jsx(W,{name:"actionTaken",control:t,render:({field:g})=>c.jsx(ce.Group,{value:g.value||[],onChange:w=>g.onChange(w),className:"flex flex-col gap-2 mb-2 ml-2",children:c.jsx(ce,{...g,value:l.value,children:l.label})})},l.value))}),S.includes("Confiscation")&&h.includes("Plastic shopping bags less than 75 microns")&&c.jsx(K,{label:"Plastic shopping bags Confiscation (KG)",invalid:!!e.plasticBagsConfiscation,errorMessage:(z=e.plasticBagsConfiscation)==null?void 0:z.message,children:c.jsx(W,{name:"plasticBagsConfiscation",control:t,render:({field:l})=>c.jsx(Ve,{placeholder:"Enter KG",...l})})}),S.includes("Confiscation")&&h.includes("Other Single Use Plastics")&&o.map((l,g)=>c.jsx(K,{label:`${l} Confiscation (KG)`,children:c.jsx(W,{name:`confiscation_otherPlastics.${l}`,control:t,render:({field:w})=>c.jsx(ee,{type:"number",placeholder:"Enter KG",...w})})},g)),c.jsx(K,{label:"Total Confiscation (KG)",children:c.jsx(W,{name:"totalConfiscation",control:t,render:({field:l})=>(F.useEffect(()=>{l.onChange(V)},[V]),c.jsx(ee,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...l}))})}),S.includes("Fine Imposed")&&c.jsx(K,{label:"Fine Amount (PKR)",children:c.jsx(W,{name:"fineAmount",control:t,render:({field:l})=>c.jsx(Ve,{placeholder:"Enter Fine Amount",...l})})}),c.jsx(K,{label:"Fine Recovery Status",children:c.jsx(W,{name:"fineRecoveryStatus",control:t,render:({field:l})=>c.jsx(Ge,{options:[{label:"Pending",value:"Pending"},{label:"Partial",value:"Partial"},{label:"Recovered",value:"Recovered"}],isDisabled:n,value:{label:l.value,value:l.value},onChange:g=>l.onChange(g==null?void 0:g.value)})})}),C!=="Pending"&&c.jsxs(c.Fragment,{children:[c.jsx(K,{label:"Fine Recovery Date",children:c.jsx(W,{name:"fineRecoveryDate",control:t,render:({field:l})=>c.jsx(ee,{type:"date",...l})})}),c.jsx(K,{label:"Recovery Amount (PKR)",children:c.jsx(W,{name:"recoveryAmount",control:t,render:({field:l})=>c.jsx(Ve,{placeholder:"Enter Recovery Amount",...l})})})]}),S.includes("De Sealed")&&c.jsx(K,{label:"De Sealed Date",children:c.jsx(W,{name:"deSealedDate",control:t,render:({field:l})=>c.jsx(ee,{type:"date",...l})})})]}),c.jsxs("div",{style:{padding:"20px"},children:[c.jsx("h1",{children:"Select Location"}),c.jsx(on,{onLocationSelect:E}),L.lat&&L.lng&&c.jsxs("div",{style:{marginTop:"20px",padding:"10px",border:"1px solid #ccc"},children:[c.jsx("h3",{children:"Selected Location Details:"}),c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsx(K,{label:"Latitude",children:c.jsx(W,{name:"latitude",control:t,render:({field:l})=>(F.useEffect(()=>{l.onChange(L.lat)},[L.lat]),c.jsx(ee,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...l}))})}),c.jsx(K,{label:"Longitude",children:c.jsx(W,{name:"longitude",control:t,render:({field:l})=>(F.useEffect(()=>{l.onChange(L.lng)},[L.lng]),c.jsx(ee,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...l}))})}),c.jsx(K,{label:"District",children:c.jsx(W,{name:"district",control:t,render:({field:l})=>(F.useEffect(()=>{l.onChange(L.district)},[L.district]),c.jsx(ee,{type:"text",placeholder:"Auto-calculated",readOnly:!0,...l}))})})]})]})]})]})},Mn=U.object({businessName:U.string().min(1,{message:"Business name required"}),businessType:U.string().min(1,{message:"Business type required"}),licenseNumber:U.string().optional(),violationFound:U.array(U.string()).optional(),violationType:U.array(U.string()).optional(),actionTaken:U.array(U.string()).optional(),plasticBagsConfiscation:U.coerce.number().optional(),confiscation_otherPlastics:U.record(U.string(),U.coerce.number()).optional(),totalConfiscation:U.coerce.number().optional(),OtherSingleUseItems:U.array(U.string()).optional(),latitude:U.coerce.number().nullable(),longitude:U.coerce.number().nullable(),district:U.string().optional()}),On=({onFormSubmit:t,defaultValues:e={},readOnly:n,children:r})=>{console.log("defaultValues2",e);const{handleSubmit:i,reset:a,formState:{errors:o},control:s}=at({defaultValues:e,resolver:tn(Mn)});return console.log("control:",JSON.stringify(s,null,2)),F.useEffect(()=>{_t(e)||a(e)},[JSON.stringify(e)]),c.jsxs(jt,{className:"flex w-full h-full",containerClassName:"flex flex-col w-full justify-between",onSubmit:i(t),children:[c.jsx(it,{children:c.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:c.jsx("div",{className:"gap-4 flex flex-col flex-auto",children:c.jsx(An,{control:s,errors:o,defaultValues:e})})})}),c.jsx(Et,{children:r})]})},sr=()=>{const t=St(),e=Ct(),[n,r]=F.useState(!1),[i,a]=F.useState(!1),[o,s]=F.useState(!1),[u,v]=F.useState(!1),[d,p]=F.useState(""),[f,m]=F.useState("success"),[h,S]=F.useState(null),[C,x]=F.useState(!1),T=new URLSearchParams(e.search).get("id");F.useEffect(()=>{console.log("id",T),console.log("Fetching inspection data..."),T&&(x(!0),de.get(`/pmc/inspection-report/${T}/`).then(D=>{const b=D.data,Y={businessName:b.business_name,businessType:b.business_type,licenseNumber:b.license_number||"",violationFound:b.violation_found||[],violationType:b.violation_type||[],actionTaken:b.action_taken||[],plasticBagsConfiscation:b.plastic_bags_confiscation||0,confiscation_otherPlastics:b.confiscation_other_plastics||{},totalConfiscation:b.total_confiscation||0,OtherSingleUseItems:b.other_single_use_items||[],latitude:b.latitude??null,longitude:b.longitude??null,district:b.district||""};console.log("Formatted Inspection Data:",Y),S(Y)}).catch(D=>{console.error("Error fetching inspection data:",D)}).finally(()=>{x(!1)}))},[T]);const V=async D=>{var Y,$,H,z;console.log("inspectionData",h),s(!0);const b=new FormData;b.append("business_name",D.businessName),b.append("business_type",D.businessType),D.licenseNumber&&b.append("license_number",D.licenseNumber),D.violationFound&&b.append("violation_found",JSON.stringify(D.violationFound)),D.violationType&&b.append("violation_type",JSON.stringify(D.violationType)),D.actionTaken&&b.append("action_taken",JSON.stringify(D.actionTaken)),D.plasticBagsConfiscation&&b.append("plastic_bags_confiscation",D.plasticBagsConfiscation.toString()),D.confiscation_otherPlastics&&b.append("confiscation_other_plastics",JSON.stringify(D.confiscation_otherPlastics)),D.totalConfiscation&&b.append("total_confiscation",D.totalConfiscation.toString()),D.OtherSingleUseItems&&b.append("other_single_use_items",JSON.stringify(D.OtherSingleUseItems)),b.append("latitude",((Y=D.latitude)==null?void 0:Y.toString())||""),b.append("longitude",(($=D.longitude)==null?void 0:$.toString())||""),b.append("district",D.district||"");try{let l;T?l=await de.patch(`/pmc/inspection-report/${T}/`,b,{headers:{"Content-Type":"multipart/form-data"}}):l=await de.post("/pmc/inspection-report/",b,{headers:{"Content-Type":"multipart/form-data"}}),console.log("Post successful:",l.data),s(!1),t("/auth/EPAOperations/AllInspections")}catch(l){console.error("Error in POST request:",l.response||l.message),s(!1);const g={status:(H=l.response)==null?void 0:H.status,data:(z=l.response)==null?void 0:z.data,message:l.message};t("/error",{state:{error:g}})}},I=()=>{r(!1),wt.push(c.jsx(Ft,{type:"success",children:"Customer discard!"}),{placement:"top-center"}),t("/auth/EPAOperations/AllInspections")},L=()=>{r(!0)},G=()=>{r(!1),a(!1)},E=()=>{a(!1)},q=()=>{v(!1)};return c.jsx(c.Fragment,{children:C?c.jsx("p",{children:"Loading..."}):c.jsxs(c.Fragment,{children:[c.jsx(On,{newCustomer:!0,defaultValues:h,onFormSubmit:V,readOnly:!1,children:c.jsx(it,{children:c.jsxs("div",{className:"flex items-center justify-between px-8",children:[c.jsx("span",{}),c.jsxs("div",{className:"flex items-center",children:[c.jsx(Le,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:c.jsx(bt,{}),onClick:L,children:"Discard"}),c.jsx(Le,{icon:c.jsx(nn,{}),variant:"solid",type:"submit",loading:o,children:"Save"})]})]})})}),c.jsx(Te,{isOpen:u,type:f,title:"Notification",onClose:q,onRequestClose:q,onConfirm:q,onCancel:q,children:c.jsx("p",{children:d})}),c.jsx(Te,{isOpen:n,type:"danger",title:"Discard changes",onClose:G,onRequestClose:G,onCancel:G,onConfirm:I,children:c.jsx("p",{children:"Are you sure you want discard this?"})}),c.jsx(Te,{isOpen:i,type:"danger",title:"Go Back",onClose:G,onRequestClose:G,onCancel:G,onConfirm:E,children:c.jsx("p",{children:"There are unsaved changes on this step, Are you sure you want to go back step?"})})]})})};export{sr as default};
