import{r as i,k as n,j as e,A as y}from"./index-CVTaqBJd.js";import{T}from"./index-DvMWk5UO.js";import{b as M}from"./isNil-C85LWpZk.js";import{u as F,F as z,a as f,C as h}from"./index.esm-dhAzpIu2.js";import{t as E,z as o}from"./index-CR6W5jyr.js";import{M as K}from"./index.esm-BMWsgiYF.js";import{B as N}from"./Button-25B2WOn4.js";import{C as U}from"./Card-BmKG3Q5O.js";import{I as w}from"./Input-DVojUF7e.js";import{S as A}from"./Select-COi_ro64.js";import"./useControllableState-B8FIsxJR.js";import"./classNames-DUq7TMwp.js";import"./index-XQNPq7eH.js";import"./TextField-BLxBlQop.js";import"./DefaultPropsProvider-CsvYfp1K.js";import"./Autocomplete-DuiqV1Zp.js";import"./FormControlLabel-DpZ4fTxy.js";import"./Divider-BeoYHaHx.js";import"./index-BSmWUK0t.js";import"./floating-ui.dom-CrKScG7J.js";const B=o.object({title:o.string().min(3,"Title must be at least 3 characters"),documentType:o.enum(["notification","minutes"],{required_error:"Select a document type"}),file:o.instanceof(File,{message:"Must be a valid file"}).optional()}),I=()=>{var b,x,j;const[l,c]=i.useState([]),[m,s]=i.useState(!1),d=n(t=>t.user.district_id)||null;n(t=>t.user.district_name);const{handleSubmit:v,control:u,setValue:R,reset:D,formState:{errors:r,isSubmitting:p}}=F({resolver:E(B),defaultValues:{title:"",documentType:"notification",file:null}}),g=()=>{s(!0),y.get("/pmc/district-documents/").then(t=>c(t.data)).catch(t=>console.error("Error fetching documents:",t)).finally(()=>s(!1))};i.useEffect(()=>{g()},[]);const S=async t=>{const a=new FormData;a.append("district_id",(d==null?void 0:d.toString())||"0"),a.append("document_type",t.documentType),a.append("title",t.title),a.append("document",t.file);try{await y.post("/pmc/district-documents/",a,{headers:{"Content-Type":"multipart/form-data"}}),alert("Document uploaded successfully!"),g(),D()}catch(_){console.error("Error uploading document:",_),alert("Failed to upload document.")}},C=[{accessorKey:"district_name",header:"District",size:200},{accessorKey:"document_type",header:"Type",size:150},{accessorKey:"title",header:"Title",size:300},{accessorKey:"uploaded_at",header:"Uploaded On",size:200},{accessorKey:"file",header:"Download",size:100,Cell:({row:t})=>e.jsx("a",{href:t.original.file,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600",children:"Download"})}];return e.jsxs(U,{children:[e.jsxs(z,{onSubmit:v(S),className:"grid md:grid-cols-2 gap-4 mb-4",children:[e.jsx(f,{label:"Document Title",invalid:!!r.title,errorMessage:(b=r.title)==null?void 0:b.message,children:e.jsx(h,{name:"title",control:u,render:({field:t})=>e.jsx(w,{...t,placeholder:"Enter document title"})})}),e.jsx(f,{label:"Document Type",invalid:!!r.documentType,errorMessage:(x=r.documentType)==null?void 0:x.message,children:e.jsx(h,{name:"documentType",control:u,render:({field:t})=>e.jsx(A,{options:[{label:"Notification",value:"notification"},{label:"Minutes of Meeting",value:"minutes"}],value:{label:t.value,value:t.value},onChange:a=>t.onChange(a==null?void 0:a.value)})})}),e.jsx(f,{label:"Upload File",invalid:!!r.file,errorMessage:(j=r.file)==null?void 0:j.message,children:e.jsx(h,{name:"file",control:u,render:({field:t})=>e.jsx("input",{type:"file",accept:".pdf,.png,.jpg,.jpeg",onChange:a=>t.onChange(a.target.files[0])})})}),e.jsx(N,{type:"submit",variant:"solid",disabled:p,loading:p,children:p?"Uploading...":"Upload"})]}),m?e.jsx("p",{children:"Loading documents..."}):e.jsx(K,{columns:C,data:l,enablePagination:!0})]})},{TabNav:L,TabList:k,TabContent:O}=T,le=()=>{const[l,c]=i.useState("tab1");n(s=>s.user.district_id);const m=n(s=>s.user.district_name)||"";return e.jsx("div",{children:e.jsxs(T,{value:l,onChange:c,children:[e.jsx(k,{children:e.jsxs(L,{value:"tab1",icon:e.jsx(M,{}),children:["Manage Documents for District: ",m]})}),e.jsx("div",{className:"p-4",children:e.jsx(O,{value:"tab1",children:e.jsx(I,{})})})]})})};export{le as default};
