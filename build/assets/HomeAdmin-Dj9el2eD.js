import{r as p,V as k,j as n,A as D}from"./index-BW1Hx4NO.js";import{M as z}from"./index.esm-BIqsQzLs.js";import{a as G}from"./index-BA3ootsb.js";import"./TextField-BmaZANU9.js";import"./DefaultPropsProvider-C69u2oWH.js";import"./Autocomplete-BkYCBHvx.js";import"./FormControlLabel-D6c4CrlZ.js";import"./Divider-Dc78WcFO.js";import"./index-DAuu1ybF.js";const P=t=>{var S,w,b,x,L,y;const u=a=>new Intl.NumberFormat("en-PK",{style:"currency",currency:"PKR",minimumFractionDigits:2}).format(a),c=t.applicationassignment.filter(a=>a.assigned_group===t.assigned_group),i=c.reduce((a,d)=>new Date(d.updated_at).getTime()>new Date(a.updated_at).getTime()?d:a,c[0]),r=i?(S=i.updated_at)==null?void 0:S.substring(0,16):"N/A";let _="N/A";if(i&&i.updated_at){const a=new Date(i.updated_at),m=new Date-a;_=Math.floor(m/(1e3*60*60*24))}let C="N/A";if((w=t.submittedapplication)!=null&&w.created_at&&((b=t.submittedapplication)!=null&&b.created_at)){const a=new Date((x=t.submittedapplication)==null?void 0:x.created_at),m=new Date-a;C=Math.floor(m/(1e3*60*60*24))}const O=t.applicantfees?t.applicantfees.reduce((a,d)=>a+parseFloat(d.fee_amount||0),0):0,h=t.applicantfees?t.applicantfees.filter(a=>a.is_settled).reduce((a,d)=>a+parseFloat(d.fee_amount||0),0):0;return{id:t.id,application_Submission_Time:((y=(L=t.submittedapplication)==null?void 0:L.created_at)==null?void 0:y.substring(0,16))||"N/A",duration:C,tracking_number:t.tracking_number,first_name:t.first_name,last_name:t.last_name,mobile_no:t.mobile_no,application_status:t.application_status,assigned_group:t.assigned_group,group_assignment_time:r,group_assignment_days:_,total_fee_amount:u(O.toFixed(2)),verified_fee_amount:u(h.toFixed(2)),created_by_username:t.created_by_username}},U=t=>t.map(u=>{const c=P(u);return Object.keys(c).forEach(i=>{(c[i]===void 0||c[i]===null)&&(c[i]="N/A")}),c}),Y=()=>{const[t,u]=p.useState([]),[c,i]=p.useState([]),[r,_]=p.useState(null),[C,O]=p.useState(0),[h,S]=p.useState(null),[w,b]=p.useState({}),[x,L]=p.useState(null),[y,a]=p.useState(!1),d=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","DG","Download License"],m={APPLICANT:"Applicant",LSO:"LSO",LSO1:"Sana",LSO2:"Qaisar",LSO3:"Ameer",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO",DG:"DG","Download License":"Download License"},F=async e=>{try{if(a(!0),L(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const l=e==="LSO1"?1:e==="LSO2"?2:0;if(navigator.onLine){const o=((await D.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:"LSO"}})).data||[]).filter(T=>{var A;return((A=T.submittedapplication)==null?void 0:A.id)%3===l}),f=N(o,!!r.length,r[0]);u(f.flattenedData),i(f.columns)}else throw new Error("Application is offline. Cannot fetch data.")}else if(navigator.onLine){const s=(await D.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],o=N(s,!!r.length,r[0]);u(o.flattenedData),i(o.columns)}else throw new Error("Application is offline. Cannot fetch data.")}catch(l){console.error("Error fetching filtered data:",l),u([]),i([])}finally{a(!1)}},N=(e,l,s)=>{const o=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","duration","remarks","group_assignment_days","total_fee_amount","verified_fee_amount","created_by_username"],f=U(e),T=f[0],A=[...Object.keys(T).filter(g=>o.includes(g)).map(g=>{let v=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(g)?v=120:["first_name"].includes(g)&&(v=180),{accessorKey:g,header:g.replace(/_/g," ").replace(/\b\w/g,E=>E.toUpperCase()),size:v,Cell:({cell:E,row:M})=>{const I=`/spuid-review/${M.original.id}?group=${s}`;return n.jsx("a",{href:I,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:E.getValue()||"-"})}}})];return{flattenedData:f,columns:A}},R=k();p.useEffect(()=>{(async()=>{a(!0);try{let s=[];try{if(navigator.onLine)s=(await D.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],_(s.map(f=>f.name));else throw new Error("Application is offline. Cannot fetch data.")}catch(o){console.error("Error fetching user groups:",o),_([])}if(console.log("groupsResponse",s),navigator.onLine){const o=await D.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});b(o.data)}else throw new Error("Application is offline. Cannot fetch data.")}catch(s){console.error("Error fetching data:",s)}finally{a(!1)}})(),S(25);const l=d.indexOf("LSO");l!==-1&&O(l)},[]),p.useEffect(()=>{console.log("userGroups:",r),r&&!r.includes("Admin")&&R("/home")},[r,R]),console.log("selectedRowId:",h),console.log(h);const j=async()=>{try{const e=await D.post("/pmc/export-applicant/",{applicant_ids:t==null?void 0:t.map(o=>o.id)},{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=l,s.setAttribute("download",`Applicant_Details_${new Date().toISOString()}.xlsx`),document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(e){console.error("Export failed:",e)}};return n.jsxs("div",{children:[n.jsx("div",{className:"tiles-container",children:Object.entries(w).map(([e,l])=>n.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:x===e?"#007BFF":"#f8f9fa",color:x===e?"#fff":"#000"},onClick:()=>F(e),children:[n.jsx("h3",{children:m[e]||e})," ",n.jsx("p",{children:l})]},e))}),n.jsx("div",{className:"mb-4",children:n.jsxs("h3",{children:[r&&r.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),y?n.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[n.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),n.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid md:grid-cols-5 gap-5 items-center mb-4",children:[n.jsx("h6",{className:"text-red-500 col-span-3",children:"Records highlighted in red require immediate attention, as they have been returned from a next step."}),n.jsx("span",{}),n.jsxs("button",{type:"button",onClick:j,className:"flex items-center justify-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200",children:[n.jsx(G,{className:"mr-2 text-xl"}),"Export to Excel"]})]}),n.jsx(z,{columns:[...c],data:t.map(e=>({...e,assigned_group_title:m[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:200,minSize:1,size:50},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},h)]})]})};export{Y as default};
