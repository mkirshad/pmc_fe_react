import{r as p,U as I,j as c,A as S}from"./index-BkUrN6cB.js";import{M as k}from"./index.esm-CbGKGaZS.js";import"./TextField-DFTc9qgK.js";import"./Divider-BfSfnTqK.js";import"./FormControlLabel-bJaZmh8r.js";import"./Autocomplete-NSaoWlne.js";import"./index-CkLwAYbx.js";const v=e=>{var i,g,D;const n=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(l=>l.assigned_group==="APPLICANT"&&l.remarks&&l.remarks!=="undefined").map(l=>l.remarks),d=n.length>0?n.join("; "):"N/A";return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,cnic:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,application_Start_Time:((i=e.created_at)==null?void 0:i.substring(0,16))||"N/A",application_Submission_Time:((D=(g=e.submittedapplication)==null?void 0:g.created_at)==null?void 0:D.substring(0,16))||"N/A",remarks:d}},y=e=>e.map(f=>{const n=v(f);return Object.keys(n).forEach(d=>{(n[d]===void 0||n[d]===null)&&(n[d]="N/A")}),n}),G=()=>{const[e,f]=p.useState([]),[n,d]=p.useState([]),[i,g]=p.useState([]),[D,l]=p.useState(0),[_,A]=p.useState(null),[R,O]=p.useState({});console.log(_);const w=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],C={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},b=(t,u,a)=>{const T=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],m=y(t),L=m[0];console.log(t);const o=[...Object.keys(L).filter(s=>T.includes(s)).map(s=>({accessorKey:s,header:s.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),size:200,Cell:({cell:r,row:N})=>c.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const x=N.original.id;console.log(`Clicked ${s}:`,r.getValue()),console.log(`Navigating with ID: ${x}`),window.location.href=u?`/spuid-review/${x}?group=${a}`:`/spuid-signup/${x}`},children:r.getValue()||"-"})}))];return{flattenedData:m,columns:o}},h=I();return p.useEffect(()=>{(async()=>{try{const a=await S.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{h("/error")}try{let a=[];try{a=(await S.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],g(a.map(s=>s.name))}catch(o){console.error("Error fetching user groups:",o),g([])}console.log("groupsResponse",a);const m=(await S.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(m)&&m.length>0){const o=b(m,a.length>0,a.map(r=>r.name)[0]);f(o.flattenedData),d(o.columns),console.log("Flattened Data:",o.flattenedData);const s=o.flattenedData[o.flattenedData.length-1];if(console.log("Last Row:",s),s&&s.id){A(s.id),console.log("Last Row ID:",s.id);const r=w.indexOf(s.assigned_group);r!==-1&&l(r)}}const L=await S.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});O(L.data)}catch(a){console.error("Error fetching data:",a)}})(),A(25);const u=w.indexOf("LSO");u!==-1&&l(u)},[]),p.useEffect(()=>{console.log("userGroups:",i),i.includes("Super")?h("/home-super"):i.includes("Admin")&&h("/home-admin")},[i,h]),console.log("selectedRowId:",_),console.log(_),c.jsxs("div",{children:[c.jsx("div",{className:"tiles-container",children:Object.entries(R).map(([t,u])=>c.jsxs("div",{className:"tile",children:[c.jsx("h3",{children:C[t]||t})," ",c.jsx("p",{children:u})]},t))}),c.jsx("div",{className:"mb-4",children:c.jsxs("h3",{children:[i.filter(t=>t!=="Download License"&&t!=="Applicant"&&t!=="LSM2").join(" - ")," Dashboard"]})}),c.jsx(k,{columns:[...n],data:e.map(t=>({...t,assigned_group_title:C[t.assigned_group]||t.assigned_group})),getRowId:t=>t.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:1,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:i.length>0,enablePagination:!0},_)]})};export{G as default};
