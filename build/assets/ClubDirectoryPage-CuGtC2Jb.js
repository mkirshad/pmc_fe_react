import{r,j as s,A as y}from"./index-DpbVdvho.js";import{H as T}from"./HeaderTemplate-C7yvATI3.js";import{M as V,V as _,T as P,O as z,a as C,b as m,S,e as R,F as f,c as x,f as A,d as B,P as G,C as H}from"./OSM-Bx5l-N5p.js";import{G as I}from"./GeoJSON-BAwyf57_.js";import{M as K}from"./index.esm-CouJZmTO.js";import{h as Z,m as $,n as O,o as J,p as W}from"./index-oQw3Caad.js";import"./Divider-1nH90sM6.js";import"./DefaultPropsProvider-Dfkjrbnv.js";import"./TextField-DahAofim.js";import"./Autocomplete-NB6zubAT.js";import"./FormControlLabel-GMnp0iW5.js";import"./index-C08Ukbpq.js";const q=()=>{const d=r.useRef(null),[o,j]=r.useState(null),[c,N]=r.useState(null),[p,v]=r.useState(null),[l,E]=r.useState([]),[i,u]=r.useState(null),[k,g]=r.useState(!1),[b,L]=r.useState([]);r.useEffect(()=>{const e=new V({target:d.current,layers:[new P({source:new z})],view:new _({zoom:7,center:[8127130,3658593]})}),t=new C({source:new m}),a=new C({source:new m});return e.addLayer(t),e.addLayer(a),N(t),v(a),j(e),()=>e.setTarget(null)},[]),r.useEffect(()=>{if(!c||!o)return;(async()=>{g(!0);try{const t=await y.get("/pmc/idm_districts-club-counts/");L(t.data.features);const a=new m({features:new I().readFeatures(t.data,{featureProjection:"EPSG:3857"})});c.setSource(a),o.getView().fit(a.getExtent(),{padding:[50,50,50,50],duration:500})}catch(t){console.error("Error fetching districts:",t)}finally{g(!1)}})()},[c,o]),r.useEffect(()=>{c&&c.setStyle(e=>{const t=e.get("id")===i;return new S({stroke:new x({color:t?"red":"blue",width:t?3:2}),fill:new f({color:t?"rgba(255,0,0,0.1)":"rgba(0,0,255,0.1)"}),text:new R({text:`${e.get("name")} (${e.get("club_count")})`,font:"12px sans-serif",fill:new f({color:"#000"}),stroke:new x({color:"#fff",width:3})})})})},[c,i]),r.useEffect(()=>{(async()=>{const t=await y.get("/pmc/idm_clubs_geojson_all/");E(t.data.features)})()},[]),r.useEffect(()=>{if(!p)return;const e=p.getSource();e.clear(),l.forEach(t=>{const a=A(t.geometry.coordinates),n=new B({geometry:new G(a)});n.setStyle(new S({image:new H({radius:5,fill:new f({color:"#22C55E"}),stroke:new x({color:"#fff",width:1})})})),e.addFeature(n)})},[p,l]),r.useEffect(()=>{if(!o||!c)return;const e=t=>{const a=o.getFeaturesAtPixel(t.pixel);if(a.length>0){const n=a[0],w=n.get("id");i===w?(u(null),o.getView().setCenter([8127130,3658593]),o.getView().setZoom(7)):(u(w),o.getView().fit(n.getGeometry().getExtent(),{padding:[50,50,50,50],maxZoom:10}))}else u(null),o.getView().setCenter([8127130,3658593]),o.getView().setZoom(7)};return o.on("click",e),()=>o.un("click",e)},[o,c,i]);const D=r.useMemo(()=>i?l.filter(e=>e.properties.district_id===i):l,[i,l]),M=r.useMemo(()=>[{accessorKey:"properties.district",header:"District",size:150},{accessorKey:"properties.name",header:"School Name",size:225},{accessorKey:"properties.address",header:"Address",size:225},{accessorKey:"properties.head_name",header:"Head Name",size:200}],[]),F=r.useMemo(()=>{const e=[...b].sort((t,a)=>a.properties.club_count-t.properties.club_count).slice(0,4);return[{properties:{name:"Total Clubs",club_count:l.length,id:null}},...e]},[b,l]),h=[{bgColor:"bg-gray-500",icon:s.jsx(Z,{className:"text-white text-3xl"})},{bgColor:"bg-orange-500",icon:s.jsx($,{className:"text-white text-3xl"})},{bgColor:"bg-blue-500",icon:s.jsx(O,{className:"text-white text-3xl"})},{bgColor:"bg-yellow-500",icon:s.jsx(J,{className:"text-white text-3xl"})},{bgColor:"bg-green-500",icon:s.jsx(W,{className:"text-white text-3xl"})}];return s.jsxs("div",{className:"flex flex-col p-4 gap-4",children:[s.jsx("div",{className:"grid grid-cols-5 gap-4",children:F.map((e,t)=>s.jsx("div",{className:`shadow-md rounded p-6 w-full cursor-pointer transition 
                ${i===null||i===e.properties.id?"opacity-100":"opacity-50"}
                ${h[t].bgColor}
                `,onClick:()=>u(e.properties.id),children:s.jsxs("div",{className:"flex items-center space-x-2",children:[h[t].icon,s.jsx("h2",{className:"text-2xl font-bold text-white",children:e.properties.name}),s.jsx("p",{className:"text-2xl font-bold text-white",children:e.properties.club_count})]})},t))}),s.jsxs("div",{className:"flex flex-row p-4 gap-4",children:[s.jsxs("div",{className:"relative w-1/2",children:[k&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-10",children:s.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-blue-500 border-t-transparent rounded-full"})}),s.jsx("div",{ref:d,style:{height:"850px"}})]}),s.jsx("div",{style:{flex:1},children:s.jsx(K,{columns:M,data:D,initialState:{pagination:{pageSize:15}},enableZebraStripes:!0,enableColumnResizing:!0,muiTableBodyRowProps:({row:e})=>({onClick:()=>handleRowClick(e),style:{cursor:"pointer"},sx:{"&:nth-of-type(even)":{backgroundColor:"#f9f9f9"},"&:hover":{backgroundColor:"#e0f7fa"}}}),muiTableProps:{sx:{border:"1px solid #ddd"}},muiTableHeadCellProps:{sx:{backgroundColor:"#f5f5f5",fontWeight:"bold",borderBottom:"2px solid #ccc",textAlign:"center"}},muiTableBodyCellProps:{sx:{borderRight:"1px solid #ddd",padding:"10px"}}})})]})]})},le=()=>{const d=s.jsxs("h6",{className:"header-text",children:[s.jsx("span",{className:"font-bold",children:"Management Information System"}),s.jsx("span",{className:"text-sm ml-2",children:"Educational Environmental Club Directory"})]});return s.jsx(T,{headerText:d,children:s.jsx(q,{})})};export{le as default};
