import{r as u,V as z,j as a,A as L}from"./index-Dpaf1lyH.js";import{M as B}from"./index.esm-DDuGjNDF.js";import"./TextField-DpjWluc_.js";import"./Divider-DbFevrjZ.js";import"./FormControlLabel-CFxkDTNj.js";import"./Autocomplete-DtpvTTJO.js";import"./index-Vty3uQT-.js";const P=n=>{const d=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],g=d.indexOf(n.assigned_group),r=n.applicationassignment||[],o=(()=>{if(r.length>1){const _=r[r.length-2];return d.indexOf(_.assigned_group)}return-1})(),S=o!==-1&&o>g,b=r.find(_=>d.indexOf(_.assigned_group)===o),O=b?b.remarks:"N/A";return{id:n.id,tracking_number:n.tracking_number,first_name:n.first_name,last_name:n.last_name,CNIC:n.cnic,mobile_no:n.mobile_no,application_status:n.application_status,assigned_group:n.assigned_group,registration_for:n.registration_for,remarks:n.remarks||"N/A",last_back_comment:O,is_assigned_back:S?"Yes":"No"}},G=n=>n.map(d=>{const g=P(d);return Object.keys(g).forEach(r=>{(g[r]===void 0||g[r]===null)&&(g[r]="N/A")}),g}),J=()=>{const[n,d]=u.useState([]),[g,r]=u.useState([]),[o,S]=u.useState(null),[b,O]=u.useState(0),[_,y]=u.useState(null),[R,I]=u.useState({}),[T,E]=u.useState(null),[M,C]=u.useState(!1),N=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],j={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},F=async e=>{try{if(C(!0),E(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const p=e==="LSO1"?1:e==="LSO2"?2:0,m=((await L.get("/pmc/applicant-detail-main-do-list/",{params:{assigned_group:"LSO"}})).data||[]).filter(x=>{var h;return((h=x.submittedapplication)==null?void 0:h.id)%3===p}),s=w(m,!!o.length,o[0]);d(s.flattenedData),r(s.columns)}else{const f=(await L.get("/pmc/applicant-detail-main-do-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],m=w(f,!!o.length,o[0]);d(m.flattenedData),r(m.columns)}}catch(p){console.error("Error fetching filtered data:",p),d([]),r([])}finally{C(!1)}},w=(e,p,f)=>{const m=["first_name","CNIC","mobile_no","tracking_number","registration_for","days_pending_for","remarks","is_assigned_back"],s=G(e),x=s[0],h=[...Object.keys(x).filter(c=>m.includes(c)).map(c=>{let i=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(c)?i=120:["first_name"].includes(c)&&(i=180),c==="is_assigned_back"?{accessorKey:c,header:"Assigned Back",size:i,Filter:({column:t})=>a.jsxs("select",{value:t.getFilterValue()||"",onChange:l=>t.setFilterValue(l.target.value||void 0),style:{width:"100%",padding:"4px"},children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"Yes",children:"Yes"}),a.jsx("option",{value:"",children:"No"})]}),filterFn:(t,l,D)=>D===""||t.original[c]===D,Cell:({cell:t,row:l})=>{const D=l.original.id,v=l.original.is_assigned_back,k=`/spuid-review/${D}?group=${f}`;return a.jsx("a",{href:k,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:v==="Yes"?"red":"blue",textDecoration:"underline"},children:t.getValue()||"-"})}}:{accessorKey:c,header:c.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()),size:i,Cell:({cell:t,row:l})=>{const D=l.original.id,v=l.original.is_assigned_back,k=`/spuid-review/${D}?group=${f}`;return a.jsx("a",{href:k,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:v==="Yes"?"red":"blue",textDecoration:"underline"},children:t.getValue()||"-"})}}})];return{flattenedData:s,columns:h}},A=z();return u.useEffect(()=>{(async()=>{var f,m;C(!0);try{const s=await L.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch(s){const x={status:(f=s.response)==null?void 0:f.status,data:(m=s.response)==null?void 0:m.data,message:s.message};A("/error",{state:{error:x}})}try{let s=[];try{s=(await L.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],S(s.map(t=>t.name))}catch(i){console.error("Error fetching user groups:",i),S([])}console.log("groupsResponse",s);const h=(await L.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(h)&&h.length>0){const i=w(h,s.length>0,s.map(l=>l.name)[0]);d(i.flattenedData),r(i.columns),console.log("Flattened Data:",i.flattenedData);const t=i.flattenedData[i.flattenedData.length-1];if(console.log("Last Row:",t),t&&t.id){y(t.id),console.log("Last Row ID:",t.id);const l=N.indexOf(t.assigned_group);l!==-1&&O(l)}}const c=await L.get("/pmc/fetch-statistics-do-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});I(c.data)}catch(s){console.error("Error fetching data:",s)}finally{C(!1)}})(),y(25);const p=N.indexOf("LSO");p!==-1&&O(p)},[]),u.useEffect(()=>{console.log("userGroups:",o),o&&!o.includes("DO")&&A("/home")},[o,A]),console.log("selectedRowId:",_),console.log(_),a.jsxs("div",{children:[a.jsx("div",{className:"tiles-container",children:Object.entries(R).map(([e,p])=>a.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:T===e?"#007BFF":"#f8f9fa",color:T===e?"#fff":"#000"},onClick:()=>F(e),children:[a.jsx("h3",{children:j[e]||e})," ",a.jsx("p",{children:p})]},e))}),a.jsx("div",{className:"mb-4",children:a.jsxs("h3",{children:[o&&o.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),M?a.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[a.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),a.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):a.jsx(B,{columns:[...g],data:n.map(e=>({...e,assigned_group_title:j[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:200,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0})]})};export{J as default};
