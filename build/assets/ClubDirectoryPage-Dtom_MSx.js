import{r as s,j as c,A as y}from"./index-DGG34ZIT.js";import{H as V}from"./HeaderTemplate-C51C4fSt.js";import{M,V as N,T as k,O as z,a as x,b as m,S as h,e as F,F as p,c as w,f as T,d as _,P as v,C as P}from"./OSM-Bx5l-N5p.js";import{G as R}from"./GeoJSON-BAwyf57_.js";import{M as A}from"./index.esm-DcMdqOG3.js";import"./Divider-B6LRTFuY.js";import"./DefaultPropsProvider-BgfdRHsn.js";import"./TextField-jeLRl-xV.js";import"./Autocomplete-bJRIVfdn.js";import"./FormControlLabel-BGns_dMp.js";import"./index-DjU-x0Hm.js";const G=()=>{const u=s.useRef(null),[r,S]=s.useState(null),[o,b]=s.useState(null),[d,E]=s.useState(null),[n,C]=s.useState([]),[i,f]=s.useState(null),[I,j]=s.useState(null);s.useEffect(()=>{const e=new M({target:u.current,layers:[new k({source:new z})],view:new N({zoom:7,center:[8127130,3658593]})}),t=new x({source:new m}),a=new x({source:new m});return e.addLayer(t),e.addLayer(a),b(t),E(a),S(e),()=>e.setTarget(null)},[]),s.useEffect(()=>{o&&r&&(async()=>{try{const t=await y.get("/pmc/idm_districts-club-counts/");j(t.data);const a=new m({features:new R().readFeatures(t.data,{featureProjection:"EPSG:3857"})});o.setSource(a),r.getView().fit(a.getExtent(),{padding:[50,50,50,50],duration:500})}catch(t){console.error("Error fetching districts:",t)}})()},[o,r]),s.useEffect(()=>{o&&o.setStyle(e=>{const t=e.get("id")===i;return new h({stroke:new w({color:t?"red":"blue",width:t?3:2}),fill:new p({color:t?"rgba(255, 0, 0, 0.1)":"rgba(0, 0, 255, 0.1)"}),text:new F({text:`${e.get("name")} (${e.get("club_count")})`,font:"12px sans-serif",fill:new p({color:"#000"}),stroke:new w({color:"#fff",width:3})})})})},[o,i]),s.useEffect(()=>{(async()=>{const t=await y.get("/pmc/idm_clubs_geojson_all/");C(t.data.features)})()},[]),s.useEffect(()=>{if(!d)return;const e=d.getSource();e.clear(),n.forEach(t=>{const a=T(t.geometry.coordinates),l=new _({geometry:new v(a)});l.setStyle(new h({image:new P({radius:5,fill:new p({color:"#22C55E"}),stroke:new w({color:"#fff",width:1})})})),e.addFeature(l)})},[d,n]),s.useEffect(()=>{if(!r||!o)return;const e=t=>{const a=r.getFeaturesAtPixel(t.pixel);if(a.length>0){const l=a[0],g=l.get("id");i===g?(f(null),r.getView().setCenter([8127130,3658593]),r.getView().setZoom(7)):(f(g),r.getView().fit(l.getGeometry().getExtent(),{padding:[50,50,50,50],maxZoom:10}))}else f(null),r.getView().setCenter([8127130,3658593]),r.getView().setZoom(7)};return r.on("click",e),()=>r.un("click",e)},[r,o,i]);const D=s.useMemo(()=>i?n.filter(e=>e.properties.district_id===i):n,[i,n]),L=s.useMemo(()=>[{accessorKey:"properties.district",header:"District",size:150},{accessorKey:"properties.name",header:"School Name",size:225},{accessorKey:"properties.address",header:"Address",size:225},{accessorKey:"properties.head_name",header:"Head Name",size:200}],[]);return c.jsxs("div",{className:"flex flex-row p-4 gap-4",children:[c.jsx("div",{ref:u,className:"w-1/2",style:{height:"850px"}}),c.jsx("div",{style:{flex:1},children:c.jsx(A,{columns:L,data:D,initialState:{pagination:{pageSize:15}},enableZebraStripes:!0,enableColumnResizing:!0})})]})},X=()=>{const u=c.jsxs("h6",{className:"header-text",children:[c.jsx("span",{className:"font-bold",children:"Management Information System"}),c.jsx("span",{className:"text-sm ml-2",children:"Educational Environmental Club Directory"})]});return c.jsx(V,{headerText:u,children:c.jsx(G,{})})};export{X as default};
