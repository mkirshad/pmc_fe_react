import{r as F,j as c,Z as me,A as pt,l as Ne,i as xt,a2 as st,W as yt,a0 as _t}from"./index-CP8CvPel.js";import{B as Oe}from"./Button-DUtQ8NIU.js";import{t as St,N as bt}from"./toast-DcE2yin6.js";import{u as ot,b as re,a as O,C as G,F as Ct}from"./index.esm-CDzj6gke.js";import{B as wt}from"./BottomStickyBar-FfxYOqr0.js";import{C as Ft}from"./Card-CPLvVMWQ.js";import{I as Y}from"./Input-CfqkujbT.js";import{S as We}from"./Select-2YT8eNtN.js";import{C as he}from"./index-BlUU7QN_.js";/* empty css           */import{g as jt,p as Et,h as Dt,s as Tt,i as Rt,R as Nt,a as lt,b as ct,j as $e,k as He,l as Ze,E as Ye,m as Q,n as Ae,d as Ge,P as Ue,o as Te,q as ce,r as ee,t as ze,u as z,v as Pe,w as Pt,x as Bt,y as It,z as Ke,A as At,B as Mt,D as kt,G as Vt,H as Lt,f as Me,S as Ot,C as Gt,c as Ut,F as Kt,M as qt,V as Wt,T as $t,O as Ht,I as Zt}from"./OSM-xj16LtVI.js";import{A as Yt,C as zt}from"./Autocomplete-DA_2KQca.js";import{T as Xt}from"./TextField-BDGJ4CPA.js";import{t as Jt,z as R}from"./index-DmGU-6NK.js";import{C as Qt}from"./ConfirmDialog-CpMnlirq.js";import{f as en}from"./index-CjsgbpFz.js";import{B as tn}from"./index-H4dL_Z8T.js";import{u as nn}from"./useInspectionStore-NTheaEfg.js";import"./classNames-C5bikH69.js";import"./StatusIcon-DdrsYP-P.js";import"./isNil-B_p1jSR0.js";import"./CloseButton-B4RMdFQJ.js";import"./index-BRuOwh_7.js";import"./setPrototypeOf-C3V6guyq.js";import"./emotion-element-f0de968e.browser.esm-BHWu9ckK.js";import"./assertThisInitialized-Bqh4UtBb.js";import"./floating-ui.dom-CrKScG7J.js";import"./_getPrototype-Bu7QJTmk.js";import"./DefaultPropsProvider-DiKrf8TX.js";import"./Modal-Dymb2e6x.js";import"./index-CMmn6TCn.js";import"./index-BOYaanX9.js";import"./index-Cwg7YpAG.js";const Xe=0,ye=1,Je=[0,0,0,0],ve=[],ke={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Ve extends kt{constructor(e,n,r){super(e),this.features=n,this.mapBrowserEvent=r}}class rn extends jt{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Et,this.defaultDeleteCondition_=function(r){return Dt(r)&&Tt(r)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Rt,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Nt,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new lt({source:new ct({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:sn(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let n;if(e.features?n=e.features:e.source&&(this.source_=e.source,n=new $e(this.source_.getFeatures()),this.source_.addEventListener(He.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(He.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!n)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=n,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ze.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ze.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const n=e.getGeometry();if(n){const i=this.SEGMENT_WRITERS_[n.getType()];i&&i(e,n)}const r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(r.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(Ye.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,n){if(!this.featuresBeingModified_){this.featuresBeingModified_=new $e;const r=this.featuresBeingModified_.getArray();for(let i=0,a=n.length;i<a;++i){const s=n[i].feature;s&&!r.includes(s)&&this.featuresBeingModified_.push(s)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Ve(ke.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Ye.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const n=this.rBush_,r=[];n.forEach(function(i){e===i.feature&&r.push(i)});for(let i=r.length-1;i>=0;--i){const a=r[i];for(let s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===a&&this.dragSegments_.splice(s,1);n.remove(a)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const n=e.target;this.removeFeature_(n),this.addFeature_(n)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,n){const r=n.getCoordinates(),i={feature:e,geometry:n,segment:[r,r]};this.rBush_.insert(n.getExtent(),i)}writeMultiPointGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i],l={feature:e,geometry:n,depth:[i],index:i,segment:[s,s]};this.rBush_.insert(n.getExtent(),l)}}writeLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length-1;i<a;++i){const s=r.slice(i,i+2),l={feature:e,geometry:n,index:i,segment:s};this.rBush_.insert(Q(s),l)}}writeMultiLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let l=0,u=s.length-1;l<u;++l){const m=s.slice(l,l+2),d={feature:e,geometry:n,depth:[i],index:l,segment:m};this.rBush_.insert(Q(m),d)}}}writePolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let l=0,u=s.length-1;l<u;++l){const m=s.slice(l,l+2),d={feature:e,geometry:n,depth:[i],index:l,segment:m};this.rBush_.insert(Q(m),d)}}}writeMultiPolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let l=0,u=s.length;l<u;++l){const m=s[l];for(let d=0,p=m.length-1;d<p;++d){const g=m.slice(d,d+2),f={feature:e,geometry:n,depth:[l,i],index:d,segment:g};this.rBush_.insert(Q(g),f)}}}}writeCircleGeometry_(e,n){const r=n.getCenter(),i={feature:e,geometry:n,index:Xe,segment:[r,r]},a={feature:e,geometry:n,index:ye,segment:[r,r]},s=[i,a];i.featureSegments=s,a.featureSegments=s,this.rBush_.insert(Ae(r),i);let l=n;this.rBush_.insert(l.getExtent(),a)}writeGeometryCollectionGeometry_(e,n){const r=n.getGeometriesArray();for(let i=0;i<r.length;++i){const a=r[i],s=this.SEGMENT_WRITERS_[a.getType()];s(e,a)}}createOrUpdateVertexFeature_(e,n,r,i){let a=this.vertexFeature_;return a?a.getGeometry().setCoordinates(e):(a=new Ge(new Ue(e)),this.vertexFeature_=a,this.overlay_.getSource().addFeature(a)),a.set("features",n),a.set("geometries",r),a.set("existing",i),a}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let n;return!e.map.getView().getInteracting()&&e.type==Te.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Te.SINGLECLICK||!this.ignoreNextSingleClick_?n=this.removePoint():n=!0),e.type==Te.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!n}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(!n)return;this.getMap().getView().getProjection();const r=[],i=n.getGeometry().getCoordinates(),a=Q([i]),s=this.rBush_.getInExtent(a),l={};s.sort(an);for(let u=0,m=s.length;u<m;++u){const d=s[u],p=d.segment;let g=ce(d.geometry);const f=d.depth;if(f&&(g+="-"+f.join("-")),l[g]||(l[g]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===ye){const h=et(e,d);ee(h,i)&&!l[g][0]&&(this.dragSegments_.push([d,0]),l[g][0]=d);continue}if(ee(p[0],i)&&!l[g][0]){this.dragSegments_.push([d,0]),l[g][0]=d;continue}if(ee(p[1],i)&&!l[g][1]){if(l[g][0]&&l[g][0].index===0){let h=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":h=h[f[1]];case"Polygon":if(d.index!==h[f[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),l[g][1]=d;continue}ce(p)in this.vertexSegments_&&!l[g][0]&&!l[g][1]&&r.push(d)}return r}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([a])=>a));const n=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],i=[];for(let a=0,s=this.dragSegments_.length;a<s;++a){const l=this.dragSegments_[a],u=l[0],m=u.feature;r.includes(m)||r.push(m);const d=u.geometry;i.includes(d)||i.push(d);const p=u.depth;let g;const f=u.segment,h=l[1];for(;n.length<d.getStride();)n.push(f[h][n.length]);switch(d.getType()){case"Point":g=n,f[0]=n,f[1]=n;break;case"MultiPoint":g=d.getCoordinates(),g[u.index]=n,f[0]=n,f[1]=n;break;case"LineString":g=d.getCoordinates(),g[u.index+h]=n,f[h]=n;break;case"MultiLineString":g=d.getCoordinates(),g[p[0]][u.index+h]=n,f[h]=n;break;case"Polygon":g=d.getCoordinates(),g[p[0]][u.index+h]=n,f[h]=n;break;case"MultiPolygon":g=d.getCoordinates(),g[p[1]][p[0]][u.index+h]=n,f[h]=n;break;case"Circle":const b=d;if(f[0]=n,f[1]=n,u.index===Xe)this.changingFeature_=!0,b.setCenter(n),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let D=ze(z(b.getCenter()),z(n));b.setRadius(D),this.changingFeature_=!1}break}g&&this.setGeometryCoordinates_(d,g)}this.createOrUpdateVertexFeature_(n,r,i,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const n=e.coordinate,r=this.findInsertVerticesAndUpdateDragSegments_(n);if(r!=null&&r.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,r),this.vertexFeature_)){const i=this.vertexFeature_.getGeometry().getCoordinates();for(let a=r.length-1;a>=0;--a)this.insertVertex_(r[a],i);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let n=this.dragSegments_.length-1;n>=0;--n){const r=this.dragSegments_[n][0],i=r.geometry;if(i.getType()==="Circle"){const a=i,s=a.getCenter(),l=r.featureSegments[0],u=r.featureSegments[1];l.segment[0]=s,l.segment[1]=s,u.segment[0]=s,u.segment[1]=s,this.rBush_.update(Ae(s),l);let m=a;this.rBush_.update(m.getExtent(),u)}else this.rBush_.update(Q(r.segment),r)}return this.featuresBeingModified_&&(this.dispatchEvent(new Ve(ke.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const n=this.getMap(),r=n.getPixelFromCoordinate(e);n.getView().getProjection();const i=function(l,u){return Qe(e,l)-Qe(e,u)};let a,s;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?u=>u===this.hitDetection_:void 0;n.forEachFeatureAtPixel(r,(u,m,d)=>{d&&d.getType()==="Point"&&(d=new Ue(Pe(d.getCoordinates())));const p=d||u.getGeometry();if(p&&p.getType()==="Point"&&u instanceof Ge&&this.features_.getArray().includes(u)){s=p;const g=u.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:u,geometry:s,segment:[g,g]}]}return!0},{layerFilter:l})}if(!a){const l=Pt(Ae(e,Je)),u=n.getView().getResolution()*this.pixelTolerance_,m=Bt(It(l,u,Je));a=this.rBush_.getInExtent(m)}if(a&&a.length>0){const l=a.sort(i)[0],u=l.segment;let m=et(e,l);const d=n.getPixelFromCoordinate(m);let p=ze(r,d);if(s||p<=this.pixelTolerance_){const g={};if(g[ce(u)]=!0,this.snapToPointer_||(this.delta_[0]=m[0]-e[0],this.delta_[1]=m[1]-e[1]),l.geometry.getType()==="Circle"&&l.index===ye)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(m,[l.feature],[l.geometry],this.snappedToVertex_);else{const f=n.getPixelFromCoordinate(u[0]),h=n.getPixelFromCoordinate(u[1]),b=Ke(d,f),D=Ke(d,h);if(p=Math.sqrt(Math.min(b,D)),this.snappedToVertex_=p<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(m=b>D?u[1]:u[0]),this.createOrUpdateVertexFeature_(m,[l.feature],[l.geometry],this.snappedToVertex_);const v={};v[ce(l.geometry)]=!0;for(let N=1,P=a.length;N<P;++N){const U=a[N].segment;if(ee(u[0],U[0])&&ee(u[1],U[1])||ee(u[0],U[1])&&ee(u[1],U[0])){const K=ce(a[N].geometry);K in v||(v[K]=!0,g[ce(U)]=!0)}else break}}this.vertexSegments_=g;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,n){const r=e.segment,i=e.feature,a=e.geometry,s=e.depth,l=e.index;let u;for(;n.length<a.getStride();)n.push(0);switch(a.getType()){case"MultiLineString":u=a.getCoordinates(),u[s[0]].splice(l+1,0,n);break;case"Polygon":u=a.getCoordinates(),u[s[0]].splice(l+1,0,n);break;case"MultiPolygon":u=a.getCoordinates(),u[s[1]][s[0]].splice(l+1,0,n);break;case"LineString":u=a.getCoordinates(),u.splice(l+1,0,n);break;default:return!1}this.setGeometryCoordinates_(a,u);const m=this.rBush_;m.remove(e),this.updateSegmentIndices_(a,l,s,1);const d={segment:[r[0],n],feature:i,geometry:a,depth:s,index:l};m.insert(Q(d.segment),d),this.dragSegments_.push([d,1]);const p={segment:[n,r[1]],feature:i,geometry:a,depth:s,index:l+1};return m.insert(Q(p.segment),p),this.dragSegments_.push([p,0]),!0}updatePointer_(e){var n;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates()}getPoint(){var n;const e=(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates();return e?Pe(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(Q([e])).some(({segment:r})=>ee(r[0],e)||ee(r[1],e))}removePoint(e){if(e&&(e=z(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=Te.POINTERDRAG){const n=this.lastPointerEvent_;this.willModifyFeatures_(n,this.dragSegments_.map(([i])=>i));const r=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Ve(ke.MODIFYEND,this.featuresBeingModified_,n)),this.featuresBeingModified_=null,r}return!1}removeVertex_(){const e=this.dragSegments_,n={};let r=!1,i,a,s,l,u,m,d,p,g,f,h;for(u=e.length-1;u>=0;--u)s=e[u],f=s[0],h=ce(f.feature),f.depth&&(h+="-"+f.depth.join("-")),h in n||(n[h]={}),s[1]===0?(n[h].right=f,n[h].index=f.index):s[1]==1&&(n[h].left=f,n[h].index=f.index+1);for(h in n){switch(g=n[h].right,d=n[h].left,m=n[h].index,p=m-1,d!==void 0?f=d:f=g,p<0&&(p=0),l=f.geometry,a=l.getCoordinates(),i=a,r=!1,l.getType()){case"MultiLineString":a[f.depth[0]].length>2&&(a[f.depth[0]].splice(m,1),r=!0);break;case"LineString":a.length>2&&(a.splice(m,1),r=!0);break;case"MultiPolygon":i=i[f.depth[1]];case"Polygon":i=i[f.depth[0]],i.length>4&&(m==i.length-1&&(m=0),i.splice(m,1),r=!0,m===0&&(i.pop(),i.push(i[0]),p=i.length-1));break}if(r){this.setGeometryCoordinates_(l,a);const b=[];if(d!==void 0&&(this.rBush_.remove(d),b.push(d.segment[0])),g!==void 0&&(this.rBush_.remove(g),b.push(g.segment[1])),d!==void 0&&g!==void 0){const D={depth:f.depth,feature:f.feature,geometry:f.geometry,index:p,segment:b};this.rBush_.insert(Q(D.segment),D)}this.updateSegmentIndices_(l,m,f.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return r}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(Q([e])).some(({segment:r})=>!(ee(r[0],e)||ee(r[1],e)))}insertPoint(e){var i;const n=e?z(e,this.getMap().getView().getProjection()):(i=this.vertexFeature_)==null?void 0:i.getGeometry().getCoordinates();return n?this.findInsertVerticesAndUpdateDragSegments_(n).reduce((a,s)=>a||this.insertVertex_(s,n),!1):!1}setGeometryCoordinates_(e,n){this.changingFeature_=!0,e.setCoordinates(n),this.changingFeature_=!1}updateSegmentIndices_(e,n,r,i){this.rBush_.forEachInExtent(e.getExtent(),function(a){a.geometry===e&&(r===void 0||a.depth===void 0||At(a.depth,r))&&a.index>n&&(a.index+=i)})}}function an(t,e){return t.index-e.index}function Qe(t,e,n){const r=e.geometry;if(r.getType()==="Circle"){let a=r;if(e.index===ye){const s=Ke(a.getCenter(),z(t)),l=Math.sqrt(s)-a.getRadius();return l*l}}const i=z(t);return ve[0]=z(e.segment[0]),ve[1]=z(e.segment[1]),Lt(i,ve)}function et(t,e,n){const r=e.geometry;if(r.getType()==="Circle"&&e.index===ye)return Pe(r.getClosestPoint(z(t)));const i=z(t);return ve[0]=z(e.segment[0]),ve[1]=z(e.segment[1]),Pe(Vt(i,ve))}function sn(){const t=Mt();return function(e,n){return t.Point}}const on=({onLocationSelect:t,savedLocation:e,isEditing:n})=>{const r=F.useRef(null),[i,a]=F.useState(null),[s,l]=F.useState(null),[u,m]=F.useState({lat:null,lng:null});F.useEffect(()=>{const p=new ct,g=e&&n?Me([e.lng,e.lat]):Me([74.3436,31.5497]),f=new Ge({geometry:new Ue(g)});f.setStyle(new Ot({image:new Gt({radius:7,fill:new Kt({color:"red"}),stroke:new Ut({color:"white",width:2})})})),p.addFeature(f),l(f);const h=new lt({source:p}),b=new qt({target:r.current,layers:[new $t({source:new Ht}),h],view:new Wt({center:g,zoom:12})});if(a(b),!n){d(b,f);const D=new rn({source:p});b.addInteraction(D),D.on("modifyend",v=>{const N=v.features.item(0).getGeometry().getCoordinates(),P=Zt(N);m({lat:P[1],lng:P[0]}),t({lat:P[1],lng:P[0]})})}return()=>b.setTarget(null)},[n,e]);const d=(p,g)=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(f=>{const h=Me([f.coords.longitude,f.coords.latitude]);g.getGeometry().setCoordinates(h),p.getView().setCenter(h),p.getView().setZoom(15),m({lat:f.coords.latitude,lng:f.coords.longitude}),t({lat:f.coords.latitude,lng:f.coords.longitude})},f=>console.error("Geolocation error:",f),{enableHighAccuracy:!0})};return c.jsxs("div",{children:[c.jsx("div",{ref:r,style:{height:"600px",width:"100%"}}),!n&&s&&i&&c.jsx("button",{type:"button",onClick:()=>d(i,s),style:{marginTop:"10px",padding:"10px",backgroundColor:"#007BFF",color:"#fff",border:"none",cursor:"pointer",borderRadius:"5px"},children:"📍 Go to Current Location"})]})};function ut(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}var _e;(function(t){t.event="event",t.props="prop"})(_e||(_e={}));function oe(){}function ln(t){var e,n=void 0;return function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e&&r.length===e.length&&r.every(function(a,s){return a===e[s]})||(e=r,n=t.apply(void 0,r)),n}}function Se(t){return!!(t||"").match(/\d/)}function pe(t){return t==null}function cn(t){return typeof t=="number"&&isNaN(t)}function dt(t){return pe(t)||cn(t)||typeof t=="number"&&!isFinite(t)}function ft(t){return t.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function un(t){switch(t){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;case"thousand":default:return/(\d)(?=(\d{3})+(?!\d))/g}}function dn(t,e,n){var r=un(n),i=t.search(/[1-9]/);return i=i===-1?t.length:i,t.substring(0,i)+t.substring(i,t.length).replace(r,"$1"+e)}function fn(t){var e=F.useRef(t);e.current=t;var n=F.useRef(function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e.current.apply(e,r)});return n.current}function qe(t,e){e===void 0&&(e=!0);var n=t[0]==="-",r=n&&e;t=t.replace("-","");var i=t.split("."),a=i[0],s=i[1]||"";return{beforeDecimal:a,afterDecimal:s,hasNegation:n,addNegation:r}}function gn(t){if(!t)return t;var e=t[0]==="-";e&&(t=t.substring(1,t.length));var n=t.split("."),r=n[0].replace(/^0+/,"")||"0",i=n[1]||"";return(e?"-":"")+r+(i?"."+i:"")}function gt(t,e,n){for(var r="",i=n?"0":"",a=0;a<=e-1;a++)r+=t[a]||i;return r}function tt(t,e){return Array(e+1).join(t)}function ht(t){var e=t+"",n=e[0]==="-"?"-":"";n&&(e=e.substring(1));var r=e.split(/[eE]/g),i=r[0],a=r[1];if(a=Number(a),!a)return n+i;i=i.replace(".","");var s=1+a,l=i.length;return s<0?i="0."+tt("0",Math.abs(s))+i:s>=l?i=i+tt("0",s-l):i=(i.substring(0,s)||"0")+"."+i.substring(s),n+i}function nt(t,e,n){if(["","-"].indexOf(t)!==-1)return t;var r=(t.indexOf(".")!==-1||n)&&e,i=qe(t),a=i.beforeDecimal,s=i.afterDecimal,l=i.hasNegation,u=parseFloat("0."+(s||"0")),m=s.length<=e?"0."+s:u.toFixed(e),d=m.split("."),p=a;a&&Number(d[0])&&(p=a.split("").reverse().reduce(function(b,D,v){return b.length>v?(Number(b[0])+Number(D)).toString()+b.substring(1,b.length):D+b},d[0]));var g=gt(d[1]||"",e,n),f=l?"-":"",h=r?".":"";return""+f+p+h+g}function ue(t,e){if(t.value=t.value,t!==null){if(t.createTextRange){var n=t.createTextRange();return n.move("character",e),n.select(),!0}return t.selectionStart||t.selectionStart===0?(t.focus(),t.setSelectionRange(e,e),!0):(t.focus(),!1)}}var mt=ln(function(t,e){for(var n=0,r=0,i=t.length,a=e.length;t[n]===e[n]&&n<i;)n++;for(;t[i-1-r]===e[a-1-r]&&a-r>n&&i-r>n;)r++;return{from:{start:n,end:i-r},to:{start:n,end:a-r}}}),hn=function(t,e){var n=Math.min(t.selectionStart,e);return{from:{start:n,end:t.selectionEnd},to:{start:n,end:e}}};function mn(t,e,n){return Math.min(Math.max(t,e),n)}function Le(t){return Math.max(t.selectionStart,t.selectionEnd)}function vn(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function pn(t){return{from:{start:0,end:0},to:{start:0,end:t.length},lastValue:""}}function xn(t){var e=t.currentValue,n=t.formattedValue,r=t.currentValueIndex,i=t.formattedValueIndex;return e[r]===n[i]}function yn(t,e,n,r,i,a,s){s===void 0&&(s=xn);var l=i.findIndex(function(U){return U}),u=t.slice(0,l);!e&&!n.startsWith(u)&&(e=u,n=u+n,r=r+u.length);for(var m=n.length,d=t.length,p={},g=new Array(m),f=0;f<m;f++){g[f]=-1;for(var h=0,b=d;h<b;h++){var D=s({currentValue:n,lastValue:e,formattedValue:t,currentValueIndex:f,formattedValueIndex:h});if(D&&p[h]!==!0){g[f]=h,p[h]=!0;break}}}for(var v=r;v<m&&(g[v]===-1||!a(n[v]));)v++;var N=v===m||g[v]===-1?d:g[v];for(v=r-1;v>0&&g[v]===-1;)v--;var P=v===-1||g[v]===-1?0:g[v]+1;return P>N?N:r-P<N-r?P:N}function rt(t,e,n,r){var i=t.length;if(e=mn(e,0,i),r==="left"){for(;e>=0&&!n[e];)e--;e===-1&&(e=n.indexOf(!0))}else{for(;e<=i&&!n[e];)e++;e>i&&(e=n.lastIndexOf(!0))}return e===-1&&(e=i),e}function _n(t){for(var e=Array.from({length:t.length+1}).map(function(){return!0}),n=0,r=e.length;n<r;n++)e[n]=!!(Se(t[n])||Se(t[n-1]));return e}function vt(t,e,n,r,i,a){a===void 0&&(a=oe);var s=fn(function(h,b){var D,v;return dt(h)?(v="",D=""):typeof h=="number"||b?(v=typeof h=="number"?ht(h):h,D=r(v)):(v=i(h,void 0),D=r(v)),{formattedValue:D,numAsString:v}}),l=F.useState(function(){return s(pe(t)?e:t,n)}),u=l[0],m=l[1],d=function(h,b){h.formattedValue!==u.formattedValue&&m({formattedValue:h.formattedValue,numAsString:h.value}),a(h,b)},p=t,g=n;pe(t)&&(p=u.numAsString,g=!0);var f=s(p,g);return F.useMemo(function(){m(f)},[f.formattedValue]),[u,d]}function Sn(t){return t.replace(/[^0-9]/g,"")}function bn(t){return t}function Cn(t){var e=t.type;e===void 0&&(e="text");var n=t.displayType;n===void 0&&(n="input");var r=t.customInput,i=t.renderText,a=t.getInputRef,s=t.format;s===void 0&&(s=bn);var l=t.removeFormatting;l===void 0&&(l=Sn);var u=t.defaultValue,m=t.valueIsNumericString,d=t.onValueChange,p=t.isAllowed,g=t.onChange;g===void 0&&(g=oe);var f=t.onKeyDown;f===void 0&&(f=oe);var h=t.onMouseUp;h===void 0&&(h=oe);var b=t.onFocus;b===void 0&&(b=oe);var D=t.onBlur;D===void 0&&(D=oe);var v=t.value,N=t.getCaretBoundary;N===void 0&&(N=_n);var P=t.isValidInputCharacter;P===void 0&&(P=Se);var U=t.isCharacterSame,K=ut(t,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),te=vt(v,u,!!m,s,l,d),X=te[0],T=X.formattedValue,q=X.numAsString,W=te[1],Z=F.useRef(),ne=F.useRef({formattedValue:T,numAsString:q}),J=function(y,_){ne.current={formattedValue:y.formattedValue,numAsString:y.value},W(y,_)},L=F.useState(!1),ae=L[0],E=L[1],w=F.useRef(null),B=F.useRef({setCaretTimeout:null,focusTimeout:null});F.useEffect(function(){return E(!0),function(){clearTimeout(B.current.setCaretTimeout),clearTimeout(B.current.focusTimeout)}},[]);var M=s,V=function(y,_){var j=parseFloat(_);return{formattedValue:y,value:_,floatValue:isNaN(j)?void 0:j}},I=function(y,_,j){y.selectionStart===0&&y.selectionEnd===y.value.length||(ue(y,_),B.current.setCaretTimeout=setTimeout(function(){y.value===j&&y.selectionStart!==_&&ue(y,_)},0))},k=function(y,_,j){return rt(y,_,N(y),j)},ie=function(y,_,j){var o=N(_),x=yn(_,T,y,j,o,P,U);return x=rt(_,x,o),x},de=function(y){var _=y.formattedValue;_===void 0&&(_="");var j=y.input,o=y.source,x=y.event,S=y.numAsString,C;if(j){var A=y.inputValue||j.value,$=Le(j);j.value=_,C=ie(A,_,$),C!==void 0&&I(j,C,_)}_!==T&&J(V(_,S),{event:x,source:o})};F.useEffect(function(){var y=ne.current,_=y.formattedValue,j=y.numAsString;(T!==_||q!==j)&&J(V(T,q),{event:void 0,source:_e.props})},[T,q]);var se=w.current?Le(w.current):void 0,le=typeof window<"u"?F.useLayoutEffect:F.useEffect;le(function(){var y=w.current;if(T!==ne.current.formattedValue&&y){var _=ie(ne.current.formattedValue,T,se);y.value=T,I(y,_,T)}},[T]);var fe=function(y,_,j){var o=_.target,x=Z.current?hn(Z.current,o.selectionEnd):mt(T,y),S=Object.assign(Object.assign({},x),{lastValue:T}),C=l(y,S),A=M(C);if(C=l(A,void 0),p&&!p(V(A,C))){var $=_.target,H=Le($),Ie=ie(y,T,H);return $.value=T,I($,Ie,T),!1}return de({formattedValue:A,numAsString:C,inputValue:y,event:_,source:j,input:_.target}),!0},ge=function(y,_){_===void 0&&(_=0);var j=y.selectionStart,o=y.selectionEnd;Z.current={selectionStart:j,selectionEnd:o+_}},be=function(y){var _=y.target,j=_.value,o=fe(j,y,_e.event);o&&g(y),Z.current=void 0},Ce=function(y){var _=y.target,j=y.key,o=_.selectionStart,x=_.selectionEnd,S=_.value;S===void 0&&(S="");var C;j==="ArrowLeft"||j==="Backspace"?C=Math.max(o-1,0):j==="ArrowRight"?C=Math.min(o+1,S.length):j==="Delete"&&(C=o);var A=0;j==="Delete"&&o===x&&(A=1);var $=j==="ArrowLeft"||j==="ArrowRight";if(C===void 0||o!==x&&!$){f(y),ge(_,A);return}var H=C;if($){var Ie=j==="ArrowLeft"?"left":"right";H=k(S,C,Ie),H!==C&&y.preventDefault()}else j==="Delete"&&!P(S[C])?H=k(S,C,"right"):j==="Backspace"&&!P(S[C])&&(H=k(S,C,"left"));H!==C&&I(_,H,S),f(y),ge(_,A)},we=function(y){var _=y.target,j=function(){var o=_.selectionStart,x=_.selectionEnd,S=_.value;if(S===void 0&&(S=""),o===x){var C=k(S,o);C!==o&&I(_,C,S)}};j(),requestAnimationFrame(function(){j()}),h(y),ge(_)},Fe=function(y){y.persist&&y.persist();var _=y.target,j=y.currentTarget;w.current=_,B.current.focusTimeout=setTimeout(function(){var o=_.selectionStart,x=_.selectionEnd,S=_.value;S===void 0&&(S="");var C=k(S,o);C!==o&&!(o===0&&x===S.length)&&I(_,C,S),b(Object.assign(Object.assign({},y),{currentTarget:j}))},0)},je=function(y){w.current=null,clearTimeout(B.current.focusTimeout),clearTimeout(B.current.setCaretTimeout),D(y)},Ee=ae&&vn()?"numeric":void 0,xe=Object.assign({inputMode:Ee},K,{type:e,value:T,onChange:be,onKeyDown:Ce,onMouseUp:we,onFocus:Fe,onBlur:je});if(n==="text")return i?me.createElement(me.Fragment,null,i(T,K)||null):me.createElement("span",Object.assign({},K,{ref:a}),T);if(r){var De=r;return me.createElement(De,Object.assign({},xe,{ref:a}))}return me.createElement("input",Object.assign({},xe,{ref:a}))}function it(t,e){var n=e.decimalScale,r=e.fixedDecimalScale,i=e.prefix;i===void 0&&(i="");var a=e.suffix;a===void 0&&(a="");var s=e.allowNegative,l=e.thousandsGroupStyle;if(l===void 0&&(l="thousand"),t===""||t==="-")return t;var u=Be(e),m=u.thousandSeparator,d=u.decimalSeparator,p=n!==0&&t.indexOf(".")!==-1||n&&r,g=qe(t,s),f=g.beforeDecimal,h=g.afterDecimal,b=g.addNegation;return n!==void 0&&(h=gt(h,n,!!r)),m&&(f=dn(f,m,l)),i&&(f=i+f),a&&(h=h+a),b&&(f="-"+f),t=f+(p&&d||"")+h,t}function Be(t){var e=t.decimalSeparator;e===void 0&&(e=".");var n=t.thousandSeparator,r=t.allowedDecimalSeparators;return n===!0&&(n=","),r||(r=[e,"."]),{decimalSeparator:e,thousandSeparator:n,allowedDecimalSeparators:r}}function wn(t,e){t===void 0&&(t="");var n=new RegExp("(-)"),r=new RegExp("(-)(.)*(-)"),i=n.test(t),a=r.test(t);return t=t.replace(/-/g,""),i&&!a&&e&&(t="-"+t),t}function Fn(t,e){return new RegExp("(^-)|[0-9]|"+ft(t),"g")}function jn(t,e,n){return t===""?!0:!(e!=null&&e.match(/\d/))&&!(n!=null&&n.match(/\d/))&&typeof t=="string"&&!isNaN(Number(t))}function En(t,e,n){var r;e===void 0&&(e=pn(t));var i=n.allowNegative,a=n.prefix;a===void 0&&(a="");var s=n.suffix;s===void 0&&(s="");var l=n.decimalScale,u=e.from,m=e.to,d=m.start,p=m.end,g=Be(n),f=g.allowedDecimalSeparators,h=g.decimalSeparator,b=t[p]===h;if(Se(t)&&(t===a||t===s)&&e.lastValue==="")return t;if(p-d===1&&f.indexOf(t[d])!==-1){var D=l===0?"":h;t=t.substring(0,d)+D+t.substring(d+1,t.length)}var v=function(w,B,M){var V=!1,I=!1;a.startsWith("-")?V=!1:w.startsWith("--")?(V=!1,I=!0):s.startsWith("-")&&w.length===s.length?V=!1:w[0]==="-"&&(V=!0);var k=V?1:0;return I&&(k=2),k&&(w=w.substring(k),B-=k,M-=k),{value:w,start:B,end:M,hasNegation:V}},N=v(t,d,p),P=N.hasNegation;r=N,t=r.value,d=r.start,p=r.end;var U=v(e.lastValue,u.start,u.end),K=U.start,te=U.end,X=U.value,T=t.substring(d,p);t.length&&X.length&&(K>X.length-s.length||te<a.length)&&!(T&&s.startsWith(T))&&(t=X);var q=0;t.startsWith(a)?q+=a.length:d<a.length&&(q=d),t=t.substring(q),p-=q;var W=t.length,Z=t.length-s.length;t.endsWith(s)?W=Z:(p>Z||p>t.length-s.length)&&(W=p),t=t.substring(0,W),t=wn(P?"-"+t:t,i),t=(t.match(Fn(h))||[]).join("");var ne=t.indexOf(h);t=t.replace(new RegExp(ft(h),"g"),function(w,B){return B===ne?".":""});var J=qe(t,i),L=J.beforeDecimal,ae=J.afterDecimal,E=J.addNegation;return m.end-m.start<u.end-u.start&&L===""&&b&&!parseFloat(ae)&&(t=E?"-":""),t}function Dn(t,e){var n=e.prefix;n===void 0&&(n="");var r=e.suffix;r===void 0&&(r="");var i=Array.from({length:t.length+1}).map(function(){return!0}),a=t[0]==="-";i.fill(!1,0,n.length+(a?1:0));var s=t.length;return i.fill(!1,s-r.length+1,s+1),i}function Tn(t){var e=Be(t),n=e.thousandSeparator,r=e.decimalSeparator,i=t.prefix;i===void 0&&(i="");var a=t.allowNegative;if(a===void 0&&(a=!0),n===r)throw new Error(`
        Decimal separator can't be same as thousand separator.
        thousandSeparator: `+n+` (thousandSeparator = {true} is same as thousandSeparator = ",")
        decimalSeparator: `+r+` (default value for decimalSeparator is .)
     `);return i.startsWith("-")&&a&&(console.error(`
      Prefix can't start with '-' when allowNegative is true.
      prefix: `+i+`
      allowNegative: `+a+`
    `),a=!1),Object.assign(Object.assign({},t),{allowNegative:a})}function Rn(t){t=Tn(t),t.decimalSeparator,t.allowedDecimalSeparators,t.thousandsGroupStyle;var e=t.suffix,n=t.allowNegative,r=t.allowLeadingZeros,i=t.onKeyDown;i===void 0&&(i=oe);var a=t.onBlur;a===void 0&&(a=oe);var s=t.thousandSeparator,l=t.decimalScale,u=t.fixedDecimalScale,m=t.prefix;m===void 0&&(m="");var d=t.defaultValue,p=t.value,g=t.valueIsNumericString,f=t.onValueChange,h=ut(t,["decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","suffix","allowNegative","allowLeadingZeros","onKeyDown","onBlur","thousandSeparator","decimalScale","fixedDecimalScale","prefix","defaultValue","value","valueIsNumericString","onValueChange"]),b=Be(t),D=b.decimalSeparator,v=b.allowedDecimalSeparators,N=function(E){return it(E,t)},P=function(E,w){return En(E,w,t)},U=pe(p)?d:p,K=g??jn(U,m,e);pe(p)?pe(d)||(K=K||typeof d=="number"):K=K||typeof p=="number";var te=function(E){return dt(E)?E:(typeof E=="number"&&(E=ht(E)),K&&typeof l=="number"?nt(E,l,!!u):E)},X=vt(te(p),te(d),!!K,N,P,f),T=X[0],q=T.numAsString,W=T.formattedValue,Z=X[1],ne=function(E){var w=E.target,B=E.key,M=w.selectionStart,V=w.selectionEnd,I=w.value;if(I===void 0&&(I=""),(B==="Backspace"||B==="Delete")&&V<m.length){E.preventDefault();return}if(M!==V){i(E);return}B==="Backspace"&&I[0]==="-"&&M===m.length+1&&n&&ue(w,1),l&&u&&(B==="Backspace"&&I[M-1]===D?(ue(w,M-1),E.preventDefault()):B==="Delete"&&I[M]===D&&E.preventDefault()),v!=null&&v.includes(B)&&I[M]===D&&ue(w,M+1);var k=s===!0?",":s;B==="Backspace"&&I[M-1]===k&&ue(w,M-1),B==="Delete"&&I[M]===k&&ue(w,M+1),i(E)},J=function(E){var w=q;if(w.match(/\d/g)||(w=""),r||(w=gn(w)),u&&l&&(w=nt(w,l,u)),w!==q){var B=it(w,t);Z({formattedValue:B,value:w,floatValue:parseFloat(w)},{event:E,source:_e.event})}a(E)},L=function(E){return E===D?!0:Se(E)},ae=function(E){var w=E.currentValue,B=E.lastValue,M=E.formattedValue,V=E.currentValueIndex,I=E.formattedValueIndex,k=w[V],ie=M[I],de=mt(B,w),se=de.to,le=function(fe){return P(fe).indexOf(".")+m.length};return p===0&&u&&l&&w[se.start]===D&&le(w)<V&&le(M)>I?!1:V>=se.start&&V<se.end&&v&&v.includes(k)&&ie===D?!0:k===ie};return Object.assign(Object.assign({},h),{value:W,valueIsNumericString:!1,isValidInputCharacter:L,isCharacterSame:ae,onValueChange:Z,format:N,removeFormatting:P,getCaretBoundary:function(E){return Dn(E,t)},onKeyDown:ne,onBlur:J})}function Nn(t){var e=Rn(t);return me.createElement(Cn,Object.assign({},e))}const Pn=({inputSuffix:t,inputPrefix:e,...n})=>c.jsx(Y,{...n,value:n.value,suffix:t,prefix:e}),Bn=({onValueChange:t,...e})=>c.jsx(Nn,{customInput:Pn,onValueChange:t,...e}),Re=({inputSuffix:t,inputPrefix:e,onValueChange:n,...r})=>c.jsx(Bn,{inputPrefix:e,inputSuffix:t,onValueChange:n,...r}),at=[{label:"Producer",value:"Producer"},{label:"Distributor",value:"Distributor"},{label:"Recycler",value:"Recycler"},{label:"Collector",value:"Collector"},{label:"Retailer",value:"Retailer"}],In=[{label:"Plastic shopping/carry bags (having thickness less than 75 micron or less than 12 x 16 inch in size)",value:"Plastic shopping/carry bags (having thickness less than 75 micron)"},{label:"Other Single Use Plastics",value:"Other Single Use Plastics"}],An=[{label:"Notice issued",value:"Notice issued"},{label:"Confiscation",value:"Confiscation"},{label:"Sealing",value:"Sealing"},{label:"FIR",value:"FIR"},{label:"Complaint before Environmental Magistrate",value:"Complaint before Environmental Magistrate"},{label:"Fine Imposed",value:"Fine Imposed"},{label:"De Sealed",value:"De Sealed"}],Mn=({control:t,errors:e,readOnly:n=!1,defaultValues:r})=>{var ie,de,se,le,fe,ge,be,Ce,we,Fe,je,Ee,xe,De,y,_,j;const[i,a]=F.useState([]),[s,l]=F.useState([]),{setValue:u,getValues:m,trigger:d}=ot(),[p,g]=F.useState(""),f=re({control:t,name:"violationFound",defaultValue:[]}),h=re({control:t,name:"violationType",defaultValue:[]}),b=re({control:t,name:"actionTaken",defaultValue:[]}),D=re({control:t,name:"fineRecoveryStatus",defaultValue:[]});re({control:t,name:"fineAmount",defaultValue:0});const v=(o,x)=>{l(x);const S=x.filter(C=>!i.includes(C));S.length>0&&a(C=>[...C,...S])},N=re({control:t,name:"plasticBagsConfiscation",defaultValue:0}),P=re({control:t,name:"confiscation_otherPlastics",defaultValue:{}}),[U,K]=F.useState(0);F.useEffect(()=>{if(b.includes("Confiscation")){let o=0;h.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&(o+=parseFloat(N)||0),s.forEach(x=>{P[x]&&(o+=parseFloat(P[x])||0)}),K(o),u("totalConfiscation",o)}},[N,P,b,u,s,h]),F.useEffect(()=>{pt.get("/pmc/inspection-report-cached/all_other_single_use_plastics/").then(o=>{a(o.data.single_use_plastic_items||[])}).catch(o=>{console.error("Error fetching available options:",o)})},[]),F.useEffect(()=>{if(r!=null&&r.fineRecoveryBreakup){const o=r.fineRecoveryBreakup.map(x=>({...x,isNew:!1}));q(o)}},[r==null?void 0:r.fineRecoveryBreakup]);const te=re({control:t,name:"fineAmount",defaultValue:0});re({control:t,name:"recoveryAmount",defaultValue:0});const X=re({control:t,name:"fineRecoveryBreakup",defaultValue:[]}),[T,q]=F.useState(X||[]),[W,Z]=F.useState(0);F.useEffect(()=>{console.log("Updating total recovery"),console.log("recoveryEntries",T);const o=T.reduce((x,S)=>x+(S.amount||0),0);Z(o),console.log("fineReoceryBreakup is setup")},[T,u]);const ne=()=>{W<te&&q([...T,{date:"",amount:0,isNew:!0}])},J=(o,x,S)=>{console.log("recovery amount updated:"),console.log(o,x,S),q(C=>{const A=C.map(($,H)=>H===o?{...$,[x]:x==="amount"?parseFloat(S)||0:S}:$);return console.log("🔹 Updated Recovery Entries:",A),A})};F.useEffect(()=>{console.log("Updated recovery entries:",T),console.log("Calculated Total Recovery:",W)},[T,W]),F.useEffect(()=>{r!=null&&r.OtherSingleUseItems&&l(r.OtherSingleUseItems)},[r==null?void 0:r.OtherSingleUseItems]);const[L,ae]=F.useState({lat:r.latitude,lng:r.longitude,district:""}),E=o=>{console.log("Selected Location:",o),(!o.lat||!o.lng)&&console.warn("Latitude or Longitude is missing, retrying..."),ae({lat:o.lat||L.lat,lng:o.lng||L.lng,district:o.district||L.district})},w=o=>{o.key==="Backspace"&&g(B(p,!0))},B=(o,x)=>{let S=o.replace(/[^a-zA-Z0-9]/g,""),C=S.slice(0,3).toUpperCase().replace(/[^A-Z]/g,""),A=S.slice(3,6).toUpperCase().replace(/[^A-Z]/g,""),$=S.slice(6).replace(/[^0-9]/g,"");if(x)return[C,A,$].filter(Boolean).join("-");let H="";return C&&(H+=C+(C.length===3?"-":"")),A&&(H+=A+(A.length===3?"-":"")),$&&(H+=$),H};console.log("fineRecoveryBreakup:",r==null?void 0:r.fineRecoveryBreakup),console.log("readOnly",n),Ne(o=>o.user.district_id);const M=Ne(o=>o.user.district_name)||"";console.log("district_name:",M),console.log("location:",r==null?void 0:r.location),console.log("defaultValues:",r);const{latitude:V,longitude:I}=r,k=V&&I?{lat:V,lng:I}:null;return F.useEffect(()=>{const x=setInterval(()=>{(!L.lat||!L.lng)&&(console.log("Retrying location fetch..."),k?ae(k):console.warn("No valid location found, please select again."))},2e3);return()=>clearInterval(x)},[L.lat,L.lng,k]),c.jsxs(Ft,{children:[c.jsxs("h4",{className:"mb-6",children:["Inspection Report - ",M]}),c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsx(O,{label:"Inspection Date*",invalid:!!e.inspectionDate,errorMessage:(ie=e.inspectionDate)==null?void 0:ie.message,children:c.jsx(G,{name:"inspectionDate",control:t,render:({field:o})=>c.jsx(Y,{type:"date",...o,readOnly:n})})}),c.jsx(O,{label:"Name of Business*",invalid:!!e.businessName,errorMessage:(de=e.businessName)==null?void 0:de.message,children:c.jsx(G,{name:"businessName",control:t,render:({field:o})=>c.jsx(Y,{type:"text",placeholder:"Business Name",readOnly:n,...o})})}),c.jsx(O,{label:"Type of Business*",invalid:!!e.businessType,errorMessage:(se=e.businessType)==null?void 0:se.message,children:c.jsx(G,{name:"businessType",control:t,render:({field:o})=>c.jsx(We,{options:at,value:at.find(x=>x.value===o.value),isDisabled:n,onChange:x=>o.onChange(x==null?void 0:x.value)})})}),c.jsx(O,{label:"Plastic Application / License Number",invalid:!!e.licenseNumber,errorMessage:(le=e.licenseNumber)==null?void 0:le.message,children:c.jsx(G,{name:"licenseNumber",control:t,render:({field:o})=>c.jsx(Y,{value:p,onChange:x=>g(B(x.target.value,!1)),onKeyDown:w,placeholder:"e.g., LHR-PRO-001",title:"Tracking Number (e.g., LHR-PRO-001)",readOnly:n})})})]}),c.jsx(O,{label:"Violation Found",invalid:!!e.violationFound,errorMessage:(fe=e.violationFound)==null?void 0:fe.message,children:c.jsx(G,{name:"violationFound",control:t,render:({field:o})=>c.jsx(he.Group,{value:o.value||[],onChange:x=>o.onChange(x),className:"flex flex-col gap-2 mb-2 ml-2",children:c.jsx(he,{...o,value:"Yes",disabled:n,children:"Yes"})})},"a1")}),f.includes("Yes")&&c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsxs(O,{label:"Type of Violation Found*",invalid:!!e.violationType,errorMessage:(ge=e.violationType)==null?void 0:ge.message,children:[In.map(o=>c.jsx(G,{name:"violationType",control:t,render:({field:x})=>c.jsx(he.Group,{value:x.value||[],onChange:S=>x.onChange(S),className:"flex flex-col gap-2 mb-2 ml-2",children:c.jsx(he,{...x,value:o.value,disabled:n,children:o.label})})},o.value)),h.includes("Other Single Use Plastics")&&c.jsx(O,{label:"Add List + (If desired item is not in the list, then type and press enter to add)",invalid:!!e.PackagingItems,errorMessage:(be=e.PackagingItems)==null?void 0:be.message,className:"ml-2 mt-4",children:c.jsx(G,{name:"OtherSingleUseItems",control:t,render:({field:o})=>c.jsx(Yt,{multiple:!0,freeSolo:!0,options:i,value:s,readOnly:n,onChange:(x,S)=>{o.onChange(S),v(x,S)},renderTags:(x,S)=>x.map((C,A)=>c.jsx(zt,{variant:"outlined",label:C,...S({index:A})})),renderInput:x=>c.jsx(Xt,{...x,variant:"outlined",label:"Other Single Use Plastics",placeholder:"Add or select Single Use Plastics"})})})})]}),c.jsx(O,{label:"Action Taken*",invalid:!!e.actionTaken,errorMessage:(Ce=e.actionTaken)==null?void 0:Ce.message,children:An.map(o=>c.jsx(G,{name:"actionTaken",control:t,render:({field:x})=>c.jsx(he.Group,{value:x.value||[],onChange:S=>x.onChange(S),className:"flex flex-col gap-2 mb-2 ml-2",children:c.jsx(he,{...x,value:o.value,disabled:n&&o.value!=="De Sealed",children:o.label})})},o.value))}),b.includes("Confiscation")&&h.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&c.jsx(O,{label:"Plastic shopping/carry bags (having thickness less than 75 micron) (KG)",invalid:!!e.plasticBagsConfiscation,errorMessage:(we=e.plasticBagsConfiscation)==null?void 0:we.message,children:c.jsx(G,{name:"plasticBagsConfiscation",control:t,render:({field:o})=>c.jsx(Re,{placeholder:"Enter KG",...o,readOnly:n})})}),b.includes("Confiscation")&&h.includes("Other Single Use Plastics")&&s.map((o,x)=>c.jsx(O,{label:`${o} Confiscation (KG)`,children:c.jsx(G,{name:`confiscation_otherPlastics.${o}`,control:t,render:({field:S})=>c.jsx(Y,{type:"number",placeholder:"Enter KG",...S,readOnly:n})})},x)),b.includes("Confiscation")&&c.jsx(O,{label:"Total Confiscation (KG)",invalid:!!e.totalConfiscation,errorMessage:(Fe=e.totalConfiscation)==null?void 0:Fe.message,children:c.jsx(G,{name:"totalConfiscation",control:t,render:({field:o})=>(F.useEffect(()=>{o.onChange(U)},[U]),c.jsx(Y,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...o}))})}),b.includes("Fine Imposed")&&c.jsxs(c.Fragment,{children:[c.jsx(O,{label:"Fine Amount (PKR)",invalid:!!e.fineAmount,errorMessage:(je=e.fineAmount)==null?void 0:je.message,children:c.jsx(G,{name:"fineAmount",control:t,render:({field:o})=>c.jsx(Re,{placeholder:"Enter Fine Amount",...o,readOnly:n})})}),c.jsx(O,{label:"Fine Recovery Status",invalid:!!e.fineRecoveryStatus,errorMessage:(Ee=e.fineRecoveryStatus)==null?void 0:Ee.message,children:c.jsx(G,{name:"fineRecoveryStatus",control:t,render:({field:o})=>c.jsx(We,{options:[{label:"Pending",value:"Pending"},{label:"Partial",value:"Partial"},{label:"Recovered",value:"Recovered"}],value:{label:o.value,value:o.value},onChange:x=>o.onChange(x==null?void 0:x.value),isDisabled:n&&o.value==="Recovered"})})}),D!=="Pending"&&c.jsxs(c.Fragment,{children:[c.jsx(O,{label:"Total Recovery Amount (PKR)",invalid:!!e.recoveryAmount,errorMessage:(xe=e.recoveryAmount)==null?void 0:xe.message,children:c.jsx(G,{name:"recoveryAmount",control:t,render:({field:o})=>(F.useEffect(()=>{o.onChange(W)},[W]),c.jsx(Re,{placeholder:"Auto-calculated",readOnly:!0,...o}))})}),T.map((o,x)=>{var S,C;return c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsx(O,{label:"Recovery Date",invalid:!!e.fineRecoveryBreakup,errorMessage:(S=e.fineAmount)==null?void 0:S.fineRecoveryBreakup,children:c.jsx(Y,{type:"date",value:o.date,onChange:A=>J(x,"date",A.target.value),readOnly:!o.isNew})}),c.jsx(O,{label:"Recovery Amount (PKR)",invalid:!!e.fineRecoveryBreakup,errorMessage:(C=e.fineAmount)==null?void 0:C.fineRecoveryBreakup,children:c.jsx(Re,{value:o.amount,onChange:A=>J(x,"amount",A.target.value),readOnly:!o.isNew})})]},x)}),c.jsx(Oe,{type:"button",onClick:ne,disabled:W>=te,className:"mt-7",children:"+ Add Recovery"})]})]}),b.includes("De Sealed")&&c.jsxs(c.Fragment,{children:[c.jsx(O,{label:"De Sealed Date",invalid:!!e.deSealedDate,errorMessage:(De=e.deSealedDate)==null?void 0:De.message,children:c.jsx(G,{name:"deSealedDate",control:t,render:({field:o})=>c.jsx(Y,{type:"date",...o,readOnly:n&&o.value!==null&&o.value!==""})})}),c.jsx(O,{label:"De Seal - Affidavit",invalid:!!e.affidavit,errorMessage:(y=e.affidavit)==null?void 0:y.message,children:c.jsx(G,{name:"affidavit",control:t,render:({field:o})=>c.jsx(Y,{type:"file",accept:".pdf,.png,.jpg,.jpeg",onChange:x=>o.onChange(x.target.files[0]||null)})})})]})]}),c.jsxs("div",{style:{padding:"20px"},children:[c.jsx("h1",{children:"Select Location"}),c.jsx(on,{onLocationSelect:E,savedLocation:k,isEditing:!!(r!=null&&r.id)}),c.jsxs("div",{style:{marginTop:"20px",padding:"10px",border:"1px solid #ccc"},children:[c.jsx("h3",{children:"Selected Location Details:"}),c.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[c.jsx(O,{label:"Latitude",invalid:!!e.latitude,errorMessage:(_=e.latitude)==null?void 0:_.message,children:c.jsx(G,{name:"latitude",control:t,render:({field:o})=>(F.useEffect(()=>{L.lat||console.warn("Latitude is missing, setting default..."),o.onChange(L.lat||0)},[L.lat]),c.jsx(Y,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...o}))})}),c.jsx(O,{label:"Longitude",invalid:!!e.longitude,errorMessage:(j=e.longitude)==null?void 0:j.message,children:c.jsx(G,{name:"longitude",control:t,render:({field:o})=>(F.useEffect(()=>{L.lng||console.warn("Longitude is missing, setting default..."),o.onChange(L.lng||0)},[L.lng]),c.jsx(Y,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...o}))})}),c.jsx(G,{name:"fineRecoveryBreakup",control:t,render:({field:o})=>(F.useEffect(()=>{o.onChange(T)},[T]),c.jsx(Y,{type:"hidden",placeholder:"Auto-calculated",readOnly:!0,...o}))})]})]})]})]})},kn=R.object({businessName:R.string().min(1,{message:"Business name required"}),businessType:R.string().min(1,{message:"Business type required"}),licenseNumber:R.string().optional(),violationFound:R.array(R.string()).optional(),violationType:R.array(R.string()).optional(),actionTaken:R.array(R.string()).optional(),plasticBagsConfiscation:R.coerce.number().optional(),confiscation_otherPlastics:R.record(R.string(),R.coerce.number()).optional(),totalConfiscation:R.coerce.number().optional(),OtherSingleUseItems:R.array(R.string()).optional(),latitude:R.coerce.number().min(-90,{message:"Latitude is required and must be valid (-90 to 90)"}),longitude:R.coerce.number().min(-180,{message:"Longitude is required and must be valid (-180 to 180)"}),district:R.string().optional(),inspectionDate:R.string().min(1,{message:"Inspection date is required"}),fineAmount:R.coerce.number().optional(),fineRecoveryStatus:R.enum(["Pending","Partial","Recovered"]).optional(),fineRecoveryDate:R.string().optional(),recoveryAmount:R.coerce.number().optional(),deSealedDate:R.string().optional(),fineRecoveryBreakup:R.array(R.object({date:R.string().min(1,{message:"Date is required"}),amount:R.coerce.number().min(0,{message:"Amount must be a number and at least 0"}),isNew:R.boolean().optional()})).default([]),affidavit:R.instanceof(File,{message:"Must be a valid file"}).optional()}),Vn=({onFormSubmit:t,defaultValues:e={},readOnly:n,children:r})=>{const{handleSubmit:i,reset:a,formState:{errors:s},control:l}=ot({defaultValues:{fineRecoveryBreakup:(e==null?void 0:e.fineRecoveryBreakup)??[]},resolver:Jt(kn)});return F.useEffect(()=>{xt(e)||a(e)},[JSON.stringify(e)]),c.jsxs(Ct,{className:"flex w-full h-full",containerClassName:"flex flex-col w-full justify-between",onSubmit:i(t),children:[c.jsx(st,{children:c.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:c.jsx("div",{className:"gap-4 flex flex-col flex-auto",children:c.jsx(Mn,{control:l,errors:s,defaultValues:e,readOnly:n})})})}),c.jsx(wt,{children:r})]})},Ln=t=>t?{id:t.id,businessName:t.business_name,businessType:t.business_type,licenseNumber:t.license_number||"",violationFound:t.violation_found||[],violationType:t.violation_type||[],actionTaken:t.action_taken||[],plasticBagsConfiscation:t.plastic_bags_confiscation??0,confiscationOtherPlastics:t.confiscation_other_plastics||{},totalConfiscation:t.total_confiscation||0,OtherSingleUseItems:t.other_single_use_items||[],latitude:t.latitude??null,longitude:t.longitude??null,district:t.district||"",inspectionDate:t.inspection_date||null,fineAmount:t.fine_amount??0,fineRecoveryStatus:t.fine_recovery_status||void 0,fineRecoveryDate:t.fine_recovery_date||"",recoveryAmount:t.recovery_amount??0,deSealedDate:t.de_sealed_date||"",fineRecoveryBreakup:t.fine_recovery_breakup||null,syncStatus:t.syncStatus||void 0}:null,yr=()=>{const t=yt(),e=_t(),{reports:n,fetchReports:r,updateReport:i,addNewReport:a,syncReports:s}=nn(),[l,u]=F.useState(!1),[m,d]=F.useState(!1),g=new URLSearchParams(e.search).get("id");console.log(n);let f=F.useMemo(()=>{const v=n.find(N=>N.id==g);return v?Ln(v):null},[n,g]);f={...f,inspectionDate:(f==null?void 0:f.inspectionDate)||new Date().toISOString().split("T")[0]},F.useEffect(()=>{g&&!f&&r()},[f,r]),Ne(v=>v.user.district_id),Ne(v=>v.user.district_name);const h=async v=>{console.log("Submitting Data:",v),d(!0);const N={business_name:v.businessName,business_type:v.businessType,license_number:v.licenseNumber||"",violation_found:v.violationFound||[],violation_type:v.violationType||[],action_taken:v.actionTaken||[],plastic_bags_confiscation:v.plasticBagsConfiscation??0,confiscation_other_plastics:v.confiscationOtherPlastics||{},total_confiscation:v.totalConfiscation||0,other_single_use_items:v.OtherSingleUseItems||[],latitude:v.latitude??null,longitude:v.longitude??null,district:v.district||"",inspection_date:v.inspectionDate||null,fine_amount:v.fineAmount??0,fine_recovery_status:v.fineRecoveryStatus||void 0,fine_recovery_date:v.fineRecoveryDate||null,recovery_amount:v.recoveryAmount??0,de_sealed_date:v.deSealedDate||null,fine_recovery_breakup:v.fineRecoveryBreakup||null,affidavit:v.affidavit||null,syncStatus:g?"patch":"post"};try{g?i(g,N):a(N),console.log("✅ Report Updated in Store"),d(!1),t("/auth/EPAOperations/AllInspections")}catch(P){console.error("❌ Error in Submission:",P),d(!1)}},b=()=>u(!0),D=()=>{u(!1),St.push(c.jsx(bt,{type:"success",children:"Customer discard!"}),{placement:"top-center"}),t("/auth/EPAOperations/AllInspections")};return c.jsx(c.Fragment,{children:c.jsxs(c.Fragment,{children:[c.jsx(Vn,{newCustomer:!0,defaultValues:f,onFormSubmit:h,readOnly:g!==null,children:c.jsx(st,{children:c.jsxs("div",{className:"flex items-center justify-between px-8",children:[c.jsx("span",{}),c.jsxs("div",{className:"flex items-center",children:[c.jsx(Oe,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:c.jsx(en,{}),onClick:b,children:"Discard"}),c.jsx(Oe,{icon:c.jsx(tn,{}),variant:"solid",type:"submit",loading:m,children:"Save"})]})]})})}),c.jsx(Qt,{isOpen:l,type:"danger",title:"Discard changes",onClose:()=>u(!1),onCancel:()=>u(!1),onConfirm:D,children:c.jsx("p",{children:"Are you sure you want to discard this?"})})]})})};export{yr as default};
