import{r as p,V as M,j as i,A as x}from"./index-BsYDAXCC.js";import{M as P}from"./index.esm-O3pBcoHS.js";import"./TextField-BV38zarO.js";import"./Divider-DN0QPZAZ.js";import"./FormControlLabel-CavGxzr0.js";import"./Autocomplete-CDdIRmOW.js";import"./index-CnKXuH36.js";const z=s=>{const l=(s.assigned_group==="APPLICANT"&&s.applicationassignment||[]).filter(a=>a.assigned_group==="APPLICANT"&&a.remarks&&a.remarks!=="undefined").map(a=>a.remarks),c=l.length>0?l.join("; "):"N/A",n=s.applicationassignment.filter(a=>a.assigned_group===s.assigned_group),D=n.reduce((a,h)=>new Date(h.updated_at).getTime()>new Date(a.updated_at).getTime()?h:a,n[0]);let A="N/A";if(D&&D.updated_at){const a=new Date(D.updated_at),w=new Date-a;A=Math.floor(w/(1e3*60*60*24))}return{id:s.id,tracking_number:s.tracking_number,first_name:s.first_name,last_name:s.last_name,CNIC:s.cnic,mobile_no:s.mobile_no,application_status:s.application_status,assigned_group:s.assigned_group,registration_for:s.registration_for,days_pending_for:A,remarks:c}},F=s=>s.map(f=>{const l=z(f);return Object.keys(l).forEach(c=>{(l[c]===void 0||l[c]===null)&&(l[c]="N/A")}),l}),J=()=>{const[s,f]=p.useState([]),[l,c]=p.useState([]),[n,D]=p.useState(null),[A,a]=p.useState(0),[h,w]=p.useState(null),[N,I]=p.useState({}),[y,v]=p.useState(null),[j,C]=p.useState(!1),b=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],R={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},k=async e=>{try{if(C(!0),v(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const d=e==="LSO1"?1:e==="LSO2"?2:0,u=((await x.get("/pmc/applicant-detail-main-do-list/",{params:{assigned_group:"LSO"}})).data||[]).filter(S=>{var m;return((m=S.submittedapplication)==null?void 0:m.id)%3===d}),t=O(u,!!n.length,n[0]);f(t.flattenedData),c(t.columns)}else{const _=(await x.get("/pmc/applicant-detail-main-do-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],u=O(_,!!n.length,n[0]);f(u.flattenedData),c(u.columns)}}catch(d){console.error("Error fetching filtered data:",d),f([]),c([])}finally{C(!1)}},O=(e,d,_)=>{const u=["first_name","CNIC","mobile_no","tracking_number","registration_for","days_pending_for","remarks"],t=F(e),S=t[0];console.log(e);const m=[...Object.keys(S).filter(g=>u.includes(g)).map(g=>{let o=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(g)?o=120:["first_name"].includes(g)&&(o=180),{accessorKey:g,header:g.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),size:o,Cell:({cell:r,row:L})=>{const E=`/spuid-review/${L.original.id}?group=${_}`;return i.jsx("a",{href:E,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:r.getValue()||"-"})}}})];return{flattenedData:t,columns:m}},T=M();return p.useEffect(()=>{(async()=>{var _,u;C(!0);try{const t=await x.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch(t){const S={status:(_=t.response)==null?void 0:_.status,data:(u=t.response)==null?void 0:u.data,message:t.message};T("/error",{state:{error:S}})}try{let t=[];try{t=(await x.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],D(t.map(r=>r.name))}catch(o){console.error("Error fetching user groups:",o),D([])}console.log("groupsResponse",t);const m=(await x.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(m)&&m.length>0){const o=O(m,t.length>0,t.map(L=>L.name)[0]);f(o.flattenedData),c(o.columns),console.log("Flattened Data:",o.flattenedData);const r=o.flattenedData[o.flattenedData.length-1];if(console.log("Last Row:",r),r&&r.id){w(r.id),console.log("Last Row ID:",r.id);const L=b.indexOf(r.assigned_group);L!==-1&&a(L)}}const g=await x.get("/pmc/fetch-statistics-do-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});I(g.data)}catch(t){console.error("Error fetching data:",t)}finally{C(!1)}})(),w(25);const d=b.indexOf("LSO");d!==-1&&a(d)},[]),p.useEffect(()=>{console.log("userGroups:",n),n&&!n.includes("DO")&&T("/home")},[n,T]),console.log("selectedRowId:",h),console.log(h),i.jsxs("div",{children:[i.jsx("div",{className:"tiles-container",children:Object.entries(N).map(([e,d])=>i.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:y===e?"#007BFF":"#f8f9fa",color:y===e?"#fff":"#000"},onClick:()=>k(e),children:[i.jsx("h3",{children:R[e]||e})," ",i.jsx("p",{children:d})]},e))}),i.jsx("div",{className:"mb-4",children:i.jsxs("h3",{children:[n&&n.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),j?i.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[i.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),i.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):i.jsx(P,{columns:[...l],data:s.map(e=>({...e,assigned_group_title:R[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:200,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},h)]})};export{J as default};
