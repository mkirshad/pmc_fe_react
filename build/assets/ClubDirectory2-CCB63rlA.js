import{r,j as e,A as g}from"./index-ZKRKcjDq.js";import{M as E,V as z,T as P,O as R,a as w,b as p,S as A,e as B,F as y,c as j}from"./OSM-Bx5l-N5p.js";import{G as $}from"./GeoJSON-BAwyf57_.js";import{M as H}from"./index.esm-CQ44RPeO.js";import{q as K,h as G,m as I,n as O,o as q,p as J}from"./index-BF4KCu_n.js";import{M as W}from"./TextField-BEIgdnQo.js";import"./DefaultPropsProvider-D03C37m8.js";import"./Autocomplete-Dps3z5mo.js";import"./FormControlLabel-BOPUSnAI.js";import"./Divider-BfdvPHfp.js";import"./index-C2g4LWyr.js";const ne=()=>{const x=r.useRef(null),[a,N]=r.useState(null),[n,C]=r.useState(null),[Z,v]=r.useState(null),[d,S]=r.useState([]),[i,u]=r.useState(null),[k,m]=r.useState(!1),[b,_]=r.useState([]),[l,c]=r.useState(null),[D,M]=r.useState(!0);r.useEffect(()=>{const t=new E({target:x.current,layers:[new P({source:new R})],view:new z({zoom:7,center:[8127130,3658593]})}),s=new w({source:new p}),o=new w({source:new p});return t.addLayer(s),t.addLayer(o),C(s),v(o),N(t),()=>t.setTarget(null)},[]),r.useEffect(()=>{if(!n||!a)return;(async()=>{m(!0);try{const s=await g.get("/pmc/idm_districts-club-counts/");_(s.data.features);const o=new p({features:new $().readFeatures(s.data,{featureProjection:"EPSG:3857"})});n.setSource(o),a.getView().fit(o.getExtent(),{padding:[50,50,50,50],duration:500})}catch(s){console.error("Error fetching districts:",s)}finally{m(!1)}})()},[n,a]),r.useEffect(()=>{n&&n.setStyle(t=>{const s=t.get("id")===i;if(t.get("club_count")!==0)return new A({stroke:new j({color:s?"red":"blue",width:s?3:2}),fill:new y({color:s?"rgba(255,0,0,0.1)":"rgba(0,0,255,0.1)"}),text:new B({text:`${t.get("name")} (${t.get("club_count")})`,font:"bold 10px sans-serif",fill:new y({color:"#000"}),stroke:new j({color:"#fff",width:3}),overflow:!0})})})},[n,i]),r.useEffect(()=>{(async()=>{const s=await g.get("/pmc/idm_clubs_geojson_all/");S(s.data.features)})()},[]),r.useEffect(()=>{if(!a||!n)return;const t=s=>{const o=a.getFeaturesAtPixel(s.pixel);if(o.length>0){const h=o[0].get("id");i===h?(u(null),a.getView().setCenter([8127130,3658593])):u(h)}else u(null),a.getView().setCenter([8127130,3658593])};return a.on("click",t),()=>a.un("click",t)},[a,n,i]);const F=r.useMemo(()=>i?d.filter(t=>t.properties.district_id===i):d,[i,d]),V=r.useMemo(()=>[{accessorKey:"properties.district",header:"District",size:150,Cell:({cell:t})=>e.jsx("a",{href:"#",className:"text-blue-500 hover:underline",onClick:s=>{s.preventDefault(),c(t.row.original.properties)},children:t.getValue()})},{accessorKey:"properties.name",header:"School Name",size:225,Cell:({cell:t})=>e.jsx("a",{href:"#",className:"text-blue-500 hover:underline",onClick:s=>{s.preventDefault(),c(t.row.original.properties)},children:t.getValue()})},{accessorKey:"properties.address",header:"Address",size:225,Cell:({cell:t})=>e.jsx("a",{href:"#",className:"text-blue-500 hover:underline",onClick:s=>{s.preventDefault(),c(t.row.original.properties)},children:t.getValue()})},{accessorKey:"properties.head_name",header:"Head Name",size:200,Cell:({cell:t})=>e.jsx("a",{href:"#",className:"text-blue-500 hover:underline",onClick:s=>{s.preventDefault(),c(t.row.original.properties)},children:t.getValue()})}],[]),L=r.useMemo(()=>{const t=[...b].sort((s,o)=>o.properties.club_count-s.properties.club_count).slice(0,3);return[{properties:{name:"Total Clubs",club_count:d.length,id:null}},...t]},[b,d]),f=[{bgColor:"bg-gray-500",icon:e.jsx(G,{className:"text-white text-3xl"})},{bgColor:"bg-orange-500",icon:e.jsx(I,{className:"text-white text-3xl"})},{bgColor:"bg-blue-500",icon:e.jsx(O,{className:"text-white text-3xl"})},{bgColor:"bg-yellow-500",icon:e.jsx(q,{className:"text-white text-3xl"})},{bgColor:"bg-green-500",icon:e.jsx(J,{className:"text-white text-3xl"})}],T=t=>{c(t.original.properties)};return e.jsxs("div",{className:"flex flex-col p-4 gap-4",children:[D&&e.jsxs("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded relative",children:[e.jsx("p",{className:"font-medium",children:"To access Head Contact Number and Club Notification, please click on the Club Name."}),e.jsx("button",{className:"absolute top-2 right-2 text-yellow-700 hover:text-yellow-900",onClick:()=>M(!1),children:"Ã—"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:L.map((t,s)=>e.jsx("div",{className:`shadow-md rounded p-6 w-full cursor-pointer transition 
                ${i===null||i===t.properties.id?"opacity-100":"opacity-50"}
                ${f[s].bgColor}
                `,onClick:()=>u(t.properties.id),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[f[s].icon,e.jsx("h2",{className:"text-2xl font-bold text-white",children:t.properties.name}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.properties.club_count})]})},s))}),e.jsxs("div",{className:"flex flex-row p-4 gap-4",children:[e.jsxs("div",{className:"relative w-1/2",children:[k&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-10",children:e.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-blue-500 border-t-transparent rounded-full"})}),e.jsx("div",{ref:x,style:{height:"850px"}})]}),e.jsx("div",{style:{flex:1},children:e.jsx(H,{columns:V,data:F,initialState:{pagination:{pageSize:15}},enableZebraStripes:!0,enableColumnResizing:!0,muiTableBodyRowProps:({row:t})=>({onClick:()=>T(t),style:{cursor:"pointer"},sx:{"&:nth-of-type(even)":{backgroundColor:"#f9f9f9"},"&:hover":{backgroundColor:"#e0f7fa"}}}),muiTableProps:{sx:{border:"1px solid #ddd"}},muiTableHeadCellProps:{sx:{backgroundColor:"#f5f5f5",fontWeight:"bold",borderBottom:"2px solid #ccc",textAlign:"center"}},muiTableBodyCellProps:{sx:{borderRight:"1px solid #ddd",padding:"10px"}}})})]}),e.jsx(W,{open:!!l,onClose:()=>c(null),"aria-labelledby":"club-details-modal",children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6 w-96 max-w-lg",children:l&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:l.name}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"District:"})," ",l.district]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Address:"})," ",l.address]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Head Name:"})," ",l.head_name]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Head Mobile:"})," ",l.head_mobile]}),l.notification_path&&e.jsxs("div",{className:"flex items-center space-x-2 border-t pt-3",children:[e.jsx(K,{size:24,className:"text-blue-500 cursor-pointer transition-transform transform hover:scale-110",onClick:()=>window.open(`/api/pmc/media${l.notification_path}`,"_blank")}),e.jsx("a",{href:`/api/pmc/media${l.notification_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 font-semibold hover:underline",children:"View Notification"})]})]}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx("button",{onClick:()=>c(null),className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200",children:"Close"})})]})})})})]})};export{ne as default};
