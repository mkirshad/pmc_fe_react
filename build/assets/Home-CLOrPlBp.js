import{r,y as w,j as s,U as V,A as S}from"./index-CeEiVNSt.js";import{M as F}from"./index.esm-C-DCJvQJ.js";import{u as G,a as U}from"./useControllableState-eTkz61qQ.js";import{c as K}from"./classNames-yt0cW5TX.js";import"./TextField-DU4BbOg6.js";import"./DefaultPropsProvider-DxAVkpuk.js";import"./FormControlLabel-BkU20GKd.js";import"./Autocomplete-DZpX6eW4.js";import"./Divider-DA83PL3k.js";import"./index-BQH_m0bE.js";const y=r.createContext({}),B=y.Provider;y.Consumer;function A(){return r.useContext(y)}const P=r.forwardRef((e,d)=>{const{className:a,defaultValue:n,onChange:t,value:l,variant:p="underline",...i}=e,[m,b]=G({prop:l,onChange:t,defaultProp:n}),x=w("tabs",a);return s.jsx(B,{value:{value:m,onValueChange:b,variant:p},children:s.jsx("div",{className:x,...i,ref:d})})});P.displayName="Tabs";const k=r.forwardRef((e,d)=>{const{className:a,children:n,...t}=e,{variant:l}=A(),p=w("tab-list",`tab-list-${l}`,a);return s.jsx("div",{ref:d,role:"tablist",className:p,...t,children:n})});k.displayName="TabList";const E=r.forwardRef((e,d)=>{const{value:a,disabled:n,className:t,icon:l,children:p,...i}=e,{value:m,onValueChange:b,variant:x}=A(),h=a===m,N=U(()=>{!h&&!n&&(b==null||b(a))}),T=K("tab-nav",`tab-nav-${x}`,h&&"tab-nav-active text-primary",h&&x==="underline"&&"border-primary",h&&x==="pill"&&"bg-primary text-neutral",n&&"tab-nav-disabled",!n&&!h&&"hover:text-primary",t);return s.jsxs("div",{ref:d,className:T,role:"tab","aria-selected":h,tabIndex:0,onClick:N,onKeyDown:N,...i,children:[l&&s.jsx("div",{className:"tab-nav-icon",children:l}),p]})});E.displayName="TabNav";const M=r.forwardRef((e,d)=>{const{value:a,children:n,className:t,...l}=e,p=A(),i=a===p.value,m=w("tab-content",i&&"tab-content-active",t);return s.jsx("div",{ref:d,role:"tabpanel",tabIndex:0,className:m,...l,children:i&&n})});M.displayName="TabContent";const R=P;R.TabList=k;R.TabNav=E;R.TabContent=M;const H=e=>{var t,l,p;const a=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(i=>i.assigned_group==="APPLICANT"&&i.remarks&&i.remarks!=="undefined").map(i=>i.remarks),n=a.length>0?a.join("; "):"N/A";return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,CNIC:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,application_Start_Time:((t=e.created_at)==null?void 0:t.substring(0,16))||"N/A",application_Submission_Time:((p=(l=e.submittedapplication)==null?void 0:l.created_at)==null?void 0:p.substring(0,16))||"N/A",remarks:n}},q=e=>e.map(d=>{const a=H(d);return Object.keys(a).forEach(n=>{(a[n]===void 0||a[n]===null)&&(a[n]="N/A")}),a}),ne=()=>{const[e,d]=r.useState([]),[a,n]=r.useState([]),[t,l]=r.useState([]),[p,i]=r.useState(0),[m,b]=r.useState(null),[x,h]=r.useState({});r.useState("tab1"),console.log(m);const[N,T]=r.useState(!1),O=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],j={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},$=(o,_,u)=>{const I=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],C=q(o),L=C[0];console.log(o);const g=[...Object.keys(L).filter(c=>I.includes(c)).map(c=>({accessorKey:c,header:c.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),Cell:({cell:f,row:z})=>s.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const D=z.original.id;console.log(`Clicked ${c}:`,f.getValue()),console.log(`Navigating with ID: ${D}`),window.location.href=_?`/spuid-review/${D}?group=${u}`:`/spuid-signup/${D}`},children:f.getValue()||"-"})}))];return{flattenedData:C,columns:g}},v=V();return r.useEffect(()=>{(async()=>{T(!0);try{const u=await S.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{v("/error")}try{let u=[];try{u=(await S.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],l(u.map(c=>c.name))}catch(g){console.error("Error fetching user groups:",g),l([])}console.log("groupsResponse",u);const C=(await S.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(C)&&C.length>0){const g=$(C,u.length>0,u.map(f=>f.name)[0]);d(g.flattenedData),n(g.columns),console.log("Flattened Data:",g.flattenedData);const c=g.flattenedData[g.flattenedData.length-1];if(console.log("Last Row:",c),c&&c.id){b(c.id),console.log("Last Row ID:",c.id);const f=O.indexOf(c.assigned_group);f!==-1&&i(f)}}const L=await S.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});h(L.data)}catch(u){console.error("Error fetching data:",u)}finally{T(!1)}})(),b(25);const _=O.indexOf("LSO");_!==-1&&i(_)},[]),r.useEffect(()=>{console.log("userGroups:",t),t.includes("DEO")?v("/home-deo"):t.includes("Admin")?v("/home-admin"):t.includes("DO")?v("/home-do"):t.includes("Super")&&v("/home-super")},[t,v]),console.log("selectedRowId:",m),console.log(m),s.jsxs("div",{children:[s.jsx("div",{className:"tiles-container",children:Object.entries(x).map(([o,_])=>s.jsxs("div",{className:"tile",children:[s.jsx("h3",{children:j[o]||o})," ",s.jsx("p",{children:_})]},o))}),t.length>0&&s.jsx("div",{className:"mb-4",children:s.jsxs("h3",{children:[t.filter(o=>o!=="Download License"&&o!=="Applicant"&&o!=="LSM2").join(" - ")," Dashboard"]})}),N?s.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),s.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):s.jsx(F,{columns:[...a],data:e.map(o=>({...o,assigned_group_title:j[o.assigned_group]||o.assigned_group})),getRowId:o=>o.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:100,size:140},enableColumnResizing:!0,enableTopToolbar:t.length>0,enablePagination:!0},m)]})};export{ne as default};
