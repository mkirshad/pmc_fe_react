import{r as d,U as z,j as o,A as L}from"./index-B2rI5w_6.js";import{M as j}from"./index.esm-A5i8xEWj.js";import"./TextField-D7YsFegv.js";import"./Divider-DEaOFzRr.js";import"./FormControlLabel-BACucMvb.js";import"./Autocomplete-BdT0Ckkp.js";import"./index-yJXN0FAT.js";const P=a=>{var x,w,T,S,O,b;const u=t=>new Intl.NumberFormat("en-PK",{style:"currency",currency:"PKR",minimumFractionDigits:2}).format(t),r=a.applicationassignment.filter(t=>t.assigned_group===a.assigned_group),s=r.reduce((t,l)=>new Date(l.updated_at).getTime()>new Date(t.updated_at).getTime()?l:t,r[0]),n=s?(x=s.updated_at)==null?void 0:x.substring(0,16):"N/A";let h="N/A";if(s&&s.updated_at){const t=new Date(s.updated_at),f=new Date-t;h=Math.floor(f/(1e3*60*60*24))}let y="N/A";if((w=a.submittedapplication)!=null&&w.created_at&&((T=a.submittedapplication)!=null&&T.created_at)){const t=new Date((S=a.submittedapplication)==null?void 0:S.created_at),f=new Date-t;y=Math.floor(f/(1e3*60*60*24))}const v=a.applicantfees?a.applicantfees.reduce((t,l)=>t+parseFloat(l.fee_amount||0),0):0,_=a.applicantfees?a.applicantfees.filter(t=>t.is_settled).reduce((t,l)=>t+parseFloat(l.fee_amount||0),0):0;return{id:a.id,application_Submission_Time:((b=(O=a.submittedapplication)==null?void 0:O.created_at)==null?void 0:b.substring(0,16))||"N/A",duration:y||"N/A",tracking_number:a.tracking_number,first_name:a.first_name,mobile_no:a.mobile_no,application_status:a.application_status,assigned_group:a.assigned_group,group_assignment_time:n,group_assignment_days:h,total_fee_amount:u(v.toFixed(2)),verified_fee_amount:u(_.toFixed(2))}},G=a=>a.map(u=>{const r=P(u);return Object.keys(r).forEach(s=>{(r[s]===void 0||r[s]===null)&&(r[s]="N/A")}),r}),q=()=>{const[a,u]=d.useState([]),[r,s]=d.useState([]),[n,h]=d.useState(null),[y,v]=d.useState(0),[_,x]=d.useState(null),[w,T]=d.useState({}),[S,O]=d.useState(null),[b,t]=d.useState(!1);console.log(_);const l=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],f={APPLICANT:"Applicant",LSO:"LSO",LSO1:"Sana",LSO2:"Qaisar",LSO3:"Ameer",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},M=async e=>{try{if(t(!0),O(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const c=e==="LSO1"?1:e==="LSO2"?2:0,p=((await L.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:"LSO"}})).data||[]).filter(D=>{var A;return((A=D.submittedapplication)==null?void 0:A.id)%3===c}),m=R(p,!!n.length,n[0]);u(m.flattenedData),s(m.columns)}else{const i=(await L.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],p=R(i,!!n.length,n[0]);u(p.flattenedData),s(p.columns)}}catch(c){console.error("Error fetching filtered data:",c),u([]),s([])}finally{t(!1)}},R=(e,c,i)=>{const p=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","duration","remarks","group_assignment_days","total_fee_amount","verified_fee_amount"],m=G(e),D=m[0],A=[...Object.keys(D).filter(g=>p.includes(g)).map(g=>{let C=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(g)?C=120:["first_name"].includes(g)?C=180:["duration"].includes(g)&&(C=80),{accessorKey:g,header:g.replace(/_/g," ").replace(/\b\w/g,F=>F.toUpperCase()),size:C,Cell:({cell:F,row:E})=>{const I=`/spuid-review/${E.original.id}?group=${i}`;return o.jsx("a",{href:I,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:F.getValue()||"-"})}}})];return{flattenedData:m,columns:A}},N=z();return d.useEffect(()=>{(async()=>{t(!0);try{const i=await L.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{N("/error")}try{let i=[];try{i=(await L.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],h(i.map(D=>D.name))}catch(m){console.error("Error fetching user groups:",m),h([])}console.log("groupsResponse",i);const p=await L.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});T(p.data)}catch(i){console.error("Error fetching data:",i)}finally{t(!1)}})(),x(25);const c=l.indexOf("LSO");c!==-1&&v(c)},[]),d.useEffect(()=>{console.log("userGroups:",n),n&&!n.includes("Super")&&N("/home")},[n,N]),console.log("selectedRowId:",_),console.log(_),o.jsxs("div",{children:[o.jsx("div",{className:"tiles-container",children:Object.entries(w).map(([e,c])=>o.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:S===e?"#007BFF":"#f8f9fa",color:S===e?"#fff":"#000"},onClick:()=>M(e),children:[o.jsx("h3",{children:f[e]||e})," ",o.jsx("p",{children:c})]},e))}),o.jsx("div",{className:"mb-4",children:o.jsxs("h3",{children:[n&&n.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),b?o.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[o.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),o.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):o.jsx(j,{columns:[...r],data:a.map(e=>({...e,assigned_group_title:f[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:200,minSize:1,size:50},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},_)]})};export{q as default};
