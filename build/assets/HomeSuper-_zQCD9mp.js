import{r,l as z,X as P,j as t,A as v}from"./index-BTJOKbiQ.js";import{M as B}from"./index.esm-D5YMjEE5.js";import"./TextField-DY5wgqPB.js";import"./DefaultPropsProvider-BLyzi3km.js";import"./Autocomplete-mvMIiviW.js";import"./FormControlLabel-BFsduQtA.js";import"./Divider-QfXlYK88.js";import"./index-CwCAxaav.js";const U=a=>{var C,_,F,E,y,b;const f=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","DG","Download License"],g=f.indexOf(a.assigned_group),c=a.applicationassignment||[],d=(()=>{if(c.length>1){const s=c[c.length-2];return f.indexOf(s.assigned_group)}return-1})(),w=d!==-1&&d>g;c.find(s=>f.indexOf(s.assigned_group)===d);const R=s=>new Intl.NumberFormat("en-PK",{style:"currency",currency:"PKR",minimumFractionDigits:2}).format(s),A=a.applicationassignment.filter(s=>s.assigned_group===a.assigned_group),u=A.reduce((s,l)=>new Date(l.updated_at).getTime()>new Date(s.updated_at).getTime()?l:s,A[0]),I=u?(C=u.updated_at)==null?void 0:C.substring(0,16):"N/A";let N="N/A";if(u&&u.updated_at){const s=new Date(u.updated_at),x=new Date-s;N=Math.floor(x/(1e3*60*60*24))}let O="N/A";if((_=a.submittedapplication)!=null&&_.created_at&&((F=a.submittedapplication)!=null&&F.created_at)){const s=new Date((E=a.submittedapplication)==null?void 0:E.created_at),x=new Date-s;O=Math.floor(x/(1e3*60*60*24))}const j=a.applicantfees?a.applicantfees.reduce((s,l)=>s+parseFloat(l.fee_amount||0),0):0,T=a.applicantfees?a.applicantfees.filter(s=>s.is_settled).reduce((s,l)=>s+parseFloat(l.fee_amount||0),0):0;return{id:a.id,application_Submission_Time:((b=(y=a.submittedapplication)==null?void 0:y.created_at)==null?void 0:b.substring(0,16))||"N/A",duration:O||"N/A",tracking_number:a.tracking_number,first_name:a.first_name,mobile_no:a.mobile_no,application_status:a.application_status,assigned_group:a.assigned_group,group_assignment_time:I,group_assignment_days:N,total_fee_amount:R(j.toFixed(2)),verified_fee_amount:R(T.toFixed(2)),is_assigned_back:w?"Yes":"No"}},V=a=>a.map(f=>{const g=U(f);return Object.keys(g).forEach(c=>{(g[c]===void 0||g[c]===null)&&(g[c]="N/A")}),g}),W=()=>{const[a,f]=r.useState([]),[g,c]=r.useState([]),[d,w]=r.useState(null),[R,A]=r.useState(0),[u,I]=r.useState(null),[N,O]=r.useState({}),[j,T]=r.useState(null),[C,_]=r.useState(!1),[F,E]=r.useState([]);console.log(u);const y=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","DG","Download License"],b={APPLICANT:"Applicant",LSO:"LSO",LSO1:"Sana",LSO2:"Qaisar",LSO3:"Ameer",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO",DG:"DG","Download License":"Download License"},s=z(e=>e.user.authority)||[],l=async e=>{console.log("matched group",e);try{if(_(!0),T(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const n=e==="LSO1"?1:e==="LSO2"?2:0,m=((await v.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:"LSO"}})).data||[]).filter(o=>{var S;return((S=o.submittedapplication)==null?void 0:S.id)%3===n}),D=x(m);f(D.flattenedData),c(D.columns)}else{const i=(await v.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],m=x(i);f(m.flattenedData),c(m.columns)}}catch(n){console.error("Error fetching filtered data:",n),f([]),c([])}finally{_(!1)}},x=e=>{const n=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","duration","remarks","group_assignment_days","total_fee_amount","verified_fee_amount","is_assigned_back"],i=V(e),m=i[0],D=[...Object.keys(m).filter(o=>n.includes(o)).map(o=>{let S=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(o)?S=120:["first_name"].includes(o)&&(S=180),o==="is_assigned_back"?{accessorKey:o,header:"Assigned Back",size:S,Filter:({column:p})=>t.jsxs("select",{value:p.getFilterValue()||"",onChange:h=>p.setFilterValue(h.target.value||void 0),style:{width:"100%",padding:"4px"},children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"Yes",children:"Yes"}),t.jsx("option",{value:"",children:"No"})]}),filterFn:(p,h,L)=>L===""||p.original[o]===L,Cell:({cell:p,row:h})=>{const L=h.original.id,k=h.original.is_assigned_back,G=`/spuid-review/${L}`;return t.jsx("a",{href:G,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:k==="Yes"?"red":"blue",textDecoration:"underline"},children:p.getValue()||"-"})}}:{accessorKey:o,header:o.replace(/_/g," ").replace(/\b\w/g,p=>p.toUpperCase()),size:S,Cell:({cell:p,row:h})=>{const L=h.original.id,k=h.original.is_assigned_back,G=`/spuid-review/${L}`;return t.jsx("a",{href:G,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:k==="Yes"?"red":"blue",textDecoration:"underline"},children:p.getValue()||"-"})}}})];return{flattenedData:i,columns:D}},M=P();return r.useEffect(()=>{(async()=>{_(!0);try{const n=await v.get("/pmc/report-fee/");E(n.data)}catch(n){console.error("Error fetching fee statistics:",n)}finally{_(!1)}})()},[]),r.useEffect(()=>{const e=y.find(n=>s.includes(n));T(e)},[s]),r.useEffect(()=>{(async()=>{_(!0);try{const i=await v.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{M("/error")}try{let i=[];try{i=(await v.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],w(i.map(o=>o.name))}catch(D){console.error("Error fetching user groups:",D),w([])}console.log("groupsResponse",i);const m=await v.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});O(m.data)}catch(i){console.error("Error fetching data:",i)}finally{_(!1)}})(),I(25);const n=y.indexOf("LSO");n!==-1&&A(n)},[]),r.useEffect(()=>{console.log("userGroups:",d),d&&!d.includes("Super")&&M("/home")},[d,M]),r.useEffect(()=>{const e=Object.keys(b).find(n=>s.includes(n));l(e)},[s]),console.log("selectedRowId:",u),console.log(u),t.jsxs("div",{children:[t.jsx("div",{className:"tiles-container",children:Object.entries(N).map(([e,n])=>t.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:j===e?"#007BFF":"#f8f9fa",color:j===e?"#fff":"#000"},onClick:()=>l(e),children:[t.jsx("h3",{children:b[e]||e})," ",t.jsx("p",{children:n})]},e))}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:F.map((e,n)=>{const i=m=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(m);return t.jsxs("div",{className:"bg-white shadow-md rounded-lg p-4 border border-gray-300",children:[t.jsxs("h4",{className:"text-xl font-semibold text-gray-700 text-center",children:["Fee amount till ",e.till]}),t.jsxs("div",{className:"mt-3 flex justify-around text-center",children:[t.jsxs("p",{className:"text-sm text-gray-600",children:["Received: ",t.jsx("br",{}),t.jsx("span",{className:"font-bold text-blue-600",children:i(e.fee_received)})]}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Verified: ",t.jsx("br",{}),t.jsx("span",{className:"font-bold text-green-600",children:i(e.fee_verified)})]}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Unverified: ",t.jsx("br",{}),t.jsx("span",{className:"font-bold text-red-600",children:i(e.fee_unverified)})]})]})]},n)})}),t.jsx("div",{className:"mb-4",children:t.jsxs("h3",{children:[d&&d.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),t.jsx("div",{className:"mb-2",children:t.jsx("h6",{className:"text-red-500",children:"Records highlighted in red require immediate attention, as they have been returned from a next step."})}),C?t.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[t.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),t.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):t.jsx(B,{columns:[...g],data:a.map(e=>({...e,assigned_group_title:b[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:200,minSize:1,size:50},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},u)]})};export{W as default};
