import{r as i,V as N,j as r,A as S}from"./index-BUja0691.js";import{M as z}from"./index.esm-DuHCNrHJ.js";import"./TextField-D_rs7nxK.js";import"./Divider-CLlu8qwH.js";import"./FormControlLabel-CUE3rA3Y.js";import"./Autocomplete-Bzlk8W7Y.js";import"./index-Z6aWpTV9.js";const I=t=>{var D,h,d;const u=t.applicationassignment.filter(s=>s.assigned_group===t.assigned_group),n=u.reduce((s,c)=>new Date(c.updated_at).getTime()>new Date(s.updated_at).getTime()?c:s,u[0]),l=n?(D=n.updated_at)==null?void 0:D.substring(0,16):"N/A",o=t.applicantfees?t.applicantfees.reduce((s,c)=>s+parseFloat(c.fee_amount||0),0):0,_=t.applicantfees?t.applicantfees.filter(s=>s.is_settled).reduce((s,c)=>s+parseFloat(c.fee_amount||0),0):0;return{id:t.id,application_Submission_Time:((d=(h=t.submittedapplication)==null?void 0:h.created_at)==null?void 0:d.substring(0,16))||"N/A",tracking_number:t.tracking_number,first_name:t.first_name,mobile_no:t.mobile_no,application_status:t.application_status,assigned_group:t.assigned_group,group_assignment_time:l,total_fee_amount:o.toFixed(2),verified_fee_amount:_.toFixed(2)}},j=t=>t.map(u=>{const n=I(u);return Object.keys(n).forEach(l=>{(n[l]===void 0||n[l]===null)&&(n[l]="N/A")}),n}),K=()=>{const[t,u]=i.useState([]),[n,l]=i.useState([]),[o,_]=i.useState(null),[D,h]=i.useState(0),[d,s]=i.useState(null),[c,w]=i.useState({}),[A,O]=i.useState(null);console.log(d);const v=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],b={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},R=async e=>{try{O(e);const a=(await S.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],m=E(a,!!o.length,o[0]);u(m.flattenedData),l(m.columns)}catch(p){console.error("Error fetching filtered data:",p),u([]),l([])}},E=(e,p,a)=>{const m=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks","group_assignment_time","total_fee_amount","verified_fee_amount"],g=j(e),x=g[0];console.log(e);const F=[...Object.keys(x).filter(f=>m.includes(f)).map(f=>{let C=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(f)?C=120:["first_name"].includes(f)&&(C=180),{accessorKey:f,header:f.replace(/_/g," ").replace(/\b\w/g,L=>L.toUpperCase()),size:C,Cell:({cell:L,row:M})=>{const y=`/spuid-review/${M.original.id}?group=${a}`;return r.jsx("a",{href:y,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:L.getValue()||"-"})}}})];return{flattenedData:g,columns:F}},T=N();return i.useEffect(()=>{(async()=>{try{const a=await S.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{T("/error")}try{let a=[];try{a=(await S.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],_(a.map(x=>x.name))}catch(g){console.error("Error fetching user groups:",g),_([])}console.log("groupsResponse",a);const m=await S.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});w(m.data)}catch(a){console.error("Error fetching data:",a)}})(),s(25);const p=v.indexOf("LSO");p!==-1&&h(p)},[]),i.useEffect(()=>{console.log("userGroups:",o),o&&!o.includes("Super")&&T("/home")},[o,T]),console.log("selectedRowId:",d),console.log(d),r.jsxs("div",{children:[r.jsx("div",{className:"tiles-container",children:Object.entries(c).map(([e,p])=>r.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:A===e?"#007BFF":"#f8f9fa",color:A===e?"#fff":"#000"},onClick:()=>R(e),children:[r.jsx("h3",{children:b[e]||e})," ",r.jsx("p",{children:p})]},e))}),r.jsx("div",{className:"mb-4",children:r.jsxs("h3",{children:[o&&o.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),r.jsx(z,{columns:[...n],data:t.map(e=>({...e,assigned_group_title:b[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:200,minSize:1,size:50},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},d)]})};export{K as default};
