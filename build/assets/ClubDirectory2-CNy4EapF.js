import{r,j as e,A as C}from"./index-DpbVdvho.js";import{M as T,V as z,T as R,O as A,a as N,b as x,S as v,e as B,F as f,c as g,f as $,d as G,P as H,C as K}from"./OSM-Bx5l-N5p.js";import{G as Z}from"./GeoJSON-BAwyf57_.js";import{M as I}from"./index.esm-CouJZmTO.js";import{q as O,h as q,m as J,n as W,o as Q,p as U}from"./index-oQw3Caad.js";import{M as X}from"./TextField-DahAofim.js";import"./DefaultPropsProvider-Dfkjrbnv.js";import"./Autocomplete-NB6zubAT.js";import"./FormControlLabel-GMnp0iW5.js";import"./Divider-1nH90sM6.js";import"./index-C08Ukbpq.js";const de=()=>{const b=r.useRef(null),[a,S]=r.useState(null),[n,k]=r.useState(null),[m,_]=r.useState(null),[c,V]=r.useState([]),[i,p]=r.useState(null),[D,h]=r.useState(!1),[w,F]=r.useState([]),[l,d]=r.useState(null);r.useEffect(()=>{const t=new T({target:b.current,layers:[new R({source:new A})],view:new z({zoom:7,center:[8127130,3658593]})}),s=new N({source:new x}),o=new N({source:new x});return t.addLayer(s),t.addLayer(o),k(s),_(o),S(t),()=>t.setTarget(null)},[]),r.useEffect(()=>{if(!n||!a)return;(async()=>{h(!0);try{const s=await C.get("/pmc/idm_districts-club-counts/");F(s.data.features);const o=new x({features:new Z().readFeatures(s.data,{featureProjection:"EPSG:3857"})});n.setSource(o),a.getView().fit(o.getExtent(),{padding:[50,50,50,50],duration:500})}catch(s){console.error("Error fetching districts:",s)}finally{h(!1)}})()},[n,a]),r.useEffect(()=>{n&&n.setStyle(t=>{const s=t.get("id")===i;return new v({stroke:new g({color:s?"red":"blue",width:s?3:2}),fill:new f({color:s?"rgba(255,0,0,0.1)":"rgba(0,0,255,0.1)"}),text:new B({text:`${t.get("name")} (${t.get("club_count")})`,font:"12px sans-serif",fill:new f({color:"#000"}),stroke:new g({color:"#fff",width:3})})})})},[n,i]),r.useEffect(()=>{(async()=>{const s=await C.get("/pmc/idm_clubs_geojson_all/");V(s.data.features)})()},[]),r.useEffect(()=>{if(!m)return;const t=m.getSource();t.clear(),c.forEach(s=>{const o=$(s.geometry.coordinates),u=new G({geometry:new H(o)});u.setStyle(new v({image:new K({radius:5,fill:new f({color:"#22C55E"}),stroke:new g({color:"#fff",width:1})})})),t.addFeature(u)})},[m,c]),r.useEffect(()=>{if(!a||!n)return;const t=s=>{const o=a.getFeaturesAtPixel(s.pixel);if(o.length>0){const u=o[0],j=u.get("id");i===j?(p(null),a.getView().setCenter([8127130,3658593]),a.getView().setZoom(7)):(p(j),a.getView().fit(u.getGeometry().getExtent(),{padding:[50,50,50,50],maxZoom:10}))}else p(null),a.getView().setCenter([8127130,3658593]),a.getView().setZoom(7)};return a.on("click",t),()=>a.un("click",t)},[a,n,i]);const M=r.useMemo(()=>i?c.filter(t=>t.properties.district_id===i):c,[i,c]),E=r.useMemo(()=>[{accessorKey:"properties.district",header:"District",size:150,Cell:({cell:t})=>e.jsx("a",{href:"#",className:"text-blue-500 hover:underline",onClick:s=>{s.preventDefault(),d(t.row.original.properties)},children:t.getValue()})},{accessorKey:"properties.name",header:"School Name",size:225,Cell:({cell:t})=>e.jsx("a",{href:"#",className:"text-blue-500 hover:underline",onClick:s=>{s.preventDefault(),d(t.row.original.properties)},children:t.getValue()})},{accessorKey:"properties.address",header:"Address",size:225,Cell:({cell:t})=>e.jsx("a",{href:"#",className:"text-blue-500 hover:underline",onClick:s=>{s.preventDefault(),d(t.row.original.properties)},children:t.getValue()})},{accessorKey:"properties.head_name",header:"Head Name",size:200,Cell:({cell:t})=>e.jsx("a",{href:"#",className:"text-blue-500 hover:underline",onClick:s=>{s.preventDefault(),d(t.row.original.properties)},children:t.getValue()})}],[]),L=r.useMemo(()=>{const t=[...w].sort((s,o)=>o.properties.club_count-s.properties.club_count).slice(0,3);return[{properties:{name:"Total Clubs",club_count:c.length,id:null}},...t]},[w,c]),y=[{bgColor:"bg-gray-500",icon:e.jsx(q,{className:"text-white text-3xl"})},{bgColor:"bg-orange-500",icon:e.jsx(J,{className:"text-white text-3xl"})},{bgColor:"bg-blue-500",icon:e.jsx(W,{className:"text-white text-3xl"})},{bgColor:"bg-yellow-500",icon:e.jsx(Q,{className:"text-white text-3xl"})},{bgColor:"bg-green-500",icon:e.jsx(U,{className:"text-white text-3xl"})}],P=t=>{d(t.original.properties)};return e.jsxs("div",{className:"flex flex-col p-4 gap-4",children:[e.jsx("div",{className:"grid grid-cols-4 gap-4",children:L.map((t,s)=>e.jsx("div",{className:`shadow-md rounded p-6 w-full cursor-pointer transition 
                ${i===null||i===t.properties.id?"opacity-100":"opacity-50"}
                ${y[s].bgColor}
                `,onClick:()=>p(t.properties.id),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[y[s].icon,e.jsx("h2",{className:"text-2xl font-bold text-white",children:t.properties.name}),e.jsx("p",{className:"text-2xl font-bold text-white",children:t.properties.club_count})]})},s))}),e.jsxs("div",{className:"flex flex-row p-4 gap-4",children:[e.jsxs("div",{className:"relative w-1/2",children:[D&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-10",children:e.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-blue-500 border-t-transparent rounded-full"})}),e.jsx("div",{ref:b,style:{height:"850px"}})]}),e.jsx("div",{style:{flex:1},children:e.jsx(I,{columns:E,data:M,initialState:{pagination:{pageSize:15}},enableZebraStripes:!0,enableColumnResizing:!0,muiTableBodyRowProps:({row:t})=>({onClick:()=>P(t),style:{cursor:"pointer"},sx:{"&:nth-of-type(even)":{backgroundColor:"#f9f9f9"},"&:hover":{backgroundColor:"#e0f7fa"}}}),muiTableProps:{sx:{border:"1px solid #ddd"}},muiTableHeadCellProps:{sx:{backgroundColor:"#f5f5f5",fontWeight:"bold",borderBottom:"2px solid #ccc",textAlign:"center"}},muiTableBodyCellProps:{sx:{borderRight:"1px solid #ddd",padding:"10px"}}})})]}),e.jsx(X,{open:!!l,onClose:()=>d(null),"aria-labelledby":"club-details-modal",children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6 w-96 max-w-lg",children:l&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:l.name}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"District:"})," ",l.district]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Address:"})," ",l.address]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Head Name:"})," ",l.head_name]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Head Mobile:"})," ",l.head_mobile]}),l.notification_path&&e.jsxs("div",{className:"flex items-center space-x-2 border-t pt-3",children:[e.jsx(O,{size:24,className:"text-blue-500 cursor-pointer transition-transform transform hover:scale-110",onClick:()=>window.open(`/api/pmc/media${l.notification_path}`,"_blank")}),e.jsx("a",{href:`/api/pmc/media${l.notification_path}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 font-semibold hover:underline",children:"View Notification"})]})]}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx("button",{onClick:()=>d(null),className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200",children:"Close"})})]})})})}),";"]})};export{de as default};
