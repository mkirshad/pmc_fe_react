import{a3 as f,a4 as u,A as d}from"./index-Dei5semP.js";const l=f()(u((s,a)=>({reports:[],loading:!1,error:null,fetchReports:async()=>{a().reports.some(t=>t.syncStatus)&&console.warn("Skipping fetch: Unsynced data exists"),s({loading:!0,error:null});try{if(navigator.onLine){const t=await d.get("/pmc/inspection-report/");s({reports:t.data})}}catch(t){console.error("Error fetching reports:",t),s({error:"Failed to fetch reports"})}finally{s({loading:!1})}},updateReport:(n,t)=>{console.log("its in update state"),s(e=>({reports:e.reports.map(o=>o.id===n?{...o,...t,syncStatus:"patch"}:o)}))},addNewReport:n=>{const t=`temp-${Date.now()}`;s(e=>({reports:[...e.reports,{...n,id:t,syncStatus:"post"}]}))},syncReports:async()=>{const{reports:n}=a(),t=n.filter(e=>e.syncStatus);if(t.length===0){console.log("No unsynced reports. Fetching fresh data..."),a().fetchReports();return}for(const e of t)try{let o,i=e,p={};if(e.hasFileUpload){const r=new FormData;r.append("id",e.id),r.append("business_name",e.businessName),r.append("license_number",e.licenseNumber||""),e.file&&r.append("file",e.file),i=r,p={"Content-Type":"multipart/form-data"}}e.syncStatus==="post"?navigator.onLine&&(o=await d.post("/pmc/inspection-report/",i,{headers:p}),e.id=o.data.id):e.syncStatus==="patch"&&navigator.onLine&&(o=await d.patch(`/pmc/inspection-report/${e.id}/`,i,{headers:p})),console.log("[✅ Synced]:",o.status,e.id),s(r=>({reports:r.reports.map(c=>c.id===e.id?{...c,syncStatus:void 0}:c)}))}catch(o){console.error("[❌ Sync Failed]:",e.id,o)}l.getState().fetchReports()},resetReports:()=>s({reports:[]})}),{name:"inspection-reports",getStorage:()=>localStorage}));typeof window<"u"&&window.addEventListener("online",async()=>{console.log("[🔄 Online] Syncing stored reports..."),l.getState().syncReports()});export{l as u};
