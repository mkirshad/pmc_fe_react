import{r as o,j as s,A,k as E}from"./index-DWSE3bw1.js";import{T as M}from"./index-DERv62CJ.js";import{j as R,k as z}from"./isNil-BBXphVgJ.js";import{M as B,E as L}from"./index.esm-_aPAFk4H.js";import{u as K,F as O,a as p,C as f}from"./index.esm-Bf7DL-pC.js";import{P as I}from"./PasswordInput-Bj7yn6D4.js";import{B as F}from"./Button-pJxQ12i0.js";import{t as D,z as d}from"./index-BGqhX8az.js";import{C as H}from"./Card-CErQfn-0.js";import{I as _}from"./Input-BWZgiRlm.js";import{I as q}from"./Autocomplete-Da5unBb6.js";import"./useControllableState-DfO1LfHJ.js";import"./classNames-BdCaQW-a.js";import"./TextField-Bq1ri3Nl.js";import"./DefaultPropsProvider-Diunql6C.js";import"./FormControlLabel-CPNxKCyR.js";import"./Divider-CrPd00pe.js";import"./index-DdMS0Oip.js";import"./index-BBWX0UV8.js";const G=d.object({username:d.string().min(3,"Username must be at least 3 characters"),first_name:d.string().optional(),last_name:d.string().optional(),password:d.string().optional(),confirmPassword:d.string().optional()}).refine(e=>!e.password||e.password===e.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]}),V=({selectedUser:e,setSelectedUser:x})=>{var b,t,y,C,P;const[m,c]=o.useState(!1),[h,l]=o.useState(null),{handleSubmit:u,formState:{errors:a},control:n,reset:i}=K({resolver:D(G),defaultValues:{username:"",first_name:"",last_name:"",password:"",confirmPassword:""}}),g=!!(e!=null&&e.id);o.useEffect(()=>{i({username:(e==null?void 0:e.username)||"",first_name:(e==null?void 0:e.first_name)||"",last_name:(e==null?void 0:e.last_name)||"",password:"",confirmPassword:""}),l(null)},[e,i]);const v=async r=>{var S,N;c(!0),l(null);try{const j={user_id:e?e.id:null,username:r.username,first_name:r.first_name,last_name:r.last_name,password:r.password?r.password:void 0};await A.post("/accounts/create-update-inpsector-user/",j),alert(e?"User updated successfully!":"User created successfully!"),x(null),i()}catch(j){console.error("Error updating/creating user:",j),l(((N=(S=j.response)==null?void 0:S.data)==null?void 0:N.error)||"An unexpected error occurred. Please try again.")}finally{c(!1)}},w=()=>{x(null),i()};return s.jsx(H,{children:s.jsxs(O,{onSubmit:u(v),children:[s.jsx("div",{className:"grid md:grid-cols-1 gap-4",children:s.jsx(p,{label:"Username",invalid:!!a.username,errorMessage:(b=a.username)==null?void 0:b.message,children:s.jsx(f,{name:"username",type:"text",control:n,render:({field:r})=>s.jsx(_,{...r,placeholder:"Username",readOnly:g})})})}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsx(p,{label:"First Name",invalid:!!a.first_name,errorMessage:(t=a.first_name)==null?void 0:t.message,children:s.jsx(f,{name:"first_name",type:"text",control:n,render:({field:r})=>s.jsx(_,{...r,placeholder:"First Name"})})}),s.jsx(p,{label:"Last Name",invalid:!!a.last_name,errorMessage:(y=a.last_name)==null?void 0:y.message,children:s.jsx(f,{name:"last_name",type:"text",control:n,render:({field:r})=>s.jsx(_,{...r,placeholder:"Last Name"})})})]}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsx(p,{label:"Password (Optional)",invalid:!!a.password,errorMessage:(C=a.password)==null?void 0:C.message,children:s.jsx(f,{name:"password",control:n,render:({field:r})=>s.jsx(I,{...r,placeholder:"Enter new password"})})}),s.jsx(p,{label:"Confirm Password (Optional)",invalid:!!a.confirmPassword,errorMessage:(P=a.confirmPassword)==null?void 0:P.message,children:s.jsx(f,{name:"confirmPassword",control:n,render:({field:r})=>s.jsx(I,{...r,placeholder:"Confirm password"})})})]}),h&&s.jsxs("div",{className:"text-red-500 text-sm mb-3",children:["⚠️ ",h]}),s.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[s.jsx(F,{type:"submit",block:!0,loading:m,disabled:m,variant:"solid",children:m?"Saving...":e?"Update User":"Create User"}),s.jsx(F,{type:"button",block:!0,variant:"outline",onClick:w,children:"Reset Form"})]})]})})},{TabNav:T,TabList:W,TabContent:k}=M,us=()=>{const[e,x]=o.useState([]),[m,c]=o.useState(!1),[h,l]=o.useState(null),[u,a]=o.useState("tab1"),n=E(t=>t.user.district_id)||null,i=E(t=>t.user.district_name)||"",g=()=>{n&&(c(!0),A.get("/accounts/list-inspectors/").then(t=>{x(t.data)}).catch(t=>{console.error("Error fetching inspectors:",t)}).finally(()=>{c(!1)}))};o.useEffect(()=>{g()},[n]),o.useEffect(()=>{u==="tab1"&&g()},[u]);const v=t=>{l(t),a("tab2")},w=()=>{l(null),a("tab1")},b=[{accessorKey:"id",header:"ID",size:100},{accessorKey:"username",header:"Username",size:200},{accessorKey:"first_name",header:"First Name",size:200},{accessorKey:"last_name",header:"Last Name",size:200},{accessorKey:"edit",header:"Actions",size:200,Cell:({row:t})=>s.jsx(q,{onClick:()=>v(t.original),children:s.jsx(L,{})})}];return s.jsx("div",{children:s.jsxs(M,{value:u,onChange:a,children:[" ",s.jsxs(W,{children:[s.jsxs(T,{value:"tab1",icon:s.jsx(R,{}),children:["List Inspectors (",i,")"]}),s.jsxs(T,{value:"tab2",icon:s.jsx(z,{}),children:["Add/Edit Inspector (",i,")"]})]}),s.jsxs("div",{className:"p-4",children:[s.jsx(k,{value:"tab1",children:m?s.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),s.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):s.jsx(B,{columns:b,data:e,enableColumnResizing:!0,enablePagination:!0,initialState:{showColumnFilters:!1},muiTableHeadCellProps:{sx:{backgroundColor:"#f5f5f5",fontWeight:"bold",borderBottom:"2px solid #ccc",textAlign:"center"}},muiTableBodyCellProps:{sx:{borderRight:"1px solid #ddd",padding:"10px"}},muiTableBodyRowProps:{sx:{"&:nth-of-type(even)":{backgroundColor:"#f9f9f9"},"&:hover":{backgroundColor:"#e0f7fa"}}}})}),s.jsx(k,{value:"tab2",children:s.jsx(V,{selectedUser:h,setSelectedUser:w})})]})]})})};export{us as default};
