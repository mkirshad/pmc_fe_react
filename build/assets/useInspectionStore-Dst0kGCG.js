import{a4 as d,a5 as f,A as c}from"./index-CVQ68EyR.js";const y=d()(f((s,l)=>({reports:[],loading:!1,error:null,fetchReports:async()=>{l().reports.some(t=>t.syncStatus)&&console.warn("Skipping fetch: Unsynced data exists"),s({loading:!0,error:null});try{if(navigator.onLine){const t=await c.get("/pmc/inspection-report/");s({reports:t.data})}}catch(t){console.error("Error fetching reports:",t),s({error:"Failed to fetch reports"})}finally{s({loading:!1})}},updateReport:(n,t)=>{console.log("its in update state"),console.log(n),console.log(t),s(e=>({reports:e.reports.map(o=>o.id==n?{...o,...t,syncStatus:"patch"}:o)}))},addNewReport:n=>{const t=`temp-${Date.now()}`;s(e=>({reports:[...e.reports,{...n,id:t,syncStatus:"post"}]}))},syncReports:async()=>{console.log("sync started:");const{reports:n}=l(),t=n.filter(e=>e.syncStatus);if(t.length===0){console.log("No unsynced reports. Fetching fresh data...");return}for(const e of t)try{let o,a=e,i={};if(e.hasFileUpload){const r=new FormData;r.append("id",e.id),r.append("business_name",e.businessName),r.append("license_number",e.licenseNumber||""),e.file&&r.append("file",e.file),a=r,i={"Content-Type":"multipart/form-data"}}e.syncStatus==="post"?navigator.onLine&&(o=await c.post("/pmc/inspection-report/",a,{headers:i}),e.id=o.data.id):e.syncStatus==="patch"&&navigator.onLine&&(o=await c.patch(`/pmc/inspection-report/${e.id}/`,a,{headers:i})),console.log("[âœ… Synced]:",o.status,e.id),s(r=>({reports:r.reports.map(p=>p.id===e.id?{...p,syncStatus:void 0}:p)}))}catch(o){console.error("[âŒ Sync Failed]:",e.id,o)}},resetReports:()=>s({reports:[]})}),{name:"inspection-reports",getStorage:()=>localStorage}));typeof window<"u"&&window.addEventListener("online",async()=>{console.log("[ðŸ”„ Online] Syncing stored reports..."),y.getState().syncReports()});export{y as u};
