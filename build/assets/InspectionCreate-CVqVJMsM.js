import{r as w,A as ut,j as l,$ as pe,l as Ne,i as _t,a3 as dt,X as St,a1 as bt}from"./index-DKOm2JUA.js";import{B as Ge}from"./Button-Bv2-jwyq.js";import{f as Ct,t as wt,N as Ft}from"./toast-BVJ8WT1O.js";import{u as ft,b as ne,a as U,C as K,F as Dt}from"./index.esm-DR7rrSsi.js";import{S as He,C as ve,B as jt}from"./index-1VuusfkI.js";import{C as Et}from"./Card-BanD5s_n.js";import{I as z}from"./Input-DMJknHP2.js";import{e as Tt,p as Rt,g as Pt,s as Nt,h as Bt,R as It,a as Ue,b as Pe,i as Ye,j as Ze,k as ze,E as Je,l as Q,m as Me,d as Ke,P as qe,n as Te,o as de,q as ee,r as Xe,u as J,v as Be,w as At,x as Mt,y as Vt,z as We,A as kt,B as Lt,D as Ot,H as Gt,I as Ut,f as Ve,S as Qe,C as Kt,c as et,F as qt,M as Wt,V as $t,T as Ht,O as Yt,J as Zt,t as zt,G as Jt}from"./terraformer-wkt-parser-BXLJ7n6u.js";import{A as Xt,C as Qt}from"./Autocomplete-DQU4a1-T.js";import{T as en}from"./TextField-DgJFoVIF.js";import{t as tn,z as T}from"./index-C8Y2NiOE.js";import{C as nn}from"./ConfirmDialog-D3pu9Q64.js";import{B as rn}from"./index-CXfioCBA.js";import{u as an}from"./useInspectionStore-B2Mp0fzE.js";import"./classNames-B4ey2C-7.js";import"./StatusIcon-Bg4FS83g.js";import"./index-k8T4JNHi.js";import"./CloseButton-CVkVNcHm.js";import"./index-CM8vwpMr.js";import"./DefaultPropsProvider-DoHP1UXG.js";import"./index-Dh9c5PxJ.js";import"./index-CCbGUrOo.js";import"./index-B9553cTr.js";import"./_getPrototype-9FG-cTBD.js";const tt=0,_e=1,nt=[0,0,0,0],ye=[],ke={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Le extends Ot{constructor(e,n,r){super(e),this.features=n,this.mapBrowserEvent=r}}class sn extends Tt{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Rt,this.defaultDeleteCondition_=function(r){return Pt(r)&&Nt(r)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Bt,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new It,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ue({source:new Pe({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:ln(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let n;if(e.features?n=e.features:e.source&&(this.source_=e.source,n=new Ye(this.source_.getFeatures()),this.source_.addEventListener(Ze.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Ze.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!n)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=n,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(ze.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(ze.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const n=e.getGeometry();if(n){const i=this.SEGMENT_WRITERS_[n.getType()];i&&i(e,n)}const r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(r.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(Je.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,n){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Ye;const r=this.featuresBeingModified_.getArray();for(let i=0,a=n.length;i<a;++i){const s=n[i].feature;s&&!r.includes(s)&&this.featuresBeingModified_.push(s)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Le(ke.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(Je.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const n=this.rBush_,r=[];n.forEach(function(i){e===i.feature&&r.push(i)});for(let i=r.length-1;i>=0;--i){const a=r[i];for(let s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===a&&this.dragSegments_.splice(s,1);n.remove(a)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const n=e.target;this.removeFeature_(n),this.addFeature_(n)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,n){const r=n.getCoordinates(),i={feature:e,geometry:n,segment:[r,r]};this.rBush_.insert(n.getExtent(),i)}writeMultiPointGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i],o={feature:e,geometry:n,depth:[i],index:i,segment:[s,s]};this.rBush_.insert(n.getExtent(),o)}}writeLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length-1;i<a;++i){const s=r.slice(i,i+2),o={feature:e,geometry:n,index:i,segment:s};this.rBush_.insert(Q(s),o)}}writeMultiLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,c=s.length-1;o<c;++o){const y=s.slice(o,o+2),u={feature:e,geometry:n,depth:[i],index:o,segment:y};this.rBush_.insert(Q(y),u)}}}writePolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,c=s.length-1;o<c;++o){const y=s.slice(o,o+2),u={feature:e,geometry:n,depth:[i],index:o,segment:y};this.rBush_.insert(Q(y),u)}}}writeMultiPolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,c=s.length;o<c;++o){const y=s[o];for(let u=0,x=y.length-1;u<x;++u){const g=y.slice(u,u+2),m={feature:e,geometry:n,depth:[o,i],index:u,segment:g};this.rBush_.insert(Q(g),m)}}}}writeCircleGeometry_(e,n){const r=n.getCenter(),i={feature:e,geometry:n,index:tt,segment:[r,r]},a={feature:e,geometry:n,index:_e,segment:[r,r]},s=[i,a];i.featureSegments=s,a.featureSegments=s,this.rBush_.insert(Me(r),i);let o=n;this.rBush_.insert(o.getExtent(),a)}writeGeometryCollectionGeometry_(e,n){const r=n.getGeometriesArray();for(let i=0;i<r.length;++i){const a=r[i],s=this.SEGMENT_WRITERS_[a.getType()];s(e,a)}}createOrUpdateVertexFeature_(e,n,r,i){let a=this.vertexFeature_;return a?a.getGeometry().setCoordinates(e):(a=new Ke(new qe(e)),this.vertexFeature_=a,this.overlay_.getSource().addFeature(a)),a.set("features",n),a.set("geometries",r),a.set("existing",i),a}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let n;return!e.map.getView().getInteracting()&&e.type==Te.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Te.SINGLECLICK||!this.ignoreNextSingleClick_?n=this.removePoint():n=!0),e.type==Te.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!n}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(!n)return;this.getMap().getView().getProjection();const r=[],i=n.getGeometry().getCoordinates(),a=Q([i]),s=this.rBush_.getInExtent(a),o={};s.sort(on);for(let c=0,y=s.length;c<y;++c){const u=s[c],x=u.segment;let g=de(u.geometry);const m=u.depth;if(m&&(g+="-"+m.join("-")),o[g]||(o[g]=new Array(2)),u.geometry.getType()==="Circle"&&u.index===_e){const v=it(e,u);ee(v,i)&&!o[g][0]&&(this.dragSegments_.push([u,0]),o[g][0]=u);continue}if(ee(x[0],i)&&!o[g][0]){this.dragSegments_.push([u,0]),o[g][0]=u;continue}if(ee(x[1],i)&&!o[g][1]){if(o[g][0]&&o[g][0].index===0){let v=u.geometry.getCoordinates();switch(u.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":v=v[m[1]];case"Polygon":if(u.index!==v[m[0]].length-2)continue;break}}this.dragSegments_.push([u,1]),o[g][1]=u;continue}de(x)in this.vertexSegments_&&!o[g][0]&&!o[g][1]&&r.push(u)}return r}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([a])=>a));const n=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],i=[];for(let a=0,s=this.dragSegments_.length;a<s;++a){const o=this.dragSegments_[a],c=o[0],y=c.feature;r.includes(y)||r.push(y);const u=c.geometry;i.includes(u)||i.push(u);const x=c.depth;let g;const m=c.segment,v=o[1];for(;n.length<u.getStride();)n.push(m[v][n.length]);switch(u.getType()){case"Point":g=n,m[0]=n,m[1]=n;break;case"MultiPoint":g=u.getCoordinates(),g[c.index]=n,m[0]=n,m[1]=n;break;case"LineString":g=u.getCoordinates(),g[c.index+v]=n,m[v]=n;break;case"MultiLineString":g=u.getCoordinates(),g[x[0]][c.index+v]=n,m[v]=n;break;case"Polygon":g=u.getCoordinates(),g[x[0]][c.index+v]=n,m[v]=n;break;case"MultiPolygon":g=u.getCoordinates(),g[x[1]][x[0]][c.index+v]=n,m[v]=n;break;case"Circle":const S=u;if(m[0]=n,m[1]=n,c.index===tt)this.changingFeature_=!0,S.setCenter(n),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let C=Xe(J(S.getCenter()),J(n));S.setRadius(C),this.changingFeature_=!1}break}g&&this.setGeometryCoordinates_(u,g)}this.createOrUpdateVertexFeature_(n,r,i,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const n=e.coordinate,r=this.findInsertVerticesAndUpdateDragSegments_(n);if(r!=null&&r.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,r),this.vertexFeature_)){const i=this.vertexFeature_.getGeometry().getCoordinates();for(let a=r.length-1;a>=0;--a)this.insertVertex_(r[a],i);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let n=this.dragSegments_.length-1;n>=0;--n){const r=this.dragSegments_[n][0],i=r.geometry;if(i.getType()==="Circle"){const a=i,s=a.getCenter(),o=r.featureSegments[0],c=r.featureSegments[1];o.segment[0]=s,o.segment[1]=s,c.segment[0]=s,c.segment[1]=s,this.rBush_.update(Me(s),o);let y=a;this.rBush_.update(y.getExtent(),c)}else this.rBush_.update(Q(r.segment),r)}return this.featuresBeingModified_&&(this.dispatchEvent(new Le(ke.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const n=this.getMap(),r=n.getPixelFromCoordinate(e);n.getView().getProjection();const i=function(o,c){return rt(e,o)-rt(e,c)};let a,s;if(this.hitDetection_){const o=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;n.forEachFeatureAtPixel(r,(c,y,u)=>{u&&u.getType()==="Point"&&(u=new qe(Be(u.getCoordinates())));const x=u||c.getGeometry();if(x&&x.getType()==="Point"&&c instanceof Ke&&this.features_.getArray().includes(c)){s=x;const g=c.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:c,geometry:s,segment:[g,g]}]}return!0},{layerFilter:o})}if(!a){const o=At(Me(e,nt)),c=n.getView().getResolution()*this.pixelTolerance_,y=Mt(Vt(o,c,nt));a=this.rBush_.getInExtent(y)}if(a&&a.length>0){const o=a.sort(i)[0],c=o.segment;let y=it(e,o);const u=n.getPixelFromCoordinate(y);let x=Xe(r,u);if(s||x<=this.pixelTolerance_){const g={};if(g[de(c)]=!0,this.snapToPointer_||(this.delta_[0]=y[0]-e[0],this.delta_[1]=y[1]-e[1]),o.geometry.getType()==="Circle"&&o.index===_e)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(y,[o.feature],[o.geometry],this.snappedToVertex_);else{const m=n.getPixelFromCoordinate(c[0]),v=n.getPixelFromCoordinate(c[1]),S=We(u,m),C=We(u,v);if(x=Math.sqrt(Math.min(S,C)),this.snappedToVertex_=x<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(y=S>C?c[1]:c[0]),this.createOrUpdateVertexFeature_(y,[o.feature],[o.geometry],this.snappedToVertex_);const h={};h[de(o.geometry)]=!0;for(let E=1,P=a.length;E<P;++E){const A=a[E].segment;if(ee(c[0],A[0])&&ee(c[1],A[1])||ee(c[0],A[1])&&ee(c[1],A[0])){const I=de(a[E].geometry);I in h||(h[I]=!0,g[de(A)]=!0)}else break}}this.vertexSegments_=g;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,n){const r=e.segment,i=e.feature,a=e.geometry,s=e.depth,o=e.index;let c;for(;n.length<a.getStride();)n.push(0);switch(a.getType()){case"MultiLineString":c=a.getCoordinates(),c[s[0]].splice(o+1,0,n);break;case"Polygon":c=a.getCoordinates(),c[s[0]].splice(o+1,0,n);break;case"MultiPolygon":c=a.getCoordinates(),c[s[1]][s[0]].splice(o+1,0,n);break;case"LineString":c=a.getCoordinates(),c.splice(o+1,0,n);break;default:return!1}this.setGeometryCoordinates_(a,c);const y=this.rBush_;y.remove(e),this.updateSegmentIndices_(a,o,s,1);const u={segment:[r[0],n],feature:i,geometry:a,depth:s,index:o};y.insert(Q(u.segment),u),this.dragSegments_.push([u,1]);const x={segment:[n,r[1]],feature:i,geometry:a,depth:s,index:o+1};return y.insert(Q(x.segment),x),this.dragSegments_.push([x,0]),!0}updatePointer_(e){var n;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates()}getPoint(){var n;const e=(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates();return e?Be(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(Q([e])).some(({segment:r})=>ee(r[0],e)||ee(r[1],e))}removePoint(e){if(e&&(e=J(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=Te.POINTERDRAG){const n=this.lastPointerEvent_;this.willModifyFeatures_(n,this.dragSegments_.map(([i])=>i));const r=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Le(ke.MODIFYEND,this.featuresBeingModified_,n)),this.featuresBeingModified_=null,r}return!1}removeVertex_(){const e=this.dragSegments_,n={};let r=!1,i,a,s,o,c,y,u,x,g,m,v;for(c=e.length-1;c>=0;--c)s=e[c],m=s[0],v=de(m.feature),m.depth&&(v+="-"+m.depth.join("-")),v in n||(n[v]={}),s[1]===0?(n[v].right=m,n[v].index=m.index):s[1]==1&&(n[v].left=m,n[v].index=m.index+1);for(v in n){switch(g=n[v].right,u=n[v].left,y=n[v].index,x=y-1,u!==void 0?m=u:m=g,x<0&&(x=0),o=m.geometry,a=o.getCoordinates(),i=a,r=!1,o.getType()){case"MultiLineString":a[m.depth[0]].length>2&&(a[m.depth[0]].splice(y,1),r=!0);break;case"LineString":a.length>2&&(a.splice(y,1),r=!0);break;case"MultiPolygon":i=i[m.depth[1]];case"Polygon":i=i[m.depth[0]],i.length>4&&(y==i.length-1&&(y=0),i.splice(y,1),r=!0,y===0&&(i.pop(),i.push(i[0]),x=i.length-1));break}if(r){this.setGeometryCoordinates_(o,a);const S=[];if(u!==void 0&&(this.rBush_.remove(u),S.push(u.segment[0])),g!==void 0&&(this.rBush_.remove(g),S.push(g.segment[1])),u!==void 0&&g!==void 0){const C={depth:m.depth,feature:m.feature,geometry:m.geometry,index:x,segment:S};this.rBush_.insert(Q(C.segment),C)}this.updateSegmentIndices_(o,y,m.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return r}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(Q([e])).some(({segment:r})=>!(ee(r[0],e)||ee(r[1],e)))}insertPoint(e){var i;const n=e?J(e,this.getMap().getView().getProjection()):(i=this.vertexFeature_)==null?void 0:i.getGeometry().getCoordinates();return n?this.findInsertVerticesAndUpdateDragSegments_(n).reduce((a,s)=>a||this.insertVertex_(s,n),!1):!1}setGeometryCoordinates_(e,n){this.changingFeature_=!0,e.setCoordinates(n),this.changingFeature_=!1}updateSegmentIndices_(e,n,r,i){this.rBush_.forEachInExtent(e.getExtent(),function(a){a.geometry===e&&(r===void 0||a.depth===void 0||kt(a.depth,r))&&a.index>n&&(a.index+=i)})}}function on(t,e){return t.index-e.index}function rt(t,e,n){const r=e.geometry;if(r.getType()==="Circle"){let a=r;if(e.index===_e){const s=We(a.getCenter(),J(t)),o=Math.sqrt(s)-a.getRadius();return o*o}}const i=J(t);return ye[0]=J(e.segment[0]),ye[1]=J(e.segment[1]),Ut(i,ye)}function it(t,e,n){const r=e.geometry;if(r.getType()==="Circle"&&e.index===_e)return Be(r.getClosestPoint(J(t)));const i=J(t);return ye[0]=J(e.segment[0]),ye[1]=J(e.segment[1]),Be(Gt(i,ye))}function ln(){const t=Lt();return function(e,n){return t.Point}}const cn=({onLocationSelect:t})=>{const e=w.useRef(null),[n,r]=w.useState(null),[i,a]=w.useState(null),[s,o]=w.useState("Fetching..."),[c,y]=w.useState(null),[u,x]=w.useState({lat:null,lng:null});w.useEffect(()=>{const S=new Pe,C=new Pe,h=new Ke({geometry:new qe(Ve([74.3436,31.5497]))});h.setStyle(new Qe({image:new Kt({radius:7,fill:new qt({color:"red"}),stroke:new et({color:"white",width:2})})})),C.addFeature(h),a(h);const E=new Ue({source:C}),P=new Ue({source:S,style:new Qe({stroke:new et({color:"blue",width:2})})}),A=new Wt({target:e.current,layers:[new Ht({source:new Yt}),P,E],view:new $t({center:Ve([74.3436,31.5497]),zoom:12})});r(A),y(P),v(P),g(A,h);const I=new sn({source:C});return A.addInteraction(I),I.on("modifyend",Y=>{const $=Y.features.item(0).getGeometry().getCoordinates(),D=Zt($);x({lat:D[1],lng:D[0]}),m(D[0],D[1])}),()=>A.setTarget(null)},[]);const g=(S,C)=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(h=>{const E=Ve([h.coords.longitude,h.coords.latitude]);C.getGeometry().setCoordinates(E),S.getView().setCenter(E),S.getView().setZoom(15),m(h.coords.longitude,h.coords.latitude)},h=>console.error("Geolocation error:",h),{enableHighAccuracy:!0})},m=async(S,C)=>{try{t({lat:C,lng:S,district:""})}catch(h){console.error("Error fetching district:",h),o("Error fetching district")}},v=async S=>{try{const P={type:"FeatureCollection",features:(await ut.get("/pmc/districts-public")).data.filter(I=>I.geom).map(I=>({type:"Feature",geometry:zt.parse(I.geom.replace("SRID=4326;","")),properties:{district_id:I.district_id,district_name:I.district_name}}))},A=new Pe({features:new Jt().readFeatures(P,{featureProjection:"EPSG:3857"})});S.setSource(A)}catch(C){console.error("Error fetching district boundaries:",C)}};return l.jsxs("div",{children:[l.jsx("div",{ref:e,style:{height:"600px",width:"100%"}}),l.jsx("button",{type:"button",onClick:()=>g(n,i),style:{marginTop:"10px",padding:"10px",backgroundColor:"#007BFF",color:"#fff",border:"none",cursor:"pointer",borderRadius:"5px"},children:"üìç Go to Current Location"})]})};function gt(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}var Se;(function(t){t.event="event",t.props="prop"})(Se||(Se={}));function le(){}function un(t){var e,n=void 0;return function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e&&r.length===e.length&&r.every(function(a,s){return a===e[s]})||(e=r,n=t.apply(void 0,r)),n}}function be(t){return!!(t||"").match(/\d/)}function xe(t){return t==null}function dn(t){return typeof t=="number"&&isNaN(t)}function ht(t){return xe(t)||dn(t)||typeof t=="number"&&!isFinite(t)}function mt(t){return t.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function fn(t){switch(t){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;case"thousand":default:return/(\d)(?=(\d{3})+(?!\d))/g}}function gn(t,e,n){var r=fn(n),i=t.search(/[1-9]/);return i=i===-1?t.length:i,t.substring(0,i)+t.substring(i,t.length).replace(r,"$1"+e)}function hn(t){var e=w.useRef(t);e.current=t;var n=w.useRef(function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e.current.apply(e,r)});return n.current}function $e(t,e){e===void 0&&(e=!0);var n=t[0]==="-",r=n&&e;t=t.replace("-","");var i=t.split("."),a=i[0],s=i[1]||"";return{beforeDecimal:a,afterDecimal:s,hasNegation:n,addNegation:r}}function mn(t){if(!t)return t;var e=t[0]==="-";e&&(t=t.substring(1,t.length));var n=t.split("."),r=n[0].replace(/^0+/,"")||"0",i=n[1]||"";return(e?"-":"")+r+(i?"."+i:"")}function vt(t,e,n){for(var r="",i=n?"0":"",a=0;a<=e-1;a++)r+=t[a]||i;return r}function at(t,e){return Array(e+1).join(t)}function pt(t){var e=t+"",n=e[0]==="-"?"-":"";n&&(e=e.substring(1));var r=e.split(/[eE]/g),i=r[0],a=r[1];if(a=Number(a),!a)return n+i;i=i.replace(".","");var s=1+a,o=i.length;return s<0?i="0."+at("0",Math.abs(s))+i:s>=o?i=i+at("0",s-o):i=(i.substring(0,s)||"0")+"."+i.substring(s),n+i}function st(t,e,n){if(["","-"].indexOf(t)!==-1)return t;var r=(t.indexOf(".")!==-1||n)&&e,i=$e(t),a=i.beforeDecimal,s=i.afterDecimal,o=i.hasNegation,c=parseFloat("0."+(s||"0")),y=s.length<=e?"0."+s:c.toFixed(e),u=y.split("."),x=a;a&&Number(u[0])&&(x=a.split("").reverse().reduce(function(S,C,h){return S.length>h?(Number(S[0])+Number(C)).toString()+S.substring(1,S.length):C+S},u[0]));var g=vt(u[1]||"",e,n),m=o?"-":"",v=r?".":"";return""+m+x+v+g}function fe(t,e){if(t.value=t.value,t!==null){if(t.createTextRange){var n=t.createTextRange();return n.move("character",e),n.select(),!0}return t.selectionStart||t.selectionStart===0?(t.focus(),t.setSelectionRange(e,e),!0):(t.focus(),!1)}}var yt=un(function(t,e){for(var n=0,r=0,i=t.length,a=e.length;t[n]===e[n]&&n<i;)n++;for(;t[i-1-r]===e[a-1-r]&&a-r>n&&i-r>n;)r++;return{from:{start:n,end:i-r},to:{start:n,end:a-r}}}),vn=function(t,e){var n=Math.min(t.selectionStart,e);return{from:{start:n,end:t.selectionEnd},to:{start:n,end:e}}};function pn(t,e,n){return Math.min(Math.max(t,e),n)}function Oe(t){return Math.max(t.selectionStart,t.selectionEnd)}function yn(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function xn(t){return{from:{start:0,end:0},to:{start:0,end:t.length},lastValue:""}}function _n(t){var e=t.currentValue,n=t.formattedValue,r=t.currentValueIndex,i=t.formattedValueIndex;return e[r]===n[i]}function Sn(t,e,n,r,i,a,s){s===void 0&&(s=_n);var o=i.findIndex(function(A){return A}),c=t.slice(0,o);!e&&!n.startsWith(c)&&(e=c,n=c+n,r=r+c.length);for(var y=n.length,u=t.length,x={},g=new Array(y),m=0;m<y;m++){g[m]=-1;for(var v=0,S=u;v<S;v++){var C=s({currentValue:n,lastValue:e,formattedValue:t,currentValueIndex:m,formattedValueIndex:v});if(C&&x[v]!==!0){g[m]=v,x[v]=!0;break}}}for(var h=r;h<y&&(g[h]===-1||!a(n[h]));)h++;var E=h===y||g[h]===-1?u:g[h];for(h=r-1;h>0&&g[h]===-1;)h--;var P=h===-1||g[h]===-1?0:g[h]+1;return P>E?E:r-P<E-r?P:E}function ot(t,e,n,r){var i=t.length;if(e=pn(e,0,i),r==="left"){for(;e>=0&&!n[e];)e--;e===-1&&(e=n.indexOf(!0))}else{for(;e<=i&&!n[e];)e++;e>i&&(e=n.lastIndexOf(!0))}return e===-1&&(e=i),e}function bn(t){for(var e=Array.from({length:t.length+1}).map(function(){return!0}),n=0,r=e.length;n<r;n++)e[n]=!!(be(t[n])||be(t[n-1]));return e}function xt(t,e,n,r,i,a){a===void 0&&(a=le);var s=hn(function(v,S){var C,h;return ht(v)?(h="",C=""):typeof v=="number"||S?(h=typeof v=="number"?pt(v):v,C=r(h)):(h=i(v,void 0),C=r(h)),{formattedValue:C,numAsString:h}}),o=w.useState(function(){return s(xe(t)?e:t,n)}),c=o[0],y=o[1],u=function(v,S){v.formattedValue!==c.formattedValue&&y({formattedValue:v.formattedValue,numAsString:v.value}),a(v,S)},x=t,g=n;xe(t)&&(x=c.numAsString,g=!0);var m=s(x,g);return w.useMemo(function(){y(m)},[m.formattedValue]),[c,u]}function Cn(t){return t.replace(/[^0-9]/g,"")}function wn(t){return t}function Fn(t){var e=t.type;e===void 0&&(e="text");var n=t.displayType;n===void 0&&(n="input");var r=t.customInput,i=t.renderText,a=t.getInputRef,s=t.format;s===void 0&&(s=wn);var o=t.removeFormatting;o===void 0&&(o=Cn);var c=t.defaultValue,y=t.valueIsNumericString,u=t.onValueChange,x=t.isAllowed,g=t.onChange;g===void 0&&(g=le);var m=t.onKeyDown;m===void 0&&(m=le);var v=t.onMouseUp;v===void 0&&(v=le);var S=t.onFocus;S===void 0&&(S=le);var C=t.onBlur;C===void 0&&(C=le);var h=t.value,E=t.getCaretBoundary;E===void 0&&(E=bn);var P=t.isValidInputCharacter;P===void 0&&(P=be);var A=t.isCharacterSame,I=gt(t,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),Y=xt(h,c,!!y,s,o,u),$=Y[0],D=$.formattedValue,q=$.numAsString,W=Y[1],Z=w.useRef(),te=w.useRef({formattedValue:D,numAsString:q}),X=function(f,p){te.current={formattedValue:f.formattedValue,numAsString:f.value},W(f,p)},H=w.useState(!1),ce=H[0],j=H[1],F=w.useRef(null),N=w.useRef({setCaretTimeout:null,focusTimeout:null});w.useEffect(function(){return j(!0),function(){clearTimeout(N.current.setCaretTimeout),clearTimeout(N.current.focusTimeout)}},[]);var k=s,L=function(f,p){var b=parseFloat(p);return{formattedValue:f,value:p,floatValue:isNaN(b)?void 0:b}},M=function(f,p,b){f.selectionStart===0&&f.selectionEnd===f.value.length||(fe(f,p),N.current.setCaretTimeout=setTimeout(function(){f.value===b&&f.selectionStart!==p&&fe(f,p)},0))},G=function(f,p,b){return ot(f,p,E(f),b)},re=function(f,p,b){var R=E(p),O=Sn(p,D,f,b,R,P,A);return O=ot(p,O,R),O},ge=function(f){var p=f.formattedValue;p===void 0&&(p="");var b=f.input,R=f.source,O=f.event,V=f.numAsString,B;if(b){var ie=f.inputValue||b.value,se=Oe(b);b.value=p,B=re(ie,p,se),B!==void 0&&M(b,B,p)}p!==D&&X(L(p,V),{event:O,source:R})};w.useEffect(function(){var f=te.current,p=f.formattedValue,b=f.numAsString;(D!==p||q!==b)&&X(L(D,q),{event:void 0,source:Se.props})},[D,q]);var ae=F.current?Oe(F.current):void 0,ue=typeof window<"u"?w.useLayoutEffect:w.useEffect;ue(function(){var f=F.current;if(D!==te.current.formattedValue&&f){var p=re(te.current.formattedValue,D,ae);f.value=D,M(f,p,D)}},[D]);var he=function(f,p,b){var R=p.target,O=Z.current?vn(Z.current,R.selectionEnd):yt(D,f),V=Object.assign(Object.assign({},O),{lastValue:D}),B=o(f,V),ie=k(B);if(B=o(ie,void 0),x&&!x(L(ie,B))){var se=p.target,oe=Oe(se),Ae=re(f,D,oe);return se.value=D,M(se,Ae,D),!1}return ge({formattedValue:ie,numAsString:B,inputValue:f,event:p,source:b,input:p.target}),!0},me=function(f,p){p===void 0&&(p=0);var b=f.selectionStart,R=f.selectionEnd;Z.current={selectionStart:b,selectionEnd:R+p}},Ce=function(f){var p=f.target,b=p.value,R=he(b,f,Se.event);R&&g(f),Z.current=void 0},we=function(f){var p=f.target,b=f.key,R=p.selectionStart,O=p.selectionEnd,V=p.value;V===void 0&&(V="");var B;b==="ArrowLeft"||b==="Backspace"?B=Math.max(R-1,0):b==="ArrowRight"?B=Math.min(R+1,V.length):b==="Delete"&&(B=R);var ie=0;b==="Delete"&&R===O&&(ie=1);var se=b==="ArrowLeft"||b==="ArrowRight";if(B===void 0||R!==O&&!se){m(f),me(p,ie);return}var oe=B;if(se){var Ae=b==="ArrowLeft"?"left":"right";oe=G(V,B,Ae),oe!==B&&f.preventDefault()}else b==="Delete"&&!P(V[B])?oe=G(V,B,"right"):b==="Backspace"&&!P(V[B])&&(oe=G(V,B,"left"));oe!==B&&M(p,oe,V),m(f),me(p,ie)},Fe=function(f){var p=f.target,b=function(){var R=p.selectionStart,O=p.selectionEnd,V=p.value;if(V===void 0&&(V=""),R===O){var B=G(V,R);B!==R&&M(p,B,V)}};b(),requestAnimationFrame(function(){b()}),v(f),me(p)},De=function(f){f.persist&&f.persist();var p=f.target,b=f.currentTarget;F.current=p,N.current.focusTimeout=setTimeout(function(){var R=p.selectionStart,O=p.selectionEnd,V=p.value;V===void 0&&(V="");var B=G(V,R);B!==R&&!(R===0&&O===V.length)&&M(p,B,V),S(Object.assign(Object.assign({},f),{currentTarget:b}))},0)},je=function(f){F.current=null,clearTimeout(N.current.focusTimeout),clearTimeout(N.current.setCaretTimeout),C(f)},Ee=ce&&yn()?"numeric":void 0,d=Object.assign({inputMode:Ee},I,{type:e,value:D,onChange:Ce,onKeyDown:we,onMouseUp:Fe,onFocus:De,onBlur:je});if(n==="text")return i?pe.createElement(pe.Fragment,null,i(D,I)||null):pe.createElement("span",Object.assign({},I,{ref:a}),D);if(r){var _=r;return pe.createElement(_,Object.assign({},d,{ref:a}))}return pe.createElement("input",Object.assign({},d,{ref:a}))}function lt(t,e){var n=e.decimalScale,r=e.fixedDecimalScale,i=e.prefix;i===void 0&&(i="");var a=e.suffix;a===void 0&&(a="");var s=e.allowNegative,o=e.thousandsGroupStyle;if(o===void 0&&(o="thousand"),t===""||t==="-")return t;var c=Ie(e),y=c.thousandSeparator,u=c.decimalSeparator,x=n!==0&&t.indexOf(".")!==-1||n&&r,g=$e(t,s),m=g.beforeDecimal,v=g.afterDecimal,S=g.addNegation;return n!==void 0&&(v=vt(v,n,!!r)),y&&(m=gn(m,y,o)),i&&(m=i+m),a&&(v=v+a),S&&(m="-"+m),t=m+(x&&u||"")+v,t}function Ie(t){var e=t.decimalSeparator;e===void 0&&(e=".");var n=t.thousandSeparator,r=t.allowedDecimalSeparators;return n===!0&&(n=","),r||(r=[e,"."]),{decimalSeparator:e,thousandSeparator:n,allowedDecimalSeparators:r}}function Dn(t,e){t===void 0&&(t="");var n=new RegExp("(-)"),r=new RegExp("(-)(.)*(-)"),i=n.test(t),a=r.test(t);return t=t.replace(/-/g,""),i&&!a&&e&&(t="-"+t),t}function jn(t,e){return new RegExp("(^-)|[0-9]|"+mt(t),"g")}function En(t,e,n){return t===""?!0:!(e!=null&&e.match(/\d/))&&!(n!=null&&n.match(/\d/))&&typeof t=="string"&&!isNaN(Number(t))}function Tn(t,e,n){var r;e===void 0&&(e=xn(t));var i=n.allowNegative,a=n.prefix;a===void 0&&(a="");var s=n.suffix;s===void 0&&(s="");var o=n.decimalScale,c=e.from,y=e.to,u=y.start,x=y.end,g=Ie(n),m=g.allowedDecimalSeparators,v=g.decimalSeparator,S=t[x]===v;if(be(t)&&(t===a||t===s)&&e.lastValue==="")return t;if(x-u===1&&m.indexOf(t[u])!==-1){var C=o===0?"":v;t=t.substring(0,u)+C+t.substring(u+1,t.length)}var h=function(F,N,k){var L=!1,M=!1;a.startsWith("-")?L=!1:F.startsWith("--")?(L=!1,M=!0):s.startsWith("-")&&F.length===s.length?L=!1:F[0]==="-"&&(L=!0);var G=L?1:0;return M&&(G=2),G&&(F=F.substring(G),N-=G,k-=G),{value:F,start:N,end:k,hasNegation:L}},E=h(t,u,x),P=E.hasNegation;r=E,t=r.value,u=r.start,x=r.end;var A=h(e.lastValue,c.start,c.end),I=A.start,Y=A.end,$=A.value,D=t.substring(u,x);t.length&&$.length&&(I>$.length-s.length||Y<a.length)&&!(D&&s.startsWith(D))&&(t=$);var q=0;t.startsWith(a)?q+=a.length:u<a.length&&(q=u),t=t.substring(q),x-=q;var W=t.length,Z=t.length-s.length;t.endsWith(s)?W=Z:(x>Z||x>t.length-s.length)&&(W=x),t=t.substring(0,W),t=Dn(P?"-"+t:t,i),t=(t.match(jn(v))||[]).join("");var te=t.indexOf(v);t=t.replace(new RegExp(mt(v),"g"),function(F,N){return N===te?".":""});var X=$e(t,i),H=X.beforeDecimal,ce=X.afterDecimal,j=X.addNegation;return y.end-y.start<c.end-c.start&&H===""&&S&&!parseFloat(ce)&&(t=j?"-":""),t}function Rn(t,e){var n=e.prefix;n===void 0&&(n="");var r=e.suffix;r===void 0&&(r="");var i=Array.from({length:t.length+1}).map(function(){return!0}),a=t[0]==="-";i.fill(!1,0,n.length+(a?1:0));var s=t.length;return i.fill(!1,s-r.length+1,s+1),i}function Pn(t){var e=Ie(t),n=e.thousandSeparator,r=e.decimalSeparator,i=t.prefix;i===void 0&&(i="");var a=t.allowNegative;if(a===void 0&&(a=!0),n===r)throw new Error(`
        Decimal separator can't be same as thousand separator.
        thousandSeparator: `+n+` (thousandSeparator = {true} is same as thousandSeparator = ",")
        decimalSeparator: `+r+` (default value for decimalSeparator is .)
     `);return i.startsWith("-")&&a&&(console.error(`
      Prefix can't start with '-' when allowNegative is true.
      prefix: `+i+`
      allowNegative: `+a+`
    `),a=!1),Object.assign(Object.assign({},t),{allowNegative:a})}function Nn(t){t=Pn(t),t.decimalSeparator,t.allowedDecimalSeparators,t.thousandsGroupStyle;var e=t.suffix,n=t.allowNegative,r=t.allowLeadingZeros,i=t.onKeyDown;i===void 0&&(i=le);var a=t.onBlur;a===void 0&&(a=le);var s=t.thousandSeparator,o=t.decimalScale,c=t.fixedDecimalScale,y=t.prefix;y===void 0&&(y="");var u=t.defaultValue,x=t.value,g=t.valueIsNumericString,m=t.onValueChange,v=gt(t,["decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","suffix","allowNegative","allowLeadingZeros","onKeyDown","onBlur","thousandSeparator","decimalScale","fixedDecimalScale","prefix","defaultValue","value","valueIsNumericString","onValueChange"]),S=Ie(t),C=S.decimalSeparator,h=S.allowedDecimalSeparators,E=function(j){return lt(j,t)},P=function(j,F){return Tn(j,F,t)},A=xe(x)?u:x,I=g??En(A,y,e);xe(x)?xe(u)||(I=I||typeof u=="number"):I=I||typeof x=="number";var Y=function(j){return ht(j)?j:(typeof j=="number"&&(j=pt(j)),I&&typeof o=="number"?st(j,o,!!c):j)},$=xt(Y(x),Y(u),!!I,E,P,m),D=$[0],q=D.numAsString,W=D.formattedValue,Z=$[1],te=function(j){var F=j.target,N=j.key,k=F.selectionStart,L=F.selectionEnd,M=F.value;if(M===void 0&&(M=""),(N==="Backspace"||N==="Delete")&&L<y.length){j.preventDefault();return}if(k!==L){i(j);return}N==="Backspace"&&M[0]==="-"&&k===y.length+1&&n&&fe(F,1),o&&c&&(N==="Backspace"&&M[k-1]===C?(fe(F,k-1),j.preventDefault()):N==="Delete"&&M[k]===C&&j.preventDefault()),h!=null&&h.includes(N)&&M[k]===C&&fe(F,k+1);var G=s===!0?",":s;N==="Backspace"&&M[k-1]===G&&fe(F,k-1),N==="Delete"&&M[k]===G&&fe(F,k+1),i(j)},X=function(j){var F=q;if(F.match(/\d/g)||(F=""),r||(F=mn(F)),c&&o&&(F=st(F,o,c)),F!==q){var N=lt(F,t);Z({formattedValue:N,value:F,floatValue:parseFloat(F)},{event:j,source:Se.event})}a(j)},H=function(j){return j===C?!0:be(j)},ce=function(j){var F=j.currentValue,N=j.lastValue,k=j.formattedValue,L=j.currentValueIndex,M=j.formattedValueIndex,G=F[L],re=k[M],ge=yt(N,F),ae=ge.to,ue=function(he){return P(he).indexOf(".")+y.length};return x===0&&c&&o&&F[ae.start]===C&&ue(F)<L&&ue(k)>M?!1:L>=ae.start&&L<ae.end&&h&&h.includes(G)&&re===C?!0:G===re};return Object.assign(Object.assign({},v),{value:W,valueIsNumericString:!1,isValidInputCharacter:H,isCharacterSame:ce,onValueChange:Z,format:E,removeFormatting:P,getCaretBoundary:function(j){return Rn(j,t)},onKeyDown:te,onBlur:X})}function Bn(t){var e=Nn(t);return pe.createElement(Fn,Object.assign({},e))}const In=({inputSuffix:t,inputPrefix:e,...n})=>l.jsx(z,{...n,value:n.value,suffix:t,prefix:e}),An=({onValueChange:t,...e})=>l.jsx(Bn,{customInput:In,onValueChange:t,...e}),Re=({inputSuffix:t,inputPrefix:e,onValueChange:n,...r})=>l.jsx(An,{inputPrefix:e,inputSuffix:t,onValueChange:n,...r}),ct=[{label:"Producer",value:"Producer"},{label:"Distributor",value:"Distributor"},{label:"Recycler",value:"Recycler"},{label:"Collector",value:"Collector"},{label:"Retailer",value:"Retailer"}],Mn=[{label:"Plastic shopping/carry bags (having thickness less than 75 micron or less than 12 x 16 inch in size)",value:"Plastic shopping/carry bags (having thickness less than 75 micron)"},{label:"Other Single Use Plastics",value:"Other Single Use Plastics"}],Vn=[{label:"Notice issued",value:"Notice issued"},{label:"Confiscation",value:"Confiscation"},{label:"Sealing",value:"Sealing"},{label:"FIR",value:"FIR"},{label:"Complaint before Environmental Magistrate",value:"Complaint before Environmental Magistrate"},{label:"Fine Imposed",value:"Fine Imposed"},{label:"De Sealed",value:"De Sealed"}],kn=({control:t,errors:e,readOnly:n=!1,defaultValues:r})=>{var L,M,G,re,ge,ae,ue,he,me,Ce,we,Fe,De,je,Ee;const[i,a]=w.useState([]),[s,o]=w.useState([]),{setValue:c,getValues:y,trigger:u}=ft(),[x,g]=w.useState(""),m=ne({control:t,name:"violationFound",defaultValue:[]}),v=ne({control:t,name:"violationType",defaultValue:[]}),S=ne({control:t,name:"actionTaken",defaultValue:[]}),C=ne({control:t,name:"fineRecoveryStatus",defaultValue:[]});ne({control:t,name:"fineAmount",defaultValue:0});const h=(d,_)=>{o(_);const f=_.filter(p=>!i.includes(p));f.length>0&&a(p=>[...p,...f])},E=ne({control:t,name:"plasticBagsConfiscation",defaultValue:0}),P=ne({control:t,name:"confiscation_otherPlastics",defaultValue:{}}),[A,I]=w.useState(0);w.useEffect(()=>{if(S.includes("Confiscation")){let d=0;v.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&(d+=parseFloat(E)||0),s.forEach(_=>{P[_]&&(d+=parseFloat(P[_])||0)}),I(d),c("totalConfiscation",d)}},[E,P,S,c,s,v]),w.useEffect(()=>{ut.get("/pmc/inspection-report/all_other_single_use_plastics/").then(d=>{a(d.data.single_use_plastic_items||[])}).catch(d=>{console.error("Error fetching available options:",d)})},[]),w.useEffect(()=>{if(r!=null&&r.fineRecoveryBreakup){const d=r.fineRecoveryBreakup.map(_=>({..._,isNew:!1}));q(d)}},[r==null?void 0:r.fineRecoveryBreakup]);const Y=ne({control:t,name:"fineAmount",defaultValue:0});ne({control:t,name:"recoveryAmount",defaultValue:0});const $=ne({control:t,name:"fineRecoveryBreakup",defaultValue:[]}),[D,q]=w.useState($||[]),[W,Z]=w.useState(0);w.useEffect(()=>{console.log("Updating total recovery"),console.log("recoveryEntries",D);const d=D.reduce((_,f)=>_+(f.amount||0),0);Z(d),console.log("fineReoceryBreakup is setup")},[D,c]);const te=()=>{W<Y&&q([...D,{date:"",amount:0,isNew:!0}])},X=(d,_,f)=>{console.log("recovery amount updated:"),console.log(d,_,f),q(p=>{const b=p.map((R,O)=>O===d?{...R,[_]:_==="amount"?parseFloat(f)||0:f}:R);return console.log("üîπ Updated Recovery Entries:",b),b})};w.useEffect(()=>{console.log("Updated recovery entries:",D),console.log("Calculated Total Recovery:",W)},[D,W]),w.useEffect(()=>{r!=null&&r.OtherSingleUseItems&&o(r.OtherSingleUseItems)},[r==null?void 0:r.OtherSingleUseItems]);const[H,ce]=w.useState({lat:null,lng:null,district:""}),j=d=>{ce(d)},F=d=>{d.key==="Backspace"&&g(N(x,!0))},N=(d,_)=>{let f=d.replace(/[^a-zA-Z0-9]/g,""),p=f.slice(0,3).toUpperCase().replace(/[^A-Z]/g,""),b=f.slice(3,6).toUpperCase().replace(/[^A-Z]/g,""),R=f.slice(6).replace(/[^0-9]/g,"");if(_)return[p,b,R].filter(Boolean).join("-");let O="";return p&&(O+=p+(p.length===3?"-":"")),b&&(O+=b+(b.length===3?"-":"")),R&&(O+=R),O};console.log("fineRecoveryBreakup:",r==null?void 0:r.fineRecoveryBreakup),console.log("readOnly",n),Ne(d=>d.user.district_id);const k=Ne(d=>d.user.district_name)||"";return console.log("district_name:",k),l.jsxs(Et,{children:[l.jsxs("h4",{className:"mb-6",children:["Inspection Report - ",k]}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(U,{label:"Inspection Date*",invalid:!!e.inspectionDate,errorMessage:(L=e.inspectionDate)==null?void 0:L.message,children:l.jsx(K,{name:"inspectionDate",control:t,render:({field:d})=>l.jsx(z,{type:"date",...d,readOnly:n})})}),l.jsx(U,{label:"Name of Business*",invalid:!!e.businessName,errorMessage:(M=e.businessName)==null?void 0:M.message,children:l.jsx(K,{name:"businessName",control:t,render:({field:d})=>l.jsx(z,{type:"text",placeholder:"Business Name",readOnly:n,...d})})}),l.jsx(U,{label:"Type of Business*",invalid:!!e.businessType,errorMessage:(G=e.businessType)==null?void 0:G.message,children:l.jsx(K,{name:"businessType",control:t,render:({field:d})=>l.jsx(He,{options:ct,value:ct.find(_=>_.value===d.value),isDisabled:n,onChange:_=>d.onChange(_==null?void 0:_.value)})})}),l.jsx(U,{label:"Plastic Application / License Number",invalid:!!e.licenseNumber,errorMessage:(re=e.licenseNumber)==null?void 0:re.message,children:l.jsx(K,{name:"licenseNumber",control:t,render:({field:d})=>l.jsx(z,{value:x,onChange:_=>g(N(_.target.value,!1)),onKeyDown:F,placeholder:"e.g., LHR-PRO-001",title:"Tracking Number (e.g., LHR-PRO-001)",readOnly:n})})})]}),l.jsx(U,{label:"Violation Found",invalid:!!e.violationFound,errorMessage:(ge=e.violationFound)==null?void 0:ge.message,children:l.jsx(K,{name:"violationFound",control:t,render:({field:d})=>l.jsx(ve.Group,{value:d.value||[],onChange:_=>d.onChange(_),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(ve,{...d,value:"Yes",disabled:n,children:"Yes"})})},"a1")}),m.includes("Yes")&&l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs(U,{label:"Type of Violation Found*",invalid:!!e.violationType,errorMessage:(ae=e.violationType)==null?void 0:ae.message,children:[Mn.map(d=>l.jsx(K,{name:"violationType",control:t,render:({field:_})=>l.jsx(ve.Group,{value:_.value||[],onChange:f=>_.onChange(f),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(ve,{..._,value:d.value,disabled:n,children:d.label})})},d.value)),v.includes("Other Single Use Plastics")&&l.jsx(U,{label:"Add List + (If desired item is not in the list, then type and press enter to add)",invalid:!!e.PackagingItems,errorMessage:(ue=e.PackagingItems)==null?void 0:ue.message,className:"ml-2 mt-4",children:l.jsx(K,{name:"OtherSingleUseItems",control:t,render:({field:d})=>l.jsx(Xt,{multiple:!0,freeSolo:!0,options:i,value:s,readOnly:n,onChange:(_,f)=>{d.onChange(f),h(_,f)},renderTags:(_,f)=>_.map((p,b)=>l.jsx(Qt,{variant:"outlined",label:p,...f({index:b})})),renderInput:_=>l.jsx(en,{..._,variant:"outlined",label:"Other Single Use Plastics",placeholder:"Add or select Single Use Plastics"})})})})]}),l.jsx(U,{label:"Action Taken*",invalid:!!e.actionTaken,errorMessage:(he=e.actionTaken)==null?void 0:he.message,children:Vn.map(d=>l.jsx(K,{name:"actionTaken",control:t,render:({field:_})=>l.jsx(ve.Group,{value:_.value||[],onChange:f=>_.onChange(f),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(ve,{..._,value:d.value,disabled:n&&d.value!=="De Sealed",children:d.label})})},d.value))}),S.includes("Confiscation")&&v.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&l.jsx(U,{label:"Plastic shopping/carry bags (having thickness less than 75 micron) (KG)",invalid:!!e.plasticBagsConfiscation,errorMessage:(me=e.plasticBagsConfiscation)==null?void 0:me.message,children:l.jsx(K,{name:"plasticBagsConfiscation",control:t,render:({field:d})=>l.jsx(Re,{placeholder:"Enter KG",...d,readOnly:n})})}),S.includes("Confiscation")&&v.includes("Other Single Use Plastics")&&s.map((d,_)=>l.jsx(U,{label:`${d} Confiscation (KG)`,children:l.jsx(K,{name:`confiscation_otherPlastics.${d}`,control:t,render:({field:f})=>l.jsx(z,{type:"number",placeholder:"Enter KG",...f,readOnly:n})})},_)),S.includes("Confiscation")&&l.jsx(U,{label:"Total Confiscation (KG)",invalid:!!e.totalConfiscation,errorMessage:(Ce=e.totalConfiscation)==null?void 0:Ce.message,children:l.jsx(K,{name:"totalConfiscation",control:t,render:({field:d})=>(w.useEffect(()=>{d.onChange(A)},[A]),l.jsx(z,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...d}))})}),S.includes("Fine Imposed")&&l.jsxs(l.Fragment,{children:[l.jsx(U,{label:"Fine Amount (PKR)",invalid:!!e.fineAmount,errorMessage:(we=e.fineAmount)==null?void 0:we.message,children:l.jsx(K,{name:"fineAmount",control:t,render:({field:d})=>l.jsx(Re,{placeholder:"Enter Fine Amount",...d,readOnly:n})})}),l.jsx(U,{label:"Fine Recovery Status",invalid:!!e.fineRecoveryStatus,errorMessage:(Fe=e.fineRecoveryStatus)==null?void 0:Fe.message,children:l.jsx(K,{name:"fineRecoveryStatus",control:t,render:({field:d})=>l.jsx(He,{options:[{label:"Pending",value:"Pending"},{label:"Partial",value:"Partial"},{label:"Recovered",value:"Recovered"}],value:{label:d.value,value:d.value},onChange:_=>d.onChange(_==null?void 0:_.value),isDisabled:n&&d.value==="Recovered"})})}),C!=="Pending"&&l.jsxs(l.Fragment,{children:[l.jsx(U,{label:"Total Recovery Amount (PKR)",invalid:!!e.recoveryAmount,errorMessage:(De=e.recoveryAmount)==null?void 0:De.message,children:l.jsx(K,{name:"recoveryAmount",control:t,render:({field:d})=>(w.useEffect(()=>{d.onChange(W)},[W]),l.jsx(Re,{placeholder:"Auto-calculated",readOnly:!0,...d}))})}),D.map((d,_)=>{var f,p;return l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(U,{label:"Recovery Date",invalid:!!e.fineRecoveryBreakup,errorMessage:(f=e.fineAmount)==null?void 0:f.fineRecoveryBreakup,children:l.jsx(z,{type:"date",value:d.date,onChange:b=>X(_,"date",b.target.value),readOnly:!d.isNew})}),l.jsx(U,{label:"Recovery Amount (PKR)",invalid:!!e.fineRecoveryBreakup,errorMessage:(p=e.fineAmount)==null?void 0:p.fineRecoveryBreakup,children:l.jsx(Re,{value:d.amount,onChange:b=>X(_,"amount",b.target.value),readOnly:!d.isNew})})]},_)}),l.jsx(Ge,{type:"button",onClick:te,disabled:W>=Y,className:"mt-7",children:"+ Add Recovery"})]})]}),S.includes("De Sealed")&&l.jsxs(l.Fragment,{children:[l.jsx(U,{label:"De Sealed Date",invalid:!!e.deSealedDate,errorMessage:(je=e.deSealedDate)==null?void 0:je.message,children:l.jsx(K,{name:"deSealedDate",control:t,render:({field:d})=>l.jsx(z,{type:"date",...d,readOnly:n&&d.value!==null&&d.value!==""})})}),l.jsx(U,{label:"De Seal - Affidavit",invalid:!!e.affidavit,errorMessage:(Ee=e.affidavit)==null?void 0:Ee.message,children:l.jsx(K,{name:"affidavit",control:t,render:({field:d})=>l.jsx(z,{type:"file",accept:".pdf,.png,.jpg,.jpeg",onChange:_=>d.onChange(_.target.files[0]||null)})})})]})]}),l.jsxs("div",{style:{padding:"20px"},children:[l.jsx("h1",{children:"Select Location"}),l.jsx(cn,{onLocationSelect:j}),H.lat&&H.lng&&l.jsxs("div",{style:{marginTop:"20px",padding:"10px",border:"1px solid #ccc"},children:[l.jsx("h3",{children:"Selected Location Details:"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(U,{label:"Latitude",children:l.jsx(K,{name:"latitude",control:t,render:({field:d})=>(w.useEffect(()=>{d.onChange(H.lat)},[H.lat]),l.jsx(z,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...d}))})}),l.jsx(U,{label:"Longitude",children:l.jsx(K,{name:"longitude",control:t,render:({field:d})=>(w.useEffect(()=>{d.onChange(H.lng)},[H.lng]),l.jsx(z,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...d}))})}),l.jsx(K,{name:"fineRecoveryBreakup",control:t,render:({field:d})=>(w.useEffect(()=>{d.onChange(D)},[D]),l.jsx(z,{type:"hidden",placeholder:"Auto-calculated",readOnly:!0,...d}))})]})]})]})]})},Ln=T.object({businessName:T.string().min(1,{message:"Business name required"}),businessType:T.string().min(1,{message:"Business type required"}),licenseNumber:T.string().optional(),violationFound:T.array(T.string()).optional(),violationType:T.array(T.string()).optional(),actionTaken:T.array(T.string()).optional(),plasticBagsConfiscation:T.coerce.number().optional(),confiscation_otherPlastics:T.record(T.string(),T.coerce.number()).optional(),totalConfiscation:T.coerce.number().optional(),OtherSingleUseItems:T.array(T.string()).optional(),latitude:T.coerce.number().nullable(),longitude:T.coerce.number().nullable(),district:T.string().optional(),inspectionDate:T.string().min(1,{message:"Inspection date is required"}),fineAmount:T.coerce.number().optional(),fineRecoveryStatus:T.enum(["Pending","Partial","Recovered"]).optional(),fineRecoveryDate:T.string().optional(),recoveryAmount:T.coerce.number().optional(),deSealedDate:T.string().optional(),fineRecoveryBreakup:T.array(T.object({date:T.string().min(1,{message:"Date is required"}),amount:T.coerce.number().min(0,{message:"Amount must be a number and at least 0"}),isNew:T.boolean().optional()})).default([]),affidavit:T.instanceof(File,{message:"Must be a valid file"}).optional()}),On=({onFormSubmit:t,defaultValues:e={},readOnly:n,children:r})=>{const{handleSubmit:i,reset:a,formState:{errors:s},control:o}=ft({defaultValues:{fineRecoveryBreakup:(e==null?void 0:e.fineRecoveryBreakup)??[]},resolver:tn(Ln)});return w.useEffect(()=>{_t(e)||a(e)},[JSON.stringify(e)]),l.jsxs(Dt,{className:"flex w-full h-full",containerClassName:"flex flex-col w-full justify-between",onSubmit:i(t),children:[l.jsx(dt,{children:l.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:l.jsx("div",{className:"gap-4 flex flex-col flex-auto",children:l.jsx(kn,{control:o,errors:s,defaultValues:e,readOnly:n})})})}),l.jsx(jt,{children:r})]})},Gn=t=>t?{id:t.id,businessName:t.business_name,businessType:t.business_type,licenseNumber:t.license_number||"",violationFound:t.violation_found||[],violationType:t.violation_type||[],actionTaken:t.action_taken||[],plasticBagsConfiscation:t.plastic_bags_confiscation??0,confiscationOtherPlastics:t.confiscation_other_plastics||{},totalConfiscation:t.total_confiscation||0,OtherSingleUseItems:t.other_single_use_items||[],latitude:t.latitude??null,longitude:t.longitude??null,district:t.district||"",inspectionDate:t.inspection_date||null,fineAmount:t.fine_amount??0,fineRecoveryStatus:t.fine_recovery_status||void 0,fineRecoveryDate:t.fine_recovery_date||"",recoveryAmount:t.recovery_amount??0,deSealedDate:t.de_sealed_date||"",fineRecoveryBreakup:t.fine_recovery_breakup||null,syncStatus:t.syncStatus||void 0}:null,fr=()=>{const t=St(),e=bt(),{reports:n,fetchReports:r,updateReport:i,addNewReport:a,syncReports:s}=an(),[o,c]=w.useState(!1),[y,u]=w.useState(!1),g=new URLSearchParams(e.search).get("id");console.log(n);let m=w.useMemo(()=>{const h=n.find(E=>E.id==g);return h?Gn(h):null},[n,g]);m={...m,inspectionDate:(m==null?void 0:m.inspectionDate)||new Date().toISOString().split("T")[0]},w.useEffect(()=>{g&&!m&&r()},[m,r]),Ne(h=>h.user.district_id),Ne(h=>h.user.district_name);const v=async h=>{console.log("Submitting Data:",h),u(!0);const E={business_name:h.businessName,business_type:h.businessType,license_number:h.licenseNumber||"",violation_found:h.violationFound||[],violation_type:h.violationType||[],action_taken:h.actionTaken||[],plastic_bags_confiscation:h.plasticBagsConfiscation??0,confiscation_other_plastics:h.confiscationOtherPlastics||{},total_confiscation:h.totalConfiscation||0,other_single_use_items:h.OtherSingleUseItems||[],latitude:h.latitude??null,longitude:h.longitude??null,district:h.district||"",inspection_date:h.inspectionDate||null,fine_amount:h.fineAmount??0,fine_recovery_status:h.fineRecoveryStatus||void 0,fine_recovery_date:h.fineRecoveryDate||null,recovery_amount:h.recoveryAmount??0,de_sealed_date:h.deSealedDate||null,fine_recovery_breakup:h.fineRecoveryBreakup||null,affidavit:h.affidavit||null,syncStatus:g?"patch":"post"};try{g?i(g,E):a(E),console.log("‚úÖ Report Updated in Store"),u(!1),t("/auth/EPAOperations/AllInspections")}catch(P){console.error("‚ùå Error in Submission:",P),u(!1)}},S=()=>c(!0),C=()=>{c(!1),wt.push(l.jsx(Ft,{type:"success",children:"Customer discard!"}),{placement:"top-center"}),t("/auth/EPAOperations/AllInspections")};return l.jsx(l.Fragment,{children:l.jsxs(l.Fragment,{children:[l.jsx(On,{newCustomer:!0,defaultValues:m,onFormSubmit:v,readOnly:g!==null,children:l.jsx(dt,{children:l.jsxs("div",{className:"flex items-center justify-between px-8",children:[l.jsx("span",{}),l.jsxs("div",{className:"flex items-center",children:[l.jsx(Ge,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:l.jsx(Ct,{}),onClick:S,children:"Discard"}),l.jsx(Ge,{icon:l.jsx(rn,{}),variant:"solid",type:"submit",loading:y,children:"Save"})]})]})})}),l.jsx(nn,{isOpen:o,type:"danger",title:"Discard changes",onClose:()=>c(!1),onCancel:()=>c(!1),onConfirm:C,children:l.jsx("p",{children:"Are you sure you want to discard this?"})})]})})};export{fr as default};
