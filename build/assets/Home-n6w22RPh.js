import{r as p,U as I,j as r,A as h}from"./index-wxNYYnG2.js";import{M as k}from"./index.esm-BEJR7zSa.js";import"./TextField-BFJCirlH.js";import"./Divider-DftoNhsF.js";import"./FormControlLabel-BUhIlJgL.js";import"./Autocomplete-BT-oPrtW.js";import"./index-Cv1QrVk1.js";const v=e=>{var m,g,S;const n=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(c=>c.assigned_group==="APPLICANT"&&c.remarks&&c.remarks!=="undefined").map(c=>c.remarks),l=n.length>0?n.join("; "):"N/A";return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,cnic:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,application_Start_Time:((m=e.created_at)==null?void 0:m.substring(0,16))||"N/A",application_Submission_Time:((S=(g=e.submittedapplication)==null?void 0:g.created_at)==null?void 0:S.substring(0,16))||"N/A",remarks:l}},y=e=>e.map(f=>{const n=v(f);return Object.keys(n).forEach(l=>{(n[l]===void 0||n[l]===null)&&(n[l]="N/A")}),n}),U=()=>{const[e,f]=p.useState([]),[n,l]=p.useState([]),[m,g]=p.useState([]),[S,c]=p.useState(0),[_,x]=p.useState(null),[T,R]=p.useState({});console.log(_);const w=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],A={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},O=(t,d,a)=>{const C=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],u=y(t),D=u[0];console.log(t);const o=[...Object.keys(D).filter(s=>C.includes(s)).map(s=>({accessorKey:s,header:s.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase()),size:200,Cell:({cell:i,row:N})=>r.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const L=N.original.id;console.log(`Clicked ${s}:`,i.getValue()),console.log(`Navigating with ID: ${L}`),window.location.href=d?`/spuid-review/${L}?group=${a}`:`/spuid-signup/${L}`},children:i.getValue()||"-"})}))];return{flattenedData:u,columns:o}},b=I();return p.useEffect(()=>{(async()=>{try{const a=await h.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{b("/error")}try{let a=[];try{a=(await h.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],g(a.map(s=>s.name))}catch(o){console.error("Error fetching user groups:",o),g([])}console.log("groupsResponse",a);const u=(await h.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(u)&&u.length>0){const o=O(u,a.length>0,a.map(i=>i.name)[0]);f(o.flattenedData),l(o.columns),console.log("Flattened Data:",o.flattenedData);const s=o.flattenedData[o.flattenedData.length-1];if(console.log("Last Row:",s),s&&s.id){x(s.id),console.log("Last Row ID:",s.id);const i=w.indexOf(s.assigned_group);i!==-1&&c(i)}}const D=await h.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});R(D.data)}catch(a){console.error("Error fetching data:",a)}})(),x(25);const d=w.indexOf("LSO");d!==-1&&c(d)},[]),console.log("selectedRowId:",_),console.log(_),r.jsxs("div",{children:[r.jsx("div",{className:"tiles-container",children:Object.entries(T).map(([t,d])=>r.jsxs("div",{className:"tile",children:[r.jsx("h3",{children:A[t]||t})," ",r.jsx("p",{children:d})]},t))}),r.jsx("div",{className:"mb-4",children:r.jsxs("h3",{children:[m.filter(t=>t!=="Download License"&&t!=="Applicant"&&t!=="LSM2").join(" - ")," Dashboard"]})}),r.jsx(k,{columns:[...n],data:e.map(t=>({...t,assigned_group_title:A[t.assigned_group]||t.assigned_group})),getRowId:t=>t.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:1,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:m.length>0,enablePagination:!1},_)]})};export{U as default};
