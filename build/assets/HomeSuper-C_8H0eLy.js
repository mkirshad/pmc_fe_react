import{r as d,U as z,j as a,A as O}from"./index-Bb__cgJ-.js";import{M as P}from"./index.esm-BnZPYR9O.js";import"./TextField-BO_5EaBq.js";import"./Divider-i-BDj4qK.js";import"./FormControlLabel-ajGQPHEX.js";import"./Autocomplete-Zvj1MlRj.js";import"./index-kUE2d1EK.js";const G=s=>{var C,h,y,D,N,x;const u=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],p=u.indexOf(s.assigned_group),o=s.applicationassignment||[],i=(()=>{if(o.length>1){const t=o[o.length-2];return u.indexOf(t.assigned_group)}return-1})(),A=i!==-1&&i>p;o.find(t=>u.indexOf(t.assigned_group)===i);const I=t=>new Intl.NumberFormat("en-PK",{style:"currency",currency:"PKR",minimumFractionDigits:2}).format(t),b=s.applicationassignment.filter(t=>t.assigned_group===s.assigned_group),l=b.reduce((t,e)=>new Date(e.updated_at).getTime()>new Date(t.updated_at).getTime()?e:t,b[0]),R=l?(C=l.updated_at)==null?void 0:C.substring(0,16):"N/A";let w="N/A";if(l&&l.updated_at){const t=new Date(l.updated_at),n=new Date-t;w=Math.floor(n/(1e3*60*60*24))}let T="N/A";if((h=s.submittedapplication)!=null&&h.created_at&&((y=s.submittedapplication)!=null&&y.created_at)){const t=new Date((D=s.submittedapplication)==null?void 0:D.created_at),n=new Date-t;T=Math.floor(n/(1e3*60*60*24))}const v=s.applicantfees?s.applicantfees.reduce((t,e)=>t+parseFloat(e.fee_amount||0),0):0,k=s.applicantfees?s.applicantfees.filter(t=>t.is_settled).reduce((t,e)=>t+parseFloat(e.fee_amount||0),0):0;return{id:s.id,application_Submission_Time:((x=(N=s.submittedapplication)==null?void 0:N.created_at)==null?void 0:x.substring(0,16))||"N/A",duration:T||"N/A",tracking_number:s.tracking_number,first_name:s.first_name,mobile_no:s.mobile_no,application_status:s.application_status,assigned_group:s.assigned_group,group_assignment_time:R,group_assignment_days:w,total_fee_amount:I(v.toFixed(2)),verified_fee_amount:I(k.toFixed(2)),is_assigned_back:A?"Yes":"No"}},B=s=>s.map(u=>{const p=G(u);return Object.keys(p).forEach(o=>{(p[o]===void 0||p[o]===null)&&(p[o]="N/A")}),p}),q=()=>{const[s,u]=d.useState([]),[p,o]=d.useState([]),[i,A]=d.useState(null),[I,b]=d.useState(0),[l,R]=d.useState(null),[w,T]=d.useState({}),[v,k]=d.useState(null),[C,h]=d.useState(!1);console.log(l);const y=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],D={APPLICANT:"Applicant",LSO:"LSO",LSO1:"Sana",LSO2:"Qaisar",LSO3:"Ameer",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},N=async e=>{try{if(h(!0),k(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const n=e==="LSO1"?1:e==="LSO2"?2:0,g=((await O.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:"LSO"}})).data||[]).filter(L=>{var F;return((F=L.submittedapplication)==null?void 0:F.id)%3===n}),f=x(g,!!i.length,i[0]);u(f.flattenedData),o(f.columns)}else{const r=(await O.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],g=x(r,!!i.length,i[0]);u(g.flattenedData),o(g.columns)}}catch(n){console.error("Error fetching filtered data:",n),u([]),o([])}finally{h(!1)}},x=(e,n,r)=>{const g=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","duration","remarks","group_assignment_days","total_fee_amount","verified_fee_amount","is_assigned_back"],f=B(e),L=f[0],F=[...Object.keys(L).filter(m=>g.includes(m)).map(m=>{let M=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(m)?M=120:["first_name"].includes(m)&&(M=180),m==="is_assigned_back"?{accessorKey:m,header:"Assigned Back",size:M,Filter:({column:c})=>a.jsxs("select",{value:c.getFilterValue()||"",onChange:_=>c.setFilterValue(_.target.value||void 0),style:{width:"100%",padding:"4px"},children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"Yes",children:"Yes"}),a.jsx("option",{value:"",children:"No"})]}),filterFn:(c,_,S)=>S===""||c.original[m]===S,Cell:({cell:c,row:_})=>{const S=_.original.id,E=_.original.is_assigned_back,j=`/spuid-review/${S}?group=${r}`;return a.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:E==="Yes"?"red":"blue",textDecoration:"underline"},children:c.getValue()||"-"})}}:{accessorKey:m,header:m.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase()),size:M,Cell:({cell:c,row:_})=>{const S=_.original.id,E=_.original.is_assigned_back,j=`/spuid-review/${S}?group=${r}`;return a.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:E==="Yes"?"red":"blue",textDecoration:"underline"},children:c.getValue()||"-"})}}})];return{flattenedData:f,columns:F}},t=z();return d.useEffect(()=>{(async()=>{h(!0);try{const r=await O.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{t("/error")}try{let r=[];try{r=(await O.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],A(r.map(L=>L.name))}catch(f){console.error("Error fetching user groups:",f),A([])}console.log("groupsResponse",r);const g=await O.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});T(g.data)}catch(r){console.error("Error fetching data:",r)}finally{h(!1)}})(),R(25);const n=y.indexOf("LSO");n!==-1&&b(n)},[]),d.useEffect(()=>{console.log("userGroups:",i),i&&!i.includes("Super")&&t("/home")},[i,t]),console.log("selectedRowId:",l),console.log(l),a.jsxs("div",{children:[a.jsx("div",{className:"tiles-container",children:Object.entries(w).map(([e,n])=>a.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:v===e?"#007BFF":"#f8f9fa",color:v===e?"#fff":"#000"},onClick:()=>N(e),children:[a.jsx("h3",{children:D[e]||e})," ",a.jsx("p",{children:n})]},e))}),a.jsx("div",{className:"mb-4",children:a.jsxs("h3",{children:[i&&i.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),C?a.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[a.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),a.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):a.jsx(P,{columns:[...p],data:s.map(e=>({...e,assigned_group_title:D[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:200,minSize:1,size:50},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},l)]})};export{q as default};
