import{r as s,j as a,A as y}from"./index-Dy_vMV_4.js";import{H as M}from"./HeaderTemplate-CoFREpmu.js";import{M as N,V as D,T as z,O as k,a as h,b as m,S as b,e as F,F as p,c as g,f as T,d as _,P,C as R}from"./OSM-Bx5l-N5p.js";import{G as A}from"./GeoJSON-BAwyf57_.js";import{M as G}from"./index.esm-KBcWPud_.js";import"./Divider-D8jILrwP.js";import"./DefaultPropsProvider-BZc3I15u.js";import"./TextField-BmDle8Aw.js";import"./Autocomplete-CKva4CMF.js";import"./FormControlLabel-ZpPHgk3T.js";import"./index-CHZ37ukL.js";const I=()=>{const u=s.useRef(null),[r,S]=s.useState(null),[c,j]=s.useState(null),[d,E]=s.useState(null),[n,C]=s.useState([]),[i,f]=s.useState(null),[L,w]=s.useState(!1);s.useEffect(()=>{const e=new N({target:u.current,layers:[new z({source:new k})],view:new D({zoom:7,center:[8127130,3658593]})}),t=new h({source:new m}),o=new h({source:new m});return e.addLayer(t),e.addLayer(o),j(t),E(o),S(e),()=>e.setTarget(null)},[]),s.useEffect(()=>{if(!c||!r)return;(async()=>{w(!0);try{const t=await y.get("/pmc/idm_districts-club-counts/"),o=new m({features:new A().readFeatures(t.data,{featureProjection:"EPSG:3857"})});c.setSource(o),r.getView().fit(o.getExtent(),{padding:[50,50,50,50],duration:500})}catch(t){console.error("Error fetching districts:",t)}finally{w(!1)}})()},[c,r]),s.useEffect(()=>{c&&c.setStyle(e=>{const t=e.get("id")===i;return new b({stroke:new g({color:t?"red":"blue",width:t?3:2}),fill:new p({color:t?"rgba(255,0,0,0.1)":"rgba(0,0,255,0.1)"}),text:new F({text:`${e.get("name")} (${e.get("club_count")})`,font:"12px sans-serif",fill:new p({color:"#000"}),stroke:new g({color:"#fff",width:3})})})})},[c,i]),s.useEffect(()=>{(async()=>{const t=await y.get("/pmc/idm_clubs_geojson_all/");C(t.data.features)})()},[]),s.useEffect(()=>{if(!d)return;const e=d.getSource();e.clear(),n.forEach(t=>{const o=T(t.geometry.coordinates),l=new _({geometry:new P(o)});l.setStyle(new b({image:new R({radius:5,fill:new p({color:"#22C55E"}),stroke:new g({color:"#fff",width:1})})})),e.addFeature(l)})},[d,n]),s.useEffect(()=>{if(!r||!c)return;const e=t=>{const o=r.getFeaturesAtPixel(t.pixel);if(o.length>0){const l=o[0],x=l.get("id");i===x?(f(null),r.getView().setCenter([8127130,3658593]),r.getView().setZoom(7)):(f(x),r.getView().fit(l.getGeometry().getExtent(),{padding:[50,50,50,50],maxZoom:10}))}else f(null),r.getView().setCenter([8127130,3658593]),r.getView().setZoom(7)};return r.on("click",e),()=>r.un("click",e)},[r,c,i]);const V=s.useMemo(()=>i?n.filter(e=>e.properties.district_id===i):n,[i,n]),v=s.useMemo(()=>[{accessorKey:"properties.district",header:"District",size:150},{accessorKey:"properties.name",header:"School Name",size:225},{accessorKey:"properties.address",header:"Address",size:225},{accessorKey:"properties.head_name",header:"Head Name",size:200}],[]);return a.jsxs("div",{className:"flex flex-row p-4 gap-4",children:[a.jsxs("div",{className:"relative w-1/2",children:[L&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-10",children:a.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-blue-500 border-t-transparent rounded-full"})}),a.jsx("div",{ref:u,style:{height:"850px"}})]}),a.jsx("div",{style:{flex:1},children:a.jsx(G,{columns:v,data:V,initialState:{pagination:{pageSize:15}},enableZebraStripes:!0,enableColumnResizing:!0})})]})},X=()=>{const u=a.jsxs("h6",{className:"header-text",children:[a.jsx("span",{className:"font-bold",children:"Management Information System"}),a.jsx("span",{className:"text-sm ml-2",children:"Educational Environmental Club Directory"})]});return a.jsx(M,{headerText:u,children:a.jsx(I,{})})};export{X as default};
