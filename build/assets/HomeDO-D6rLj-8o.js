import{r as p,U as M,j as f,A as D}from"./index-NrorgcSW.js";import{M as N}from"./index.esm-BW6-gYF5.js";import"./TextField-CS0QlRfP.js";import"./Divider-DHG-fOFI.js";import"./FormControlLabel-ulXp7Te6.js";import"./Autocomplete-D-BgHp9i.js";import"./index-C32lntTj.js";const E=e=>{const o=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(t=>t.assigned_group==="APPLICANT"&&t.remarks&&t.remarks!=="undefined").map(t=>t.remarks),u=o.length>0?o.join("; "):"N/A",i=e.applicationassignment.filter(t=>t.assigned_group===e.assigned_group),d=i.reduce((t,c)=>new Date(c.updated_at).getTime()>new Date(t.updated_at).getTime()?c:t,i[0]);let h="N/A";if(d&&d.updated_at){const t=new Date(d.updated_at),m=new Date-t;h=Math.floor(m/(1e3*60*60*24))}return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,CNIC:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,days_pending_for:h,remarks:u}},b=e=>e.map(_=>{const o=E(_);return Object.keys(o).forEach(u=>{(o[u]===void 0||o[u]===null)&&(o[u]="N/A")}),o}),B=()=>{const[e,_]=p.useState([]),[o,u]=p.useState([]),[i,d]=p.useState(null),[h,t]=p.useState(0),[c,m]=p.useState(null),[P,x]=p.useState({});console.log(c);const C=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],R={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},O=(n,S,a)=>{const T=["first_name","CNIC","mobile_no","tracking_number","registration_for","days_pending_for","remarks"],g=b(n),A=g[0];console.log(n);const r=[...Object.keys(A).filter(s=>T.includes(s)).map(s=>{let l=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(s)?l=120:["first_name"].includes(s)&&(l=180),{accessorKey:s,header:s.replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase()),size:l,Cell:({cell:w,row:I})=>{const y=`/spuid-review/${I.original.id}?group=${a}`;return f.jsx("a",{href:y,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:w.getValue()||"-"})}}})];return{flattenedData:g,columns:r}},L=M();return p.useEffect(()=>{(async()=>{try{const a=await D.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{L("/error")}try{let a=[];try{a=(await D.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],d(a.map(s=>s.name))}catch(r){console.error("Error fetching user groups:",r),d([])}console.log("groupsResponse",a);const g=(await D.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(g)&&g.length>0){const r=O(g,a.length>0,a.map(l=>l.name)[0]);_(r.flattenedData),u(r.columns),console.log("Flattened Data:",r.flattenedData);const s=r.flattenedData[r.flattenedData.length-1];if(console.log("Last Row:",s),s&&s.id){m(s.id),console.log("Last Row ID:",s.id);const l=C.indexOf(s.assigned_group);l!==-1&&t(l)}}const A=await D.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});x(A.data)}catch(a){console.error("Error fetching data:",a)}})(),m(25);const S=C.indexOf("LSO");S!==-1&&t(S)},[]),p.useEffect(()=>{console.log("userGroups:",i),i&&!i.includes("DO")&&L("/home")},[i,L]),console.log("selectedRowId:",c),console.log(c),f.jsxs("div",{children:[f.jsx("div",{className:"mb-4",children:f.jsxs("h3",{children:[i&&i.filter(n=>n!=="Download License"&&n!=="Applicant"&&n!=="LSM2").join(" - ")," Dashboard"]})}),f.jsx(N,{columns:[...o],data:e.map(n=>({...n,assigned_group_title:R[n.assigned_group]||n.assigned_group})),getRowId:n=>n.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:200,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},c)]})};export{B as default};
