import{r as i,j as e,A as V}from"./index-B4Yyn_e3.js";/* empty css           */import{M as se,V as ie,T as ae,O as ce,a as G,b as B,S as H,C as re,c as O,F as Z,f as le,d as oe,P as ne}from"./OSM-xj16LtVI.js";import{G as de}from"./GeoJSON-X8m8cf5v.js";import{t as ue}from"./terraformer-wkt-parser-C0Lol2vK.js";import{s as y,i as me,j as ge,k as ye,l as A,h as fe}from"./index-CEaiGlSZ.js";import{D as xe,a as pe,b as he,c as Ce,B as be,M as je}from"./index.esm-DQ5xyWPR.js";import{P as we}from"./TextField-CTAYyKbu.js";import{T as De}from"./FormControlLabel-BQ4LaRk8.js";import"./DefaultPropsProvider-Dxaa7F9g.js";import"./emotion-element-f0de968e.browser.esm-D-FlQB8p.js";import"./Modal-AKqUA7L2.js";import"./setPrototypeOf-C3V6guyq.js";import"./Autocomplete-Ba7F61HC.js";import"./assertThisInitialized-CUNnMRSQ.js";import"./Box-C4R34K36.js";import"./Divider-BmRGXkoa.js";import"./index-wc-c60si.js";function _e(m){switch(m){case"Producer":return"#FB923C";case"Distributor":return"#3B82F6";case"Collector":return"#FBBF24";case"Recycler":return"#22C55E";default:return"gray"}}const p=[{key:"Produced",bgColor:"bg-orange-500",icon:e.jsx(me,{className:"text-white text-3xl"}),info:"Produced: Total amount (Kg/Day) calculated by summing the 'Average Production Capacity (Kg/day)' from all Producer registrations."},{key:"Distributed",bgColor:"bg-blue-500",icon:e.jsx(ge,{className:"text-white text-3xl"}),info:"Distributed: Total amount (Kg/Day) calculated by summing the 'Average Sale (Kg/day)' from all Distributor registrations."},{key:"Collected",bgColor:"bg-yellow-500",icon:e.jsx(ye,{className:"text-white text-3xl"}),info:"Collected: Total amount (Kg/Day) calculated by summing the 'Average Collection (Kg/day)' from all Collector registrations."},{key:"W-Collected",bgColor:"bg-yellow-500",icon:e.jsx(A,{className:"text-white text-3xl"}),info:"Waste Collected: Total waste amount (Kg/Day) calculated by summing the 'Average Waste Collection (Kg/day)' from all Recycler registrations."},{key:"Recycled",bgColor:"bg-green-500",icon:e.jsx(A,{className:"text-white text-3xl"}),info:"Recycled: Total recycled waste (Kg/Day) calculated by summing the 'Average Waste Disposal (Kg/day)' from all Recycler registrations."},{key:"Un-Managed",bgColor:"bg-gray-500",icon:e.jsx(fe,{className:"text-white text-3xl"}),info:"Unmanaged Waste: Calculated as the higher of Collected or Waste Collected minus Recycled. Indicates the waste not managed by recycling."}],J=[{key:"Recycling Efficiency",bgColor:"bg-green-500",icon:e.jsx(A,{className:"text-white text-3xl"}),info:"Recycling Efficiency (%): Indicates how effectively waste is recycled. Calculated as (Recycled ÷ Maximum of Collected or Waste Collected) × 100."}],Je=()=>{const m=i.useRef(null),[r,k]=i.useState(null),[u,w]=i.useState(null),[h,l]=i.useState(null),[D,n]=i.useState(null),[_,E]=i.useState(null),[d,g]=i.useState([]),[$,ke]=i.useState([]),[C,b]=i.useState(null),[j,N]=i.useState(["Produced","Distributed","Collected","W-Collected","Recycled"]),[M,q]=i.useState(!1),[P,Ee]=i.useState([8054803349056441e-9,3.6232483407283584e6]),[T,Ne]=i.useState(6.53343814691434),[Q,R]=i.useState(4),[S,W]=i.useState({open:!1,title:"",content:""}),L=(s,t)=>{W({open:!0,title:s,content:t})},I=()=>{W({open:!1,title:"",content:""})};i.useEffect(()=>{const s=new se({target:m.current,layers:[new ae({source:new ce})],view:new ie({zoom:7,center:[8127130,3658593]})}),t=new G({source:new B});return s.addLayer(t),w(t),k(s),()=>s.setTarget(null)},[]),i.useEffect(()=>{if(!r)return;const s=new G({source:new B,style:t=>{const a=t.get("category");return new H({image:new re({radius:Q,fill:new Z({color:_e(a)}),stroke:new O({color:"#fff",width:1})})})}});r.addLayer(s),l(s)},[r]),i.useEffect(()=>{(async()=>{try{const t=await V.get("/pmc/mis-district-plastic-stats/");g(t.data)}catch(t){console.error("Error fetching applicant data:",t)}})()},[]);const v=i.useMemo(()=>C?d.filter(s=>s.district_name===C):d,[C,d]),K=i.useMemo(()=>v.filter(s=>j),[v,j]);i.useEffect(()=>{if(!h)return;const s=h.getSource();s.clear(),K.forEach(t=>{if(t.latitude&&t.longitude){const a=le([Number(t.longitude),Number(t.latitude)]),c=new oe({geometry:new ne(a)});s.addFeature(c)}})},[K,h]),i.useEffect(()=>{if(!r||!u||M)return;(async()=>{let t=_;t||(t=(await V.get("/pmc/districts-public")).data.filter(te=>te.geom));const c={type:"FeatureCollection",features:t.map(x=>({type:"Feature",geometry:ue.parse(x.geom.replace("SRID=4326;","")),properties:{district_id:x.district_id,district_name:x.district_name,district_code:x.district_code}}))},o=u.getSource();o.clear(),o.addFeatures(new de().readFeatures(c,{featureProjection:"EPSG:3857"}));const F=o.getExtent();r.getView().fit(F,{padding:[50,50,50,50],maxZoom:10}),q(!0)})()},[r,u,M,_]),i.useEffect(()=>{u&&u.setStyle(s=>{const t=s.get("district_id"),a=d.find(o=>o.district_id===t);let c="rgba(200, 200, 200, 0.5)";if(a){let o=a.recycling_efficiency||0;o=Math.max(0,Math.min(o,100)),o<=0?c="rgba(255, 99, 71, 0.8)":o<20?c="rgba(255, 165, 0, 0.8)":o<50?c="rgba(144, 238, 144, 0.8)":o<80?c="rgba(34, 197, 94, 0.8)":c="rgba(0, 128, 0, 0.8)"}return new H({stroke:new O({color:"black",width:1}),fill:new Z({color:c})})})},[u,d]),i.useEffect(()=>{if(!r||!u)return;const s=t=>{const a=r.getFeaturesAtPixel(t.pixel);if(a&&a.length>0){const c=a[0],o=c.getProperties(),F=o.district_name;if(C===F)b(null),n(null),r.getView().setCenter(P),r.getView().setZoom(T),R(3);else{b(F),n(o.district_id),R(5);const x=c.getGeometry();r.getView().fit(x.getExtent(),{padding:[50,50,50,50],maxZoom:10})}}else b(null),n(null),R(3),r.getView().setCenter(P),r.getView().setZoom(T)};return r.on("click",s),()=>r.un("click",s)},[r,u,C]);function X(s){return s.reduce((t,a)=>{t.Produced+=a.produced_kg_per_day||0,t.Distributed+=a.distributed_kg_per_day||0,t.Collected+=a.collected_kg_per_day||0,t["W-Collected"]+=a.waste_collected_kg_per_day||0,t.Recycled+=a.waste_disposed_kg_per_day||0,t["Un-Managed"]+=a.unmanaged_waste_kg_per_day||0;const c=Math.max(t.Collected,t["W-Collected"]);return t["Recycling Efficiency"]=c>0?Math.max(0,(t.Recycled/c*100).toFixed(2)):"0.00",t.districtCount+=1,t},{Produced:0,Distributed:0,Collected:0,"W-Collected":0,Recycled:0,"Un-Managed":0,"Recycling Efficiency":0,districtCount:0})}const z=X(v);console.log(z);const Y=j.reduce((s,t)=>s+z[t],0),[f,U]=i.useState([]),ee=s=>{let t;typeof s=="function"?U(a=>(t=s(a),t)):(U(s),t=s)};return i.useEffect(()=>{let s=[];Array.isArray(f)?s=f:typeof f=="object"&&f!==null&&(s=Object.values(f));let t=null,a=["Producer","Distributor","Collector","Recycler"];s.forEach(c=>{c.id==="district_name"&&(t=c.value||null),c.id==="category"&&c.value&&(a=[c.value])}),b(t),N(a)},[f]),e.jsxs("div",{children:[e.jsx(Se,{stats:z,enabledCategories:j,setEnabledCategories:N,enabledTotal:Y,openModal:L}),e.jsxs("div",{className:"",children:[e.jsx("div",{className:"flex justify-center mt-4 mb-4",children:e.jsx("div",{ref:m,style:{height:"600px",width:"1000px"},className:"mb-4 mt-4"})}),e.jsx("div",{className:"",children:e.jsx(Fe,{data:K,selectedDistrict:C,setSelectedDistrict:b,enabledCategories:j,setEnabledCategories:N,columnFilters:f,districtOptions:$,onColumnFiltersChange:ee,openModal:L})})]}),e.jsxs(xe,{open:S.open,onClose:I,children:[e.jsx(pe,{children:S.title}),e.jsxs(he,{children:[e.jsx("p",{children:S.content}),S.title==="Recycling Efficiency"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{children:"District Color Coding:"}),e.jsxs("ul",{className:"list-disc pl-4 mt-2",children:[e.jsxs("li",{children:[e.jsx("span",{style:{color:"#FF6347"},children:"■"})," Tomato Red (0%): Critical"]}),e.jsxs("li",{children:[e.jsx("span",{style:{color:"#FFA500"},children:"■"})," Orange (1-19%): Very Low Efficiency"]}),e.jsxs("li",{children:[e.jsx("span",{style:{color:"#90EE90"},children:"■"})," Light Green (20-49%): Moderate Efficiency"]}),e.jsxs("li",{children:[e.jsx("span",{style:{color:"#22C55E"},children:"■"})," Medium Green (50-79%): Good Efficiency"]}),e.jsxs("li",{children:[e.jsx("span",{style:{color:"#008000"},children:"■"})," Dark Green (80-100%): Excellent Efficiency"]})]})]})]}),e.jsx(Ce,{children:e.jsx(be,{onClick:I,variant:"contained",autoFocus:!0,children:"OK"})})]})]})},Se=({stats:m,enabledCategories:r,setEnabledCategories:k,enabledTotal:u,openModal:w})=>{function h(l){return m[l]||0}return e.jsx(e.Fragment,{children:e.jsxs(we,{elevation:3,sx:{p:2,border:"1px solid #ccc",borderRadius:2,position:"relative"},className:"",children:[e.jsx(De,{variant:"h6",sx:{position:"absolute",top:-16,left:16,backgroundColor:"white",px:1,fontWeight:"bold",color:"gray"},children:"Amount of Plastic Flow (Kg/Day)"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-5 gap-4",children:p.concat(J).map(l=>{const D=h(l.key);return e.jsxs("div",{className:`flex items-center justify-start p-4 rounded-lg shadow-md transition cursor-pointer opacity-100 ${l.bgColor} ${l.key==="Un-Managed"||l.key==="Recycling Efficiency"?"col-span-2":""}`,children:[e.jsx("div",{className:"mr-3",children:l.icon}),e.jsxs("h2",{className:"text-lg font-bold text-white",children:[l.key," ",l.key==="Recycling Efficiency"?`${D}%`:D.toFixed(0)]}),e.jsx(y,{className:"ml-auto cursor-pointer text-white",onClick:()=>w(l.key,l.info)})]},l.key)})})]})})},Fe=({data:m,selectedDistrict:r,setSelectedDistrict:k,enabledCategories:u,setEnabledCategories:w,columnFilters:h,districtOptions:l,onColumnFiltersChange:D,openModal:n})=>{console.log("districtOptions",l);const _=i.useMemo(()=>[{accessorKey:"district_name",header:"District",minSize:50,maxSize:50,size:50},{accessorKey:"produced_kg_per_day",header:"Produced (Kg/day)",Header:({column:E})=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Produced (Kg/day)"}),e.jsx(y,{className:"ml-1 cursor-pointer text-blue-500",onClick:()=>n("Produced",p[0].info)})]}),minSize:50,maxSize:50,size:50},{accessorKey:"distributed_kg_per_day",header:"Distributed (Kg/day)",Header:()=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Distributed (Kg/day)"}),e.jsx(y,{className:"ml-1 cursor-pointer text-blue-500",size:22,onClick:()=>n("Distributed",p[1].info)})]}),minSize:50,maxSize:50,size:50},{accessorKey:"collected_kg_per_day",header:"Collected (Kg/day)",Header:()=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Collected (Kg/day)"}),e.jsx(y,{className:"ml-1 cursor-pointer text-blue-500",onClick:()=>n("Collected",p[2].info)})]}),minSize:50,maxSize:50,size:50},{accessorKey:"waste_collected_kg_per_day",header:"Waste Collected (Kg/day)",Header:()=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Waste Collected (Kg/day)"}),e.jsx(y,{className:"ml-1 cursor-pointer text-blue-500",size:25,onClick:()=>n("Waste Collected",p[3].info)})]}),minSize:50,maxSize:50,size:50},{accessorKey:"waste_disposed_kg_per_day",header:"Waste Recycled (Kg/day)",Header:()=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Waste Recycled (Kg/day)"}),e.jsx(y,{className:"ml-1 cursor-pointer text-blue-500",size:25,onClick:()=>n("Recycled",p[4].info)})]}),minSize:50,maxSize:50,size:50},{accessorKey:"unmanaged_waste_kg_per_day",header:"Unmanaged Waste (Kg/day)",Header:()=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Unmanaged Waste (Kg/day)"}),e.jsx(y,{className:"ml-1 cursor-pointer text-blue-500",size:25,onClick:()=>n("Un-Managed",p[5].info)})]}),minSize:50,maxSize:50,size:50},{accessorKey:"recycling_efficiency",header:"Recycling Efficiency (%)",Header:()=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{children:"Recycling Efficiency (%)"}),e.jsx(y,{className:"ml-1 cursor-pointer text-blue-500",size:25,onClick:()=>n("Recycling Efficiency",J[0].info)})]}),minSize:50,maxSize:50,size:50,Cell:({cell:E})=>{const d=parseFloat(E.getValue())||0;let g="";return d<=0?g="#FF6347":d<20?g="#FFA500":d<50?g="#90EE90":d<80?g="#22C55E":g="#008000",e.jsxs("span",{style:{color:g,fontWeight:"bold"},children:[d.toFixed(2),"%"]})}}],[m]);return e.jsx(je,{columns:_,data:m,initialState:{showColumnFilters:!1,pagination:{pageSize:10}}})};export{Je as default};
