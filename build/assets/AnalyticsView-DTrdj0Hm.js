import{r as l,V as E,j as e,A as T}from"./index-BsYDAXCC.js";import{_ as V}from"./KPIDashboard-Cut_VuX1.js";import{M}from"./index.esm-O3pBcoHS.js";import{b as R,c as U,d as B,e as L,f as O}from"./index-aLQRHTX_.js";import"./index-CnKXuH36.js";import"./TextField-BV38zarO.js";import"./Divider-DN0QPZAZ.js";import"./FormControlLabel-CavGxzr0.js";import"./Autocomplete-CDdIRmOW.js";const z=({loginUrl:b="/sign-in"})=>{const[g,h]=l.useState([]),[x,c]=l.useState([]),[o,D]=l.useState(null),[_,A]=l.useState(""),[N,k]=l.useState(""),S=E();l.useEffect(()=>{(async()=>{var a,i;try{const r=await T.get("/pmc/applicant-statistics/",{headers:{"Content-Type":"multipart/form-data"}});console.log(r.data);const{district_data:n,registration_statistics:y,grid_data:w}=r.data;if(!n||!Array.isArray(n))throw new Error("Invalid district_data format");if(!y||!Array.isArray(y))throw new Error("Invalid registration_statistics format");if(!w||!Array.isArray(w))throw new Error("Invalid grid_data format");const $={Total:e.jsx(R,{className:"text-white text-3xl"}),Producer:e.jsx(U,{className:"text-white text-3xl"}),Consumer:e.jsx(B,{className:"text-white text-3xl"}),Recycler:e.jsx(L,{className:"text-white text-3xl"}),Collector:e.jsx(O,{className:"text-white text-3xl"})},F={Producer:"bg-orange-500",Consumer:"bg-blue-500",Recycler:"bg-green-500",Collector:"bg-yellow-500"},K=r.data.registration_statistics.map(s=>({title:s.registration_for,data:[{value:s.Applications,label:"Applications",title:"Applications"},{value:s.DO,label:"DO",title:"District Officer (Environment)/Assistant/Deputy Director/District In-Charge"},{value:s.PMC,label:"PMC",title:"Plastic Management Cell"},{value:s.APPLICANT,label:"Applicant",title:"Applicant"},{value:s.Licenses,label:"Licenses",title:"Licenses"}],color:F[s.registration_for]||"bg-gray-500",icon:$[s.registration_for]||null})),m=Array.from(new Set(n.map(s=>{var d;return((d=s.businessprofile__district__district_name)==null?void 0:d.trim())||"Unknown"}).filter(s=>s!=="Unknown"))),j=Array.from(new Set(n.map(s=>s.registration_for||"Unknown").filter(s=>s!=="Unknown"))).map(s=>{const d=m.map(f=>{const u=r.data.district_data.find(p=>p.registration_for===s&&p.businessprofile__district__district_name===f);return u?u.count:0});return{name:s,data:d}});D({series:j,options:{chart:{type:"bar",height:550,stacked:!0,events:{dataPointSelection:(s,d,f)=>{const{seriesIndex:u,dataPointIndex:p}=f,v=j[u].name,C=m[p];I(v,C),console.log(`Series: ${v}, Category: ${C}`)}}},title:{text:"Applications by Category and District"},xaxis:{categories:m},legend:{position:"right"},plotOptions:{bar:{horizontal:!1,borderRadius:5}},colors:["#F97316","#3B82F6","#22C55E","#EAB308"]}}),h(K),c(r.data.grid_data)}catch(r){const n={status:(a=r.response)==null?void 0:a.status,data:(i=r.response)==null?void 0:i.data,message:r.message};S("/error",{state:{error:n}})}})()},[]);const P=[{accessorKey:"tracking_number",header:"Tracking Number",size:150,Cell:({cell:t,row:a})=>{const r=`/spuid-review/${a.original.id}`;return e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:t.getValue()||"-"})}},{accessorKey:"first_name",header:"First Name",Cell:({cell:t,row:a})=>{const r=`/spuid-review/${a.original.id}`;return e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:t.getValue()||"-"})}},{accessorKey:"last_name",header:"Last Name",Cell:({cell:t,row:a})=>{const r=`/spuid-review/${a.original.id}`;return e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:t.getValue()||"-"})}},{accessorKey:"cnic",header:"CNIC",Cell:({cell:t,row:a})=>{const r=`/spuid-review/${a.original.id}`;return e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:t.getValue()||"-"})}},{accessorKey:"mobile_no",header:"Mobile No",Cell:({cell:t,row:a})=>{const r=`/spuid-review/${a.original.id}`;return e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:t.getValue()||"-"})}},{accessorKey:"application_status",header:"Status",Cell:({cell:t,row:a})=>{const r=`/spuid-review/${a.original.id}`;return e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:t.getValue()||"-"})}},{accessorKey:"assigned_group",header:"Assigned Group",Cell:({cell:t,row:a})=>{const r=`/spuid-review/${a.original.id}`;return e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:t.getValue()||"-"})}},{accessorKey:"registration_for",header:"Category",Cell:({cell:t,row:a})=>{const r=`/spuid-review/${a.original.id}`;return e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:t.getValue()||"-"})}}];function I(t,a){A(a),k(t),console.log("District calculated: ",a),console.log("seriesName calculated: ",t)}return console.log("chartData",o),e.jsxs("div",{className:"dashboard-container flex flex-col flex-auto",children:[e.jsx("header",{className:"dashboard-header",children:e.jsx("h1",{children:"Admin - Data Analytics"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:g.map((t,a)=>e.jsx(G,{title:t.title,data:t.data,color:t.color,icon:t.icon},a))}),e.jsx("div",{id:"chart",className:"mt-5",children:o&&o.series&&o.options&&e.jsx(V,{options:o.options,series:o.series,type:"bar",height:350})}),_!==""&&e.jsx("div",{className:"mt-2",children:e.jsx(M,{columns:P,data:x.filter(t=>t.businessprofile__district__district_name===_&&t.registration_for===N),initialState:{},enableColumnResizing:!0})})]})},re=()=>e.jsx(z,{}),G=({title:b,data:g,color:h,icon:x})=>e.jsxs("div",{className:`shadow-md rounded p-6 w-full ${h}`,children:[e.jsxs("div",{className:"flex items-center mb-4",children:[x,e.jsx("h2",{className:"text-2xl font-bold text-white ml-2",children:b})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:g.map((c,o)=>e.jsxs("div",{className:"text-center",title:c.title,children:[" ",e.jsx("p",{className:"text-3xl font-bold text-white",children:c.value}),e.jsx("p",{className:"text-sm text-white",children:c.label})]},o))})]});export{z as KPIDashboardBase,re as default};
