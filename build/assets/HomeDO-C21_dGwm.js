import{r as l,U as I,j as m,A as h}from"./index-TLmqPQHU.js";import{M as N}from"./index.esm-CIgfkhTj.js";import"./TextField-7Bf9o3zK.js";import"./Divider-DZmAm2nX.js";import"./FormControlLabel-DXCY1eR7.js";import"./Autocomplete-CnRztLJk.js";import"./index-Bg0iy7Ql.js";const k=e=>{var i,d,D;const n=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(c=>c.assigned_group==="APPLICANT"&&c.remarks&&c.remarks!=="undefined").map(c=>c.remarks),p=n.length>0?n.join("; "):"N/A";return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,cnic:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,application_Start_Time:((i=e.created_at)==null?void 0:i.substring(0,16))||"N/A",application_Submission_Time:((D=(d=e.submittedapplication)==null?void 0:d.created_at)==null?void 0:D.substring(0,16))||"N/A",remarks:p}},y=e=>e.map(g=>{const n=k(g);return Object.keys(n).forEach(p=>{(n[p]===void 0||n[p]===null)&&(n[p]="N/A")}),n}),U=()=>{const[e,g]=l.useState([]),[n,p]=l.useState([]),[i,d]=l.useState(null),[D,c]=l.useState(0),[f,A]=l.useState(null),[E,x]=l.useState({});console.log(f);const C=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],R={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},O=(s,_,a)=>{const T=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],u=y(s),L=u[0];console.log(s);const o=[...Object.keys(L).filter(t=>T.includes(t)).map(t=>({accessorKey:t,header:t.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),size:200,Cell:({cell:r,row:b})=>m.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const w=b.original.id;console.log(`Clicked ${t}:`,r.getValue()),console.log(`Navigating with ID: ${w}`),window.location.href=_?`/spuid-review/${w}?group=${a}`:`/spuid-signup/${w}`},children:r.getValue()||"-"})}))];return{flattenedData:u,columns:o}},S=I();return l.useEffect(()=>{(async()=>{try{const a=await h.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{S("/error")}try{let a=[];try{a=(await h.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],d(a.map(t=>t.name))}catch(o){console.error("Error fetching user groups:",o),d([])}console.log("groupsResponse",a);const u=(await h.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(u)&&u.length>0){const o=O(u,a.length>0,a.map(r=>r.name)[0]);g(o.flattenedData),p(o.columns),console.log("Flattened Data:",o.flattenedData);const t=o.flattenedData[o.flattenedData.length-1];if(console.log("Last Row:",t),t&&t.id){A(t.id),console.log("Last Row ID:",t.id);const r=C.indexOf(t.assigned_group);r!==-1&&c(r)}}const L=await h.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});x(L.data)}catch(a){console.error("Error fetching data:",a)}})(),A(25);const _=C.indexOf("LSO");_!==-1&&c(_)},[]),l.useEffect(()=>{console.log("userGroups:",i),i&&!i.includes("DO")&&S("/home")},[i,S]),console.log("selectedRowId:",f),console.log(f),m.jsxs("div",{children:[m.jsx("div",{className:"mb-4",children:m.jsxs("h3",{children:[i&&i.filter(s=>s!=="Download License"&&s!=="Applicant"&&s!=="LSM2").join(" - ")," Dashboard"]})}),m.jsx(N,{columns:[...n],data:e.map(s=>({...s,assigned_group_title:R[s.assigned_group]||s.assigned_group})),getRowId:s=>s.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:1,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},f)]})};export{U as default};
