import{r as s,j as o,A as L,$ as Y}from"./index-D62TTXsO.js";import{M as ee,V as te,T as se,O as re,a as V,b as I,S as B,C as ce,c as K,F as G,f as oe,d as ae,P as ie}from"./OSM-Bx5l-N5p.js";import{G as le}from"./GeoJSON-BAwyf57_.js";import{t as ne}from"./terraformer-wkt-parser-BeUE_zJd.js";import{h as ue,i as Z,j as O,k as U,l as J}from"./index-Dw_UNSBI.js";import{M as de}from"./index.esm-CKQvFv7p.js";import"./TextField-DtZF9weG.js";import"./DefaultPropsProvider-Hi5WCJnN.js";import"./Autocomplete-DtfBTtM4.js";import"./FormControlLabel-CtCpsWNl.js";import"./Divider-kuOxbgFU.js";import"./index-DKZsV2M2.js";function me(n){switch(n){case"Producer":return"#FB923C";case"Distributor":return"#3B82F6";case"Collector":return"#FBBF24";case"Recycler":return"#22C55E";default:return"gray"}}const Te=()=>{const n=s.useRef(null),[r,m]=s.useState(null),[l,b]=s.useState(null),[f,h]=s.useState(null),[w,c]=s.useState(null),[g,F]=s.useState(null),[S,E]=s.useState([]),[p,j]=s.useState([]),[u,D]=s.useState(null),[C,k]=s.useState(["Producer","Distributor","Collector","Recycler"]),[z,$]=s.useState(!1),[R,pe]=s.useState([8054803349056441e-9,3.6232483407283584e6]),[v,he]=s.useState(6.53343814691434),[q,_]=s.useState(4);s.useEffect(()=>{const t=new ee({target:n.current,layers:[new se({source:new re})],view:new te({zoom:7,center:[8127130,3658593]})}),e=new V({source:new I});return t.addLayer(e),b(e),m(t),()=>t.setTarget(null)},[]),s.useEffect(()=>{if(!r)return;const t=new V({source:new I,style:e=>{const a=e.get("category");return new B({image:new ce({radius:q,fill:new G({color:me(a)}),stroke:new K({color:"#fff",width:1})})})}});r.addLayer(t),h(t)},[r]),s.useEffect(()=>{(async()=>{try{const e=await L.get("/pmc/applicant-location-public/");E(e.data);const a=new Set(e.data.map(d=>d.district_name).filter(Boolean)),i=Array.from(a).sort();j(i)}catch(e){console.error("Error fetching applicant data:",e)}})()},[]);const P=s.useMemo(()=>u?S.filter(t=>t.district_name===u):S,[u,S]),T=s.useMemo(()=>P.filter(t=>C.includes(t.category)),[P,C]);s.useEffect(()=>{if(!f)return;const t=f.getSource();t.clear(),T.forEach(e=>{if(e.latitude&&e.longitude){const a=oe([Number(e.longitude),Number(e.latitude)]),i=new ae({geometry:new ie(a),category:e.category});t.addFeature(i)}})},[T,f]),s.useEffect(()=>{if(!r||!l||z)return;(async()=>{let e=g;e||(e=(await L.get("/pmc/districts-public")).data.filter(X=>X.geom));const i={type:"FeatureCollection",features:e.map(x=>({type:"Feature",geometry:ne.parse(x.geom.replace("SRID=4326;","")),properties:{district_id:x.district_id,district_name:x.district_name,district_code:x.district_code}}))},d=l.getSource();d.clear(),d.addFeatures(new le().readFeatures(i,{featureProjection:"EPSG:3857"}));const N=d.getExtent();r.getView().fit(N,{padding:[50,50,50,50],maxZoom:10}),$(!0)})()},[r,l,z,g]),s.useEffect(()=>{l&&l.setStyle(t=>{const e=t.get("district_id")===w;return new B({stroke:new K({color:e?"red":"blue",width:e?3:2}),fill:new G({color:e?"rgba(255, 0, 0, 0.1)":"rgba(0, 0, 255, 0.1)"})})})},[l,w]),s.useEffect(()=>{if(!r||!l)return;const t=e=>{const a=r.getFeaturesAtPixel(e.pixel);if(a&&a.length>0){const i=a[0],d=i.getProperties(),N=d.district_name;if(u===N)D(null),c(null),r.getView().setCenter(R),r.getView().setZoom(v),_(3);else{D(N),c(d.district_id),_(5);const x=i.getGeometry();r.getView().fit(x.getExtent(),{padding:[50,50,50,50],maxZoom:10})}}else D(null),c(null),_(3),r.getView().setCenter(R),r.getView().setZoom(v)};return r.on("click",t),()=>r.un("click",t)},[r,l,u]);function H(t){const e={Total:t.length,Producer:0,Distributor:0,Collector:0,Recycler:0};return t.forEach(a=>{a.category==="Producer"&&e.Producer++,a.category==="Distributor"&&e.Distributor++,a.category==="Collector"&&e.Collector++,a.category==="Recycler"&&e.Recycler++}),e}const A=H(P),W=C.reduce((t,e)=>t+A[e],0),[y,M]=s.useState([]),Q=t=>{let e;typeof t=="function"?M(a=>(e=t(a),e)):(M(t),e=t)};return s.useEffect(()=>{let t=[];Array.isArray(y)?t=y:typeof y=="object"&&y!==null&&(t=Object.values(y));let e=null,a=["Producer","Distributor","Collector","Recycler"];t.forEach(i=>{i.id==="district_name"&&(e=i.value||null),i.id==="category"&&i.value&&(a=[i.value])}),D(e),k(a)},[y]),o.jsxs("div",{children:[o.jsx(fe,{stats:A,enabledCategories:C,setEnabledCategories:k,enabledTotal:W}),o.jsxs("div",{className:"flex flex-col md:flex-row",children:[o.jsx("div",{ref:n,style:{height:"600px",width:"500px"},className:"mb-4"}),o.jsx("div",{className:"ml-4 flex-grow",children:o.jsx(xe,{data:T,selectedDistrict:u,setSelectedDistrict:D,enabledCategories:C,setEnabledCategories:k,columnFilters:y,districtOptions:p,onColumnFiltersChange:Q})})]})]})},fe=({stats:n,enabledCategories:r,setEnabledCategories:m,enabledTotal:l})=>{const b=c=>{if(c==="Total"){r.length===4?m([]):m(["Producer","Distributor","Collector","Recycler"]);return}r.includes(c)?m(r.filter(g=>g!==c)):m([...r,c])},f=c=>c==="Total"?r.length>0:r.includes(c);function h(c){return c==="Total"?f("Total")?l:0:n[c]||0}const w=[{key:"Total",bgColor:"bg-gray-500",icon:o.jsx(ue,{className:"text-white text-3xl"})},{key:"Producer",bgColor:"bg-orange-500",icon:o.jsx(Z,{className:"text-white text-3xl"})},{key:"Distributor",bgColor:"bg-blue-500",icon:o.jsx(O,{className:"text-white text-3xl"})},{key:"Collector",bgColor:"bg-yellow-500",icon:o.jsx(U,{className:"text-white text-3xl"})},{key:"Recycler",bgColor:"bg-green-500",icon:o.jsx(J,{className:"text-white text-3xl"})}];return o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4",children:w.map(c=>{const g=f(c.key),F=h(c.key);return o.jsx("div",{onClick:()=>b(c.key),className:`shadow-md rounded p-6 w-full cursor-pointer transition
              ${g?"opacity-100":"opacity-50"}
              ${c.bgColor}
            `,children:o.jsxs("div",{className:"flex items-center space-x-2",children:[c.icon,o.jsx("h2",{className:"text-2xl font-bold text-white",children:c.key}),o.jsx("p",{className:"text-2xl font-bold text-white",children:F})]})},c.key)})})},ge={Producer:o.jsx(Z,{className:"text-xl"}),Distributor:o.jsx(O,{className:"text-xl"}),Collector:o.jsx(U,{className:"text-xl"}),Recycler:o.jsx(J,{className:"text-xl"})},ye={Producer:"text-orange-500",Distributor:"text-blue-500",Collector:"text-yellow-500",Recycler:"text-green-500"},xe=({data:n,selectedDistrict:r,setSelectedDistrict:m,enabledCategories:l,setEnabledCategories:b,columnFilters:f,districtOptions:h,onColumnFiltersChange:w})=>{const c=Y(),F=new URLSearchParams(c.search).get("viewAll")==="true",S=s.useMemo(()=>[{accessorKey:"district_name",header:"District",minSize:50,maxSize:50,size:50},{accessorKey:"tehsil_name",header:"Tehsil",minSize:50,maxSize:50,size:50},{accessorKey:"category",header:"Category",Cell:({cell:E})=>{const p=E.getValue(),j=ge[p],u=ye[p]||"text-gray-500";return j?o.jsxs("div",{className:`flex items-center ${u}`,children:[j,o.jsx("span",{className:"ml-1",children:p})]}):p},minSize:50,maxSize:50,size:50},{accessorKey:"business_name",header:"Business Name",minSize:50,maxSize:50,size:50},{accessorKey:"postal_address",header:"Postal Address",minSize:50,maxSize:100,size:100},{accessorKey:"material_flow_kg_per_day",header:"Material Flow (Kg/Day)",minSize:50,maxSize:100,size:100}],[h]);return o.jsx(de,{columns:S,data:n,initialState:{showColumnFilters:!1,pagination:{pageSize:F?1e5:5}}})};export{Te as default};
