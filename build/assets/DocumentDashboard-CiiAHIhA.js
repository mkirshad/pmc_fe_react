import{G as F,r as d,k as m,j as e,A as D}from"./index-DJi4Zqjc.js";import{T as _}from"./index-lQQSLi56.js";import{b as K}from"./isNil-xlZo68mk.js";import{u as U,F as E,a as i,C as c}from"./index.esm-D0C0e4jY.js";import{t as w,z as l}from"./index-6MHWSehF.js";import{M as B}from"./index.esm-Cj9f8FT7.js";import{B as A}from"./Button-CXBYP7F7.js";import{C as I}from"./Card-V0l_CcCK.js";import{I as h}from"./Input-CgA4Mobu.js";import{S as L}from"./Select-Crjraat8.js";import{m as O}from"./index-Unbb-A4X.js";import"./useControllableState-BluMbtF5.js";import"./classNames-CCasXtN5.js";import"./index-ChXtDgIW.js";import"./TextField-zZrTmBFB.js";import"./DefaultPropsProvider-VWlBNndu.js";import"./Autocomplete-Hq7eg0h_.js";import"./FormControlLabel-CEtaxQ4K.js";import"./Divider-Cn_E8RVp.js";import"./index-DW4sZk_T.js";import"./floating-ui.dom-CrKScG7J.js";function k(o){return F({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M512 1024c-69.1 0-136.2-13.5-199.3-40.2C251.7 958 197 921 150 874c-47-47-84-101.7-109.8-162.7C13.5 648.2 0 581.1 0 512c0-19.9 16.1-36 36-36s36 16.1 36 36c0 59.4 11.6 117 34.6 171.3 22.2 52.4 53.9 99.5 94.3 139.9 40.4 40.4 87.5 72.2 139.9 94.3C395 940.4 452.6 952 512 952c59.4 0 117-11.6 171.3-34.6 52.4-22.2 99.5-53.9 139.9-94.3 40.4-40.4 72.2-87.5 94.3-139.9C940.4 629 952 571.4 952 512c0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.2C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3s-13.5 136.2-40.2 199.3C958 772.3 921 827 874 874c-47 47-101.8 83.9-162.7 109.7-63.1 26.8-130.2 40.3-199.3 40.3z"},child:[]}]})(o)}const q=l.object({title:l.string().min(3,"Title must be at least 3 characters"),documentType:l.enum(["Notification","Minutes of Meeting"],{required_error:"Select a document type"}),file:l.instanceof(File,{message:"Must be a valid file"}).optional(),document_date:l.string().min(1,{message:"Document Date is required!"})}),G=()=>{var j,b,y,v,T;const[o,u]=d.useState([]),[p,r]=d.useState(!1),f=m(t=>t.user.district_id)||null;m(t=>t.user.district_name);const{handleSubmit:C,control:n,setValue:P,reset:M,formState:{errors:s,isSubmitting:g}}=U({resolver:w(q),defaultValues:{title:"",documentType:"Notification",file:null}}),x=()=>{r(!0),D.get("/pmc/district-documents/").then(t=>u(t.data)).catch(t=>console.error("Error fetching documents:",t)).finally(()=>r(!1))};d.useEffect(()=>{x()},[]);const S=async t=>{const a=new FormData;a.append("district_id",(f==null?void 0:f.toString())||"0"),a.append("document_type",t.documentType),a.append("title",t.title),a.append("document",t.file),t.document_date&&a.append("document_date",t.document_date);try{await D.post("/pmc/district-documents/",a,{headers:{"Content-Type":"multipart/form-data"}}),alert("Document uploaded successfully!"),x(),M()}catch(z){console.error("Error uploading document:",z),alert("Failed to upload document.")}},N=[{accessorKey:"district_name",header:"District",size:200},{accessorKey:"document_type",header:"Type",size:150},{accessorKey:"title",header:"Title",size:300},{accessorKey:"document_date",header:"Document Date",size:200},{accessorKey:"uploaded_at",header:"Uploaded On",size:200},{accessorKey:"uploaded_by_name",header:"Uploaded By",size:200},{accessorKey:"file",header:"Download",size:100,Cell:({row:t})=>e.jsx("a",{href:t.original.file,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600",children:"Download"})}];return e.jsxs(I,{children:[e.jsx(E,{onSubmit:C(S),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsx(i,{label:"Document Title",invalid:!!s.title,errorMessage:(j=s.title)==null?void 0:j.message,children:e.jsx(c,{name:"title",control:n,render:({field:t})=>e.jsx(h,{...t,placeholder:"Enter document title"})})}),e.jsx(i,{label:"Document Type",invalid:!!s.documentType,errorMessage:(b=s.documentType)==null?void 0:b.message,children:e.jsx(c,{name:"documentType",control:n,render:({field:t})=>e.jsx(L,{options:[{label:"Notification",value:"Notification"},{label:"Minutes of Meeting",value:"Minutes of Meeting"}],value:{label:t.value,value:t.value},onChange:a=>t.onChange(a==null?void 0:a.value)})})}),e.jsx(i,{label:"Document Date",invalid:!!s.document_date,errorMessage:(y=s.document_date)==null?void 0:y.message,children:e.jsx(c,{name:"document_date",control:n,render:({field:t})=>e.jsx(h,{type:"date",...t})})}),e.jsx(i,{label:"Upload File",invalid:!!s.file,errorMessage:(v=s.file)==null?void 0:v.message,children:e.jsx(c,{name:"file",control:n,render:({field:t})=>e.jsx(h,{type:"file",accept:".pdf,.png,.jpg,.jpeg,.doc,.docx,.xls,.xlsx",onChange:a=>t.onChange(a.target.files[0])})})}),e.jsx(i,{className:"mt-7",invalid:!!s.file,errorMessage:(T=s.file)==null?void 0:T.message,children:e.jsx(c,{name:"button",control:n,render:({field:t})=>e.jsxs(A,{disabled:g,className:"flex items-center",children:[g?e.jsx(k,{className:"mr-2 animate-spin"}):e.jsx(O,{className:"mr-2"}),g?"Uploading...":"Upload"]})})})]})}),p?e.jsx("p",{children:"Loading documents..."}):e.jsx(B,{columns:N,data:o,enablePagination:!0})]})},{TabNav:R,TabList:V,TabContent:H}=_,fe=()=>{const[o,u]=d.useState("tab1");m(r=>r.user.district_id);const p=m(r=>r.user.district_name)||"";return e.jsx("div",{children:e.jsxs(_,{value:o,onChange:u,children:[e.jsx(V,{children:e.jsxs(R,{value:"tab1",icon:e.jsx(K,{}),children:["Manage Documents for District: ",p]})}),e.jsx("div",{className:"p-4",children:e.jsx(H,{value:"tab1",children:e.jsx(G,{})})})]})})};export{fe as default};
