import{r,y as w,j as s,X as F,A as _}from"./index-DZB01bAc.js";import{M as K}from"./index.esm-fAkH6oKo.js";import{u as U,a as B}from"./useControllableState-C54SVgS7.js";import{c as H}from"./classNames-FHsaen3e.js";import"./TextField-KHiirH5n.js";import"./DefaultPropsProvider-BdLv011I.js";import"./Autocomplete-BDxJhgLp.js";import"./FormControlLabel-CqNCLOf1.js";import"./Divider-GW1E5b24.js";import"./index-O_QYat-O.js";const y=r.createContext({}),X=y.Provider;y.Consumer;function A(){return r.useContext(y)}const k=r.forwardRef((e,d)=>{const{className:a,defaultValue:n,onChange:t,value:l,variant:p="underline",...i}=e,[m,b]=U({prop:l,onChange:t,defaultProp:n}),v=w("tabs",a);return s.jsx(X,{value:{value:m,onValueChange:b,variant:p},children:s.jsx("div",{className:v,...i,ref:d})})});k.displayName="Tabs";const E=r.forwardRef((e,d)=>{const{className:a,children:n,...t}=e,{variant:l}=A(),p=w("tab-list",`tab-list-${l}`,a);return s.jsx("div",{ref:d,role:"tablist",className:p,...t,children:n})});E.displayName="TabList";const $=r.forwardRef((e,d)=>{const{value:a,disabled:n,className:t,icon:l,children:p,...i}=e,{value:m,onValueChange:b,variant:v}=A(),h=a===m,S=B(()=>{!h&&!n&&(b==null||b(a))}),R=H("tab-nav",`tab-nav-${v}`,h&&"tab-nav-active text-primary",h&&v==="underline"&&"border-primary",h&&v==="pill"&&"bg-primary text-neutral",n&&"tab-nav-disabled",!n&&!h&&"hover:text-primary",t);return s.jsxs("div",{ref:d,className:R,role:"tab","aria-selected":h,tabIndex:0,onClick:S,onKeyDown:S,...i,children:[l&&s.jsx("div",{className:"tab-nav-icon",children:l}),p]})});$.displayName="TabNav";const M=r.forwardRef((e,d)=>{const{value:a,children:n,className:t,...l}=e,p=A(),i=a===p.value,m=w("tab-content",i&&"tab-content-active",t);return s.jsx("div",{ref:d,role:"tabpanel",tabIndex:0,className:m,...l,children:i&&n})});M.displayName="TabContent";const N=k;N.TabList=E;N.TabNav=$;N.TabContent=M;const{TabNav:re,TabList:ie,TabContent:le}=N,q=e=>{var t,l,p;const a=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(i=>i.assigned_group==="APPLICANT"&&i.remarks&&i.remarks!=="undefined").map(i=>i.remarks),n=a.length>0?a.join("; "):"N/A";return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,CNIC:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,application_Start_Time:((t=e.created_at)==null?void 0:t.substring(0,16))||"N/A",application_Submission_Time:((p=(l=e.submittedapplication)==null?void 0:l.created_at)==null?void 0:p.substring(0,16))||"N/A",remarks:n}},J=e=>e.map(d=>{const a=q(d);return Object.keys(a).forEach(n=>{(a[n]===void 0||a[n]===null)&&(a[n]="N/A")}),a}),ce=()=>{const[e,d]=r.useState([]),[a,n]=r.useState([]),[t,l]=r.useState([]),[p,i]=r.useState(0),[m,b]=r.useState(null),[v,h]=r.useState({}),[S,R]=r.useState("tab1");console.log(m);const[z,O]=r.useState(!1),j=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],I={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},G=(o,C,u)=>{const P=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],T=J(o),L=T[0];console.log(o);const g=[...Object.keys(L).filter(c=>P.includes(c)).map(c=>({accessorKey:c,header:c.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),Cell:({cell:f,row:V})=>s.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const D=V.original.id;console.log(`Clicked ${c}:`,f.getValue()),console.log(`Navigating with ID: ${D}`),window.location.href=C?`/spuid-review/${D}?group=${u}`:`/spuid-signup/${D}`},children:f.getValue()||"-"})}))];return{flattenedData:T,columns:g}},x=F();return r.useEffect(()=>{(async()=>{O(!0);try{const u=await _.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{x("/error")}try{let u=[];try{u=(await _.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],l(u.map(c=>c.name))}catch(g){console.error("Error fetching user groups:",g),l([])}console.log("groupsResponse",u);const T=(await _.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(T)&&T.length>0){const g=G(T,u.length>0,u.map(f=>f.name)[0]);d(g.flattenedData),n(g.columns),console.log("Flattened Data:",g.flattenedData);const c=g.flattenedData[g.flattenedData.length-1];if(console.log("Last Row:",c),c&&c.id){b(c.id),console.log("Last Row ID:",c.id);const f=j.indexOf(c.assigned_group);f!==-1&&i(f)}}const L=await _.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});h(L.data)}catch(u){console.error("Error fetching data:",u)}finally{O(!1)}})(),b(25);const C=j.indexOf("LSO");C!==-1&&i(C)},[]),r.useEffect(()=>{console.log("userGroups:",t),t.includes("DEO")||t.includes("DG")?x("/home-deo"):t.includes("Admin")?x("/home-admin"):t.includes("DO")?x("/home-do"):t.includes("Super")&&x("/home-super")},[t,x]),console.log("selectedRowId:",m),console.log(m),s.jsxs("div",{children:[s.jsx("div",{className:"tiles-container",children:Object.entries(v).map(([o,C])=>s.jsxs("div",{className:"tile",children:[s.jsx("h3",{children:I[o]||o})," ",s.jsx("p",{children:C})]},o))}),t.length>0&&s.jsx("div",{className:"mb-4",children:s.jsxs("h3",{children:[t.filter(o=>o!=="Download License"&&o!=="Applicant"&&o!=="LSM2").join(" - ")," Dashboard"]})}),z?s.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),s.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):s.jsx(K,{columns:[...a],data:e.map(o=>({...o,assigned_group_title:I[o.assigned_group]||o.assigned_group})),getRowId:o=>o.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:100,size:140},enableColumnResizing:!0,enableTopToolbar:t.length>0,enablePagination:!0},m)]})};export{ce as default};
