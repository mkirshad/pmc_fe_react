import{r as p,U as I,j as c,A as S}from"./index-aUG5KHU6.js";import{M as k}from"./index.esm-DewI3pIL.js";import"./TextField-CZ-jz06T.js";import"./Divider-S4pu8aMl.js";import"./FormControlLabel-BFxZCqnH.js";import"./Autocomplete-CTEXkHxy.js";import"./index-DodjoTUY.js";const v=e=>{var o,g,D;const n=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(l=>l.assigned_group==="APPLICANT"&&l.remarks&&l.remarks!=="undefined").map(l=>l.remarks),d=n.length>0?n.join("; "):"N/A";return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,cnic:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,application_Start_Time:((o=e.created_at)==null?void 0:o.substring(0,16))||"N/A",application_Submission_Time:((D=(g=e.submittedapplication)==null?void 0:g.created_at)==null?void 0:D.substring(0,16))||"N/A",remarks:d}},y=e=>e.map(_=>{const n=v(_);return Object.keys(n).forEach(d=>{(n[d]===void 0||n[d]===null)&&(n[d]="N/A")}),n}),G=()=>{const[e,_]=p.useState([]),[n,d]=p.useState([]),[o,g]=p.useState([]),[D,l]=p.useState(0),[h,A]=p.useState(null),[O,R]=p.useState({});console.log(h);const w=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],C={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},b=(t,u,a)=>{const T=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],m=y(t),L=m[0];console.log(t);const i=[...Object.keys(L).filter(s=>T.includes(s)).map(s=>({accessorKey:s,header:s.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),size:200,Cell:({cell:r,row:N})=>c.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const x=N.original.id;console.log(`Clicked ${s}:`,r.getValue()),console.log(`Navigating with ID: ${x}`),window.location.href=u?`/spuid-review/${x}?group=${a}`:`/spuid-signup/${x}`},children:r.getValue()||"-"})}))];return{flattenedData:m,columns:i}},f=I();return p.useEffect(()=>{(async()=>{try{const a=await S.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{f("/error")}try{let a=[];try{a=(await S.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],g(a.map(s=>s.name))}catch(i){console.error("Error fetching user groups:",i),g([])}console.log("groupsResponse",a);const m=(await S.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(m)&&m.length>0){const i=b(m,a.length>0,a.map(r=>r.name)[0]);_(i.flattenedData),d(i.columns),console.log("Flattened Data:",i.flattenedData);const s=i.flattenedData[i.flattenedData.length-1];if(console.log("Last Row:",s),s&&s.id){A(s.id),console.log("Last Row ID:",s.id);const r=w.indexOf(s.assigned_group);r!==-1&&l(r)}}const L=await S.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});R(L.data)}catch(a){console.error("Error fetching data:",a)}})(),A(25);const u=w.indexOf("LSO");u!==-1&&l(u)},[]),p.useEffect(()=>{console.log("userGroups:",o),o.includes("Super")?f("/home-super"):o.includes("Admin")?f("/home-admin"):o.includes("DO")&&f("/home-do")},[o,f]),console.log("selectedRowId:",h),console.log(h),c.jsxs("div",{children:[c.jsx("div",{className:"tiles-container",children:Object.entries(O).map(([t,u])=>c.jsxs("div",{className:"tile",children:[c.jsx("h3",{children:C[t]||t})," ",c.jsx("p",{children:u})]},t))}),c.jsx("div",{className:"mb-4",children:c.jsxs("h3",{children:[o.filter(t=>t!=="Download License"&&t!=="Applicant"&&t!=="LSM2").join(" - ")," Dashboard"]})}),c.jsx(k,{columns:[...n],data:e.map(t=>({...t,assigned_group_title:C[t.assigned_group]||t.assigned_group})),getRowId:t=>t.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:1,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:o.length>0,enablePagination:!0},h)]})};export{G as default};
