import{r as d,U as z,j as a,A as O}from"./index-Ce0aloOU.js";import{M as P}from"./index.esm-D6YGH7vG.js";import"./TextField-CptLIDAN.js";import"./Divider-DGPoXPgN.js";import"./FormControlLabel-BZsoqhc0.js";import"./Autocomplete-7U1h4c1X.js";import"./index-FOo-8iPH.js";const G=s=>{var C,h,y,S,N,D;const u=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],p=u.indexOf(s.assigned_group),o=s.applicationassignment||[],i=(()=>{if(o.length>1){const t=o[o.length-2];return u.indexOf(t.assigned_group)}return-1})(),b=i!==-1&&i>p;o.find(t=>u.indexOf(t.assigned_group)===i);const R=t=>new Intl.NumberFormat("en-PK",{style:"currency",currency:"PKR",minimumFractionDigits:2}).format(t),A=s.applicationassignment.filter(t=>t.assigned_group===s.assigned_group),l=A.reduce((t,e)=>new Date(e.updated_at).getTime()>new Date(t.updated_at).getTime()?e:t,A[0]),I=l?(C=l.updated_at)==null?void 0:C.substring(0,16):"N/A";let w="N/A";if(l&&l.updated_at){const t=new Date(l.updated_at),n=new Date-t;w=Math.floor(n/(1e3*60*60*24))}let v="N/A";if((h=s.submittedapplication)!=null&&h.created_at&&((y=s.submittedapplication)!=null&&y.created_at)){const t=new Date((S=s.submittedapplication)==null?void 0:S.created_at),n=new Date-t;v=Math.floor(n/(1e3*60*60*24))}const T=s.applicantfees?s.applicantfees.reduce((t,e)=>t+parseFloat(e.fee_amount||0),0):0,j=s.applicantfees?s.applicantfees.filter(t=>t.is_settled).reduce((t,e)=>t+parseFloat(e.fee_amount||0),0):0;return{id:s.id,application_Submission_Time:((D=(N=s.submittedapplication)==null?void 0:N.created_at)==null?void 0:D.substring(0,16))||"N/A",duration:v||"N/A",tracking_number:s.tracking_number,first_name:s.first_name,mobile_no:s.mobile_no,application_status:s.application_status,assigned_group:s.assigned_group,group_assignment_time:I,group_assignment_days:w,total_fee_amount:R(T.toFixed(2)),verified_fee_amount:R(j.toFixed(2)),is_assigned_back:b?"Yes":"No"}},B=s=>s.map(u=>{const p=G(u);return Object.keys(p).forEach(o=>{(p[o]===void 0||p[o]===null)&&(p[o]="N/A")}),p}),Q=()=>{const[s,u]=d.useState([]),[p,o]=d.useState([]),[i,b]=d.useState(null),[R,A]=d.useState(0),[l,I]=d.useState(null),[w,v]=d.useState({}),[T,j]=d.useState(null),[C,h]=d.useState(!1);console.log(l);const y=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],S={APPLICANT:"Applicant",LSO:"LSO",LSO1:"Sana",LSO2:"Qaisar",LSO3:"Ameer",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},N=async e=>{try{if(h(!0),j(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const n=e==="LSO1"?1:e==="LSO2"?2:0,g=((await O.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:"LSO"}})).data||[]).filter(L=>{var F;return((F=L.submittedapplication)==null?void 0:F.id)%3===n}),f=D(g,!!i.length,i[0]);u(f.flattenedData),o(f.columns)}else{const r=(await O.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],g=D(r,!!i.length,i[0]);u(g.flattenedData),o(g.columns)}}catch(n){console.error("Error fetching filtered data:",n),u([]),o([])}finally{h(!1)}},D=(e,n,r)=>{const g=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","duration","remarks","group_assignment_days","total_fee_amount","verified_fee_amount","is_assigned_back"],f=B(e),L=f[0],F=[...Object.keys(L).filter(m=>g.includes(m)).map(m=>{let M=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(m)?M=120:["first_name"].includes(m)&&(M=180),m==="is_assigned_back"?{accessorKey:m,header:"Assigned Back",size:M,Filter:({column:c})=>a.jsxs("select",{value:c.getFilterValue()||"",onChange:_=>c.setFilterValue(_.target.value||void 0),style:{width:"100%",padding:"4px"},children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"Yes",children:"Yes"}),a.jsx("option",{value:"",children:"No"})]}),filterFn:(c,_,x)=>x===""||c.original[m]===x,Cell:({cell:c,row:_})=>{const x=_.original.id,k=_.original.is_assigned_back,E=`/spuid-review/${x}?group=${r}`;return a.jsx("a",{href:E,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:k==="Yes"?"red":"blue",textDecoration:"underline"},children:c.getValue()||"-"})}}:{accessorKey:m,header:m.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase()),size:M,Cell:({cell:c,row:_})=>{const x=_.original.id,k=_.original.is_assigned_back,E=`/spuid-review/${x}?group=${r}`;return a.jsx("a",{href:E,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:k==="Yes"?"red":"blue",textDecoration:"underline"},children:c.getValue()||"-"})}}})];return{flattenedData:f,columns:F}},t=z();return d.useEffect(()=>{(async()=>{h(!0);try{const r=await O.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{t("/error")}try{let r=[];try{r=(await O.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],b(r.map(L=>L.name))}catch(f){console.error("Error fetching user groups:",f),b([])}console.log("groupsResponse",r);const g=await O.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});v(g.data)}catch(r){console.error("Error fetching data:",r)}finally{h(!1)}})(),I(25);const n=y.indexOf("LSO");n!==-1&&A(n)},[]),d.useEffect(()=>{console.log("userGroups:",i),i&&!i.includes("Super")&&t("/home")},[i,t]),console.log("selectedRowId:",l),console.log(l),a.jsxs("div",{children:[a.jsx("div",{className:"tiles-container",children:Object.entries(w).map(([e,n])=>a.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:T===e?"#007BFF":"#f8f9fa",color:T===e?"#fff":"#000"},onClick:()=>N(e),children:[a.jsx("h3",{children:S[e]||e})," ",a.jsx("p",{children:n})]},e))}),a.jsx("div",{className:"mb-4",children:a.jsxs("h3",{children:[i&&i.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),a.jsx("div",{className:"mb-2",children:a.jsx("h6",{className:"text-red-500",children:"Records highlighted in red require immediate attention, as they have been returned from a next step."})}),C?a.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[a.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),a.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):a.jsx(P,{columns:[...p],data:s.map(e=>({...e,assigned_group_title:S[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:200,minSize:1,size:50},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},l)]})};export{Q as default};
