import{r as i,y as w,j as s,W as F,A as D}from"./index-KL744_Zs.js";import{M as K}from"./index.esm-BJT4XwNp.js";import{u as U,a as B}from"./useControllableState-By3dNZm9.js";import{c as H}from"./classNames-B7ZzC02m.js";import"./TextField-Cwkpihsx.js";import"./DefaultPropsProvider-C8NmIctS.js";import"./Autocomplete-BXK0zHoZ.js";import"./FormControlLabel-FS6Kw8gb.js";import"./Divider-B3kG1t7M.js";import"./index-CjaKO9R-.js";const y=i.createContext({}),W=y.Provider;y.Consumer;function A(){return i.useContext(y)}const k=i.forwardRef((e,d)=>{const{className:a,defaultValue:n,onChange:t,value:l,variant:u="underline",...r}=e,[p,b]=U({prop:l,onChange:t,defaultProp:n}),v=w("tabs",a);return s.jsx(W,{value:{value:p,onValueChange:b,variant:u},children:s.jsx("div",{className:v,...r,ref:d})})});k.displayName="Tabs";const E=i.forwardRef((e,d)=>{const{className:a,children:n,...t}=e,{variant:l}=A(),u=w("tab-list",`tab-list-${l}`,a);return s.jsx("div",{ref:d,role:"tablist",className:u,...t,children:n})});E.displayName="TabList";const $=i.forwardRef((e,d)=>{const{value:a,disabled:n,className:t,icon:l,children:u,...r}=e,{value:p,onValueChange:b,variant:v}=A(),h=a===p,N=B(()=>{!h&&!n&&(b==null||b(a))}),R=H("tab-nav",`tab-nav-${v}`,h&&"tab-nav-active text-primary",h&&v==="underline"&&"border-primary",h&&v==="pill"&&"bg-primary text-neutral",n&&"tab-nav-disabled",!n&&!h&&"hover:text-primary",t);return s.jsxs("div",{ref:d,className:R,role:"tab","aria-selected":h,tabIndex:0,onClick:N,onKeyDown:N,...r,children:[l&&s.jsx("div",{className:"tab-nav-icon",children:l}),u]})});$.displayName="TabNav";const M=i.forwardRef((e,d)=>{const{value:a,children:n,className:t,...l}=e,u=A(),r=a===u.value,p=w("tab-content",r&&"tab-content-active",t);return s.jsx("div",{ref:d,role:"tabpanel",tabIndex:0,className:p,...l,children:r&&n})});M.displayName="TabContent";const _=k;_.TabList=E;_.TabNav=$;_.TabContent=M;const{TabNav:ie,TabList:re,TabContent:le}=_,q=e=>{var t,l,u;const a=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(r=>r.assigned_group==="APPLICANT"&&r.remarks&&r.remarks!=="undefined").map(r=>r.remarks),n=a.length>0?a.join("; "):"N/A";return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,CNIC:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,application_Start_Time:((t=e.created_at)==null?void 0:t.substring(0,16))||"N/A",application_Submission_Time:((u=(l=e.submittedapplication)==null?void 0:l.created_at)==null?void 0:u.substring(0,16))||"N/A",remarks:n}},J=e=>e.map(d=>{const a=q(d);return Object.keys(a).forEach(n=>{(a[n]===void 0||a[n]===null)&&(a[n]="N/A")}),a}),ce=()=>{const[e,d]=i.useState([]),[a,n]=i.useState([]),[t,l]=i.useState([]),[u,r]=i.useState(0),[p,b]=i.useState(null),[v,h]=i.useState({}),[N,R]=i.useState("tab1");console.log(p);const[z,O]=i.useState(!1),j=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],I={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},G=(o,x,g)=>{const P=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],C=J(o),S=C[0];console.log(o);const m=[...Object.keys(S).filter(c=>P.includes(c)).map(c=>({accessorKey:c,header:c.replace(/_/g," ").replace(/\b\w/g,f=>f.toUpperCase()),Cell:({cell:f,row:V})=>s.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const L=V.original.id;console.log(`Clicked ${c}:`,f.getValue()),console.log(`Navigating with ID: ${L}`),window.location.href=x?`/spuid-review/${L}?group=${g}`:`/spuid-signup/${L}`},children:f.getValue()||"-"})}))];return{flattenedData:C,columns:m}},T=F();return i.useEffect(()=>{(async()=>{O(!0);try{let g=[];try{g=(await D.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],l(g.map(c=>c.name))}catch(m){console.error("Error fetching user groups:",m),l([])}console.log("groupsResponse",g);const C=(await D.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(C)&&C.length>0){const m=G(C,g.length>0,g.map(f=>f.name)[0]);d(m.flattenedData),n(m.columns),console.log("Flattened Data:",m.flattenedData);const c=m.flattenedData[m.flattenedData.length-1];if(console.log("Last Row:",c),c&&c.id){b(c.id),console.log("Last Row ID:",c.id);const f=j.indexOf(c.assigned_group);f!==-1&&r(f)}}const S=await D.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});h(S.data)}catch(g){console.error("Error fetching data:",g)}finally{O(!1)}})(),b(25);const x=j.indexOf("LSO");x!==-1&&r(x)},[]),i.useEffect(()=>{console.log("userGroups:",t),t.includes("DEO")||t.includes("DG")?T("/home-deo"):t.includes("Admin")?T("/home-admin"):t.includes("DO")?T("/home-do"):t.includes("Super")&&T("/home-super")},[t,T]),console.log("selectedRowId:",p),console.log(p),s.jsxs("div",{children:[s.jsx("div",{className:"tiles-container",children:Object.entries(v).map(([o,x])=>s.jsxs("div",{className:"tile",children:[s.jsx("h3",{children:I[o]||o})," ",s.jsx("p",{children:x})]},o))}),t.length>0&&s.jsx("div",{className:"mb-4",children:s.jsxs("h3",{children:[t.filter(o=>o!=="Download License"&&o!=="Applicant"&&o!=="LSM2").join(" - ")," Dashboard"]})}),z?s.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),s.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):s.jsx(K,{columns:[...a],data:e.map(o=>({...o,assigned_group_title:I[o.assigned_group]||o.assigned_group})),getRowId:o=>o.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:100,size:140},enableColumnResizing:!0,enableTopToolbar:t.length>0,enablePagination:!0},p)]})};export{ce as default};
