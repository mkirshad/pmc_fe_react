import{r as o,l as j,W as I,j as s,A as L}from"./index-juD6yl2f.js";import{M as R}from"./index.esm-CRu29ry0.js";import{T as k}from"./index-BPIaU27K.js";import{a as P}from"./index-ClUrwCEo.js";import"./TextField-BtuvFgGi.js";import"./DefaultPropsProvider-CWF1nGAA.js";import"./emotion-element-f0de968e.browser.esm-Co6boKfh.js";import"./setPrototypeOf-C3V6guyq.js";import"./assertThisInitialized-_-h-Fw0n.js";import"./Modal-BrncEOSU.js";import"./Autocomplete-CNwMJZi2.js";import"./Box-CnXUW6_y.js";import"./FormControlLabel-hmYK94Jh.js";import"./Divider-BNBlqxf7.js";import"./index-DcUHYfPk.js";import"./useControllableState-DhPPf3LF.js";import"./classNames-8w7M7qfv.js";const{TabNav:ne,TabList:ie,TabContent:oe}=k,M=t=>{var w,f,m;const i=(t.assigned_group==="APPLICANT"&&t.applicationassignment||[]).filter(r=>r.assigned_group==="APPLICANT"&&r.remarks&&r.remarks!=="undefined").map(r=>r.remarks),p=i.length>0?i.join("; "):"N/A";return{id:t.id,tracking_number:t.tracking_number,first_name:t.first_name,last_name:t.last_name,CNIC:t.cnic,mobile_no:t.mobile_no,application_status:t.application_status,assigned_group:t.assigned_group,registration_for:t.registration_for,application_Start_Time:((w=t.created_at)==null?void 0:w.substring(0,16))||"N/A",application_Submission_Time:((m=(f=t.submittedapplication)==null?void 0:f.created_at)==null?void 0:m.substring(0,16))||"N/A",remarks:p}},$=t=>t.map(x=>{const i=M(x);return Object.keys(i).forEach(p=>{(i[p]===void 0||i[p]===null)&&(i[p]="N/A")}),i}),re=()=>{const[t,x]=o.useState([]),[i,p]=o.useState([]),[w,f]=o.useState(0),[m,r]=o.useState(null),[T,N]=o.useState({}),[z,F]=o.useState("tab1");console.log(m);const[O,A]=o.useState(!1),D=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],C={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},a=j(e=>e.user.authority)||[];console.log("user authority:",a);const y=(e,l,n)=>{const u=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],c=$(e),d=c[0];console.log(e);const _=[...Object.keys(d).filter(h=>u.includes(h)).map(h=>({accessorKey:h,header:h.replace(/_/g," ").replace(/\b\w/g,b=>b.toUpperCase()),Cell:({cell:b,row:v})=>s.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const S=v.original.id;console.log(`Clicked ${h}:`,b.getValue()),console.log(`Navigating with ID: ${S}`),window.location.href=l?`/spuid-review/${S}?group=${n}`:`/spuid-signup/${S}`},children:b.getValue()||"-"})}))];return{flattenedData:c,columns:_}},g=I();o.useEffect(()=>{(async()=>{A(!0);try{if(navigator.onLine){const u=(await L.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(u)&&u.length>0){const c=y(u,a.length>0&&a[0]!=="",a[0]);x(c.flattenedData),p(c.columns),console.log("Flattened Data:",c.flattenedData);const d=c.flattenedData[c.flattenedData.length-1];if(console.log("Last Row:",d),d&&d.id){r(d.id),console.log("Last Row ID:",d.id);const _=D.indexOf(d.assigned_group);_!==-1&&f(_)}}}else throw new Error("Application is offline. Cannot fetch applicant details.");if(navigator.onLine){const n=await L.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});N(n.data)}else throw new Error("Application is offline. Cannot fetch statistics.")}catch(n){console.error("Error fetching data:",n)}finally{A(!1)}})(),r(25);const l=D.indexOf("LSO");l!==-1&&f(l)},[]),o.useEffect(()=>{console.log("userGroups:",a),a.includes("DEO")||a.includes("DG")?g("/home-deo"):a.includes("Admin")?g("/home-admin"):a.includes("DO")?g("/home-do"):a.includes("Super")?g("/home-super"):a.length===1&&a[0]==="Inspector"&&g("/auth/EPAOperations/AllInspections")},[a,g]),console.log("selectedRowId:",m),console.log(m);const E=async()=>{try{const e=await L.post("/pmc/export-applicant/",{applicant_ids:t==null?void 0:t.map(u=>u.id)},{responseType:"blob"}),l=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=l,n.setAttribute("download",`Applicant_Details_${new Date().toISOString()}.xlsx`),document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(e){console.error("Export failed:",e)}};return s.jsxs("div",{children:[s.jsx("div",{className:"tiles-container",children:Object.entries(T).map(([e,l])=>s.jsxs("div",{className:"tile",children:[s.jsx("h3",{children:C[e]||e})," ",s.jsx("p",{children:l})]},e))}),a.length>0&&s.jsx("div",{className:"mb-4",children:s.jsxs("h3",{children:[a.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),O?s.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),s.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid md:grid-cols-5 gap-5 items-center mb-4",children:[s.jsx("span",{className:"text-red-500 col-span-3"}),s.jsx("span",{}),s.jsxs("button",{type:"button",onClick:E,className:"flex items-center justify-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200",children:[s.jsx(P,{className:"mr-2 text-xl"}),"Export to Excel"]})]}),s.jsx(R,{columns:[...i],data:t.map(e=>({...e,assigned_group_title:C[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:100,size:140},enableColumnResizing:!0,enableTopToolbar:a.length>0,enablePagination:!0},m)]})]})};export{re as default};
