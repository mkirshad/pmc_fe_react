import{r as s,j as c,A as v}from"./index-DcN3Nqar.js";import{M as Y,V as ee,T as te,O as se,a as A,b as L,S as V,C as re,c as I,F as B,f as oe,d as ce,P as ae}from"./OSM-Bx5l-N5p.js";import{G as ie}from"./GeoJSON-BAwyf57_.js";import{t as le}from"./terraformer-wkt-parser-B5doMakL.js";import{h as ne,i as K,j as G,k as Z,l as O}from"./index-DRhNDIRY.js";import{M as ue}from"./index.esm-DWlyNnQt.js";import"./TextField-BeUYlKRv.js";import"./DefaultPropsProvider-CZB_b_by.js";import"./Autocomplete-CGY5UVMC.js";import"./FormControlLabel-DD9f1hDI.js";import"./Divider-F7ri74hI.js";import"./index-BPwZYC2P.js";function de(n){switch(n){case"Producer":return"#FB923C";case"Distributor":return"#3B82F6";case"Collector":return"#FBBF24";case"Recycler":return"#22C55E";default:return"gray"}}const Te=()=>{const n=s.useRef(null),[r,m]=s.useState(null),[l,b]=s.useState(null),[f,p]=s.useState(null),[S,o]=s.useState(null),[u,g]=s.useState(null),[h,j]=s.useState([]),[J,U]=s.useState([]),[w,D]=s.useState(null),[C,N]=s.useState(["Producer","Distributor","Collector","Recycler"]),[T,$]=s.useState(!1),[z,xe]=s.useState([8054803349056441e-9,3.6232483407283584e6]),[R,pe]=s.useState(6.53343814691434),[H,E]=s.useState(4);s.useEffect(()=>{const t=new Y({target:n.current,layers:[new te({source:new se})],view:new ee({zoom:7,center:[8127130,3658593]})}),e=new A({source:new L});return t.addLayer(e),b(e),m(t),()=>t.setTarget(null)},[]),s.useEffect(()=>{if(!r)return;const t=new A({source:new L,style:e=>{const a=e.get("category");return new V({image:new re({radius:H,fill:new B({color:de(a)}),stroke:new I({color:"#fff",width:1})})})}});r.addLayer(t),p(t)},[r]),s.useEffect(()=>{(async()=>{try{const e=await v.get("/pmc/applicant-location-public/");j(e.data);const a=new Set(e.data.map(d=>d.district_name).filter(Boolean)),i=Array.from(a).sort();U(i)}catch(e){console.error("Error fetching applicant data:",e)}})()},[]);const k=s.useMemo(()=>w?h.filter(t=>t.district_name===w):h,[w,h]),_=s.useMemo(()=>k.filter(t=>C.includes(t.category)),[k,C]);s.useEffect(()=>{if(!f)return;const t=f.getSource();t.clear(),_.forEach(e=>{if(e.latitude&&e.longitude){const a=oe([Number(e.longitude),Number(e.latitude)]),i=new ce({geometry:new ae(a),category:e.category});t.addFeature(i)}})},[_,f]),s.useEffect(()=>{if(!r||!l||T)return;(async()=>{let e=u;e||(e=(await v.get("/pmc/districts-public")).data.filter(X=>X.geom));const i={type:"FeatureCollection",features:e.map(x=>({type:"Feature",geometry:le.parse(x.geom.replace("SRID=4326;","")),properties:{district_id:x.district_id,district_name:x.district_name,district_code:x.district_code}}))},d=l.getSource();d.clear(),d.addFeatures(new ie().readFeatures(i,{featureProjection:"EPSG:3857"}));const F=d.getExtent();r.getView().fit(F,{padding:[50,50,50,50],maxZoom:10}),$(!0)})()},[r,l,T,u]),s.useEffect(()=>{l&&l.setStyle(t=>{const e=t.get("district_id")===S;return new V({stroke:new I({color:e?"red":"blue",width:e?3:2}),fill:new B({color:e?"rgba(255, 0, 0, 0.1)":"rgba(0, 0, 255, 0.1)"})})})},[l,S]),s.useEffect(()=>{if(!r||!l)return;const t=e=>{const a=r.getFeaturesAtPixel(e.pixel);if(a&&a.length>0){const i=a[0],d=i.getProperties(),F=d.district_name;if(w===F)D(null),o(null),r.getView().setCenter(z),r.getView().setZoom(R),E(3);else{D(F),o(d.district_id),E(5);const x=i.getGeometry();r.getView().fit(x.getExtent(),{padding:[50,50,50,50],maxZoom:10})}}else D(null),o(null),E(3),r.getView().setCenter(z),r.getView().setZoom(R)};return r.on("click",t),()=>r.un("click",t)},[r,l,w]);function W(t){const e={Total:t.length,Producer:0,Distributor:0,Collector:0,Recycler:0};return t.forEach(a=>{a.category==="Producer"&&e.Producer++,a.category==="Distributor"&&e.Distributor++,a.category==="Collector"&&e.Collector++,a.category==="Recycler"&&e.Recycler++}),e}const P=W(k),q=C.reduce((t,e)=>t+P[e],0),[y,M]=s.useState([]),Q=t=>{let e;typeof t=="function"?M(a=>(e=t(a),e)):(M(t),e=t)};return s.useEffect(()=>{let t=[];Array.isArray(y)?t=y:typeof y=="object"&&y!==null&&(t=Object.values(y));let e=null,a=["Producer","Distributor","Collector","Recycler"];t.forEach(i=>{i.id==="district_name"&&(e=i.value||null),i.id==="category"&&i.value&&(a=[i.value])}),D(e),N(a)},[y]),c.jsxs("div",{children:[c.jsx(me,{stats:P,enabledCategories:C,setEnabledCategories:N,enabledTotal:q}),c.jsxs("div",{className:"flex flex-col md:flex-row",children:[c.jsx("div",{ref:n,style:{height:"600px",width:"500px"},className:"mb-4"}),c.jsx("div",{className:"ml-4 flex-grow",children:c.jsx(ye,{data:_,selectedDistrict:w,setSelectedDistrict:D,enabledCategories:C,setEnabledCategories:N,columnFilters:y,districtOptions:J,onColumnFiltersChange:Q})})]})]})},me=({stats:n,enabledCategories:r,setEnabledCategories:m,enabledTotal:l})=>{const b=o=>{if(o==="Total"){r.length===4?m([]):m(["Producer","Distributor","Collector","Recycler"]);return}r.includes(o)?m(r.filter(u=>u!==o)):m([...r,o])},f=o=>o==="Total"?r.length>0:r.includes(o);function p(o){return o==="Total"?f("Total")?l:0:n[o]||0}const S=[{key:"Total",bgColor:"bg-gray-500",icon:c.jsx(ne,{className:"text-white text-3xl"})},{key:"Producer",bgColor:"bg-orange-500",icon:c.jsx(K,{className:"text-white text-3xl"})},{key:"Distributor",bgColor:"bg-blue-500",icon:c.jsx(G,{className:"text-white text-3xl"})},{key:"Collector",bgColor:"bg-yellow-500",icon:c.jsx(Z,{className:"text-white text-3xl"})},{key:"Recycler",bgColor:"bg-green-500",icon:c.jsx(O,{className:"text-white text-3xl"})}];return c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4",children:S.map(o=>{const u=f(o.key),g=p(o.key);return c.jsx("div",{onClick:()=>b(o.key),className:`shadow-md rounded p-6 w-full cursor-pointer transition
              ${u?"opacity-100":"opacity-50"}
              ${o.bgColor}
            `,children:c.jsxs("div",{className:"flex items-center space-x-2",children:[o.icon,c.jsx("h2",{className:"text-2xl font-bold text-white",children:o.key}),c.jsx("p",{className:"text-2xl font-bold text-white",children:g})]})},o.key)})})},fe={Producer:c.jsx(K,{className:"text-xl"}),Distributor:c.jsx(G,{className:"text-xl"}),Collector:c.jsx(Z,{className:"text-xl"}),Recycler:c.jsx(O,{className:"text-xl"})},ge={Producer:"text-orange-500",Distributor:"text-blue-500",Collector:"text-yellow-500",Recycler:"text-green-500"},ye=({data:n,selectedDistrict:r,setSelectedDistrict:m,enabledCategories:l,setEnabledCategories:b,columnFilters:f,districtOptions:p,onColumnFiltersChange:S})=>{console.log("districtOptions",p);const o=s.useMemo(()=>[{accessorKey:"district_name",header:"District",minSize:50,maxSize:50,size:50},{accessorKey:"tehsil_name",header:"Tehsil",minSize:50,maxSize:50,size:50},{accessorKey:"category",header:"Category",Cell:({cell:u})=>{const g=u.getValue(),h=fe[g],j=ge[g]||"text-gray-500";return h?c.jsxs("div",{className:`flex items-center ${j}`,children:[h,c.jsx("span",{className:"ml-1",children:g})]}):g},minSize:50,maxSize:50,size:50},{accessorKey:"business_name",header:"Business Name",minSize:50,maxSize:50,size:50},{accessorKey:"postal_address",header:"Postal Address",minSize:50,maxSize:100,size:100},{accessorKey:"material_flow_kg_per_day",header:"Material Flow (Kg/Day)",minSize:50,maxSize:100,size:100}],[p]);return c.jsx(ue,{columns:o,data:n,initialState:{showColumnFilters:!1,pagination:{pageSize:5}}})};export{Te as default};
