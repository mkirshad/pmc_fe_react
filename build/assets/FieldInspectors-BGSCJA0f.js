import{r as o,j as s,A,l as E}from"./index-oDwQGYEA.js";import{T as M}from"./index-D-8Rpkt9.js";import{j as R,k as z}from"./isNil-DegOKdHG.js";import{M as B,E as L}from"./index.esm-C6T0MJvz.js";import{u as K,F as O,a as p,C as f}from"./index.esm-BwKut1eI.js";import{P as I}from"./PasswordInput-DPjab3V9.js";import{B as F}from"./Button-CkHimBRY.js";import{t as D,z as m}from"./index-EAOVwyn9.js";import{C as H}from"./Card-DyjZqYue.js";import{I as _}from"./Input-Zn4GrLhU.js";import{I as q}from"./Autocomplete-Dg-hWFz0.js";import"./useControllableState-D-PZJh6c.js";import"./classNames-Dv-7hrnu.js";import"./TextField-r5TNIsmD.js";import"./DefaultPropsProvider-CGomaEqC.js";import"./emotion-element-f0de968e.browser.esm-DX8E_o2N.js";import"./setPrototypeOf-C3V6guyq.js";import"./assertThisInitialized-Cle6jci9.js";import"./Modal-CFzYjZPq.js";import"./Box-CNakWzJu.js";import"./FormControlLabel-BQoHBKRj.js";import"./Divider-B6CetmYu.js";import"./index-CFuoc-5k.js";import"./index-DWjkHJka.js";const G=m.object({username:m.string().min(3,"Username must be at least 3 characters"),first_name:m.string().optional(),last_name:m.string().optional(),password:m.string().optional(),confirmPassword:m.string().optional()}).refine(r=>!r.password||r.password===r.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]}),V=({selectedUser:r,setSelectedUser:x})=>{var b,a,y,C,P;const[d,c]=o.useState(!1),[h,l]=o.useState(null),{handleSubmit:u,formState:{errors:t},control:n,reset:i}=K({resolver:D(G),defaultValues:{username:"",first_name:"",last_name:"",password:"",confirmPassword:""}}),g=!!(r!=null&&r.id);o.useEffect(()=>{i({username:(r==null?void 0:r.username)||"",first_name:(r==null?void 0:r.first_name)||"",last_name:(r==null?void 0:r.last_name)||"",password:"",confirmPassword:""}),l(null)},[r,i]);const v=async e=>{var S,N;c(!0),l(null);try{const j={user_id:r?r.id:null,username:e.username,first_name:e.first_name,last_name:e.last_name,password:e.password?e.password:void 0};await A.post("/accounts/create-update-inpsector-user/",j),alert(r?"User updated successfully!":"User created successfully!"),x(null),i()}catch(j){console.error("Error updating/creating user:",j),l(((N=(S=j.response)==null?void 0:S.data)==null?void 0:N.error)||"An unexpected error occurred. Please try again.")}finally{c(!1)}},w=()=>{x(null),i()};return s.jsx(H,{children:s.jsxs(O,{onSubmit:u(v),children:[s.jsx("div",{className:"grid md:grid-cols-1 gap-4",children:s.jsx(p,{label:"Username",invalid:!!t.username,errorMessage:(b=t.username)==null?void 0:b.message,children:s.jsx(f,{name:"username",type:"text",control:n,render:({field:e})=>s.jsx(_,{...e,placeholder:"Username",readOnly:g})})})}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsx(p,{label:"First Name",invalid:!!t.first_name,errorMessage:(a=t.first_name)==null?void 0:a.message,children:s.jsx(f,{name:"first_name",type:"text",control:n,render:({field:e})=>s.jsx(_,{...e,placeholder:"First Name"})})}),s.jsx(p,{label:"Last Name",invalid:!!t.last_name,errorMessage:(y=t.last_name)==null?void 0:y.message,children:s.jsx(f,{name:"last_name",type:"text",control:n,render:({field:e})=>s.jsx(_,{...e,placeholder:"Last Name"})})})]}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsx(p,{label:"Password (Optional)",invalid:!!t.password,errorMessage:(C=t.password)==null?void 0:C.message,children:s.jsx(f,{name:"password",control:n,render:({field:e})=>s.jsx(I,{...e,placeholder:"Enter new password"})})}),s.jsx(p,{label:"Confirm Password (Optional)",invalid:!!t.confirmPassword,errorMessage:(P=t.confirmPassword)==null?void 0:P.message,children:s.jsx(f,{name:"confirmPassword",control:n,render:({field:e})=>s.jsx(I,{...e,placeholder:"Confirm password"})})})]}),h&&s.jsxs("div",{className:"text-red-500 text-sm mb-3",children:["⚠️ ",h]}),s.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[s.jsx(F,{type:"submit",block:!0,loading:d,disabled:d,variant:"solid",children:d?"Saving...":r?"Update User":"Create User"}),s.jsx(F,{type:"button",block:!0,variant:"outline",onClick:w,children:"Reset Form"})]})]})})},{TabNav:T,TabList:W,TabContent:k}=M,gs=()=>{const[r,x]=o.useState([]),[d,c]=o.useState(!1),[h,l]=o.useState(null),[u,t]=o.useState("tab1"),n=E(a=>a.user.district_id)||null,i=E(a=>a.user.district_name)||"",g=()=>{n&&(c(!0),A.get("/accounts/list-inspectors/").then(a=>{x(a.data)}).catch(a=>{console.error("Error fetching inspectors:",a)}).finally(()=>{c(!1)}))};o.useEffect(()=>{g()},[n]),o.useEffect(()=>{u==="tab1"&&g()},[u]);const v=a=>{l(a),t("tab2")},w=()=>{l(null)},b=[{accessorKey:"id",header:"ID",size:100},{accessorKey:"username",header:"Username",size:200},{accessorKey:"first_name",header:"First Name",size:200},{accessorKey:"last_name",header:"Last Name",size:200},{accessorKey:"edit",header:"Actions",size:200,Cell:({row:a})=>s.jsx(q,{onClick:()=>v(a.original),children:s.jsx(L,{})})}];return s.jsx("div",{children:s.jsxs(M,{value:u,onChange:t,children:[" ",s.jsxs(W,{children:[s.jsxs(T,{value:"tab1",icon:s.jsx(R,{}),children:["List Inspectors (",i,")"]}),s.jsxs(T,{value:"tab2",icon:s.jsx(z,{}),children:["Add/Edit Inspector (",i,")"]})]}),s.jsxs("div",{className:"p-4",children:[s.jsx(k,{value:"tab1",children:d?s.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),s.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):s.jsx(B,{columns:b,data:r,enableColumnResizing:!0,enablePagination:!0,initialState:{showColumnFilters:!1},muiTableHeadCellProps:{sx:{backgroundColor:"#f5f5f5",fontWeight:"bold",borderBottom:"2px solid #ccc",textAlign:"center"}},muiTableBodyCellProps:{sx:{borderRight:"1px solid #ddd",padding:"10px"}},muiTableBodyRowProps:{sx:{"&:nth-of-type(even)":{backgroundColor:"#f9f9f9"},"&:hover":{backgroundColor:"#e0f7fa"}}}})}),s.jsx(k,{value:"tab2",children:s.jsx(V,{selectedUser:h,setSelectedUser:w})})]})]})})};export{gs as default};
