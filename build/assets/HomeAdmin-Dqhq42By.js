import{r as u,W as z,j as o,A as C}from"./index-DnuspYaO.js";import{M as G}from"./index.esm-DW_l0syq.js";import"./TextField-DnzLoTYC.js";import"./DefaultPropsProvider-B8bWQP4E.js";import"./Autocomplete-Bkh9yYw1.js";import"./FormControlLabel-TTFewDMt.js";import"./Divider-CNUGPaGs.js";import"./index-DvllCgW7.js";const P=t=>{var S,L,w,h,x,A;const p=a=>new Intl.NumberFormat("en-PK",{style:"currency",currency:"PKR",minimumFractionDigits:2}).format(a),c=t.applicationassignment.filter(a=>a.assigned_group===t.assigned_group),n=c.reduce((a,d)=>new Date(d.updated_at).getTime()>new Date(a.updated_at).getTime()?d:a,c[0]),s=n?(S=n.updated_at)==null?void 0:S.substring(0,16):"N/A";let g="N/A";if(n&&n.updated_at){const a=new Date(n.updated_at),m=new Date-a;g=Math.floor(m/(1e3*60*60*24))}let O="N/A";if((L=t.submittedapplication)!=null&&L.created_at&&((w=t.submittedapplication)!=null&&w.created_at)){const a=new Date((h=t.submittedapplication)==null?void 0:h.created_at),m=new Date-a;O=Math.floor(m/(1e3*60*60*24))}const T=t.applicantfees?t.applicantfees.reduce((a,d)=>a+parseFloat(d.fee_amount||0),0):0,_=t.applicantfees?t.applicantfees.filter(a=>a.is_settled).reduce((a,d)=>a+parseFloat(d.fee_amount||0),0):0;return{id:t.id,application_Submission_Time:((A=(x=t.submittedapplication)==null?void 0:x.created_at)==null?void 0:A.substring(0,16))||"N/A",duration:O,tracking_number:t.tracking_number,first_name:t.first_name,last_name:t.last_name,mobile_no:t.mobile_no,application_status:t.application_status,assigned_group:t.assigned_group,group_assignment_time:s,group_assignment_days:g,total_fee_amount:p(T.toFixed(2)),verified_fee_amount:p(_.toFixed(2)),created_by_username:t.created_by_username}},k=t=>t.map(p=>{const c=P(p);return Object.keys(c).forEach(n=>{(c[n]===void 0||c[n]===null)&&(c[n]="N/A")}),c}),q=()=>{const[t,p]=u.useState([]),[c,n]=u.useState([]),[s,g]=u.useState(null),[O,T]=u.useState(0),[_,S]=u.useState(null),[L,w]=u.useState({}),[h,x]=u.useState(null),[A,a]=u.useState(!1),d=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","DG","Download License"],m={APPLICANT:"Applicant",LSO:"LSO",LSO1:"Sana",LSO2:"Qaisar",LSO3:"Ameer",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO",DG:"DG","Download License":"Download License"},R=async e=>{try{if(a(!0),x(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const r=e==="LSO1"?1:e==="LSO2"?2:0;if(navigator.onLine){const D=await C.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:"LSO"}})}else throw new Error("Application is offline. Cannot fetch data.");const i=(response.data||[]).filter(D=>{var b;return((b=D.submittedapplication)==null?void 0:b.id)%3===r}),l=E(i,!!s.length,s[0]);p(l.flattenedData),n(l.columns)}else{if(navigator.onLine){const l=await C.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})}else throw new Error("Application is offline. Cannot fetch data.");const r=response.data||[],i=E(r,!!s.length,s[0]);p(i.flattenedData),n(i.columns)}}catch(r){console.error("Error fetching filtered data:",r),p([]),n([])}finally{a(!1)}},E=(e,r,i)=>{const l=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","duration","remarks","group_assignment_days","total_fee_amount","verified_fee_amount","created_by_username"],D=k(e),b=D[0],F=[...Object.keys(b).filter(f=>l.includes(f)).map(f=>{let y=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(f)?y=120:["first_name"].includes(f)&&(y=180),{accessorKey:f,header:f.replace(/_/g," ").replace(/\b\w/g,v=>v.toUpperCase()),size:y,Cell:({cell:v,row:M})=>{const I=`/spuid-review/${M.original.id}?group=${i}`;return o.jsx("a",{href:I,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:v.getValue()||"-"})}}})];return{flattenedData:D,columns:F}},N=z();return u.useEffect(()=>{(async()=>{a(!0);try{let i=[];try{if(navigator.onLine){const l=await C.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})}else throw new Error("Application is offline. Cannot fetch data.");i=response.data||[],g(i.map(l=>l.name))}catch(l){console.error("Error fetching user groups:",l),g([])}if(console.log("groupsResponse",i),navigator.onLine){const l=await C.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}})}else throw new Error("Application is offline. Cannot fetch data.");w(statsResponse.data)}catch(i){console.error("Error fetching data:",i)}finally{a(!1)}})(),S(25);const r=d.indexOf("LSO");r!==-1&&T(r)},[]),u.useEffect(()=>{console.log("userGroups:",s),s&&!s.includes("Admin")&&N("/home")},[s,N]),console.log("selectedRowId:",_),console.log(_),o.jsxs("div",{children:[o.jsx("div",{className:"tiles-container",children:Object.entries(L).map(([e,r])=>o.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:h===e?"#007BFF":"#f8f9fa",color:h===e?"#fff":"#000"},onClick:()=>R(e),children:[o.jsx("h3",{children:m[e]||e})," ",o.jsx("p",{children:r})]},e))}),o.jsx("div",{className:"mb-4",children:o.jsxs("h3",{children:[s&&s.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),A?o.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[o.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),o.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):o.jsx(G,{columns:[...c],data:t.map(e=>({...e,assigned_group_title:m[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:200,minSize:1,size:50},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},_)]})};export{q as default};
