import{r,j as t,A as g}from"./index-D8nJZtJt.js";import{H as z}from"./HeaderTemplate2-Bya-AqIk.js";/* empty css           */import{M as V,V as P,T as R,O as A,a as h,b as p,S as B,e as $,F as w,c as y}from"./OSM-xj16LtVI.js";import{G}from"./GeoJSON-X8m8cf5v.js";import{M as H}from"./index.esm-Dc5Niph5.js";import{m as j,h as I,n as K,o as O,p as q}from"./index-ygezcPLj.js";import"./Divider--jG0XPJR.js";import"./DefaultPropsProvider-DOWsvLhH.js";import"./emotion-element-f0de968e.browser.esm-LzCS9emh.js";import"./TextField-BZuLgQqT.js";import"./setPrototypeOf-C3V6guyq.js";import"./assertThisInitialized-BaPDaEme.js";import"./Modal-IBht-_uA.js";import"./Autocomplete-BtllHiky.js";import"./Box-BOSY3aB-.js";import"./FormControlLabel--9ZGn5Ap.js";import"./index-Bwc2VGjd.js";const J=()=>{const d=r.useRef(null),[a,C]=r.useState(null),[i,N]=r.useState(null),[W,S]=r.useState(null),[n,v]=r.useState([]),[l,u]=r.useState(null),[k,m]=r.useState(!1),[x,M]=r.useState([]),[L,T]=r.useState(!0);r.useEffect(()=>{const e=new V({target:d.current,layers:[new R({source:new A})],view:new P({zoom:7,center:[8127130,3658593]})}),s=new h({source:new p}),o=new h({source:new p});return e.addLayer(s),e.addLayer(o),N(s),S(o),C(e),()=>e.setTarget(null)},[]),r.useEffect(()=>{if(!i||!a)return;(async()=>{m(!0);try{const s=await g.get("/pmc/idm_districts-club-counts/");M(s.data.features);const o=new p({features:new G().readFeatures(s.data,{featureProjection:"EPSG:3857"})});i.setSource(o),a.getView().fit(o.getExtent(),{padding:[50,50,50,50],duration:500})}catch(s){console.error("Error fetching districts:",s)}finally{m(!1)}})()},[i,a]),r.useEffect(()=>{i&&i.setStyle(e=>{const s=e.get("id")===l;if(e.get("club_count")!==0)return new B({stroke:new y({color:s?"red":"blue",width:s?3:2}),fill:new w({color:s?"rgba(255,0,0,0.1)":"rgba(0,0,255,0.1)"}),text:new $({text:`${e.get("name")} (${e.get("club_count")})`,font:"bold 10px sans-serif",fill:new w({color:"#000"}),stroke:new y({color:"#fff",width:3}),overflow:!0})})})},[i,l]),r.useEffect(()=>{(async()=>{const s=await g.get("/pmc/idm_clubs_geojson_all/");v(s.data.features)})()},[]),r.useEffect(()=>{if(!a||!i)return;const e=s=>{const o=a.getFeaturesAtPixel(s.pixel);if(o.length>0){const b=o[0].get("id");l===b?(u(null),a.getView().setCenter([8127130,3658593])):u(b)}else u(null),a.getView().setCenter([8127130,3658593])};return a.on("click",e),()=>a.un("click",e)},[a,i,l]);const D=r.useMemo(()=>l?n.filter(e=>e.properties.district_id===l):n,[l,n]),_=r.useMemo(()=>[{accessorKey:"properties.district",header:"District",size:150},{accessorKey:"properties.name",header:"School Name",size:225},{accessorKey:"properties.address",header:"Address",size:225},{accessorKey:"properties.head_name",header:"Head Name",size:200},{header:"Map",size:50,Cell:({row:e})=>{const{name:s,district:o}=e.original.properties,c=F(s,o);return t.jsx("a",{href:c,target:"_blank",rel:"noopener noreferrer",title:"Open in Google Maps",className:"text-blue-500 hover:text-blue-700",children:t.jsx(j,{size:20})})}}],[]),E=r.useMemo(()=>{const e=[...x].sort((s,o)=>o.properties.club_count-s.properties.club_count).slice(0,4);return[{properties:{name:"Total Clubs",club_count:n.length,id:null}},...e]},[x,n]),f=[{bgColor:"bg-gray-500",icon:t.jsx(I,{className:"text-white text-3xl"})},{bgColor:"bg-orange-500",icon:t.jsx(K,{className:"text-white text-3xl"})},{bgColor:"bg-blue-500",icon:t.jsx(O,{className:"text-white text-3xl"})},{bgColor:"bg-yellow-500",icon:t.jsx(j,{className:"text-white text-3xl"})},{bgColor:"bg-green-500",icon:t.jsx(q,{className:"text-white text-3xl"})}],F=(e,s)=>{const o=c=>(c==null?void 0:c.replace(/\d+/g,"").replace(/\s+/g,"+"))||"";return`https://www.google.com/maps/search/?api=1&query=${o(e)}+${o(s)}`};return t.jsxs("div",{className:"flex flex-col p-4 gap-4",children:[L&&t.jsxs("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded relative",children:[t.jsx("p",{className:"font-medium",children:"To access Head Contact Number and Club Notification, please sign in with an authenticated account."}),t.jsx("button",{className:"absolute top-2 right-2 text-yellow-700 hover:text-yellow-900",onClick:()=>T(!1),children:"Ã—"})]}),t.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4",children:E.map((e,s)=>t.jsx("div",{className:`shadow-md rounded p-6 w-full cursor-pointer transition 
                ${l===null||l===e.properties.id?"opacity-100":"opacity-50"}
                ${f[s].bgColor}
                `,onClick:()=>u(e.properties.id),children:t.jsxs("div",{className:"flex items-center space-x-2",children:[f[s].icon,t.jsx("h2",{className:"text-2xl font-bold text-white",children:e.properties.name}),t.jsx("p",{className:"text-2xl font-bold text-white",children:e.properties.club_count})]})},s))}),t.jsxs("div",{className:"flex flex-col p-4 gap-4 md:flex-row",children:[t.jsxs("div",{className:"relative",children:[k&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-10",children:t.jsx("div",{className:"animate-spin h-10 w-10 border-4 border-blue-500 border-t-transparent rounded-full"})}),t.jsx("div",{ref:d,style:{height:"850px",width:"500px"}})]}),t.jsx("div",{style:{flex:1},children:t.jsx(H,{columns:_,data:D,initialState:{pagination:{pageSize:15}},enableZebraStripes:!0,enableColumnResizing:!0,muiTableBodyRowProps:({row:e})=>({onClick:()=>handleRowClick(e),style:{cursor:"pointer"},sx:{"&:nth-of-type(even)":{backgroundColor:"#f9f9f9"},"&:hover":{backgroundColor:"#e0f7fa"}}}),muiTableProps:{sx:{border:"1px solid #ddd"}},muiTableHeadCellProps:{sx:{backgroundColor:"#f5f5f5",fontWeight:"bold",borderBottom:"2px solid #ccc",textAlign:"center"}},muiTableBodyCellProps:{sx:{borderRight:"1px solid #ddd",padding:"10px"}}})})]})]})},me=()=>{const d=t.jsxs("h6",{className:"header-text",children:[t.jsx("span",{className:"font-bold",children:"Management Information System"}),t.jsx("span",{className:"text-sm ml-2",children:"Educational Environmental Club Directory"})]});return t.jsx(z,{headerText:d,children:t.jsx(J,{})})};export{me as default};
