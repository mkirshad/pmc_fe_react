import{r,j as c,A as L,a0 as Y}from"./index-C594DpIG.js";/* empty css           */import{M as ee,V as te,T as re,O as se,a as V,b as I,S as B,C as oe,c as K,F as G,f as ce,d as ae,P as ie}from"./OSM-xj16LtVI.js";import{G as le}from"./GeoJSON-X8m8cf5v.js";import{t as ne}from"./terraformer-wkt-parser-wocUExXV.js";import{h as ue,i as Z,j as O,k as U,l as J}from"./index-CtZuTRCO.js";import{M as de}from"./index.esm-CbjVy8lI.js";import"./TextField-C1CUzy9w.js";import"./DefaultPropsProvider-CyS0rKbe.js";import"./emotion-element-f0de968e.browser.esm-CwV0OXU2.js";import"./setPrototypeOf-C3V6guyq.js";import"./assertThisInitialized-B1vlTPkO.js";import"./Modal-BtV3E_wH.js";import"./Autocomplete-CngPG4Ip.js";import"./Box-CGDrnXkE.js";import"./FormControlLabel-BSYMHEAy.js";import"./Divider-BKhYglDO.js";import"./index-B2fMv3j9.js";function me(n){switch(n){case"Producer":return"#FB923C";case"Distributor":return"#3B82F6";case"Collector":return"#FBBF24";case"Recycler":return"#22C55E";default:return"gray"}}const Le=()=>{const n=r.useRef(null),[s,m]=r.useState(null),[l,b]=r.useState(null),[f,h]=r.useState(null),[w,o]=r.useState(null),[g,F]=r.useState(null),[S,E]=r.useState([]),[p,j]=r.useState([]),[u,D]=r.useState(null),[C,k]=r.useState(["Producer","Distributor","Collector","Recycler"]),[z,$]=r.useState(!1),[R,pe]=r.useState([8054803349056441e-9,3.6232483407283584e6]),[v,he]=r.useState(6.53343814691434),[q,_]=r.useState(4);r.useEffect(()=>{const t=new ee({target:n.current,layers:[new re({source:new se})],view:new te({zoom:7,center:[8127130,3658593]})}),e=new V({source:new I});return t.addLayer(e),b(e),m(t),()=>t.setTarget(null)},[]),r.useEffect(()=>{if(!s)return;const t=new V({source:new I,style:e=>{const a=e.get("category");return new B({image:new oe({radius:q,fill:new G({color:me(a)}),stroke:new K({color:"#fff",width:1})})})}});s.addLayer(t),h(t)},[s]),r.useEffect(()=>{(async()=>{try{const e=await L.get("/pmc/applicant-location-public/");E(e.data);const a=new Set(e.data.map(d=>d.district_name).filter(Boolean)),i=Array.from(a).sort();j(i)}catch(e){console.error("Error fetching applicant data:",e)}})()},[]);const P=r.useMemo(()=>u?S.filter(t=>t.district_name===u):S,[u,S]),T=r.useMemo(()=>P.filter(t=>C.includes(t.category)),[P,C]);r.useEffect(()=>{if(!f)return;const t=f.getSource();t.clear(),T.forEach(e=>{if(e.latitude&&e.longitude){const a=ce([Number(e.longitude),Number(e.latitude)]),i=new ae({geometry:new ie(a),category:e.category});t.addFeature(i)}})},[T,f]),r.useEffect(()=>{if(!s||!l||z)return;(async()=>{let e=g;e||(e=(await L.get("/pmc/districts-public")).data.filter(X=>X.geom));const i={type:"FeatureCollection",features:e.map(x=>({type:"Feature",geometry:ne.parse(x.geom.replace("SRID=4326;","")),properties:{district_id:x.district_id,district_name:x.district_name,district_code:x.district_code}}))},d=l.getSource();d.clear(),d.addFeatures(new le().readFeatures(i,{featureProjection:"EPSG:3857"}));const N=d.getExtent();s.getView().fit(N,{padding:[50,50,50,50],maxZoom:10}),$(!0)})()},[s,l,z,g]),r.useEffect(()=>{l&&l.setStyle(t=>{const e=t.get("district_id")===w;return new B({stroke:new K({color:e?"red":"blue",width:e?3:2}),fill:new G({color:e?"rgba(255, 0, 0, 0.1)":"rgba(0, 0, 255, 0.1)"})})})},[l,w]),r.useEffect(()=>{if(!s||!l)return;const t=e=>{const a=s.getFeaturesAtPixel(e.pixel);if(a&&a.length>0){const i=a[0],d=i.getProperties(),N=d.district_name;if(u===N)D(null),o(null),s.getView().setCenter(R),s.getView().setZoom(v),_(3);else{D(N),o(d.district_id),_(5);const x=i.getGeometry();s.getView().fit(x.getExtent(),{padding:[50,50,50,50],maxZoom:10})}}else D(null),o(null),_(3),s.getView().setCenter(R),s.getView().setZoom(v)};return s.on("click",t),()=>s.un("click",t)},[s,l,u]);function H(t){const e={Total:t.length,Producer:0,Distributor:0,Collector:0,Recycler:0};return t.forEach(a=>{a.category==="Producer"&&e.Producer++,a.category==="Distributor"&&e.Distributor++,a.category==="Collector"&&e.Collector++,a.category==="Recycler"&&e.Recycler++}),e}const A=H(P),W=C.reduce((t,e)=>t+A[e],0),[y,M]=r.useState([]),Q=t=>{let e;typeof t=="function"?M(a=>(e=t(a),e)):(M(t),e=t)};return r.useEffect(()=>{let t=[];Array.isArray(y)?t=y:typeof y=="object"&&y!==null&&(t=Object.values(y));let e=null,a=["Producer","Distributor","Collector","Recycler"];t.forEach(i=>{i.id==="district_name"&&(e=i.value||null),i.id==="category"&&i.value&&(a=[i.value])}),D(e),k(a)},[y]),c.jsxs("div",{children:[c.jsx(fe,{stats:A,enabledCategories:C,setEnabledCategories:k,enabledTotal:W}),c.jsxs("div",{className:"flex flex-col md:flex-row",children:[c.jsx("div",{ref:n,style:{height:"600px",width:"500px"},className:"mb-4"}),c.jsx("div",{className:"ml-4 flex-grow",children:c.jsx(xe,{data:T,selectedDistrict:u,setSelectedDistrict:D,enabledCategories:C,setEnabledCategories:k,columnFilters:y,districtOptions:p,onColumnFiltersChange:Q})})]})]})},fe=({stats:n,enabledCategories:s,setEnabledCategories:m,enabledTotal:l})=>{const b=o=>{if(o==="Total"){s.length===4?m([]):m(["Producer","Distributor","Collector","Recycler"]);return}s.includes(o)?m(s.filter(g=>g!==o)):m([...s,o])},f=o=>o==="Total"?s.length>0:s.includes(o);function h(o){return o==="Total"?f("Total")?l:0:n[o]||0}const w=[{key:"Total",bgColor:"bg-gray-500",icon:c.jsx(ue,{className:"text-white text-3xl"})},{key:"Producer",bgColor:"bg-orange-500",icon:c.jsx(Z,{className:"text-white text-3xl"})},{key:"Distributor",bgColor:"bg-blue-500",icon:c.jsx(O,{className:"text-white text-3xl"})},{key:"Collector",bgColor:"bg-yellow-500",icon:c.jsx(U,{className:"text-white text-3xl"})},{key:"Recycler",bgColor:"bg-green-500",icon:c.jsx(J,{className:"text-white text-3xl"})}];return c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4",children:w.map(o=>{const g=f(o.key),F=h(o.key);return c.jsx("div",{onClick:()=>b(o.key),className:`shadow-md rounded p-6 w-full cursor-pointer transition
              ${g?"opacity-100":"opacity-50"}
              ${o.bgColor}
            `,children:c.jsxs("div",{className:"flex items-center space-x-2",children:[o.icon,c.jsx("h2",{className:"text-2xl font-bold text-white",children:o.key}),c.jsx("p",{className:"text-2xl font-bold text-white",children:F})]})},o.key)})})},ge={Producer:c.jsx(Z,{className:"text-xl"}),Distributor:c.jsx(O,{className:"text-xl"}),Collector:c.jsx(U,{className:"text-xl"}),Recycler:c.jsx(J,{className:"text-xl"})},ye={Producer:"text-orange-500",Distributor:"text-blue-500",Collector:"text-yellow-500",Recycler:"text-green-500"},xe=({data:n,selectedDistrict:s,setSelectedDistrict:m,enabledCategories:l,setEnabledCategories:b,columnFilters:f,districtOptions:h,onColumnFiltersChange:w})=>{const o=Y(),F=new URLSearchParams(o.search).get("viewAll")==="true",S=r.useMemo(()=>[{accessorKey:"district_name",header:"District",minSize:50,maxSize:50,size:50},{accessorKey:"tehsil_name",header:"Tehsil",minSize:50,maxSize:50,size:50},{accessorKey:"category",header:"Category",Cell:({cell:E})=>{const p=E.getValue(),j=ge[p],u=ye[p]||"text-gray-500";return j?c.jsxs("div",{className:`flex items-center ${u}`,children:[j,c.jsx("span",{className:"ml-1",children:p})]}):p},minSize:50,maxSize:50,size:50},{accessorKey:"business_name",header:"Business Name",minSize:50,maxSize:50,size:50},{accessorKey:"postal_address",header:"Postal Address",minSize:50,maxSize:100,size:100},{accessorKey:"material_flow_kg_per_day",header:"Material Flow (Kg/Day)",minSize:50,maxSize:100,size:100}],[h]);return c.jsx(de,{columns:S,data:n,initialState:{showColumnFilters:!1,pagination:{pageSize:F?1e5:5}}})};export{Le as default};
