import{r as c,k as z,W as P,j as t,A as D}from"./index-Dez6KUd-.js";import{M as B}from"./index.esm-CF5MQHYB.js";import"./TextField-OkNoTz_W.js";import"./DefaultPropsProvider-DNq-LJgg.js";import"./Autocomplete-DPH7sKEm.js";import"./FormControlLabel-CePI-8g0.js";import"./Divider-D0qqVSxz.js";import"./index-DVa26zf9.js";const Y=a=>{const d=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","DG","Download License"],p=d.indexOf(a.assigned_group),i=a.applicationassignment||[],n=(()=>{if(i.length>1){const S=i[i.length-2];return d.indexOf(S.assigned_group)}return-1})(),L=n!==-1&&n>p;return i.find(S=>d.indexOf(S.assigned_group)===n),{id:a.id,tracking_number:a.tracking_number,first_name:a.first_name,last_name:a.last_name,CNIC:a.cnic,mobile_no:a.mobile_no,application_status:a.application_status,assigned_group:a.assigned_group,registration_for:a.registration_for,remarks:a.remarks||"N/A",is_assigned_back:L?"Yes":"No"}},U=a=>a.map(d=>{const p=Y(d);return Object.keys(p).forEach(i=>{(p[i]===void 0||p[i]===null)&&(p[i]="N/A")}),p}),X=()=>{const[a,d]=c.useState([]),[p,i]=c.useState([]),[n,L]=c.useState(null),[S,A]=c.useState(0),[y,j]=c.useState(null),[E,M]=c.useState({}),[N,G]=c.useState(null),[F,O]=c.useState(!1),T=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","DG","Download License"],b={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO",DG:"DG","Download License":"Download License"},k=z(e=>e.user.authority)||[],R=async e=>{try{if(O(!0),G(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const l=e==="LSO1"?1:e==="LSO2"?2:0,h=((await D.get("/pmc/applicant-detail-main-do-list/",{params:{assigned_group:"LSO"}})).data||[]).filter(x=>{var r;return((r=x.submittedapplication)==null?void 0:r.id)%3===l}),g=C(h,!!n.length,n[0]);d(g.flattenedData),i(g.columns)}else{const o=(await D.get("/pmc/applicant-detail-main-do-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],h=C(o,!!n.length,n[0]);d(h.flattenedData),i(h.columns)}}catch(l){console.error("Error fetching filtered data:",l),d([]),i([])}finally{O(!1)}},C=(e,l,o)=>{const h=["first_name","CNIC","mobile_no","tracking_number","registration_for","days_pending_for","remarks","is_assigned_back"],g=U(e),x=g[0],r=[...Object.keys(x).filter(s=>h.includes(s)).map(s=>{let m=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(s)?m=120:["first_name"].includes(s)&&(m=180),s==="is_assigned_back"?{accessorKey:s,header:"Assigned Back",size:m,Filter:({column:u})=>t.jsxs("select",{value:u.getFilterValue()||"",onChange:f=>u.setFilterValue(f.target.value||void 0),style:{width:"100%",padding:"4px"},children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"Yes",children:"Yes"}),t.jsx("option",{value:"",children:"No"})]}),filterFn:(u,f,_)=>_===""||u.original[s]===_,Cell:({cell:u,row:f})=>{const _=f.original.id,v=f.original.is_assigned_back,w=`/spuid-review/${_}?group=${o}`;return t.jsx("a",{href:w,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:v==="Yes"?"red":"blue",textDecoration:"underline"},children:u.getValue()||"-"})}}:{accessorKey:s,header:s.replace(/_/g," ").replace(/\b\w/g,u=>u.toUpperCase()),size:m,Cell:({cell:u,row:f})=>{const _=f.original.id,v=f.original.is_assigned_back,w=`/spuid-review/${_}?group=${o}`;return t.jsx("a",{href:w,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:v==="Yes"?"red":"blue",textDecoration:"underline"},children:u.getValue()||"-"})}}})];return{flattenedData:g,columns:r}},I=P();return c.useEffect(()=>{(async()=>{O(!0);try{let o=[];try{o=(await D.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],L(o.map(s=>s.name))}catch(r){console.error("Error fetching user groups:",r),L([])}console.log("groupsResponse",o);const g=(await D.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(g)&&g.length>0){const r=C(g,o.length>0,o.map(m=>m.name)[0]);d(r.flattenedData),i(r.columns),console.log("Flattened Data:",r.flattenedData);const s=r.flattenedData[r.flattenedData.length-1];if(console.log("Last Row:",s),s&&s.id){j(s.id),console.log("Last Row ID:",s.id);const m=T.indexOf(s.assigned_group);m!==-1&&A(m)}}const x=await D.get("/pmc/fetch-statistics-do-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});M(x.data)}catch(o){console.error("Error fetching data:",o)}finally{O(!1)}})(),j(25);const l=T.indexOf("LSO");l!==-1&&A(l)},[]),c.useEffect(()=>{console.log("userGroups:",n),n&&!n.includes("DO")&&I("/home")},[n,I]),c.useEffect(()=>{const e=Object.keys(b).find(l=>k.includes(l));R(e)},[k]),console.log("selectedRowId:",y),console.log(y),t.jsxs("div",{children:[t.jsx("div",{className:"tiles-container",children:Object.entries(E).map(([e,l])=>t.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:N===e?"#007BFF":"#f8f9fa",color:N===e?"#fff":"#000"},onClick:()=>R(e),children:[t.jsx("h3",{children:b[e]||e})," ",t.jsx("p",{children:l})]},e))}),t.jsx("div",{className:"mb-4",children:t.jsxs("h3",{children:[n&&n.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),t.jsx("div",{children:t.jsx("h6",{className:"text-red-500",children:"Records highlighted in red require immediate attention, as they have been returned from a next step."})}),F?t.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[t.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),t.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):t.jsx(B,{columns:[...p],data:a.map(e=>({...e,assigned_group_title:b[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:200,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0})]})};export{X as default};
