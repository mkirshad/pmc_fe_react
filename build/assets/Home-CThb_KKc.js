import{r as i,y as A,j as s,W as F,A as D}from"./index-Dei5semP.js";import{M as K}from"./index.esm-C84je-h6.js";import{u as U,a as B}from"./useControllableState-a7j904Wj.js";import{c as H}from"./classNames-ChKocHs_.js";import"./TextField-2mlSQWfa.js";import"./DefaultPropsProvider-BNLJDJpk.js";import"./Autocomplete-C3qtyuRj.js";import"./FormControlLabel-DOE8mnIK.js";import"./Divider-Duqu6Bco.js";import"./index-MPMz43IR.js";const y=i.createContext({}),W=y.Provider;y.Consumer;function R(){return i.useContext(y)}const P=i.forwardRef((e,d)=>{const{className:a,defaultValue:n,onChange:t,value:c,variant:p="underline",...r}=e,[u,f]=U({prop:c,onChange:t,defaultProp:n}),h=A("tabs",a);return s.jsx(W,{value:{value:u,onValueChange:f,variant:p},children:s.jsx("div",{className:h,...r,ref:d})})});P.displayName="Tabs";const k=i.forwardRef((e,d)=>{const{className:a,children:n,...t}=e,{variant:c}=R(),p=A("tab-list",`tab-list-${c}`,a);return s.jsx("div",{ref:d,role:"tablist",className:p,...t,children:n})});k.displayName="TabList";const $=i.forwardRef((e,d)=>{const{value:a,disabled:n,className:t,icon:c,children:p,...r}=e,{value:u,onValueChange:f,variant:h}=R(),g=a===u,w=B(()=>{!g&&!n&&(f==null||f(a))}),O=H("tab-nav",`tab-nav-${h}`,g&&"tab-nav-active text-primary",g&&h==="underline"&&"border-primary",g&&h==="pill"&&"bg-primary text-neutral",n&&"tab-nav-disabled",!n&&!g&&"hover:text-primary",t);return s.jsxs("div",{ref:d,className:O,role:"tab","aria-selected":g,tabIndex:0,onClick:w,onKeyDown:w,...r,children:[c&&s.jsx("div",{className:"tab-nav-icon",children:c}),p]})});$.displayName="TabNav";const M=i.forwardRef((e,d)=>{const{value:a,children:n,className:t,...c}=e,p=R(),r=a===p.value,u=A("tab-content",r&&"tab-content-active",t);return s.jsx("div",{ref:d,role:"tabpanel",tabIndex:0,className:u,...c,children:r&&n})});M.displayName="TabContent";const L=P;L.TabList=k;L.TabNav=$;L.TabContent=M;const{TabNav:ie,TabList:re,TabContent:le}=L,q=e=>{var t,c,p;const a=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(r=>r.assigned_group==="APPLICANT"&&r.remarks&&r.remarks!=="undefined").map(r=>r.remarks),n=a.length>0?a.join("; "):"N/A";return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,CNIC:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,application_Start_Time:((t=e.created_at)==null?void 0:t.substring(0,16))||"N/A",application_Submission_Time:((p=(c=e.submittedapplication)==null?void 0:c.created_at)==null?void 0:p.substring(0,16))||"N/A",remarks:n}},J=e=>e.map(d=>{const a=q(d);return Object.keys(a).forEach(n=>{(a[n]===void 0||a[n]===null)&&(a[n]="N/A")}),a}),ce=()=>{const[e,d]=i.useState([]),[a,n]=i.useState([]),[t,c]=i.useState([]),[p,r]=i.useState(0),[u,f]=i.useState(null),[h,g]=i.useState({}),[w,O]=i.useState("tab1");console.log(u);const[z,j]=i.useState(!1),I=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],E={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},G=(o,v,m)=>{const T=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],l=J(o),b=l[0];console.log(o);const x=[...Object.keys(b).filter(_=>T.includes(_)).map(_=>({accessorKey:_,header:_.replace(/_/g," ").replace(/\b\w/g,N=>N.toUpperCase()),Cell:({cell:N,row:V})=>s.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const S=V.original.id;console.log(`Clicked ${_}:`,N.getValue()),console.log(`Navigating with ID: ${S}`),window.location.href=v?`/spuid-review/${S}?group=${m}`:`/spuid-signup/${S}`},children:N.getValue()||"-"})}))];return{flattenedData:l,columns:x}},C=F();return i.useEffect(()=>{(async()=>{j(!0);try{let m=[];try{if(navigator.onLine){const l=await D.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})}else throw new Error("Application is offline. Cannot fetch data.");m=response.data||[],c(m.map(l=>l.name))}catch(l){console.error("Error fetching user groups:",l),c([])}if(console.log("groupsResponse",m),navigator.onLine){const l=await D.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})}else throw new Error("Application is offline. Cannot fetch data.");const T=response.data;if(Array.isArray(T)&&T.length>0){const l=G(T,m.length>0,m.map(x=>x.name)[0]);d(l.flattenedData),n(l.columns),console.log("Flattened Data:",l.flattenedData);const b=l.flattenedData[l.flattenedData.length-1];if(console.log("Last Row:",b),b&&b.id){f(b.id),console.log("Last Row ID:",b.id);const x=I.indexOf(b.assigned_group);x!==-1&&r(x)}}if(navigator.onLine){const l=await D.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}})}else throw new Error("Application is offline. Cannot fetch data.");g(statsResponse.data)}catch(m){console.error("Error fetching data:",m)}finally{j(!1)}})(),f(25);const v=I.indexOf("LSO");v!==-1&&r(v)},[]),i.useEffect(()=>{console.log("userGroups:",t),t.includes("DEO")||t.includes("DG")?C("/home-deo"):t.includes("Admin")?C("/home-admin"):t.includes("DO")?C("/home-do"):t.includes("Super")&&C("/home-super")},[t,C]),console.log("selectedRowId:",u),console.log(u),s.jsxs("div",{children:[s.jsx("div",{className:"tiles-container",children:Object.entries(h).map(([o,v])=>s.jsxs("div",{className:"tile",children:[s.jsx("h3",{children:E[o]||o})," ",s.jsx("p",{children:v})]},o))}),t.length>0&&s.jsx("div",{className:"mb-4",children:s.jsxs("h3",{children:[t.filter(o=>o!=="Download License"&&o!=="Applicant"&&o!=="LSM2").join(" - ")," Dashboard"]})}),z?s.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[s.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),s.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):s.jsx(K,{columns:[...a],data:e.map(o=>({...o,assigned_group_title:E[o.assigned_group]||o.assigned_group})),getRowId:o=>o.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:100,size:140},enableColumnResizing:!0,enableTopToolbar:t.length>0,enablePagination:!0},u)]})};export{ce as default};
