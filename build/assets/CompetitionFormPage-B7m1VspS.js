import{j as e,a3 as x,A as y}from"./index-oDwQGYEA.js";import{a as m,C as u,u as _,F as k}from"./index.esm-BwKut1eI.js";import{t as N,z as r}from"./index-EAOVwyn9.js";import{B as P}from"./BottomStickyBar-D8srE-Mm.js";import{C as w}from"./Card-DyjZqYue.js";import{I as g}from"./Input-Zn4GrLhU.js";import{S as B}from"./Select-D8ijT30g.js";import{I as L}from"./index-BOnOqGgc.js";import{B as T}from"./Button-CkHimBRY.js";import{B as I}from"./index-CDrWRDXV.js";import"./classNames-Dv-7hrnu.js";import"./index-DWjkHJka.js";import"./isNil-DegOKdHG.js";import"./setPrototypeOf-C3V6guyq.js";import"./emotion-element-f0de968e.browser.esm-DX8E_o2N.js";import"./assertThisInitialized-Cle6jci9.js";import"./floating-ui.dom-CrKScG7J.js";const S=[{label:"Poster",value:"poster"},{label:"Painting",value:"painting"},{label:"3D Model",value:"3d_model"}],F=["8th","9th","10th","Intermediate","O Level","A Level","BS","MS","MPhil","PhD"].map(t=>({label:t,value:t})),M=t=>{const a=["BS","MS","MPhil","PhD"],d=["8th","9th","10th","Intermediate","O Level","A Level"];return a.includes(t)?"University":d.includes(t)?"School":""},D={School:["poster","painting","3d_model"],University:["poster","painting"]},R=t=>t?t.split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "):"object",A=({control:t,errors:a,readOnly:d=!1,watch:h})=>{var o,s,c,C,p,b;const f=h("grade"),j=M(f),v=S.filter(i=>{var n;return(n=D[j])==null?void 0:n.includes(i.value)});return e.jsxs(w,{children:[e.jsx("h4",{className:"mb-6",children:"Competition Registration"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(m,{label:"Full Name *",invalid:!!a.fullName,errorMessage:(o=a.fullName)==null?void 0:o.message,children:e.jsx(u,{name:"fullName",control:t,render:({field:i})=>e.jsx(g,{placeholder:"Full Name",readOnly:d,...i})})}),e.jsx(m,{label:"Institute Name *",invalid:!!a.institute,errorMessage:(s=a.institute)==null?void 0:s.message,children:e.jsx(u,{name:"institute",control:t,render:({field:i})=>e.jsx(g,{placeholder:"Institute Name",readOnly:d,...i})})}),e.jsx(m,{label:"Grade *",invalid:!!a.grade,errorMessage:(c=a.grade)==null?void 0:c.message,children:e.jsx(u,{name:"grade",control:t,render:({field:i})=>e.jsx(B,{options:F,value:F.find(n=>n.value===i.value),isDisabled:d,onChange:n=>i.onChange(n==null?void 0:n.value)})})}),e.jsx(m,{label:"Auto-detected Category",children:e.jsx(g,{value:M(h("grade")),readOnly:!0})}),e.jsx(m,{label:"Competition Type *",invalid:!!a.competitionType,errorMessage:(C=a.competitionType)==null?void 0:C.message,children:e.jsx(u,{name:"competitionType",control:t,render:({field:i})=>e.jsx(B,{options:v,value:S.find(n=>n.value===i.value),isDisabled:d,onChange:n=>i.onChange(n==null?void 0:n.value)})})}),e.jsx(m,{label:"Mobile Number *",invalid:!!a.mobile,errorMessage:(p=a.mobile)==null?void 0:p.message,children:e.jsx(u,{name:"mobile",control:t,render:({field:i})=>e.jsx(L,{mask:"3999999999",value:i.value,readOnly:d,onChange:n=>i.onChange(n.target.value),children:n=>e.jsx(g,{placeholder:"Mobile",...n})})})}),e.jsx(m,{label:"Student Card Front *",invalid:!!a.studentCardFront,errorMessage:(b=a.studentCardFront)==null?void 0:b.message,children:e.jsx(u,{name:"studentCardFront",control:t,render:({field:i})=>e.jsx(g,{type:"file",accept:"image/*",capture:"environment",onChange:n=>{var l;return i.onChange((l=n.target.files)==null?void 0:l[0])}})})}),e.jsx(m,{label:"Student Card Back",children:e.jsx(u,{name:"studentCardBack",control:t,render:({field:i})=>e.jsx(g,{type:"file",accept:"image/*",capture:"environment",onChange:n=>{var l;return i.onChange((l=n.target.files)==null?void 0:l[0])}})})}),e.jsx(m,{label:`Photo of your ${R(h("competitionType"))}`,children:e.jsx(u,{name:"photoObject",control:t,render:({field:i})=>e.jsx(g,{type:"file",accept:"image/*",capture:"environment",onChange:n=>{var l;return i.onChange((l=n.target.files)==null?void 0:l[0])}})})})]})]})},O=r.object({fullName:r.string().min(1,{message:"Required"}),institute:r.string().min(1,{message:"Required"}),grade:r.string().min(1),competitionType:r.string().min(1),mobile:r.string().min(10).max(10),studentCardFront:r.instanceof(File,{message:"Student Card (Front) is required"}).refine(t=>t.size<=10*1024*1024,{message:"Student Card (Front) must be smaller than 10MB"}),studentCardBack:r.union([r.instanceof(File),r.null(),r.undefined()]).optional().refine(t=>t==null?!0:t.size<=10*1024*1024,{message:"Back Student Card must be a file smaller than 10 MB."}).optional(),photoObject:r.union([r.instanceof(File),r.null(),r.undefined()]).optional().refine(t=>t==null?!0:t.size<=10*1024*1024,{message:"Objeect Photo must be a file smaller than 10 MB."}).optional()}),ne=()=>{const{handleSubmit:t,control:a,formState:{errors:d},reset:h,watch:f}=_({resolver:N(O),defaultValues:{fullName:"",institute:"",grade:"",category:"",competitionType:"",mobile:""}}),j=o=>{const s=["BS","MS","MPhil","PhD"],c=["8th","9th","10th","Intermediate","O Level","A Level"];return s.includes(o)?"University":c.includes(o)?"School":""},v=async o=>{const s=new FormData;s.append("full_name",o.fullName),s.append("institute",o.institute),s.append("grade",o.grade),s.append("category",j(o.grade)),s.append("competition_type",o.competitionType),s.append("mobile",o.mobile),s.append("student_card_front",o.studentCardFront),o.studentCardBack instanceof File&&s.append("student_card_back",o.studentCardBack),o.photoObject instanceof File&&s.append("photo_object",o.photoObject);try{const c={"Content-Type":"multipart/form-data"},p=(await y.post("/pmc/competition/register/",s,{headers:c})).data;if(p.success){alert(`Registration Successful! Your ID is ${p.registration_id}

ðŸ“¦ The courier label will now be downloaded.
Please print it and paste it on your courier package before dispatching your competition submission to the Plastic Management Cell.`);const b=await y.get(`/pmc/competition/generate-label/?registration_id=${p.registration_id}`,{responseType:"blob"}),i=new Blob([b.data],{type:"application/pdf"}),n=window.URL.createObjectURL(i),l=document.createElement("a");l.href=n,l.setAttribute("download",`courier_label_${p.registration_id}.pdf`),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(n),h({fullName:"",institute:"",grade:"",category:"",competitionType:"",mobile:"",studentCardFront:void 0,studentCardBack:void 0,photoObject:void 0})}else alert("Something went wrong. Please try again.")}catch(c){console.error("Submission failed:",c),alert("Error submitting the form. Please try again later.")}};return e.jsxs(k,{onSubmit:t(v),children:[e.jsx(x,{children:e.jsx(A,{control:a,errors:d,readOnly:!1,watch:f})}),e.jsx(P,{children:e.jsx(x,{className:"flex justify-end",children:e.jsx(T,{icon:e.jsx(I,{}),variant:"solid",type:"submit",children:"Submit & Generate Slip"})})})]})};export{ne as default};
