import{r as c,k as E,K as H,j as e,e as _,A as L,u as U,b as q}from"./index-B9sKIpKq.js";import{L as W}from"./Logo-arvJIuFD.js";import{u as z,A as D}from"./useTimeOutMessage-BM3DQFPK.js";import{I as K}from"./Input-B9EoeLCh.js";import{B as O}from"./Button-49dt9LRz.js";import{u as R,F as V,a as C,C as S}from"./index.esm-ITmD8gIe.js";import{P as G}from"./PasswordInput-CPfaSBkD.js";import{t as J,z as u}from"./index-CbvGynKP.js";import{A as y}from"./ActionLink-BSoAakfk.js";import"./StatusIcon-DQRv6HhE.js";import"./isNil-DoGwQrer.js";import"./CloseButton-BQjjGzDY.js";import"./classNames-BzxHWcMT.js";import"./index-D1T5BbOg.js";const Q=u.object({email:u.string({required_error:"Please enter your email"}).min(1,{message:"Please enter your email"}),password:u.string({required_error:"Please enter your password"}).min(1,{message:"Please enter your password"})}),X=d=>{var j,b,w;const[n,i]=c.useState(!1),[p,l]=c.useState(""),[h,m]=c.useState(""),A=E(s=>s.setUser),{disableSubmit:v=!1,className:I,setMessage:a,passwordHint:g}=d,{handleSubmit:N,formState:{errors:t},control:x,register:Z}=R({defaultValues:{email:"",password:""},resolver:J(Q)}),f=async()=>{try{if(navigator.onLine){const r=(await L.get("/accounts/generate-captcha/")).data;l(r.captcha_image),m(r.captcha_token)}else throw new Error("Application is offline. Cannot load CAPTCHA.")}catch(s){console.error("Error loading CAPTCHA:",s),l(""),m("")}};c.useEffect(()=>{f()},[]);const{signIn:P}=H(),k=async s=>{const{email:r,password:T,captcha_input:F,captcha_token:B}=s;if(!v){i(!0);const o=await P({username:r,password:T,captcha_input:F,captcha_token:B});(o==null?void 0:o.status)==="failed"?o.message.includes("CAPTCHA")?(a==null||a("Incorrect CAPTCHA, please try again."),await f()):o.message.includes("400")?a==null||a("Invalid Credentials!"):a==null||a("Technical Error! Please try again or email at fdm@epd.punjab.gov.pk"):A({email:r,userName:r.split("@")[0]})}i(!1)};return e.jsx("div",{className:I,children:e.jsxs(V,{onSubmit:N(k),children:[e.jsx(C,{label:"Username",invalid:!!t.email,errorMessage:(j=t.email)==null?void 0:j.message,children:e.jsx(S,{name:"email",control:x,render:({field:s})=>e.jsx(K,{type:"text",placeholder:"Username",autoComplete:"off",...s})})}),e.jsx(C,{label:"Password",invalid:!!t.password,errorMessage:(b=t.password)==null?void 0:b.message,className:_(g&&"mb-0",((w=t.password)==null?void 0:w.message)&&"mb-8"),children:e.jsx(S,{name:"password",control:x,rules:{required:!0},render:({field:s})=>e.jsx(G,{type:"text",placeholder:"Password",autoComplete:"off",...s})})}),g,e.jsx(O,{block:!0,loading:n,variant:"solid",type:"submit",children:n?"Signing in...":"Sign In"})]})})},Y=({signUpUrl:d="/sign-up",forgetPasswordUrl:n="/forgot-password",disableSubmit:i})=>{const[p,l]=z(),h=U(m=>m.mode);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-8",children:e.jsx(q,{to:"/",children:e.jsx(W,{type:"streamline",mode:h,imgClass:"mx-auto",logoWidth:60})})}),e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"mb-2",children:"Welcome back!"}),e.jsx("p",{className:"font-semibold heading-text",children:"Please enter your credentials to sign in!"})]}),p&&e.jsx(D,{showIcon:!0,className:"mb-4",type:"danger",children:e.jsx("span",{className:"break-all",children:p})}),e.jsx(X,{disableSubmit:i,setMessage:l,passwordHint:e.jsx("div",{className:"mb-7 mt-2",children:e.jsx(y,{to:n,className:"font-semibold heading-text mt-2 underline",themeColor:!1,children:"Forgot password"})})}),e.jsx("div",{children:e.jsxs("div",{className:"mt-6 text-center",children:[e.jsxs("span",{children:["Don't have an account yet?"," "]}),e.jsx(y,{to:d,className:"heading-text font-bold",themeColor:!1,children:"Sign up"})]})})]})},pe=()=>e.jsx(Y,{});export{Y as SignInBase,pe as default};
