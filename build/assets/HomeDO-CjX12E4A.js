import{r as c,l as B,W as P,j as t,A as _}from"./index-oDwQGYEA.js";import{M as U}from"./index.esm-C6T0MJvz.js";import{a as Y}from"./index-DE7QgtAB.js";import"./TextField-r5TNIsmD.js";import"./DefaultPropsProvider-CGomaEqC.js";import"./emotion-element-f0de968e.browser.esm-DX8E_o2N.js";import"./setPrototypeOf-C3V6guyq.js";import"./assertThisInitialized-Cle6jci9.js";import"./Modal-CFzYjZPq.js";import"./Autocomplete-Dg-hWFz0.js";import"./Box-CNakWzJu.js";import"./FormControlLabel-BQoHBKRj.js";import"./Divider-B6CetmYu.js";import"./index-CFuoc-5k.js";const $=n=>{const d=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","DG","Download License"],m=d.indexOf(n.assigned_group),r=n.applicationassignment||[],o=(()=>{if(r.length>1){const L=r[r.length-2];return d.indexOf(L.assigned_group)}return-1})(),D=o!==-1&&o>m;return r.find(L=>d.indexOf(L.assigned_group)===o),{id:n.id,tracking_number:n.tracking_number,first_name:n.first_name,last_name:n.last_name,CNIC:n.cnic,mobile_no:n.mobile_no,application_status:n.application_status,assigned_group:n.assigned_group,registration_for:n.registration_for,remarks:n.remarks||"N/A",is_assigned_back:D?"Yes":"No"}},V=n=>n.map(d=>{const m=$(d);return Object.keys(m).forEach(r=>{(m[r]===void 0||m[r]===null)&&(m[r]="N/A")}),m}),ie=()=>{const[n,d]=c.useState([]),[m,r]=c.useState([]),[o,D]=c.useState(null),[L,v]=c.useState(0),[A,j]=c.useState(null),[I,M]=c.useState({}),[N,F]=c.useState(null),[G,S]=c.useState(!1),E=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","DG","Download License"],O={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO",DG:"DG","Download License":"Download License"},k=B(e=>e.user.authority)||[],R=async e=>{try{if(S(!0),F(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const i=e==="LSO1"?1:e==="LSO2"?2:0,g=((await _.get("/pmc/applicant-detail-main-do-list/",{params:{assigned_group:"LSO"}})).data||[]).filter(b=>{var l;return((l=b.submittedapplication)==null?void 0:l.id)%3===i}),p=w(g,!!o.length,o[0]);d(p.flattenedData),r(p.columns)}else{const s=(await _.get("/pmc/applicant-detail-main-do-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],g=w(s,!!o.length,o[0]);d(g.flattenedData),r(g.columns)}}catch(i){console.error("Error fetching filtered data:",i),d([]),r([])}finally{S(!1)}},w=(e,i,s)=>{const g=["first_name","CNIC","mobile_no","tracking_number","registration_for","days_pending_for","remarks","is_assigned_back"],p=V(e),b=p[0],l=[...Object.keys(b).filter(a=>g.includes(a)).map(a=>{let f=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(a)?f=120:["first_name"].includes(a)&&(f=180),a==="is_assigned_back"?{accessorKey:a,header:"Assigned Back",size:f,Filter:({column:u})=>t.jsxs("select",{value:u.getFilterValue()||"",onChange:h=>u.setFilterValue(h.target.value||void 0),style:{width:"100%",padding:"4px"},children:[t.jsx("option",{value:"",children:"All"}),t.jsx("option",{value:"Yes",children:"Yes"}),t.jsx("option",{value:"",children:"No"})]}),filterFn:(u,h,x)=>x===""||u.original[a]===x,Cell:({cell:u,row:h})=>{const x=h.original.id,C=h.original.is_assigned_back,y=`/spuid-review/${x}?group=${s}`;return t.jsx("a",{href:y,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:C==="Yes"?"red":"blue",textDecoration:"underline"},children:u.getValue()||"-"})}}:{accessorKey:a,header:a.replace(/_/g," ").replace(/\b\w/g,u=>u.toUpperCase()),size:f,Cell:({cell:u,row:h})=>{const x=h.original.id,C=h.original.is_assigned_back,y=`/spuid-review/${x}?group=${s}`;return t.jsx("a",{href:y,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:C==="Yes"?"red":"blue",textDecoration:"underline"},children:u.getValue()||"-"})}}})];return{flattenedData:p,columns:l}},T=P();c.useEffect(()=>{(async()=>{S(!0);try{let s=[];try{s=(await _.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],D(s.map(a=>a.name))}catch(l){console.error("Error fetching user groups:",l),D([])}console.log("groupsResponse",s);const p=(await _.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(p)&&p.length>0&&p[0]!==""){const l=w(p,s.length>0&&s[0]!=="",s.map(f=>f.name)[0]);d(l.flattenedData),r(l.columns),console.log("Flattened Data:",l.flattenedData);const a=l.flattenedData[l.flattenedData.length-1];if(console.log("Last Row:",a),a&&a.id){j(a.id),console.log("Last Row ID:",a.id);const f=E.indexOf(a.assigned_group);f!==-1&&v(f)}}const b=await _.get("/pmc/fetch-statistics-do-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});M(b.data)}catch(s){console.error("Error fetching data:",s)}finally{S(!1)}})(),j(25);const i=E.indexOf("LSO");i!==-1&&v(i)},[]),c.useEffect(()=>{console.log("userGroups:",o),o&&!o.includes("DO")&&T("/home")},[o,T]),c.useEffect(()=>{const e=Object.keys(O).find(i=>k.includes(i));R(e)},[k]),console.log("selectedRowId:",A),console.log(A);const z=async()=>{try{const e=await _.post("/pmc/export-applicant/",{applicant_ids:n==null?void 0:n.map(g=>g.id)},{responseType:"blob"}),i=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=i,s.setAttribute("download",`Applicant_Details_${new Date().toISOString()}.xlsx`),document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(e){console.error("Export failed:",e)}};return t.jsxs("div",{children:[t.jsx("div",{className:"tiles-container",children:Object.entries(I).map(([e,i])=>t.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:N===e?"#007BFF":"#f8f9fa",color:N===e?"#fff":"#000"},onClick:()=>R(e),children:[t.jsx("h3",{children:O[e]||e})," ",t.jsx("p",{children:i})]},e))}),t.jsx("div",{className:"mb-4",children:t.jsxs("h3",{children:[o&&o.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),t.jsxs("div",{className:"grid md:grid-cols-5 gap-5 items-center mb-4",children:[t.jsx("h6",{className:"text-red-500 col-span-3",children:"Records highlighted in red require immediate attention, as they have been returned from a next step."}),t.jsx("span",{}),t.jsxs("button",{type:"button",onClick:z,className:"flex items-center justify-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-200",children:[t.jsx(Y,{className:"mr-2 text-xl"}),"Export to Excel"]})]}),G?t.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[t.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),t.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):t.jsx(U,{columns:[...m],data:n.map(e=>({...e,assigned_group_title:O[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:200,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0})]})};export{ie as default};
