import{r as s,j as c,A as v}from"./index-BVVVfUoT.js";import{M as ee,T as te,O as se,V as re,a as A,b as L,S as V,C as ce,F as I,c as B,f as oe,d as ae,P as ie,t as le,G as ne}from"./terraformer-wkt-parser-DBiwPZU5.js";import{b as ue,c as K,d as G,e as Z,f as O}from"./index-CphuLRJn.js";import{M as de}from"./index.esm-BSNc5XcJ.js";import"./TextField-Dq66N8AB.js";import"./Divider-BCZX7UF2.js";import"./FormControlLabel-DlG85ndg.js";import"./Autocomplete-DR-RBTx_.js";import"./index-DxE9PNIY.js";function me(x){switch(x){case"Producer":return"#FB923C";case"Distributor":return"#3B82F6";case"Collector":return"#FBBF24";case"Recycler":return"#22C55E";default:return"gray"}}const ke=({onDistrictClick:x})=>{const n=s.useRef(null),[o,C]=s.useState(null),[l,h]=s.useState(null),[m,b]=s.useState(null),[r,u]=s.useState(null),[d,j]=s.useState(null),[w,J]=s.useState([]),[U,$]=s.useState([]),[p,S]=s.useState(null),[D,N]=s.useState(["Producer","Distributor","Collector","Recycler"]),[T,H]=s.useState(!1),[z,pe]=s.useState([8054803349056441e-9,3.6232483407283584e6]),[R,he]=s.useState(6.53343814691434),[W,E]=s.useState(4);s.useEffect(()=>{const t=new ee({target:n.current,layers:[new te({source:new se})],view:new re({zoom:7,center:[8127130,3658593]})}),e=new A({source:new L});return t.addLayer(e),h(e),C(t),()=>t.setTarget(null)},[]),s.useEffect(()=>{if(!o)return;const t=new A({source:new L,style:e=>{const a=e.get("category");return new V({image:new ce({radius:W,fill:new I({color:me(a)}),stroke:new B({color:"#fff",width:1})})})}});o.addLayer(t),b(t)},[o]),s.useEffect(()=>{(async()=>{try{const e=await v.get("/pmc/applicant-location-public/");J(e.data);const a=new Set(e.data.map(f=>f.district_name).filter(Boolean)),i=Array.from(a).sort();$(i)}catch(e){console.error("Error fetching applicant data:",e)}})()},[]);const k=s.useMemo(()=>p?w.filter(t=>t.district_name===p):w,[p,w]),_=s.useMemo(()=>k.filter(t=>D.includes(t.category)),[k,D]);s.useEffect(()=>{if(!m)return;const t=m.getSource();t.clear(),_.forEach(e=>{if(e.latitude&&e.longitude){const a=oe([Number(e.longitude),Number(e.latitude)]),i=new ae({geometry:new ie(a),category:e.category});t.addFeature(i)}})},[_,m]),s.useEffect(()=>{if(!o||!l||T)return;(async()=>{let e=d;e||(e=(await v.get("/pmc/districts-public")).data.filter(Y=>Y.geom));const i={type:"FeatureCollection",features:e.map(y=>({type:"Feature",geometry:le.parse(y.geom.replace("SRID=4326;","")),properties:{district_id:y.district_id,district_name:y.district_name,district_code:y.district_code}}))},f=l.getSource();f.clear(),f.addFeatures(new ne().readFeatures(i,{featureProjection:"EPSG:3857"}));const F=f.getExtent();o.getView().fit(F,{padding:[50,50,50,50],maxZoom:10}),H(!0)})()},[o,l,T,d]),s.useEffect(()=>{l&&l.setStyle(t=>{const e=t.get("district_id")===r;return new V({stroke:new B({color:e?"red":"blue",width:e?3:2}),fill:new I({color:e?"rgba(255, 0, 0, 0.1)":"rgba(0, 0, 255, 0.1)"})})})},[l,r]),s.useEffect(()=>{if(!o||!l)return;const t=e=>{const a=o.getFeaturesAtPixel(e.pixel);if(a&&a.length>0){const i=a[0],f=i.getProperties(),F=f.district_name;if(p===F)S(null),u(null),o.getView().setCenter(z),o.getView().setZoom(R),E(3);else{S(F),u(f.district_id),E(5);const y=i.getGeometry();o.getView().fit(y.getExtent(),{padding:[50,50,50,50],maxZoom:10})}}else S(null),u(null),E(3),o.getView().setCenter(z),o.getView().setZoom(R)};return o.on("click",t),()=>o.un("click",t)},[o,l,p]);function q(t){const e={Total:t.length,Producer:0,Distributor:0,Collector:0,Recycler:0};return t.forEach(a=>{a.category==="Producer"&&e.Producer++,a.category==="Distributor"&&e.Distributor++,a.category==="Collector"&&e.Collector++,a.category==="Recycler"&&e.Recycler++}),e}const P=q(k),Q=D.reduce((t,e)=>t+P[e],0),[g,M]=s.useState([]),X=t=>{let e;typeof t=="function"?M(a=>(e=t(a),e)):(M(t),e=t)};return s.useEffect(()=>{let t=[];Array.isArray(g)?t=g:typeof g=="object"&&g!==null&&(t=Object.values(g));let e=null,a=["Producer","Distributor","Collector","Recycler"];t.forEach(i=>{i.id==="district_name"&&(e=i.value||null),i.id==="category"&&i.value&&(a=[i.value])}),S(e),N(a)},[g]),c.jsxs("div",{children:[c.jsx(fe,{stats:P,enabledCategories:D,setEnabledCategories:N,enabledTotal:Q}),c.jsxs("div",{className:"flex flex-col md:flex-row",children:[c.jsx("div",{ref:n,style:{height:"600px",width:"500px"},className:"mb-4"}),c.jsx("div",{className:"ml-4 flex-grow",children:c.jsx(xe,{data:_,selectedDistrict:p,setSelectedDistrict:S,enabledCategories:D,setEnabledCategories:N,columnFilters:g,districtOptions:U,onColumnFiltersChange:X})})]})]})},fe=({stats:x,enabledCategories:n,setEnabledCategories:o,enabledTotal:C})=>{const l=r=>{if(r==="Total"){n.length===4?o([]):o(["Producer","Distributor","Collector","Recycler"]);return}n.includes(r)?o(n.filter(u=>u!==r)):o([...n,r])},h=r=>r==="Total"?n.length>0:n.includes(r);function m(r){return r==="Total"?h("Total")?C:0:x[r]||0}const b=[{key:"Total",bgColor:"bg-gray-500",icon:c.jsx(ue,{className:"text-white text-3xl"})},{key:"Producer",bgColor:"bg-orange-500",icon:c.jsx(K,{className:"text-white text-3xl"})},{key:"Distributor",bgColor:"bg-blue-500",icon:c.jsx(G,{className:"text-white text-3xl"})},{key:"Collector",bgColor:"bg-yellow-500",icon:c.jsx(Z,{className:"text-white text-3xl"})},{key:"Recycler",bgColor:"bg-green-500",icon:c.jsx(O,{className:"text-white text-3xl"})}];return c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4",children:b.map(r=>{const u=h(r.key),d=m(r.key);return c.jsx("div",{onClick:()=>l(r.key),className:`shadow-md rounded p-6 w-full cursor-pointer transition
              ${u?"opacity-100":"opacity-50"}
              ${r.bgColor}
            `,children:c.jsxs("div",{className:"flex items-center space-x-2",children:[r.icon,c.jsx("h2",{className:"text-2xl font-bold text-white",children:r.key}),c.jsx("p",{className:"text-2xl font-bold text-white",children:d})]})},r.key)})})},ge={Producer:c.jsx(K,{className:"text-xl"}),Distributor:c.jsx(G,{className:"text-xl"}),Collector:c.jsx(Z,{className:"text-xl"}),Recycler:c.jsx(O,{className:"text-xl"})},ye={Producer:"text-orange-500",Distributor:"text-blue-500",Collector:"text-yellow-500",Recycler:"text-green-500"},xe=({data:x,selectedDistrict:n,setSelectedDistrict:o,enabledCategories:C,setEnabledCategories:l,columnFilters:h,districtOptions:m,onColumnFiltersChange:b})=>{console.log("districtOptions",m);const r=s.useMemo(()=>[{accessorKey:"district_name",header:"District",minSize:50,maxSize:50,size:50},{accessorKey:"tehsil_name",header:"Tehsil",minSize:50,maxSize:50,size:50},{accessorKey:"category",header:"Category",Cell:({cell:u})=>{const d=u.getValue(),j=ge[d],w=ye[d]||"text-gray-500";return j?c.jsxs("div",{className:`flex items-center ${w}`,children:[j,c.jsx("span",{className:"ml-1",children:d})]}):d},minSize:50,maxSize:50,size:50},{accessorKey:"business_name",header:"Business Name",minSize:50,maxSize:50,size:50},{accessorKey:"postal_address",header:"Postal Address",minSize:50,maxSize:100,size:100},{accessorKey:"material_flow_kg_per_day",header:"Material Flow (Kg/Day)",minSize:50,maxSize:100,size:100}],[m]);return c.jsx(de,{columns:r,data:x,initialState:{showColumnFilters:!1,pagination:{pageSize:5}}})};export{ke as default};
