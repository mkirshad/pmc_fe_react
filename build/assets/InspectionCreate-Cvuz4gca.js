import{r as j,A as Ie,j as l,Z as de,i as yt,a2 as rt,W as _t,a0 as St}from"./index-BoH5IUwZ.js";import{B as ke}from"./Button-DCIqqH8R.js";import{f as bt,t as Ct,N as wt}from"./toast-DFn9aN63.js";import{u as it,b as ce,a as k,C as O,F as Ft}from"./index.esm-CaJzLmo1.js";import{C as jt,S as Oe,a as ue,B as Dt}from"./index-anqTpEJt.js";import{I as $}from"./Input-BrLMjn_d.js";import{e as Et,p as Tt,g as Pt,s as Nt,h as It,R as Vt,a as Ve,b as _e,i as Ge,j as Ue,k as Ke,E as qe,l as z,m as je,d as Re,P as Ae,n as ye,o as oe,q as X,r as We,u as H,v as Se,w as Rt,x as At,y as Bt,z as Be,A as Mt,B as Lt,D as kt,H as Ot,I as Gt,f as De,S as $e,C as Ut,c as He,F as Kt,M as qt,V as Wt,T as $t,O as Ht,J as Zt,t as Yt,G as Jt}from"./terraformer-wkt-parser-BcK4IJY9.js";import{A as zt,C as Xt}from"./Autocomplete-B79yYt8l.js";import{T as Qt}from"./TextField-BzPJkQMa.js";import{t as en,z as V}from"./index-Cy_V4wPm.js";import{C as tn}from"./ConfirmDialog-DkLYJOuu.js";import{B as nn}from"./index-DFjwxSUi.js";import{u as rn}from"./useInspectionStore-Csg1xtEX.js";import"./classNames-D4bL7P5D.js";import"./StatusIcon-azAcUm8z.js";import"./CloseButton-oiVe2uCh.js";import"./index-C8NRoHn_.js";import"./DefaultPropsProvider-Cd9iqir9.js";import"./index-P_7vLITc.js";import"./index-DxIfr8Ey.js";import"./index-BMfhYqtY.js";import"./_getPrototype-BHb-SDCS.js";const Ze=0,me=1,Ye=[0,0,0,0],fe=[],Ee={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class Te extends kt{constructor(e,n,r){super(e),this.features=n,this.mapBrowserEvent=r}}class an extends Et{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:Tt,this.defaultDeleteCondition_=function(r){return Pt(r)&&Nt(r)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:It,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Vt,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ve({source:new _e({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:on(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let n;if(e.features?n=e.features:e.source&&(this.source_=e.source,n=new Ge(this.source_.getFeatures()),this.source_.addEventListener(Ue.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Ue.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!n)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=n,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Ke.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Ke.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const n=e.getGeometry();if(n){const i=this.SEGMENT_WRITERS_[n.getType()];i&&i(e,n)}const r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(r.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(qe.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,n){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Ge;const r=this.featuresBeingModified_.getArray();for(let i=0,a=n.length;i<a;++i){const s=n[i].feature;s&&!r.includes(s)&&this.featuresBeingModified_.push(s)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new Te(Ee.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(qe.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const n=this.rBush_,r=[];n.forEach(function(i){e===i.feature&&r.push(i)});for(let i=r.length-1;i>=0;--i){const a=r[i];for(let s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===a&&this.dragSegments_.splice(s,1);n.remove(a)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const n=e.target;this.removeFeature_(n),this.addFeature_(n)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,n){const r=n.getCoordinates(),i={feature:e,geometry:n,segment:[r,r]};this.rBush_.insert(n.getExtent(),i)}writeMultiPointGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i],o={feature:e,geometry:n,depth:[i],index:i,segment:[s,s]};this.rBush_.insert(n.getExtent(),o)}}writeLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length-1;i<a;++i){const s=r.slice(i,i+2),o={feature:e,geometry:n,index:i,segment:s};this.rBush_.insert(z(s),o)}}writeMultiLineStringGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,c=s.length-1;o<c;++o){const m=s.slice(o,o+2),d={feature:e,geometry:n,depth:[i],index:o,segment:m};this.rBush_.insert(z(m),d)}}}writePolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,c=s.length-1;o<c;++o){const m=s.slice(o,o+2),d={feature:e,geometry:n,depth:[i],index:o,segment:m};this.rBush_.insert(z(m),d)}}}writeMultiPolygonGeometry_(e,n){const r=n.getCoordinates();for(let i=0,a=r.length;i<a;++i){const s=r[i];for(let o=0,c=s.length;o<c;++o){const m=s[o];for(let d=0,v=m.length-1;d<v;++d){const f=m.slice(d,d+2),h={feature:e,geometry:n,depth:[o,i],index:d,segment:f};this.rBush_.insert(z(f),h)}}}}writeCircleGeometry_(e,n){const r=n.getCenter(),i={feature:e,geometry:n,index:Ze,segment:[r,r]},a={feature:e,geometry:n,index:me,segment:[r,r]},s=[i,a];i.featureSegments=s,a.featureSegments=s,this.rBush_.insert(je(r),i);let o=n;this.rBush_.insert(o.getExtent(),a)}writeGeometryCollectionGeometry_(e,n){const r=n.getGeometriesArray();for(let i=0;i<r.length;++i){const a=r[i],s=this.SEGMENT_WRITERS_[a.getType()];s(e,a)}}createOrUpdateVertexFeature_(e,n,r,i){let a=this.vertexFeature_;return a?a.getGeometry().setCoordinates(e):(a=new Re(new Ae(e)),this.vertexFeature_=a,this.overlay_.getSource().addFeature(a)),a.set("features",n),a.set("geometries",r),a.set("existing",i),a}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let n;return!e.map.getView().getInteracting()&&e.type==ye.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=ye.SINGLECLICK||!this.ignoreNextSingleClick_?n=this.removePoint():n=!0),e.type==ye.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!n}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const n=this.vertexFeature_;if(!n)return;this.getMap().getView().getProjection();const r=[],i=n.getGeometry().getCoordinates(),a=z([i]),s=this.rBush_.getInExtent(a),o={};s.sort(sn);for(let c=0,m=s.length;c<m;++c){const d=s[c],v=d.segment;let f=oe(d.geometry);const h=d.depth;if(h&&(f+="-"+h.join("-")),o[f]||(o[f]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===me){const g=ze(e,d);X(g,i)&&!o[f][0]&&(this.dragSegments_.push([d,0]),o[f][0]=d);continue}if(X(v[0],i)&&!o[f][0]){this.dragSegments_.push([d,0]),o[f][0]=d;continue}if(X(v[1],i)&&!o[f][1]){if(o[f][0]&&o[f][0].index===0){let g=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":g=g[h[1]];case"Polygon":if(d.index!==g[h[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),o[f][1]=d;continue}oe(v)in this.vertexSegments_&&!o[f][0]&&!o[f][1]&&r.push(d)}return r}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([a])=>a));const n=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],i=[];for(let a=0,s=this.dragSegments_.length;a<s;++a){const o=this.dragSegments_[a],c=o[0],m=c.feature;r.includes(m)||r.push(m);const d=c.geometry;i.includes(d)||i.push(d);const v=c.depth;let f;const h=c.segment,g=o[1];for(;n.length<d.getStride();)n.push(h[g][n.length]);switch(d.getType()){case"Point":f=n,h[0]=n,h[1]=n;break;case"MultiPoint":f=d.getCoordinates(),f[c.index]=n,h[0]=n,h[1]=n;break;case"LineString":f=d.getCoordinates(),f[c.index+g]=n,h[g]=n;break;case"MultiLineString":f=d.getCoordinates(),f[v[0]][c.index+g]=n,h[g]=n;break;case"Polygon":f=d.getCoordinates(),f[v[0]][c.index+g]=n,h[g]=n;break;case"MultiPolygon":f=d.getCoordinates(),f[v[1]][v[0]][c.index+g]=n,h[g]=n;break;case"Circle":const b=d;if(h[0]=n,h[1]=n,c.index===Ze)this.changingFeature_=!0,b.setCenter(n),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let _=We(H(b.getCenter()),H(n));b.setRadius(_),this.changingFeature_=!1}break}f&&this.setGeometryCoordinates_(d,f)}this.createOrUpdateVertexFeature_(n,r,i,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const n=e.coordinate,r=this.findInsertVerticesAndUpdateDragSegments_(n);if(r!=null&&r.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,r),this.vertexFeature_)){const i=this.vertexFeature_.getGeometry().getCoordinates();for(let a=r.length-1;a>=0;--a)this.insertVertex_(r[a],i);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let n=this.dragSegments_.length-1;n>=0;--n){const r=this.dragSegments_[n][0],i=r.geometry;if(i.getType()==="Circle"){const a=i,s=a.getCenter(),o=r.featureSegments[0],c=r.featureSegments[1];o.segment[0]=s,o.segment[1]=s,c.segment[0]=s,c.segment[1]=s,this.rBush_.update(je(s),o);let m=a;this.rBush_.update(m.getExtent(),c)}else this.rBush_.update(z(r.segment),r)}return this.featuresBeingModified_&&(this.dispatchEvent(new Te(Ee.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const n=this.getMap(),r=n.getPixelFromCoordinate(e);n.getView().getProjection();const i=function(o,c){return Je(e,o)-Je(e,c)};let a,s;if(this.hitDetection_){const o=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;n.forEachFeatureAtPixel(r,(c,m,d)=>{d&&d.getType()==="Point"&&(d=new Ae(Se(d.getCoordinates())));const v=d||c.getGeometry();if(v&&v.getType()==="Point"&&c instanceof Re&&this.features_.getArray().includes(c)){s=v;const f=c.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:c,geometry:s,segment:[f,f]}]}return!0},{layerFilter:o})}if(!a){const o=Rt(je(e,Ye)),c=n.getView().getResolution()*this.pixelTolerance_,m=At(Bt(o,c,Ye));a=this.rBush_.getInExtent(m)}if(a&&a.length>0){const o=a.sort(i)[0],c=o.segment;let m=ze(e,o);const d=n.getPixelFromCoordinate(m);let v=We(r,d);if(s||v<=this.pixelTolerance_){const f={};if(f[oe(c)]=!0,this.snapToPointer_||(this.delta_[0]=m[0]-e[0],this.delta_[1]=m[1]-e[1]),o.geometry.getType()==="Circle"&&o.index===me)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(m,[o.feature],[o.geometry],this.snappedToVertex_);else{const h=n.getPixelFromCoordinate(c[0]),g=n.getPixelFromCoordinate(c[1]),b=Be(d,h),_=Be(d,g);if(v=Math.sqrt(Math.min(b,_)),this.snappedToVertex_=v<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(m=b>_?c[1]:c[0]),this.createOrUpdateVertexFeature_(m,[o.feature],[o.geometry],this.snappedToVertex_);const p={};p[oe(o.geometry)]=!0;for(let P=1,N=a.length;P<N;++P){const A=a[P].segment;if(X(c[0],A[0])&&X(c[1],A[1])||X(c[0],A[1])&&X(c[1],A[0])){const R=oe(a[P].geometry);R in p||(p[R]=!0,f[oe(A)]=!0)}else break}}this.vertexSegments_=f;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,n){const r=e.segment,i=e.feature,a=e.geometry,s=e.depth,o=e.index;let c;for(;n.length<a.getStride();)n.push(0);switch(a.getType()){case"MultiLineString":c=a.getCoordinates(),c[s[0]].splice(o+1,0,n);break;case"Polygon":c=a.getCoordinates(),c[s[0]].splice(o+1,0,n);break;case"MultiPolygon":c=a.getCoordinates(),c[s[1]][s[0]].splice(o+1,0,n);break;case"LineString":c=a.getCoordinates(),c.splice(o+1,0,n);break;default:return!1}this.setGeometryCoordinates_(a,c);const m=this.rBush_;m.remove(e),this.updateSegmentIndices_(a,o,s,1);const d={segment:[r[0],n],feature:i,geometry:a,depth:s,index:o};m.insert(z(d.segment),d),this.dragSegments_.push([d,1]);const v={segment:[n,r[1]],feature:i,geometry:a,depth:s,index:o+1};return m.insert(z(v.segment),v),this.dragSegments_.push([v,0]),!0}updatePointer_(e){var n;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates()}getPoint(){var n;const e=(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates();return e?Se(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(z([e])).some(({segment:r})=>X(r[0],e)||X(r[1],e))}removePoint(e){if(e&&(e=H(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=ye.POINTERDRAG){const n=this.lastPointerEvent_;this.willModifyFeatures_(n,this.dragSegments_.map(([i])=>i));const r=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Te(Ee.MODIFYEND,this.featuresBeingModified_,n)),this.featuresBeingModified_=null,r}return!1}removeVertex_(){const e=this.dragSegments_,n={};let r=!1,i,a,s,o,c,m,d,v,f,h,g;for(c=e.length-1;c>=0;--c)s=e[c],h=s[0],g=oe(h.feature),h.depth&&(g+="-"+h.depth.join("-")),g in n||(n[g]={}),s[1]===0?(n[g].right=h,n[g].index=h.index):s[1]==1&&(n[g].left=h,n[g].index=h.index+1);for(g in n){switch(f=n[g].right,d=n[g].left,m=n[g].index,v=m-1,d!==void 0?h=d:h=f,v<0&&(v=0),o=h.geometry,a=o.getCoordinates(),i=a,r=!1,o.getType()){case"MultiLineString":a[h.depth[0]].length>2&&(a[h.depth[0]].splice(m,1),r=!0);break;case"LineString":a.length>2&&(a.splice(m,1),r=!0);break;case"MultiPolygon":i=i[h.depth[1]];case"Polygon":i=i[h.depth[0]],i.length>4&&(m==i.length-1&&(m=0),i.splice(m,1),r=!0,m===0&&(i.pop(),i.push(i[0]),v=i.length-1));break}if(r){this.setGeometryCoordinates_(o,a);const b=[];if(d!==void 0&&(this.rBush_.remove(d),b.push(d.segment[0])),f!==void 0&&(this.rBush_.remove(f),b.push(f.segment[1])),d!==void 0&&f!==void 0){const _={depth:h.depth,feature:h.feature,geometry:h.geometry,index:v,segment:b};this.rBush_.insert(z(_.segment),_)}this.updateSegmentIndices_(o,m,h.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return r}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(r=>r.getType()==="Circle"||r.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(z([e])).some(({segment:r})=>!(X(r[0],e)||X(r[1],e)))}insertPoint(e){var i;const n=e?H(e,this.getMap().getView().getProjection()):(i=this.vertexFeature_)==null?void 0:i.getGeometry().getCoordinates();return n?this.findInsertVerticesAndUpdateDragSegments_(n).reduce((a,s)=>a||this.insertVertex_(s,n),!1):!1}setGeometryCoordinates_(e,n){this.changingFeature_=!0,e.setCoordinates(n),this.changingFeature_=!1}updateSegmentIndices_(e,n,r,i){this.rBush_.forEachInExtent(e.getExtent(),function(a){a.geometry===e&&(r===void 0||a.depth===void 0||Mt(a.depth,r))&&a.index>n&&(a.index+=i)})}}function sn(t,e){return t.index-e.index}function Je(t,e,n){const r=e.geometry;if(r.getType()==="Circle"){let a=r;if(e.index===me){const s=Be(a.getCenter(),H(t)),o=Math.sqrt(s)-a.getRadius();return o*o}}const i=H(t);return fe[0]=H(e.segment[0]),fe[1]=H(e.segment[1]),Gt(i,fe)}function ze(t,e,n){const r=e.geometry;if(r.getType()==="Circle"&&e.index===me)return Se(r.getClosestPoint(H(t)));const i=H(t);return fe[0]=H(e.segment[0]),fe[1]=H(e.segment[1]),Se(Ot(i,fe))}function on(){const t=Lt();return function(e,n){return t.Point}}const ln=({onLocationSelect:t})=>{const e=j.useRef(null),[n,r]=j.useState(null),[i,a]=j.useState(null),[s,o]=j.useState("Fetching..."),[c,m]=j.useState(null),[d,v]=j.useState({lat:null,lng:null});j.useEffect(()=>{const b=new _e,_=new _e,p=new Re({geometry:new Ae(De([74.3436,31.5497]))});p.setStyle(new $e({image:new Ut({radius:7,fill:new Kt({color:"red"}),stroke:new He({color:"white",width:2})})})),_.addFeature(p),a(p);const P=new Ve({source:_}),N=new Ve({source:b,style:new $e({stroke:new He({color:"blue",width:2})})}),A=new qt({target:e.current,layers:[new $t({source:new Ht}),N,P],view:new Wt({center:De([74.3436,31.5497]),zoom:12})});r(A),m(N),g(N),f(A,p);const R=new an({source:_});return A.addInteraction(R),R.on("modifyend",G=>{const q=G.features.item(0).getGeometry().getCoordinates(),E=Zt(q);v({lat:E[1],lng:E[0]}),h(E[0],E[1])}),()=>A.setTarget(null)},[]);const f=(b,_)=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(p=>{const P=De([p.coords.longitude,p.coords.latitude]);_.getGeometry().setCoordinates(P),b.getView().setCenter(P),b.getView().setZoom(15),h(p.coords.longitude,p.coords.latitude)},p=>console.error("Geolocation error:",p),{enableHighAccuracy:!0})},h=async(b,_)=>{try{t({lat:_,lng:b,district:""});const p=await Ie.get(`/pmc/DistrictByLatLon?lat=${_}&lon=${b}`);p.data&&p.data.district_name?(o(p.data.district_name),t({lat:_,lng:b,district:p.data.district_name})):o("District not found")}catch(p){console.error("Error fetching district:",p),o("Error fetching district")}},g=async b=>{try{const N={type:"FeatureCollection",features:(await Ie.get("/pmc/districts-public")).data.filter(R=>R.geom).map(R=>({type:"Feature",geometry:Yt.parse(R.geom.replace("SRID=4326;","")),properties:{district_id:R.district_id,district_name:R.district_name}}))},A=new _e({features:new Jt().readFeatures(N,{featureProjection:"EPSG:3857"})});b.setSource(A)}catch(_){console.error("Error fetching district boundaries:",_)}};return l.jsxs("div",{children:[l.jsx("div",{ref:e,style:{height:"600px",width:"100%"}}),l.jsx("button",{type:"button",onClick:()=>f(n,i),style:{marginTop:"10px",padding:"10px",backgroundColor:"#007BFF",color:"#fff",border:"none",cursor:"pointer",borderRadius:"5px"},children:"üìç Go to Current Location"})]})};function at(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}var ve;(function(t){t.event="event",t.props="prop"})(ve||(ve={}));function se(){}function cn(t){var e,n=void 0;return function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e&&r.length===e.length&&r.every(function(a,s){return a===e[s]})||(e=r,n=t.apply(void 0,r)),n}}function pe(t){return!!(t||"").match(/\d/)}function ge(t){return t==null}function un(t){return typeof t=="number"&&isNaN(t)}function st(t){return ge(t)||un(t)||typeof t=="number"&&!isFinite(t)}function ot(t){return t.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function dn(t){switch(t){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;case"thousand":default:return/(\d)(?=(\d{3})+(?!\d))/g}}function fn(t,e,n){var r=dn(n),i=t.search(/[1-9]/);return i=i===-1?t.length:i,t.substring(0,i)+t.substring(i,t.length).replace(r,"$1"+e)}function gn(t){var e=j.useRef(t);e.current=t;var n=j.useRef(function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return e.current.apply(e,r)});return n.current}function Me(t,e){e===void 0&&(e=!0);var n=t[0]==="-",r=n&&e;t=t.replace("-","");var i=t.split("."),a=i[0],s=i[1]||"";return{beforeDecimal:a,afterDecimal:s,hasNegation:n,addNegation:r}}function hn(t){if(!t)return t;var e=t[0]==="-";e&&(t=t.substring(1,t.length));var n=t.split("."),r=n[0].replace(/^0+/,"")||"0",i=n[1]||"";return(e?"-":"")+r+(i?"."+i:"")}function lt(t,e,n){for(var r="",i=n?"0":"",a=0;a<=e-1;a++)r+=t[a]||i;return r}function Xe(t,e){return Array(e+1).join(t)}function ct(t){var e=t+"",n=e[0]==="-"?"-":"";n&&(e=e.substring(1));var r=e.split(/[eE]/g),i=r[0],a=r[1];if(a=Number(a),!a)return n+i;i=i.replace(".","");var s=1+a,o=i.length;return s<0?i="0."+Xe("0",Math.abs(s))+i:s>=o?i=i+Xe("0",s-o):i=(i.substring(0,s)||"0")+"."+i.substring(s),n+i}function Qe(t,e,n){if(["","-"].indexOf(t)!==-1)return t;var r=(t.indexOf(".")!==-1||n)&&e,i=Me(t),a=i.beforeDecimal,s=i.afterDecimal,o=i.hasNegation,c=parseFloat("0."+(s||"0")),m=s.length<=e?"0."+s:c.toFixed(e),d=m.split("."),v=a;a&&Number(d[0])&&(v=a.split("").reverse().reduce(function(b,_,p){return b.length>p?(Number(b[0])+Number(_)).toString()+b.substring(1,b.length):_+b},d[0]));var f=lt(d[1]||"",e,n),h=o?"-":"",g=r?".":"";return""+h+v+g+f}function le(t,e){if(t.value=t.value,t!==null){if(t.createTextRange){var n=t.createTextRange();return n.move("character",e),n.select(),!0}return t.selectionStart||t.selectionStart===0?(t.focus(),t.setSelectionRange(e,e),!0):(t.focus(),!1)}}var ut=cn(function(t,e){for(var n=0,r=0,i=t.length,a=e.length;t[n]===e[n]&&n<i;)n++;for(;t[i-1-r]===e[a-1-r]&&a-r>n&&i-r>n;)r++;return{from:{start:n,end:i-r},to:{start:n,end:a-r}}}),mn=function(t,e){var n=Math.min(t.selectionStart,e);return{from:{start:n,end:t.selectionEnd},to:{start:n,end:e}}};function vn(t,e,n){return Math.min(Math.max(t,e),n)}function Pe(t){return Math.max(t.selectionStart,t.selectionEnd)}function pn(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function xn(t){return{from:{start:0,end:0},to:{start:0,end:t.length},lastValue:""}}function yn(t){var e=t.currentValue,n=t.formattedValue,r=t.currentValueIndex,i=t.formattedValueIndex;return e[r]===n[i]}function _n(t,e,n,r,i,a,s){s===void 0&&(s=yn);var o=i.findIndex(function(A){return A}),c=t.slice(0,o);!e&&!n.startsWith(c)&&(e=c,n=c+n,r=r+c.length);for(var m=n.length,d=t.length,v={},f=new Array(m),h=0;h<m;h++){f[h]=-1;for(var g=0,b=d;g<b;g++){var _=s({currentValue:n,lastValue:e,formattedValue:t,currentValueIndex:h,formattedValueIndex:g});if(_&&v[g]!==!0){f[h]=g,v[g]=!0;break}}}for(var p=r;p<m&&(f[p]===-1||!a(n[p]));)p++;var P=p===m||f[p]===-1?d:f[p];for(p=r-1;p>0&&f[p]===-1;)p--;var N=p===-1||f[p]===-1?0:f[p]+1;return N>P?P:r-N<P-r?N:P}function et(t,e,n,r){var i=t.length;if(e=vn(e,0,i),r==="left"){for(;e>=0&&!n[e];)e--;e===-1&&(e=n.indexOf(!0))}else{for(;e<=i&&!n[e];)e++;e>i&&(e=n.lastIndexOf(!0))}return e===-1&&(e=i),e}function Sn(t){for(var e=Array.from({length:t.length+1}).map(function(){return!0}),n=0,r=e.length;n<r;n++)e[n]=!!(pe(t[n])||pe(t[n-1]));return e}function dt(t,e,n,r,i,a){a===void 0&&(a=se);var s=gn(function(g,b){var _,p;return st(g)?(p="",_=""):typeof g=="number"||b?(p=typeof g=="number"?ct(g):g,_=r(p)):(p=i(g,void 0),_=r(p)),{formattedValue:_,numAsString:p}}),o=j.useState(function(){return s(ge(t)?e:t,n)}),c=o[0],m=o[1],d=function(g,b){g.formattedValue!==c.formattedValue&&m({formattedValue:g.formattedValue,numAsString:g.value}),a(g,b)},v=t,f=n;ge(t)&&(v=c.numAsString,f=!0);var h=s(v,f);return j.useMemo(function(){m(h)},[h.formattedValue]),[c,d]}function bn(t){return t.replace(/[^0-9]/g,"")}function Cn(t){return t}function wn(t){var e=t.type;e===void 0&&(e="text");var n=t.displayType;n===void 0&&(n="input");var r=t.customInput,i=t.renderText,a=t.getInputRef,s=t.format;s===void 0&&(s=Cn);var o=t.removeFormatting;o===void 0&&(o=bn);var c=t.defaultValue,m=t.valueIsNumericString,d=t.onValueChange,v=t.isAllowed,f=t.onChange;f===void 0&&(f=se);var h=t.onKeyDown;h===void 0&&(h=se);var g=t.onMouseUp;g===void 0&&(g=se);var b=t.onFocus;b===void 0&&(b=se);var _=t.onBlur;_===void 0&&(_=se);var p=t.value,P=t.getCaretBoundary;P===void 0&&(P=Sn);var N=t.isValidInputCharacter;N===void 0&&(N=pe);var A=t.isCharacterSame,R=at(t,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),G=dt(p,c,!!m,s,o,d),q=G[0],E=q.formattedValue,U=q.numAsString,Z=G[1],W=j.useRef(),Y=j.useRef({formattedValue:E,numAsString:U}),J=function(x,S){Y.current={formattedValue:x.formattedValue,numAsString:x.value},Z(x,S)},ee=j.useState(!1),ne=ee[0],w=ee[1],C=j.useRef(null),u=j.useRef({setCaretTimeout:null,focusTimeout:null});j.useEffect(function(){return w(!0),function(){clearTimeout(u.current.setCaretTimeout),clearTimeout(u.current.focusTimeout)}},[]);var y=s,D=function(x,S){var F=parseFloat(S);return{formattedValue:x,value:S,floatValue:isNaN(F)?void 0:F}},T=function(x,S,F){x.selectionStart===0&&x.selectionEnd===x.value.length||(le(x,S),u.current.setCaretTimeout=setTimeout(function(){x.value===F&&x.selectionStart!==S&&le(x,S)},0))},B=function(x,S,F){return et(x,S,P(x),F)},Q=function(x,S,F){var M=P(S),K=_n(S,E,x,F,M,N,A);return K=et(S,K,M),K},re=function(x){var S=x.formattedValue;S===void 0&&(S="");var F=x.input,M=x.source,K=x.event,L=x.numAsString,I;if(F){var te=x.inputValue||F.value,ie=Pe(F);F.value=S,I=Q(te,S,ie),I!==void 0&&T(F,I,S)}S!==E&&J(D(S,L),{event:K,source:M})};j.useEffect(function(){var x=Y.current,S=x.formattedValue,F=x.numAsString;(E!==S||U!==F)&&J(D(E,U),{event:void 0,source:ve.props})},[E,U]);var he=C.current?Pe(C.current):void 0,xe=typeof window<"u"?j.useLayoutEffect:j.useEffect;xe(function(){var x=C.current;if(E!==Y.current.formattedValue&&x){var S=Q(Y.current.formattedValue,E,he);x.value=E,T(x,S,E)}},[E]);var Ce=function(x,S,F){var M=S.target,K=W.current?mn(W.current,M.selectionEnd):ut(E,x),L=Object.assign(Object.assign({},K),{lastValue:E}),I=o(x,L),te=y(I);if(I=o(te,void 0),v&&!v(D(te,I))){var ie=S.target,ae=Pe(ie),Fe=Q(x,E,ae);return ie.value=E,T(ie,Fe,E),!1}return re({formattedValue:te,numAsString:I,inputValue:x,event:S,source:F,input:S.target}),!0},we=function(x,S){S===void 0&&(S=0);var F=x.selectionStart,M=x.selectionEnd;W.current={selectionStart:F,selectionEnd:M+S}},ft=function(x){var S=x.target,F=S.value,M=Ce(F,x,ve.event);M&&f(x),W.current=void 0},gt=function(x){var S=x.target,F=x.key,M=S.selectionStart,K=S.selectionEnd,L=S.value;L===void 0&&(L="");var I;F==="ArrowLeft"||F==="Backspace"?I=Math.max(M-1,0):F==="ArrowRight"?I=Math.min(M+1,L.length):F==="Delete"&&(I=M);var te=0;F==="Delete"&&M===K&&(te=1);var ie=F==="ArrowLeft"||F==="ArrowRight";if(I===void 0||M!==K&&!ie){h(x),we(S,te);return}var ae=I;if(ie){var Fe=F==="ArrowLeft"?"left":"right";ae=B(L,I,Fe),ae!==I&&x.preventDefault()}else F==="Delete"&&!N(L[I])?ae=B(L,I,"right"):F==="Backspace"&&!N(L[I])&&(ae=B(L,I,"left"));ae!==I&&T(S,ae,L),h(x),we(S,te)},ht=function(x){var S=x.target,F=function(){var M=S.selectionStart,K=S.selectionEnd,L=S.value;if(L===void 0&&(L=""),M===K){var I=B(L,M);I!==M&&T(S,I,L)}};F(),requestAnimationFrame(function(){F()}),g(x),we(S)},mt=function(x){x.persist&&x.persist();var S=x.target,F=x.currentTarget;C.current=S,u.current.focusTimeout=setTimeout(function(){var M=S.selectionStart,K=S.selectionEnd,L=S.value;L===void 0&&(L="");var I=B(L,M);I!==M&&!(M===0&&K===L.length)&&T(S,I,L),b(Object.assign(Object.assign({},x),{currentTarget:F}))},0)},vt=function(x){C.current=null,clearTimeout(u.current.focusTimeout),clearTimeout(u.current.setCaretTimeout),_(x)},pt=ne&&pn()?"numeric":void 0,Le=Object.assign({inputMode:pt},R,{type:e,value:E,onChange:ft,onKeyDown:gt,onMouseUp:ht,onFocus:mt,onBlur:vt});if(n==="text")return i?de.createElement(de.Fragment,null,i(E,R)||null):de.createElement("span",Object.assign({},R,{ref:a}),E);if(r){var xt=r;return de.createElement(xt,Object.assign({},Le,{ref:a}))}return de.createElement("input",Object.assign({},Le,{ref:a}))}function tt(t,e){var n=e.decimalScale,r=e.fixedDecimalScale,i=e.prefix;i===void 0&&(i="");var a=e.suffix;a===void 0&&(a="");var s=e.allowNegative,o=e.thousandsGroupStyle;if(o===void 0&&(o="thousand"),t===""||t==="-")return t;var c=be(e),m=c.thousandSeparator,d=c.decimalSeparator,v=n!==0&&t.indexOf(".")!==-1||n&&r,f=Me(t,s),h=f.beforeDecimal,g=f.afterDecimal,b=f.addNegation;return n!==void 0&&(g=lt(g,n,!!r)),m&&(h=fn(h,m,o)),i&&(h=i+h),a&&(g=g+a),b&&(h="-"+h),t=h+(v&&d||"")+g,t}function be(t){var e=t.decimalSeparator;e===void 0&&(e=".");var n=t.thousandSeparator,r=t.allowedDecimalSeparators;return n===!0&&(n=","),r||(r=[e,"."]),{decimalSeparator:e,thousandSeparator:n,allowedDecimalSeparators:r}}function Fn(t,e){t===void 0&&(t="");var n=new RegExp("(-)"),r=new RegExp("(-)(.)*(-)"),i=n.test(t),a=r.test(t);return t=t.replace(/-/g,""),i&&!a&&e&&(t="-"+t),t}function jn(t,e){return new RegExp("(^-)|[0-9]|"+ot(t),"g")}function Dn(t,e,n){return t===""?!0:!(e!=null&&e.match(/\d/))&&!(n!=null&&n.match(/\d/))&&typeof t=="string"&&!isNaN(Number(t))}function En(t,e,n){var r;e===void 0&&(e=xn(t));var i=n.allowNegative,a=n.prefix;a===void 0&&(a="");var s=n.suffix;s===void 0&&(s="");var o=n.decimalScale,c=e.from,m=e.to,d=m.start,v=m.end,f=be(n),h=f.allowedDecimalSeparators,g=f.decimalSeparator,b=t[v]===g;if(pe(t)&&(t===a||t===s)&&e.lastValue==="")return t;if(v-d===1&&h.indexOf(t[d])!==-1){var _=o===0?"":g;t=t.substring(0,d)+_+t.substring(d+1,t.length)}var p=function(C,u,y){var D=!1,T=!1;a.startsWith("-")?D=!1:C.startsWith("--")?(D=!1,T=!0):s.startsWith("-")&&C.length===s.length?D=!1:C[0]==="-"&&(D=!0);var B=D?1:0;return T&&(B=2),B&&(C=C.substring(B),u-=B,y-=B),{value:C,start:u,end:y,hasNegation:D}},P=p(t,d,v),N=P.hasNegation;r=P,t=r.value,d=r.start,v=r.end;var A=p(e.lastValue,c.start,c.end),R=A.start,G=A.end,q=A.value,E=t.substring(d,v);t.length&&q.length&&(R>q.length-s.length||G<a.length)&&!(E&&s.startsWith(E))&&(t=q);var U=0;t.startsWith(a)?U+=a.length:d<a.length&&(U=d),t=t.substring(U),v-=U;var Z=t.length,W=t.length-s.length;t.endsWith(s)?Z=W:(v>W||v>t.length-s.length)&&(Z=v),t=t.substring(0,Z),t=Fn(N?"-"+t:t,i),t=(t.match(jn(g))||[]).join("");var Y=t.indexOf(g);t=t.replace(new RegExp(ot(g),"g"),function(C,u){return u===Y?".":""});var J=Me(t,i),ee=J.beforeDecimal,ne=J.afterDecimal,w=J.addNegation;return m.end-m.start<c.end-c.start&&ee===""&&b&&!parseFloat(ne)&&(t=w?"-":""),t}function Tn(t,e){var n=e.prefix;n===void 0&&(n="");var r=e.suffix;r===void 0&&(r="");var i=Array.from({length:t.length+1}).map(function(){return!0}),a=t[0]==="-";i.fill(!1,0,n.length+(a?1:0));var s=t.length;return i.fill(!1,s-r.length+1,s+1),i}function Pn(t){var e=be(t),n=e.thousandSeparator,r=e.decimalSeparator,i=t.prefix;i===void 0&&(i="");var a=t.allowNegative;if(a===void 0&&(a=!0),n===r)throw new Error(`
        Decimal separator can't be same as thousand separator.
        thousandSeparator: `+n+` (thousandSeparator = {true} is same as thousandSeparator = ",")
        decimalSeparator: `+r+` (default value for decimalSeparator is .)
     `);return i.startsWith("-")&&a&&(console.error(`
      Prefix can't start with '-' when allowNegative is true.
      prefix: `+i+`
      allowNegative: `+a+`
    `),a=!1),Object.assign(Object.assign({},t),{allowNegative:a})}function Nn(t){t=Pn(t),t.decimalSeparator,t.allowedDecimalSeparators,t.thousandsGroupStyle;var e=t.suffix,n=t.allowNegative,r=t.allowLeadingZeros,i=t.onKeyDown;i===void 0&&(i=se);var a=t.onBlur;a===void 0&&(a=se);var s=t.thousandSeparator,o=t.decimalScale,c=t.fixedDecimalScale,m=t.prefix;m===void 0&&(m="");var d=t.defaultValue,v=t.value,f=t.valueIsNumericString,h=t.onValueChange,g=at(t,["decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","suffix","allowNegative","allowLeadingZeros","onKeyDown","onBlur","thousandSeparator","decimalScale","fixedDecimalScale","prefix","defaultValue","value","valueIsNumericString","onValueChange"]),b=be(t),_=b.decimalSeparator,p=b.allowedDecimalSeparators,P=function(w){return tt(w,t)},N=function(w,C){return En(w,C,t)},A=ge(v)?d:v,R=f??Dn(A,m,e);ge(v)?ge(d)||(R=R||typeof d=="number"):R=R||typeof v=="number";var G=function(w){return st(w)?w:(typeof w=="number"&&(w=ct(w)),R&&typeof o=="number"?Qe(w,o,!!c):w)},q=dt(G(v),G(d),!!R,P,N,h),E=q[0],U=E.numAsString,Z=E.formattedValue,W=q[1],Y=function(w){var C=w.target,u=w.key,y=C.selectionStart,D=C.selectionEnd,T=C.value;if(T===void 0&&(T=""),(u==="Backspace"||u==="Delete")&&D<m.length){w.preventDefault();return}if(y!==D){i(w);return}u==="Backspace"&&T[0]==="-"&&y===m.length+1&&n&&le(C,1),o&&c&&(u==="Backspace"&&T[y-1]===_?(le(C,y-1),w.preventDefault()):u==="Delete"&&T[y]===_&&w.preventDefault()),p!=null&&p.includes(u)&&T[y]===_&&le(C,y+1);var B=s===!0?",":s;u==="Backspace"&&T[y-1]===B&&le(C,y-1),u==="Delete"&&T[y]===B&&le(C,y+1),i(w)},J=function(w){var C=U;if(C.match(/\d/g)||(C=""),r||(C=hn(C)),c&&o&&(C=Qe(C,o,c)),C!==U){var u=tt(C,t);W({formattedValue:u,value:C,floatValue:parseFloat(C)},{event:w,source:ve.event})}a(w)},ee=function(w){return w===_?!0:pe(w)},ne=function(w){var C=w.currentValue,u=w.lastValue,y=w.formattedValue,D=w.currentValueIndex,T=w.formattedValueIndex,B=C[D],Q=y[T],re=ut(u,C),he=re.to,xe=function(Ce){return N(Ce).indexOf(".")+m.length};return v===0&&c&&o&&C[he.start]===_&&xe(C)<D&&xe(y)>T?!1:D>=he.start&&D<he.end&&p&&p.includes(B)&&Q===_?!0:B===Q};return Object.assign(Object.assign({},g),{value:Z,valueIsNumericString:!1,isValidInputCharacter:ee,isCharacterSame:ne,onValueChange:W,format:P,removeFormatting:N,getCaretBoundary:function(w){return Tn(w,t)},onKeyDown:Y,onBlur:J})}function In(t){var e=Nn(t);return de.createElement(wn,Object.assign({},e))}const Vn=({inputSuffix:t,inputPrefix:e,...n})=>l.jsx($,{...n,value:n.value,suffix:t,prefix:e}),Rn=({onValueChange:t,...e})=>l.jsx(In,{customInput:Vn,onValueChange:t,...e}),Ne=({inputSuffix:t,inputPrefix:e,onValueChange:n,...r})=>l.jsx(Rn,{inputPrefix:e,inputSuffix:t,onValueChange:n,...r}),nt=[{label:"Producer",value:"Producer"},{label:"Distributor",value:"Distributor"},{label:"Recycler",value:"Recycler"},{label:"Collector",value:"Collector"},{label:"Retailer",value:"Retailer"}],An=[{label:"Plastic shopping/carry bags (having thickness less than 75 micron)",value:"Plastic shopping/carry bags (having thickness less than 75 micron)"},{label:"Other Single Use Plastics",value:"Other Single Use Plastics"}],Bn=[{label:"Notice issued",value:"Notice issued"},{label:"Confiscation",value:"Confiscation"},{label:"Sealing",value:"Sealing"},{label:"FIR",value:"FIR"},{label:"Complaint before Environmental Magistrate",value:"Complaint before Environmental Magistrate"},{label:"Fine Imposed",value:"Fine Imposed"},{label:"De Sealed",value:"De Sealed"}],Mn=({control:t,errors:e,readOnly:n=!1,defaultValues:r})=>{var W,Y,J,ee,ne,w,C;const[i,a]=j.useState([]),[s,o]=j.useState([]),{setValue:c,getValues:m,trigger:d}=it(),[v,f]=j.useState(""),h=ce({control:t,name:"violationFound",defaultValue:[]}),g=ce({control:t,name:"violationType",defaultValue:[]}),b=ce({control:t,name:"actionTaken",defaultValue:[]}),_=ce({control:t,name:"fineRecoveryStatus",defaultValue:[]}),p=(u,y)=>{o(y);const D=y.filter(T=>!i.includes(T));D.length>0&&a(T=>[...T,...D])},P=ce({control:t,name:"plasticBagsConfiscation",defaultValue:0}),N=ce({control:t,name:"confiscation_otherPlastics",defaultValue:{}}),[A,R]=j.useState(0);j.useEffect(()=>{if(b.includes("Confiscation")){let u=0;g.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&(u+=parseFloat(P)||0),s.forEach(y=>{N[y]&&(u+=parseFloat(N[y])||0)}),R(u),c("totalConfiscation",u)}},[P,N,b,c,s,g]),j.useEffect(()=>{Ie.get("/pmc/inspection-report/all_other_single_use_plastics/").then(u=>{a(u.data.single_use_plastic_items||[])}).catch(u=>{console.error("Error fetching available options:",u)})},[]),j.useEffect(()=>{r!=null&&r.OtherSingleUseItems&&o(r.OtherSingleUseItems)},[r==null?void 0:r.OtherSingleUseItems]);const[G,q]=j.useState({lat:null,lng:null,district:""}),E=u=>{q(u)},U=u=>{u.key==="Backspace"&&f(Z(v,!0))},Z=(u,y)=>{let D=u.replace(/[^a-zA-Z0-9]/g,""),T=D.slice(0,3).toUpperCase().replace(/[^A-Z]/g,""),B=D.slice(3,6).toUpperCase().replace(/[^A-Z]/g,""),Q=D.slice(6).replace(/[^0-9]/g,"");if(y)return[T,B,Q].filter(Boolean).join("-");let re="";return T&&(re+=T+(T.length===3?"-":"")),B&&(re+=B+(B.length===3?"-":"")),Q&&(re+=Q),re};return l.jsxs(jt,{children:[l.jsx("h4",{className:"mb-6",children:"Inspection Report"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(k,{label:"Inspection Date*",invalid:!!e.inspectionDate,errorMessage:(W=e.inspectionDate)==null?void 0:W.message,children:l.jsx(O,{name:"inspectionDate",control:t,render:({field:u})=>l.jsx($,{type:"date",...u})})}),l.jsx(k,{label:"Name of Business*",invalid:!!e.businessName,errorMessage:(Y=e.businessName)==null?void 0:Y.message,children:l.jsx(O,{name:"businessName",control:t,render:({field:u})=>l.jsx($,{type:"text",placeholder:"Business Name",readOnly:n,...u})})}),l.jsx(k,{label:"Type of Business*",invalid:!!e.businessType,errorMessage:(J=e.businessType)==null?void 0:J.message,children:l.jsx(O,{name:"businessType",control:t,render:({field:u})=>l.jsx(Oe,{options:nt,isDisabled:n,value:nt.find(y=>y.value===u.value),onChange:y=>u.onChange(y==null?void 0:y.value)})})}),l.jsx(k,{label:"Plastic Application / License Number",invalid:!!e.businessType,errorMessage:(ee=e.businessType)==null?void 0:ee.message,children:l.jsx(O,{name:"licenseNumber",control:t,render:({field:u})=>l.jsx($,{value:v,onChange:y=>f(Z(y.target.value,!1)),onKeyDown:U,placeholder:"e.g., LHR-PRO-001",title:"Tracking Number (e.g., LHR-PRO-001)"})})})]}),l.jsx(k,{label:"Violation Found",children:l.jsx(O,{name:"violationFound",control:t,render:({field:u})=>l.jsx(ue.Group,{value:u.value||[],onChange:y=>u.onChange(y),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(ue,{...u,value:"Yes",children:"Yes"})})},"a1")}),h.includes("Yes")&&l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsxs(k,{label:"Type of Violation Found*",children:[An.map(u=>l.jsx(O,{name:"violationType",control:t,render:({field:y})=>l.jsx(ue.Group,{value:y.value||[],onChange:D=>y.onChange(D),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(ue,{...y,value:u.value,children:u.label})})},u.value)),g.includes("Other Single Use Plastics")&&l.jsx(k,{label:"Add List + (If desired item is not in the list, then type and press enter to add)",invalid:!!e.PackagingItems,errorMessage:(ne=e.PackagingItems)==null?void 0:ne.message,className:"ml-2 mt-4",children:l.jsx(O,{name:"OtherSingleUseItems",control:t,render:({field:u})=>l.jsx(zt,{multiple:!0,freeSolo:!0,options:i,value:s,readOnly:n,onChange:(y,D)=>{u.onChange(D),p(y,D)},renderTags:(y,D)=>y.map((T,B)=>l.jsx(Xt,{variant:"outlined",label:T,...D({index:B})})),renderInput:y=>l.jsx(Qt,{...y,variant:"outlined",label:"Other Single Use Plastics",placeholder:"Add or select Single Use Plastics"})})})})]}),l.jsx(k,{label:"Action Taken*",children:Bn.map(u=>l.jsx(O,{name:"actionTaken",control:t,render:({field:y})=>l.jsx(ue.Group,{value:y.value||[],onChange:D=>y.onChange(D),className:"flex flex-col gap-2 mb-2 ml-2",children:l.jsx(ue,{...y,value:u.value,children:u.label})})},u.value))}),b.includes("Confiscation")&&g.includes("Plastic shopping/carry bags (having thickness less than 75 micron)")&&l.jsx(k,{label:"Plastic shopping/carry bags (having thickness less than 75 micron) (KG)",invalid:!!e.plasticBagsConfiscation,errorMessage:(w=e.plasticBagsConfiscation)==null?void 0:w.message,children:l.jsx(O,{name:"plasticBagsConfiscation",control:t,render:({field:u})=>l.jsx(Ne,{placeholder:"Enter KG",...u})})}),b.includes("Confiscation")&&g.includes("Other Single Use Plastics")&&s.map((u,y)=>l.jsx(k,{label:`${u} Confiscation (KG)`,children:l.jsx(O,{name:`confiscation_otherPlastics.${u}`,control:t,render:({field:D})=>l.jsx($,{type:"number",placeholder:"Enter KG",...D})})},y)),b.includes("Confiscation")&&l.jsx(k,{label:"Total Confiscation (KG)",children:l.jsx(O,{name:"totalConfiscation",control:t,render:({field:u})=>(j.useEffect(()=>{u.onChange(A)},[A]),l.jsx($,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...u}))})}),b.includes("Fine Imposed")&&l.jsx(k,{label:"Fine Amount (PKR)",children:l.jsx(O,{name:"fineAmount",control:t,render:({field:u})=>l.jsx(Ne,{placeholder:"Enter Fine Amount",...u})})}),l.jsx(k,{label:"Fine Recovery Status",children:l.jsx(O,{name:"fineRecoveryStatus",control:t,render:({field:u})=>l.jsx(Oe,{options:[{label:"Pending",value:"Pending"},{label:"Partial",value:"Partial"},{label:"Recovered",value:"Recovered"}],isDisabled:n,value:{label:u.value,value:u.value},onChange:y=>u.onChange(y==null?void 0:y.value)})})}),_!=="Pending"&&l.jsxs(l.Fragment,{children:[l.jsx(k,{label:"Fine Recovery Date",children:l.jsx(O,{name:"fineRecoveryDate",control:t,render:({field:u})=>l.jsx($,{type:"date",...u})})}),l.jsx(k,{label:"Recovery Amount (PKR)",children:l.jsx(O,{name:"recoveryAmount",control:t,render:({field:u})=>l.jsx(Ne,{placeholder:"Enter Recovery Amount",...u})})})]}),b.includes("De Sealed")&&l.jsxs(l.Fragment,{children:[l.jsx(k,{label:"De Sealed Date",children:l.jsx(O,{name:"deSealedDate",control:t,render:({field:u})=>l.jsx($,{type:"date",...u})})}),l.jsx(k,{label:"De Seal - Affidavit",invalid:!!e.flow_diagram,errorMessage:(C=e.flow_diagram)==null?void 0:C.message,children:l.jsx(O,{name:"affidavit",control:t,render:({field:u})=>l.jsx($,{type:"file",accept:".pdf,.png,.jpg,.jpeg",disabled:n,onChange:y=>u.onChange(y.target.files[0]||null)})})})]})]}),l.jsxs("div",{style:{padding:"20px"},children:[l.jsx("h1",{children:"Select Location"}),l.jsx(ln,{onLocationSelect:E}),G.lat&&G.lng&&l.jsxs("div",{style:{marginTop:"20px",padding:"10px",border:"1px solid #ccc"},children:[l.jsx("h3",{children:"Selected Location Details:"}),l.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[l.jsx(k,{label:"Latitude",children:l.jsx(O,{name:"latitude",control:t,render:({field:u})=>(j.useEffect(()=>{u.onChange(G.lat)},[G.lat]),l.jsx($,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...u}))})}),l.jsx(k,{label:"Longitude",children:l.jsx(O,{name:"longitude",control:t,render:({field:u})=>(j.useEffect(()=>{u.onChange(G.lng)},[G.lng]),l.jsx($,{type:"number",placeholder:"Auto-calculated",readOnly:!0,...u}))})}),l.jsx(k,{label:"District",children:l.jsx(O,{name:"district",control:t,render:({field:u})=>(j.useEffect(()=>{u.onChange(G.district)},[G.district]),l.jsx($,{type:"text",placeholder:"Auto-calculated",readOnly:!0,...u}))})})]})]})]})]})},Ln=V.object({businessName:V.string().min(1,{message:"Business name required"}),businessType:V.string().min(1,{message:"Business type required"}),licenseNumber:V.string().optional(),violationFound:V.array(V.string()).optional(),violationType:V.array(V.string()).optional(),actionTaken:V.array(V.string()).optional(),plasticBagsConfiscation:V.coerce.number().optional(),confiscation_otherPlastics:V.record(V.string(),V.coerce.number()).optional(),totalConfiscation:V.coerce.number().optional(),OtherSingleUseItems:V.array(V.string()).optional(),latitude:V.coerce.number().nullable(),longitude:V.coerce.number().nullable(),district:V.string().optional(),inspectionDate:V.string().min(1,{message:"Inspection date is required"}),fineAmount:V.coerce.number().optional(),fineRecoveryStatus:V.enum(["Pending","Partial","Recovered"]).optional(),fineRecoveryDate:V.string().optional(),recoveryAmount:V.coerce.number().optional(),deSealedDate:V.string().optional(),affidavit:V.instanceof(File,{message:"Must be a valid file"}).optional()}),kn=({onFormSubmit:t,defaultValues:e={},readOnly:n,children:r})=>{const{handleSubmit:i,reset:a,formState:{errors:s},control:o}=it({defaultValues:e,resolver:en(Ln)});return j.useEffect(()=>{yt(e)||a(e)},[JSON.stringify(e)]),l.jsxs(Ft,{className:"flex w-full h-full",containerClassName:"flex flex-col w-full justify-between",onSubmit:i(t),children:[l.jsx(rt,{children:l.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:l.jsx("div",{className:"gap-4 flex flex-col flex-auto",children:l.jsx(Mn,{control:o,errors:s,defaultValues:e})})})}),l.jsx(Dt,{children:r})]})},On=t=>t?{id:t.id,businessName:t.business_name,businessType:t.business_type,licenseNumber:t.license_number||"",violationFound:t.violation_found||[],violationType:t.violation_type||[],actionTaken:t.action_taken||[],totalConfiscation:t.total_confiscation||0,district:t.district||"",createdAt:t.created_at||"",syncStatus:t.syncStatus||void 0}:null,cr=()=>{const t=_t(),e=St(),{reports:n,fetchReports:r,updateReport:i,addNewReport:a}=rn(),[s,o]=j.useState(!1),[c,m]=j.useState(!1),v=new URLSearchParams(e.search).get("id");console.log(n);const f=j.useMemo(()=>{const _=n.find(p=>p.id==v);return _?On(_):null},[n,v]);j.useEffect(()=>{v&&!f&&r()},[f,r]);const h=async _=>{console.log("Submitting Data:",_),m(!0);const p={business_name:_.businessName,business_type:_.businessType,license_number:_.licenseNumber||"",violation_found:_.violationFound||[],violation_type:_.violationType||[],action_taken:_.actionTaken||[],total_confiscation:_.totalConfiscation||0,district:_.district||"",syncStatus:v?"patch":"post"};try{v?i(v,p):a(p),console.log("‚úÖ Report Updated in Store"),m(!1),t("/auth/EPAOperations/AllInspections")}catch(P){console.error("‚ùå Error in Submission:",P),m(!1)}},g=()=>o(!0),b=()=>{o(!1),Ct.push(l.jsx(wt,{type:"success",children:"Customer discard!"}),{placement:"top-center"}),t("/auth/EPAOperations/AllInspections")};return l.jsx(l.Fragment,{children:l.jsxs(l.Fragment,{children:[l.jsx(kn,{newCustomer:!0,defaultValues:f,onFormSubmit:h,readOnly:!1,children:l.jsx(rt,{children:l.jsxs("div",{className:"flex items-center justify-between px-8",children:[l.jsx("span",{}),l.jsxs("div",{className:"flex items-center",children:[l.jsx(ke,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:l.jsx(bt,{}),onClick:g,children:"Discard"}),l.jsx(ke,{icon:l.jsx(nn,{}),variant:"solid",type:"submit",loading:c,children:"Save"})]})]})})}),l.jsx(tn,{isOpen:s,type:"danger",title:"Discard changes",onClose:()=>o(!1),onCancel:()=>o(!1),onConfirm:b,children:l.jsx("p",{children:"Are you sure you want to discard this?"})})]})})};export{cr as default};
