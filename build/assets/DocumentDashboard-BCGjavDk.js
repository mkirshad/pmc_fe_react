import{r as o,l as n,j as e,A as v}from"./index-BUmH887k.js";import{T as y}from"./index-B4b-6TfH.js";import{b as _}from"./isNil-D7fvhFzJ.js";import{u as F,F as N,a as f,C as g}from"./index.esm-B6_Tk-U-.js";import{t as z,z as i}from"./index-B-LDSaRN.js";import{M as E}from"./index.esm-zzro7Vhh.js";import{B as K}from"./Button-DWiR-adH.js";import{C as U}from"./Card-3osJnAmx.js";import{I as w}from"./Input-BE0qsVD4.js";import{S as A}from"./Select-dv0ohcNi.js";import"./useControllableState-Bbte2Q9o.js";import"./classNames-B4rasR4p.js";import"./index-akHDwKQs.js";import"./TextField-BHlAeOZa.js";import"./DefaultPropsProvider-CxugKlR0.js";import"./Autocomplete-II9qOCLw.js";import"./FormControlLabel-CvOE0z_u.js";import"./Divider-Beq1bW_6.js";import"./index-DUfXPSSW.js";import"./floating-ui.dom-CrKScG7J.js";const B=i.object({title:i.string().min(3,"Title must be at least 3 characters"),documentType:i.enum(["notification","minutes"],{required_error:"Select a document type"}),file:i.instanceof(File,{message:"Must be a valid file"}).optional()}),I=()=>{var x,b,j;const[l,c]=o.useState([]),[d,a]=o.useState(!1),m=n(t=>t.user.district_id)||null;n(t=>t.user.district_name);const{handleSubmit:T,control:u,setValue:V,reset:D,formState:{errors:r,isSubmitting:p}}=F({resolver:z(B),defaultValues:{title:"",documentType:"notification",file:null}}),h=()=>{a(!0),v.get("/pmc/district-documents/").then(t=>c(t.data)).catch(t=>console.error("Error fetching documents:",t)).finally(()=>a(!1))};o.useEffect(()=>{h()},[]);const S=async t=>{const s=new FormData;s.append("district_id",(m==null?void 0:m.toString())||"0"),s.append("document_type",t.documentType),s.append("title",t.title),s.append("document",t.file);try{await v.post("/pmc/district-documents/",s,{headers:{"Content-Type":"multipart/form-data"}}),alert("Document uploaded successfully!"),h(),D()}catch(M){console.error("Error uploading document:",M),alert("Failed to upload document.")}},C=[{accessorKey:"district_name",header:"District",size:200},{accessorKey:"document_type",header:"Type",size:150},{accessorKey:"title",header:"Title",size:300},{accessorKey:"uploaded_at",header:"Uploaded On",size:200},{accessorKey:"file",header:"Download",size:100,Cell:({row:t})=>e.jsx("a",{href:t.original.file,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600",children:"Download"})}];return e.jsxs(U,{children:[e.jsx(N,{onSubmit:T(S),children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 gap-4",children:[e.jsx(f,{label:"Document Title",invalid:!!r.title,errorMessage:(x=r.title)==null?void 0:x.message,children:e.jsx(g,{name:"title",control:u,render:({field:t})=>e.jsx(w,{...t,placeholder:"Enter document title"})})}),e.jsx(f,{label:"Document Type",invalid:!!r.documentType,errorMessage:(b=r.documentType)==null?void 0:b.message,children:e.jsx(g,{name:"documentType",control:u,render:({field:t})=>e.jsx(A,{options:[{label:"Notification",value:"Notification"},{label:"Minutes of Meeting",value:"Minutes of Meeting"}],value:{label:t.value,value:t.value},onChange:s=>t.onChange(s==null?void 0:s.value)})})}),e.jsx(f,{label:"Upload File",invalid:!!r.file,errorMessage:(j=r.file)==null?void 0:j.message,children:e.jsx(g,{name:"file",control:u,render:({field:t})=>e.jsx("input",{type:"file",accept:".pdf,.png,.jpg,.jpeg",onChange:s=>t.onChange(s.target.files[0])})})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 gap-4",children:e.jsx(K,{type:"submit",variant:"solid",disabled:p,loading:p,children:p?"Uploading...":"Upload"})})]})}),d?e.jsx("p",{children:"Loading documents..."}):e.jsx(E,{columns:C,data:l,enablePagination:!0})]})},{TabNav:L,TabList:O,TabContent:R}=y,le=()=>{const[l,c]=o.useState("tab1");n(a=>a.user.district_id);const d=n(a=>a.user.district_name)||"";return e.jsx("div",{children:e.jsxs(y,{value:l,onChange:c,children:[e.jsx(O,{children:e.jsxs(L,{value:"tab1",icon:e.jsx(_,{}),children:["Manage Documents for District: ",d]})}),e.jsx("div",{className:"p-4",children:e.jsx(R,{value:"tab1",children:e.jsx(I,{})})})]})})};export{le as default};
