import{r as p,U as E,j as i,A as S}from"./index-Bub9wnZN.js";import{M as v}from"./index.esm-BYMO2SuU.js";import"./TextField-DFfDd3ye.js";import"./Divider-BEZ4xzZM.js";import"./FormControlLabel-BOdA7Lx-.js";import"./Autocomplete-fgH9pY-W.js";import"./index-Azlc7LJE.js";const y=e=>{var o,m,D;const n=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(l=>l.assigned_group==="APPLICANT"&&l.remarks&&l.remarks!=="undefined").map(l=>l.remarks),d=n.length>0?n.join("; "):"N/A";return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,CNIC:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,application_Start_Time:((o=e.created_at)==null?void 0:o.substring(0,16))||"N/A",application_Submission_Time:((D=(m=e.submittedapplication)==null?void 0:m.created_at)==null?void 0:D.substring(0,16))||"N/A",remarks:d}},M=e=>e.map(_=>{const n=y(_);return Object.keys(n).forEach(d=>{(n[d]===void 0||n[d]===null)&&(n[d]="N/A")}),n}),B=()=>{const[e,_]=p.useState([]),[n,d]=p.useState([]),[o,m]=p.useState([]),[D,l]=p.useState(0),[h,A]=p.useState(null),[O,R]=p.useState({});console.log(h);const C=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],w={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},b=(t,f,a)=>{const T=["first_name","last_name","CNIC","mobile_no","tracking_number","assigned_group","registration_for","application_Submission_Time","remarks"],u=M(t),L=u[0];console.log(t);const r=[...Object.keys(L).filter(s=>T.includes(s)).map(s=>{let c=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(s)?c=120:["first_name"].includes(s)&&(c=180),{accessorKey:s,header:s.replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase()),size:c,Cell:({cell:x,row:N})=>{const I=`/spuid-review/${N.original.id}?group=${a}`;return i.jsx("a",{href:I,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:x.getValue()||"-"})}}})];return{flattenedData:u,columns:r}},g=E();return p.useEffect(()=>{(async()=>{try{const a=await S.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{g("/error")}try{let a=[];try{a=(await S.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],m(a.map(s=>s.name))}catch(r){console.error("Error fetching user groups:",r),m([])}console.log("groupsResponse",a);const u=(await S.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(u)&&u.length>0){const r=b(u,a.length>0,a.map(c=>c.name)[0]);_(r.flattenedData),d(r.columns),console.log("Flattened Data:",r.flattenedData);const s=r.flattenedData[r.flattenedData.length-1];if(console.log("Last Row:",s),s&&s.id){A(s.id),console.log("Last Row ID:",s.id);const c=C.indexOf(s.assigned_group);c!==-1&&l(c)}}const L=await S.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});R(L.data)}catch(a){console.error("Error fetching data:",a)}})(),A(25);const f=C.indexOf("LSO");f!==-1&&l(f)},[]),p.useEffect(()=>{console.log("userGroups:",o),o.includes("Super")?g("/home-super"):o.includes("Admin")?g("/home-admin"):o.includes("DO")&&g("/home-do")},[o,g]),console.log("selectedRowId:",h),console.log(h),i.jsxs("div",{children:[i.jsx("div",{className:"tiles-container",children:Object.entries(O).map(([t,f])=>i.jsxs("div",{className:"tile",children:[i.jsx("h3",{children:w[t]||t})," ",i.jsx("p",{children:f})]},t))}),i.jsx("div",{className:"mb-4",children:i.jsxs("h3",{children:[o.filter(t=>t!=="Download License"&&t!=="Applicant"&&t!=="LSM2").join(" - ")," Dashboard"]})}),i.jsx(v,{columns:[...n],data:e.map(t=>({...t,assigned_group_title:w[t.assigned_group]||t.assigned_group})),getRowId:t=>t.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:1,size:100},enableColumnResizing:!0,enableTopToolbar:o.length>0,enablePagination:!0},h)]})};export{B as default};
