import{r as p,l as B,M as q,j as e,f as L,A as U,u as R,d as W}from"./index-Cy33ZDgw.js";import{L as z}from"./Logo-Cwdh3TBU.js";import{u as D,A as O}from"./useTimeOutMessage-CcdTGGpZ.js";import{I as P}from"./Input-CBgUoA_2.js";import{B as V}from"./Button-BVFxs0MY.js";import{u as G,F as J,a as f,C as j}from"./index.esm-JHelMKqY.js";import{P as K}from"./PasswordInput-vrKzQBz5.js";import{t as M,z as n}from"./index-C7G4Q7s9.js";import{A as y}from"./ActionLink-g-UgqIwz.js";import"./StatusIcon-2gdMl9nt.js";import"./isNil-NwTYd6RS.js";import"./CloseButton-B2vRxu5C.js";import"./classNames-C-yI9Dp9.js";import"./index-Dhoti6Pq.js";const Q=n.object({email:n.string({required_error:"Please enter your email"}).min(1,{message:"Please enter your email"}),password:n.string({required_error:"Please enter your password"}).min(1,{message:"Please enter your password"}),captcha_input:n.string({required_error:"Please enter the CAPTCHA"}).min(1,{message:"Please enter the CAPTCHA"}),captcha_token:n.string({required_error:"CAPTCHA token missing"}).min(1,{message:"CAPTCHA token missing"})}),X=u=>{var b,A,w;const[i,l]=p.useState(!1),[m,c]=p.useState(""),[h,d]=p.useState(""),S=B(s=>s.setUser),{disableSubmit:v=!1,className:N,setMessage:a,passwordHint:C}=u,{handleSubmit:k,formState:{errors:r},control:g,register:I}=G({defaultValues:{email:"",password:""},resolver:M(Q)}),x=async()=>{try{if(navigator.onLine){const t=(await U.get("/accounts/generate-captcha/")).data;c(t.captcha_image),d(t.captcha_token)}else throw new Error("Application is offline. Cannot load CAPTCHA.")}catch(s){console.error("Error loading CAPTCHA:",s),c(""),d("")}};p.useEffect(()=>{x()},[]);const{signIn:T}=q(),H=async s=>{const{email:t,password:_,captcha_input:E,captcha_token:F}=s;if(!v){l(!0);const o=await T({username:t,password:_,captcha_input:E,captcha_token:F});(o==null?void 0:o.status)==="failed"?o.message.includes("CAPTCHA")?(a==null||a("Incorrect CAPTCHA, please try again."),await x()):o.message.includes("400")?a==null||a("Invalid Credentials!"):a==null||a("Technical Error! Please try again or email at fdm@epd.punjab.gov.pk"):S({email:t,userName:t.split("@")[0]})}l(!1)};return e.jsx("div",{className:N,children:e.jsxs(J,{onSubmit:k(H),children:[e.jsx(f,{label:"Username",invalid:!!r.email,errorMessage:(b=r.email)==null?void 0:b.message,children:e.jsx(j,{name:"email",control:g,render:({field:s})=>e.jsx(P,{type:"text",placeholder:"Username",autoComplete:"off",...s})})}),e.jsx(f,{label:"Password",invalid:!!r.password,errorMessage:(A=r.password)==null?void 0:A.message,className:L(C&&"mb-0",((w=r.password)==null?void 0:w.message)&&"mb-8"),children:e.jsx(j,{name:"password",control:g,rules:{required:!0},render:({field:s})=>e.jsx(K,{type:"text",placeholder:"Password",autoComplete:"off",...s})})}),e.jsxs(f,{label:"Enter Captcha",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("img",{src:m,alt:"captcha",className:"h-16 w-auto rounded border shadow-sm"}),e.jsx("button",{type:"button",onClick:x,className:"text-blue-600 hover:text-blue-800",title:"Refresh CAPTCHA",children:"🔁"})]}),e.jsx(j,{name:"captcha_input",control:g,render:({field:s})=>e.jsx(P,{type:"text",placeholder:"Enter CAPTCHA text",autoComplete:"off",...s})}),e.jsx("input",{type:"hidden",value:h,...I("captcha_token")})]}),C,e.jsx(V,{block:!0,loading:i,variant:"solid",type:"submit",children:i?"Signing in...":"Sign In"})]})})},Y=({signUpUrl:u="/sign-up",forgetPasswordUrl:i="/forgot-password",disableSubmit:l})=>{const[m,c]=D(),h=R(d=>d.mode);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-8",children:e.jsx(W,{to:"/",children:e.jsx(z,{type:"streamline",mode:h,imgClass:"mx-auto",logoWidth:60})})}),e.jsxs("div",{className:"mb-10",children:[e.jsx("h2",{className:"mb-2",children:"Welcome back!"}),e.jsx("p",{className:"font-semibold heading-text",children:"Please enter your credentials to sign in!"})]}),m&&e.jsx(O,{showIcon:!0,className:"mb-4",type:"danger",children:e.jsx("span",{className:"break-all",children:m})}),e.jsx(X,{disableSubmit:l,setMessage:c,passwordHint:e.jsx("div",{className:"mb-7 mt-2",children:e.jsx(y,{to:i,className:"font-semibold heading-text mt-2 underline",themeColor:!1,children:"Forgot password"})})}),e.jsx("div",{children:e.jsxs("div",{className:"mt-6 text-center",children:[e.jsxs("span",{children:["Don't have an account yet?"," "]}),e.jsx(y,{to:u,className:"heading-text font-bold",themeColor:!1,children:"Sign up"})]})})]})},pe=()=>e.jsx(Y,{});export{Y as SignInBase,pe as default};
