import{r as p,U as I,j as S,A as L}from"./index-Bb__cgJ-.js";import{M as b}from"./index.esm-BnZPYR9O.js";import"./TextField-BO_5EaBq.js";import"./Divider-i-BDj4qK.js";import"./FormControlLabel-ajGQPHEX.js";import"./Autocomplete-Zvj1MlRj.js";import"./index-kUE2d1EK.js";const N=e=>{var r,d,h;const s=(e.assigned_group==="APPLICANT"&&e.applicationassignment||[]).filter(c=>c.assigned_group==="APPLICANT"&&c.remarks&&c.remarks!=="undefined").map(c=>c.remarks),l=s.length>0?s.join("; "):"N/A";return{id:e.id,tracking_number:e.tracking_number,first_name:e.first_name,last_name:e.last_name,CNIC:e.cnic,mobile_no:e.mobile_no,application_status:e.application_status,assigned_group:e.assigned_group,registration_for:e.registration_for,application_Start_Time:((r=e.created_at)==null?void 0:r.substring(0,16))||"N/A",application_Submission_Time:((h=(d=e.submittedapplication)==null?void 0:d.created_at)==null?void 0:h.substring(0,16))||"N/A",remarks:l}},k=e=>e.map(g=>{const s=N(g);return Object.keys(s).forEach(l=>{(s[l]===void 0||s[l]===null)&&(s[l]="N/A")}),s}),F=()=>{const[e,g]=p.useState([]),[s,l]=p.useState([]),[r,d]=p.useState([]),[h,c]=p.useState(0),[w,A]=p.useState(null),C=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],x={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},O=(i,f,t)=>{const T=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks"],u=k(i),a=u[0];console.log(i);const n=[...Object.keys(a).filter(o=>T.includes(o)).map(o=>({accessorKey:o,header:o.replace(/_/g," ").replace(/\b\w/g,_=>_.toUpperCase()),Cell:({cell:_,row:R})=>S.jsx("span",{style:{cursor:"pointer",color:"blue",textDecoration:"underline"},onClick:()=>{const D=R.original.id;console.log(`Clicked ${o}:`,_.getValue()),console.log(`Navigating with ID: ${D}`),window.location.href=f?`/spuid-review/${D}?group=${t}`:`/spuid-signup/${D}`},children:_.getValue()||"-"})}))];return{flattenedData:u,columns:n}},m=I();return p.useEffect(()=>{(async()=>{try{const t=await L.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{m("/error")}try{let t=[];try{t=(await L.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],d(t.map(n=>n.name))}catch(a){console.error("Error fetching user groups:",a),d([])}console.log("groupsResponse",t);const u=(await L.get("/pmc/license-by-user/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(u)&&u.length>0){const a=O(u,t.length>0,t.map(o=>o.name)[0]);g(a.flattenedData),l(a.columns),console.log("Flattened Data:",a.flattenedData);const n=a.flattenedData[a.flattenedData.length-1];if(console.log("Last Row:",n),n&&n.id){A(n.id),console.log("Last Row ID:",n.id);const o=C.indexOf(n.assigned_group);o!==-1&&c(o)}}}catch(t){console.error("Error fetching data:",t)}})(),A(25);const f=C.indexOf("LSO");f!==-1&&c(f)},[]),p.useEffect(()=>{console.log("userGroups:",r),r.includes("Super")?m("/home-super"):r.includes("Admin")?m("/home-admin"):r.includes("DO")&&m("/home-do")},[r,m]),S.jsx("div",{children:S.jsx(b,{columns:[...s],data:e.map(i=>({...i,assigned_group_title:x[i.assigned_group]||i.assigned_group})),getRowId:i=>i.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:100,size:140},enableColumnResizing:!0,enableTopToolbar:r.length>0,enablePagination:!0},w)})};export{F as default};
