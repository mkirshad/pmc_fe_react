import{r as g,U as E,j as c,A as S}from"./index-BKARamyo.js";import{M as F}from"./index.esm-CVVTYGQu.js";import"./TextField-Dy5Q01Zw.js";import"./Divider-TuMHcTHW.js";import"./FormControlLabel-D-gnwnG-.js";import"./Autocomplete-Bt403VW3.js";import"./index-ScwGhi-m.js";const M=t=>{var w,h,f;const p=t.applicationassignment.filter(a=>a.assigned_group===t.assigned_group),o=p.reduce((a,d)=>new Date(d.updated_at).getTime()>new Date(a.updated_at).getTime()?d:a,p[0]),l=o?(w=o.updated_at)==null?void 0:w.substring(0,16):"N/A",i=t.applicantfees?t.applicantfees.reduce((a,d)=>a+parseFloat(d.fee_amount||0),0):0,x=t.applicantfees?t.applicantfees.filter(a=>a.is_settled).reduce((a,d)=>a+parseFloat(d.fee_amount||0),0):0;return{id:t.id,application_Submission_Time:((f=(h=t.submittedapplication)==null?void 0:h.created_at)==null?void 0:f.substring(0,16))||"N/A",tracking_number:t.tracking_number,first_name:t.first_name,mobile_no:t.mobile_no,application_status:t.application_status,assigned_group:t.assigned_group,group_assignment_time:l,total_fee_amount:i.toFixed(2),verified_fee_amount:x.toFixed(2)}},I=t=>t.map(p=>{const o=M(p);return Object.keys(o).forEach(l=>{(o[l]===void 0||o[l]===null)&&(o[l]="N/A")}),o}),B=()=>{const[t,p]=g.useState([]),[o,l]=g.useState([]),[i,x]=g.useState(null),[w,h]=g.useState(0),[f,a]=g.useState(null),[d,A]=g.useState({});console.log(f);const C=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],O={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},v=async e=>{try{const s=(await S.get("/pmc/applicant-detail/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],D=R(s,!!i.length,i[0]);p(D.flattenedData),l(D.columns)}catch(u){console.error("Error fetching filtered data:",u),p([]),l([])}},R=(e,u,s)=>{const D=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","remarks","group_assignment_time","total_fee_amount","verified_fee_amount"],_=I(e),T=_[0];console.log(e);const r=[...Object.keys(T).filter(n=>D.includes(n)).map(n=>({accessorKey:n,header:n.replace(/_/g," ").replace(/\b\w/g,m=>m.toUpperCase()),size:200,Cell:({cell:m,row:y})=>{const b=`/spuid-review/${y.original.id}?group=${s}`;return c.jsx("a",{href:b,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:m.getValue()||"-"})}}))];return{flattenedData:_,columns:r}},L=E();return g.useEffect(()=>{(async()=>{try{const s=await S.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch{L("/error")}try{let s=[];try{s=(await S.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],x(s.map(n=>n.name))}catch(r){console.error("Error fetching user groups:",r),x([])}console.log("groupsResponse",s);const _=(await S.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(_)&&_.length>0){const r=R(_,s.length>0,s.map(m=>m.name)[0]);p(r.flattenedData),l(r.columns),console.log("Flattened Data:",r.flattenedData);const n=r.flattenedData[r.flattenedData.length-1];if(console.log("Last Row:",n),n&&n.id){a(n.id),console.log("Last Row ID:",n.id);const m=C.indexOf(n.assigned_group);m!==-1&&h(m)}}const T=await S.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});A(T.data)}catch(s){console.error("Error fetching data:",s)}})(),a(25);const u=C.indexOf("LSO");u!==-1&&h(u)},[]),g.useEffect(()=>{console.log("userGroups:",i),i&&!i.includes("Super")&&L("/home")},[i,L]),console.log("selectedRowId:",f),console.log(f),c.jsxs("div",{children:[c.jsx("div",{className:"tiles-container",children:Object.entries(d).map(([e,u])=>c.jsxs("div",{className:"tile",style:{cursor:"pointer"},onClick:()=>v(e),children:[c.jsx("h3",{children:O[e]||e})," ",c.jsx("p",{children:u})]},e))}),c.jsx("div",{className:"mb-4",children:c.jsxs("h3",{children:[i&&i.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),c.jsx(F,{columns:[...o],data:t.map(e=>({...e,assigned_group_title:O[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:1,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},f)]})};export{B as default};
