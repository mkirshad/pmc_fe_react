import{r as u,U as z,j as a,A as D}from"./index-Bb__cgJ-.js";import{M as P}from"./index.esm-BnZPYR9O.js";import"./TextField-BO_5EaBq.js";import"./Divider-i-BDj4qK.js";import"./FormControlLabel-ajGQPHEX.js";import"./Autocomplete-Zvj1MlRj.js";import"./index-kUE2d1EK.js";const B=n=>{const d=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],g=d.indexOf(n.assigned_group),r=n.applicationassignment||[],o=(()=>{if(r.length>1){const S=r[r.length-2];return d.indexOf(S.assigned_group)}return-1})(),L=o!==-1&&o>g;return r.find(S=>d.indexOf(S.assigned_group)===o),{id:n.id,tracking_number:n.tracking_number,first_name:n.first_name,last_name:n.last_name,CNIC:n.cnic,mobile_no:n.mobile_no,application_status:n.application_status,assigned_group:n.assigned_group,registration_for:n.registration_for,remarks:n.remarks||"N/A",is_assigned_back:L?"Yes":"No"}},G=n=>n.map(d=>{const g=B(d);return Object.keys(g).forEach(r=>{(g[r]===void 0||g[r]===null)&&(g[r]="N/A")}),g}),J=()=>{const[n,d]=u.useState([]),[g,r]=u.useState([]),[o,L]=u.useState(null),[S,A]=u.useState(0),[y,T]=u.useState(null),[k,I]=u.useState({}),[j,E]=u.useState(null),[M,O]=u.useState(!1),N=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","Download License"],R={APPLICANT:"Applicant",LSO:"LSO",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO","Download License":"Download License"},F=async e=>{try{if(O(!0),E(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const p=e==="LSO1"?1:e==="LSO2"?2:0,m=((await D.get("/pmc/applicant-detail-main-do-list/",{params:{assigned_group:"LSO"}})).data||[]).filter(_=>{var h;return((h=_.submittedapplication)==null?void 0:h.id)%3===p}),s=C(m,!!o.length,o[0]);d(s.flattenedData),r(s.columns)}else{const f=(await D.get("/pmc/applicant-detail-main-do-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],m=C(f,!!o.length,o[0]);d(m.flattenedData),r(m.columns)}}catch(p){console.error("Error fetching filtered data:",p),d([]),r([])}finally{O(!1)}},C=(e,p,f)=>{const m=["first_name","CNIC","mobile_no","tracking_number","registration_for","days_pending_for","remarks","is_assigned_back"],s=G(e),_=s[0],h=[...Object.keys(_).filter(c=>m.includes(c)).map(c=>{let i=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(c)?i=120:["first_name"].includes(c)&&(i=180),c==="is_assigned_back"?{accessorKey:c,header:"Assigned Back",size:i,Filter:({column:t})=>a.jsxs("select",{value:t.getFilterValue()||"",onChange:l=>t.setFilterValue(l.target.value||void 0),style:{width:"100%",padding:"4px"},children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"Yes",children:"Yes"}),a.jsx("option",{value:"",children:"No"})]}),filterFn:(t,l,x)=>x===""||t.original[c]===x,Cell:({cell:t,row:l})=>{const x=l.original.id,w=l.original.is_assigned_back,v=`/spuid-review/${x}?group=${f}`;return a.jsx("a",{href:v,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:w==="Yes"?"red":"blue",textDecoration:"underline"},children:t.getValue()||"-"})}}:{accessorKey:c,header:c.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()),size:i,Cell:({cell:t,row:l})=>{const x=l.original.id,w=l.original.is_assigned_back,v=`/spuid-review/${x}?group=${f}`;return a.jsx("a",{href:v,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:w==="Yes"?"red":"blue",textDecoration:"underline"},children:t.getValue()||"-"})}}})];return{flattenedData:s,columns:h}},b=z();return u.useEffect(()=>{(async()=>{var f,m;O(!0);try{const s=await D.get("/pmc/ping/",{headers:{"Content-Type":"application/json"}})}catch(s){const _={status:(f=s.response)==null?void 0:f.status,data:(m=s.response)==null?void 0:m.data,message:s.message};b("/error",{state:{error:_}})}try{let s=[];try{s=(await D.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],L(s.map(t=>t.name))}catch(i){console.error("Error fetching user groups:",i),L([])}console.log("groupsResponse",s);const h=(await D.get("/pmc/applicant-detail/",{headers:{"Content-Type":"multipart/form-data"}})).data;if(Array.isArray(h)&&h.length>0){const i=C(h,s.length>0,s.map(l=>l.name)[0]);d(i.flattenedData),r(i.columns),console.log("Flattened Data:",i.flattenedData);const t=i.flattenedData[i.flattenedData.length-1];if(console.log("Last Row:",t),t&&t.id){T(t.id),console.log("Last Row ID:",t.id);const l=N.indexOf(t.assigned_group);l!==-1&&A(l)}}const c=await D.get("/pmc/fetch-statistics-do-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});I(c.data)}catch(s){console.error("Error fetching data:",s)}finally{O(!1)}})(),T(25);const p=N.indexOf("LSO");p!==-1&&A(p)},[]),u.useEffect(()=>{console.log("userGroups:",o),o&&!o.includes("DO")&&b("/home")},[o,b]),console.log("selectedRowId:",y),console.log(y),a.jsxs("div",{children:[a.jsx("div",{className:"tiles-container",children:Object.entries(k).map(([e,p])=>a.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:j===e?"#007BFF":"#f8f9fa",color:j===e?"#fff":"#000"},onClick:()=>F(e),children:[a.jsx("h3",{children:R[e]||e})," ",a.jsx("p",{children:p})]},e))}),a.jsx("div",{className:"mb-4",children:a.jsxs("h3",{children:[o&&o.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),M?a.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[a.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),a.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):a.jsx(P,{columns:[...g],data:n.map(e=>({...e,assigned_group_title:R[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:420,minSize:200,size:100},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0})]})};export{J as default};
