import{r as d,W as z,j as i,A}from"./index-D_1ywQiJ.js";import{M as G}from"./index.esm-3J9xzOfP.js";import"./TextField-CPU8Ag7R.js";import"./DefaultPropsProvider-CJ9uD5E9.js";import"./Autocomplete-BaIPv15Y.js";import"./FormControlLabel-Ixjg_-Gq.js";import"./Divider-DLY9MfWN.js";import"./index-55mwKGyU.js";const P=t=>{var L,x,w,h,b,O;const u=a=>new Intl.NumberFormat("en-PK",{style:"currency",currency:"PKR",minimumFractionDigits:2}).format(a),r=t.applicationassignment.filter(a=>a.assigned_group===t.assigned_group),s=r.reduce((a,o)=>new Date(o.updated_at).getTime()>new Date(a.updated_at).getTime()?o:a,r[0]),n=s?(L=s.updated_at)==null?void 0:L.substring(0,16):"N/A";let g="N/A";if(s&&s.updated_at){const a=new Date(s.updated_at),f=new Date-a;g=Math.floor(f/(1e3*60*60*24))}let y="N/A";if((x=t.submittedapplication)!=null&&x.created_at&&((w=t.submittedapplication)!=null&&w.created_at)){const a=new Date((h=t.submittedapplication)==null?void 0:h.created_at),f=new Date-a;y=Math.floor(f/(1e3*60*60*24))}const C=t.applicantfees?t.applicantfees.reduce((a,o)=>a+parseFloat(o.fee_amount||0),0):0,D=t.applicantfees?t.applicantfees.filter(a=>a.is_settled).reduce((a,o)=>a+parseFloat(o.fee_amount||0),0):0;return{id:t.id,application_Submission_Time:((O=(b=t.submittedapplication)==null?void 0:b.created_at)==null?void 0:O.substring(0,16))||"N/A",duration:y,tracking_number:t.tracking_number,first_name:t.first_name,last_name:t.last_name,mobile_no:t.mobile_no,application_status:t.application_status,assigned_group:t.assigned_group,group_assignment_time:n,group_assignment_days:g,total_fee_amount:u(C.toFixed(2)),verified_fee_amount:u(D.toFixed(2)),created_by_username:t.created_by_username}},k=t=>t.map(u=>{const r=P(u);return Object.keys(r).forEach(s=>{(r[s]===void 0||r[s]===null)&&(r[s]="N/A")}),r}),q=()=>{const[t,u]=d.useState([]),[r,s]=d.useState([]),[n,g]=d.useState(null),[y,C]=d.useState(0),[D,L]=d.useState(null),[x,w]=d.useState({}),[h,b]=d.useState(null),[O,a]=d.useState(!1),o=["APPLICANT","LSO","LSM","DO","LSM2","TL","DEO","DG","Download License"],f={APPLICANT:"Applicant",LSO:"LSO",LSO1:"Sana",LSO2:"Qaisar",LSO3:"Ameer",LSM:"LSM",DO:"DO",LSM2:"LSM",TL:"TL",DEO:"DEO",DG:"DG","Download License":"Download License"},M=async e=>{try{if(a(!0),b(e),e==="LSO1"||e==="LSO2"||e==="LSO3"){const l=e==="LSO1"?1:e==="LSO2"?2:0,m=((await A.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:"LSO"}})).data||[]).filter(S=>{var T;return((T=S.submittedapplication)==null?void 0:T.id)%3===l}),p=F(m,!!n.length,n[0]);u(p.flattenedData),s(p.columns)}else{const c=(await A.get("/pmc/applicant-detail-main-list/",{params:{assigned_group:e!=="All-Applications"&&e!=="Challan-Downloaded"?e:void 0,application_status:e==="Challan-Downloaded"?"Fee Challan":void 0}})).data||[],m=F(c,!!n.length,n[0]);u(m.flattenedData),s(m.columns)}}catch(l){console.error("Error fetching filtered data:",l),u([]),s([])}finally{a(!1)}},F=(e,l,c)=>{const m=["first_name","last_name","cnic","mobile_no","application_status","tracking_number","assigned_group","registration_for","application_Start_Time","application_Submission_Time","duration","remarks","group_assignment_days","total_fee_amount","verified_fee_amount","created_by_username"],p=k(e),S=p[0],T=[...Object.keys(S).filter(_=>m.includes(_)).map(_=>{let v=160;return["mobile_no","application_status","assigned_group","total_fee_amount"].includes(_)?v=120:["first_name"].includes(_)&&(v=180),{accessorKey:_,header:_.replace(/_/g," ").replace(/\b\w/g,N=>N.toUpperCase()),size:v,Cell:({cell:N,row:E})=>{const I=`/spuid-review/${E.original.id}?group=${c}`;return i.jsx("a",{href:I,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer",color:"blue",textDecoration:"underline"},children:N.getValue()||"-"})}}})];return{flattenedData:p,columns:T}},R=z();return d.useEffect(()=>{(async()=>{a(!0);try{let c=[];try{c=(await A.get("/pmc/user-groups/",{headers:{"Content-Type":"application/json"}})).data||[],g(c.map(S=>S.name))}catch(p){console.error("Error fetching user groups:",p),g([])}console.log("groupsResponse",c);const m=await A.get("/pmc/fetch-statistics-view-groups/",{headers:{"Content-Type":"multipart/form-data"}});w(m.data)}catch(c){console.error("Error fetching data:",c)}finally{a(!1)}})(),L(25);const l=o.indexOf("LSO");l!==-1&&C(l)},[]),d.useEffect(()=>{console.log("userGroups:",n),n&&!n.includes("Admin")&&R("/home")},[n,R]),console.log("selectedRowId:",D),console.log(D),i.jsxs("div",{children:[i.jsx("div",{className:"tiles-container",children:Object.entries(x).map(([e,l])=>i.jsxs("div",{className:"tile",style:{cursor:"pointer",backgroundColor:h===e?"#007BFF":"#f8f9fa",color:h===e?"#fff":"#000"},onClick:()=>M(e),children:[i.jsx("h3",{children:f[e]||e})," ",i.jsx("p",{children:l})]},e))}),i.jsx("div",{className:"mb-4",children:i.jsxs("h3",{children:[n&&n.filter(e=>e!=="Download License"&&e!=="Applicant"&&e!=="LSM2").join(" - ")," Dashboard"]})}),O?i.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-gray-50",children:[i.jsx("div",{className:"w-16 h-16 border-4 border-blue-400 border-t-transparent border-solid rounded-full animate-spin"}),i.jsx("p",{className:"mt-4 text-lg font-medium text-gray-600",children:"Loading data, please wait..."})]}):i.jsx(G,{columns:[...r],data:t.map(e=>({...e,assigned_group_title:f[e.assigned_group]||e.assigned_group})),getRowId:e=>e.id,initialState:{showColumnFilters:!1},defaultColumn:{maxSize:200,minSize:1,size:50},enableColumnResizing:!0,columnResizeMode:"onChange",enableTopToolbar:!0,enablePagination:!0},D)]})};export{q as default};
