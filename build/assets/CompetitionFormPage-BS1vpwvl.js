import{j as e,a2 as x,A as y}from"./index-ClCfYMYi.js";import{a as c,C as p,u as k,F as N}from"./index.esm-CyTI7Qgj.js";import{t as w,z as l}from"./index-DuAGPkoH.js";import{B as _}from"./BottomStickyBar-5tecdzRG.js";import{C as P}from"./Card-w04iuF6T.js";import{I as g}from"./Input-Ba2kNzo2.js";import{S}from"./Select-BQ-LJTux.js";import{I as L}from"./index-CAPOa5Cx.js";import{B as I}from"./Button-DBt4BUHC.js";import{B as T}from"./index-BAswmQLO.js";import"./classNames-CBqcFvs1.js";import"./index-DkUzVkBg.js";import"./isNil-ypH6BUNe.js";import"./setPrototypeOf-C3V6guyq.js";import"./emotion-element-f0de968e.browser.esm-T8ABZb-b.js";import"./assertThisInitialized-CcP38MDu.js";import"./floating-ui.dom-CrKScG7J.js";const B=[{label:"Poster",value:"poster"},{label:"Painting",value:"painting"},{label:"3D Model",value:"3d_model"}],F=["8th","9th","10th","Intermediate","O Level","A Level","BS","MS","MPhil","PhD"].map(n=>({label:n,value:n})),M=n=>{const i=["BS","MS","MPhil","PhD"],d=["8th","9th","10th","Intermediate","O Level","A Level"];return i.includes(n)?"University":d.includes(n)?"School":""},D={School:["poster","painting","3d_model"],University:["poster","painting"]},R=({control:n,errors:i,readOnly:d=!1,watch:h})=>{var s,o,m,j,u,b;const f=h("grade"),v=M(f),C=B.filter(a=>{var t;return(t=D[v])==null?void 0:t.includes(a.value)});return e.jsxs(P,{children:[e.jsx("h4",{className:"mb-6",children:"Competition Registration"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(c,{label:"Full Name *",invalid:!!i.fullName,errorMessage:(s=i.fullName)==null?void 0:s.message,children:e.jsx(p,{name:"fullName",control:n,render:({field:a})=>e.jsx(g,{placeholder:"Full Name",readOnly:d,...a})})}),e.jsx(c,{label:"Institute Name *",invalid:!!i.institute,errorMessage:(o=i.institute)==null?void 0:o.message,children:e.jsx(p,{name:"institute",control:n,render:({field:a})=>e.jsx(g,{placeholder:"Institute Name",readOnly:d,...a})})}),e.jsx(c,{label:"Grade *",invalid:!!i.grade,errorMessage:(m=i.grade)==null?void 0:m.message,children:e.jsx(p,{name:"grade",control:n,render:({field:a})=>e.jsx(S,{options:F,value:F.find(t=>t.value===a.value),isDisabled:d,onChange:t=>a.onChange(t==null?void 0:t.value)})})}),e.jsx(c,{label:"Auto-detected Category",children:e.jsx(g,{value:M(h("grade")),readOnly:!0})}),e.jsx(c,{label:"Competition Type *",invalid:!!i.competitionType,errorMessage:(j=i.competitionType)==null?void 0:j.message,children:e.jsx(p,{name:"competitionType",control:n,render:({field:a})=>e.jsx(S,{options:C,value:B.find(t=>t.value===a.value),isDisabled:d,onChange:t=>a.onChange(t==null?void 0:t.value)})})}),e.jsx(c,{label:"Mobile Number *",invalid:!!i.mobile,errorMessage:(u=i.mobile)==null?void 0:u.message,children:e.jsx(p,{name:"mobile",control:n,render:({field:a})=>e.jsx(L,{mask:"3999999999",value:a.value,readOnly:d,onChange:t=>a.onChange(t.target.value),children:t=>e.jsx(g,{placeholder:"Mobile",...t})})})}),e.jsx(c,{label:"Student Card Front *",invalid:!!i.studentCardFront,errorMessage:(b=i.studentCardFront)==null?void 0:b.message,children:e.jsx(p,{name:"studentCardFront",control:n,render:({field:a})=>e.jsx(g,{type:"file",accept:"image/*",capture:"environment",onChange:t=>{var r;return a.onChange((r=t.target.files)==null?void 0:r[0])}})})}),e.jsx(c,{label:"Student Card Back",children:e.jsx(p,{name:"studentCardBack",control:n,render:({field:a})=>e.jsx(g,{type:"file",accept:"image/*",capture:"environment",onChange:t=>{var r;return a.onChange((r=t.target.files)==null?void 0:r[0])}})})})]})]})},A=l.object({fullName:l.string().min(1,{message:"Required"}),institute:l.string().min(1,{message:"Required"}),grade:l.string().min(1),competitionType:l.string().min(1),mobile:l.string().min(10).max(10),studentCardFront:l.instanceof(File,{message:"Student Card (Front) is required"}).refine(n=>n.size<=10*1024*1024,{message:"Student Card (Front) must be smaller than 10MB"}),studentCardBack:l.union([l.instanceof(File),l.null(),l.undefined()]).optional().refine(n=>n==null?!0:n.size<=10*1024*1024,{message:"Back Student Card must be a file smaller than 10 MB."}).optional()}),te=()=>{const{handleSubmit:n,control:i,formState:{errors:d},reset:h,watch:f}=k({resolver:w(A),defaultValues:{fullName:"",institute:"",grade:"",category:"",competitionType:"",mobile:""}}),v=s=>{const o=["BS","MS","MPhil","PhD"],m=["8th","9th","10th","Intermediate","O Level","A Level"];return o.includes(s)?"University":m.includes(s)?"School":""},C=async s=>{const o=new FormData;o.append("full_name",s.fullName),o.append("institute",s.institute),o.append("grade",s.grade),o.append("category",v(s.grade)),o.append("competition_type",s.competitionType),o.append("mobile",s.mobile),o.append("student_card_front",s.studentCardFront),s.studentCardBack instanceof File&&o.append("student_card_back",s.studentCardBack);try{const m={"Content-Type":"multipart/form-data"},u=(await y.post("/pmc/competition/register/",o,{headers:m})).data;if(u.success){alert(`Registration Successful! Your ID is ${u.registration_id}

ðŸ“¦ The courier label will now be downloaded.
Please print it and paste it on your courier package before dispatching your competition submission to the Plastic Management Cell.`);const b=await y.get(`/pmc/competition/generate-label/?registration_id=${u.registration_id}`,{responseType:"blob"}),a=new Blob([b.data],{type:"application/pdf"}),t=window.URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.setAttribute("download",`courier_label_${u.registration_id}.pdf`),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(t),h({fullName:"",institute:"",grade:"",category:"",competitionType:"",mobile:"",studentCardFront:void 0,studentCardBack:void 0})}else alert("Something went wrong. Please try again.")}catch(m){console.error("Submission failed:",m),alert("Error submitting the form. Please try again later.")}};return e.jsxs(N,{onSubmit:n(C),children:[e.jsx(x,{children:e.jsx(R,{control:i,errors:d,readOnly:!1,watch:f})}),e.jsx(_,{children:e.jsx(x,{className:"flex justify-end",children:e.jsx(I,{icon:e.jsx(T,{}),variant:"solid",type:"submit",children:"Submit & Generate Slip"})})})]})};export{te as default};
